/*!
 * excalibur - 0.30.3 - 2025-1-1
 * https://github.com/excaliburjs/Excalibur
 * Copyright (c) 2025 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
 * Licensed BSD-2-Clause
 * @preserve
 */var Hc={851:(n,t,e)=>{e.d(t,{A:()=>h});var i=e(1),s=e.n(i),r=e(935),o=e.n(r),a=o()(s());a.push([n.id,`/* Buttons styles start */

button#excalibur-play {
  display: inline-block;
  position: relative;
  z-index: 999;
  border-radius: 6px;
  border: none;
  /*border: 3px solid;
    border-color: white;
    box-shadow: 0 0 10px #ccc;*/
  padding: 1rem 1.5rem 1rem 4rem;
  margin: 0;
  text-decoration: none;
  background: #00b233;
  color: #ffffff;
  font-family: sans-serif;
  font-size: 2rem;
  white-space: nowrap;
  line-height: 1;
  cursor: pointer;
  text-align: center;
  transition:
    background 250ms ease-in-out,
    transform 150ms ease;
  -webkit-appearance: none;
  -moz-appearance: none;

  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */
  animation: excalibur-button-fadein 200ms;
}

/*
button#excalibur-play {
  display: none;
}*/

button#excalibur-play:after {
  position: absolute;
  content: '';
  border: 8px solid;
  border-color: transparent transparent transparent white;
  left: 35px;
  top: 24px;
  width: 0;
  height: 0;
}

button#excalibur-play:before {
  position: absolute;
  content: '';
  border: 3px solid;
  left: 19px;
  top: 14px;
  border-radius: 20px;
  width: 30px;
  height: 30px;
}

button#excalibur-play:hover,
button#excalibur-play:focus {
  background: #00982c;
}

button#excalibur-play:focus {
  outline: 1px solid #fff;
  outline-offset: -4px;
}

button#excalibur-play:active {
  transform: scale(0.99);
}

@keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Firefox < 16 */
@-moz-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Internet Explorer */
@-ms-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Opera < 12.1 */
@-o-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
`,"",{version:3,sources:["webpack://./Director/Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB;;wBAEsB;EACtB,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:[`/* Buttons styles start */\r
\r
button#excalibur-play {\r
  display: inline-block;\r
  position: relative;\r
  z-index: 999;\r
  border-radius: 6px;\r
  border: none;\r
  /*border: 3px solid;\r
    border-color: white;\r
    box-shadow: 0 0 10px #ccc;*/\r
  padding: 1rem 1.5rem 1rem 4rem;\r
  margin: 0;\r
  text-decoration: none;\r
  background: #00b233;\r
  color: #ffffff;\r
  font-family: sans-serif;\r
  font-size: 2rem;\r
  white-space: nowrap;\r
  line-height: 1;\r
  cursor: pointer;\r
  text-align: center;\r
  transition:\r
    background 250ms ease-in-out,\r
    transform 150ms ease;\r
  -webkit-appearance: none;\r
  -moz-appearance: none;\r
\r
  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\r
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\r
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\r
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\r
  animation: excalibur-button-fadein 200ms;\r
}\r
\r
/*\r
button#excalibur-play {\r
  display: none;\r
}*/\r
\r
button#excalibur-play:after {\r
  position: absolute;\r
  content: '';\r
  border: 8px solid;\r
  border-color: transparent transparent transparent white;\r
  left: 35px;\r
  top: 24px;\r
  width: 0;\r
  height: 0;\r
}\r
\r
button#excalibur-play:before {\r
  position: absolute;\r
  content: '';\r
  border: 3px solid;\r
  left: 19px;\r
  top: 14px;\r
  border-radius: 20px;\r
  width: 30px;\r
  height: 30px;\r
}\r
\r
button#excalibur-play:hover,\r
button#excalibur-play:focus {\r
  background: #00982c;\r
}\r
\r
button#excalibur-play:focus {\r
  outline: 1px solid #fff;\r
  outline-offset: -4px;\r
}\r
\r
button#excalibur-play:active {\r
  transform: scale(0.99);\r
}\r
\r
@keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Firefox < 16 */\r
@-moz-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Safari, Chrome and Opera > 12.1 */\r
@-webkit-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Internet Explorer */\r
@-ms-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Opera < 12.1 */\r
@-o-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
`],sourceRoot:""}]);const h=a},296:(n,t,e)=>{e.d(t,{A:()=>h});var i=e(1),s=e.n(i),r=e(935),o=e.n(r),a=o()(s());a.push([n.id,`#ex-toast-container {
  position: absolute;
  height: 0;
  min-width: 50%;
  left: 50%;
  top: 0;
}

.ex-toast-message {
  left: -50%;
  position: relative;
  display: flex;
  justify-content: space-between;

  padding: 10px;
  margin-top: 5px;
  font-size: 18px;
  font-family: sans-serif;
  border-radius: 6px;
  border: 3px solid #b7b779;
  background-color: rgb(253, 253, 192);
}

.ex-toast-message button {
  align-self: flex-start;
}
`,"",{version:3,sources:["webpack://./Util/Toaster.css"],names:[],mappings:"AAAA;EACE,kBAAkB;EAClB,SAAS;EACT,cAAc;EACd,SAAS;EACT,MAAM;AACR;;AAEA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,8BAA8B;;EAE9B,aAAa;EACb,eAAe;EACf,eAAe;EACf,uBAAuB;EACvB,kBAAkB;EAClB,yBAAyB;EACzB,oCAAoC;AACtC;;AAEA;EACE,sBAAsB;AACxB",sourcesContent:[`#ex-toast-container {\r
  position: absolute;\r
  height: 0;\r
  min-width: 50%;\r
  left: 50%;\r
  top: 0;\r
}\r
\r
.ex-toast-message {\r
  left: -50%;\r
  position: relative;\r
  display: flex;\r
  justify-content: space-between;\r
\r
  padding: 10px;\r
  margin-top: 5px;\r
  font-size: 18px;\r
  font-family: sans-serif;\r
  border-radius: 6px;\r
  border: 3px solid #b7b779;\r
  background-color: rgb(253, 253, 192);\r
}\r
\r
.ex-toast-message button {\r
  align-self: flex-start;\r
}\r
`],sourceRoot:""}]);const h=a},935:n=>{n.exports=function(t){var e=[];return e.toString=function(){return this.map(function(s){var r="",o=typeof s[5]<"u";return s[4]&&(r+="@supports (".concat(s[4],") {")),s[2]&&(r+="@media ".concat(s[2]," {")),o&&(r+="@layer".concat(s[5].length>0?" ".concat(s[5]):""," {")),r+=t(s),o&&(r+="}"),s[2]&&(r+="}"),s[4]&&(r+="}"),r}).join("")},e.i=function(s,r,o,a,h){typeof s=="string"&&(s=[[null,s,void 0]]);var l={};if(o)for(var c=0;c<this.length;c++){var d=this[c][0];d!=null&&(l[d]=!0)}for(var A=0;A<s.length;A++){var u=[].concat(s[A]);o&&l[u[0]]||(typeof h<"u"&&(typeof u[5]>"u"||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=h),r&&(u[2]&&(u[1]="@media ".concat(u[2]," {").concat(u[1],"}")),u[2]=r),a&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=a):u[4]="".concat(a)),e.push(u))}},e}},1:n=>{n.exports=function(t){var e=t[1],i=t[3];if(!i)return e;if(typeof btoa=="function"){var s=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),o="/*# ".concat(r," */");return[e].concat([o]).join(`
`)}return[e].join(`
`)}}},rh={};function le(n){var t=rh[n];if(t!==void 0)return t.exports;var e=rh[n]={id:n,exports:{}};return Hc[n](e,e.exports,le),e.exports}le.n=n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return le.d(t,{a:t}),t};le.d=(n,t)=>{for(var e in t)le.o(t,e)&&!le.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})};le.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);le.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var _={};le.d(_,{eKr:()=>ma,yVm:()=>Gr,a7j:()=>Vh,U_w:()=>Na,JF2:()=>_a,htg:()=>ms,HXL:()=>Fa,mcg:()=>da,Agj:()=>ye,J3_:()=>$d,Wgv:()=>va,u6S:()=>Sd,x7M:()=>te,X55:()=>ze,m3M:()=>Js,aE5:()=>bd,YJU:()=>Ge,eZi:()=>wo,GNv:()=>tr,Y56:()=>xo,_0v:()=>An,vhs:()=>sn,vrQ:()=>Ur,Z8b:()=>fl,Yfw:()=>Bt,IcQ:()=>ht,kgJ:()=>Io,GTT:()=>Xl,ypY:()=>or,i7d:()=>Dl,fQ3:()=>iu,HlI:()=>Sn,jlt:()=>Qn,VQc:()=>ge,zD7:()=>Ua,AUF:()=>ri,JoF:()=>Oi,MlA:()=>ee,PZh:()=>ji,qA:()=>$s,CrD:()=>bi,dQK:()=>si,D3r:()=>je,Qpo:()=>cn,D9n:()=>ln,b6v:()=>Ks,mvh:()=>Fn,Bpo:()=>gt,Q1f:()=>q,IKv:()=>Vl,fcV:()=>Ki,Glf:()=>Yl,uAl:()=>Ue,ElT:()=>he,Z8r:()=>Wo,QSL:()=>Gl,sPV:()=>hn,nAn:()=>Ii,zCU:()=>an,QrV:()=>Ae,fF9:()=>Mu,Jqv:()=>Cl,d_u:()=>yl,xI8:()=>ua,yar:()=>ae,SP7:()=>Zl,oRy:()=>Dn,f5X:()=>Pa,V1c:()=>jo,Mlx:()=>Jl,ZiM:()=>Eo,ZCo:()=>er,J5p:()=>Kl,mL_:()=>be,Guw:()=>ml,N5j:()=>jh,pgY:()=>vl,OP3:()=>nn,rl5:()=>ic,eod:()=>du,q5Z:()=>oe,YUC:()=>xa,saR:()=>un,hvr:()=>Bo,Qol:()=>pl,Wf4:()=>gl,JCs:()=>Mt,gJV:()=>Se,fWD:()=>Tl,Va_:()=>Di,N$8:()=>xe,_jQ:()=>uu,rxj:()=>pa,rhv:()=>ga,wCu:()=>_e,HAp:()=>Dd,Zy1:()=>Fl,bkB:()=>Nt,wfL:()=>on,sVA:()=>Ho,$Gs:()=>ya,CJ0:()=>dn,NWh:()=>wi,tWi:()=>fa,xAj:()=>Aa,zWh:()=>_l,i_4:()=>Ru,iIx:()=>de,Hxo:()=>wl,c9e:()=>mo,KQV:()=>is,weH:()=>kt,jXp:()=>ku,zzY:()=>rn,yRQ:()=>tn,MtE:()=>$l,rPj:()=>hr,KLc:()=>ke,Fir:()=>bt,V5f:()=>Jo,Xj7:()=>Ko,Wud:()=>Zr,FVg:()=>ha,g5Y:()=>aa,YQB:()=>na,KPb:()=>oa,nHK:()=>Mn,Jrb:()=>nc,TX_:()=>Pu,Olt:()=>hc,r3n:()=>Es,Fvk:()=>fu,gpR:()=>gn,vYh:()=>qt,hnk:()=>Wt,D2R:()=>bs,n1o:()=>Qa,h9O:()=>Nl,X5j:()=>ei,p3P:()=>Da,RLG:()=>ca,fBU:()=>Ia,Adb:()=>ie,bEs:()=>ii,wCy:()=>Pt,CbD:()=>Ut,x_C:()=>Us,pGf:()=>La,ibQ:()=>Ol,shR:()=>nr,Yjk:()=>Ra,_u1:()=>_u,OBI:()=>oc,klh:()=>qs,s3S:()=>ql,D$R:()=>ar,xth:()=>En,JU7:()=>Au,h9x:()=>Pl,N1A:()=>za,e_k:()=>Yt,aHM:()=>ns,tlv:()=>Od,Vi9:()=>Sl,ieR:()=>Bl,$bb:()=>se,VyI:()=>lt,imn:()=>Nh,uqu:()=>Be,QnL:()=>oo,vnc:()=>Ca,wk_:()=>vo,GH0:()=>Dt,_1r:()=>kn,l0X:()=>fo,bT:()=>el,HHX:()=>_o,jtW:()=>sl,tjk:()=>Ti,rWe:()=>Wi,j9l:()=>qh,l0$:()=>Ha,sGJ:()=>pi,NVp:()=>Ea,cPK:()=>ve,XoL:()=>Ma,RmF:()=>we,DXI:()=>Pn,tCD:()=>mu,J3D:()=>Bn,vCJ:()=>gu,e6k:()=>Oh,f9l:()=>Ze,v9m:()=>Un,yRJ:()=>zl,EU6:()=>bo,m3O:()=>Ai,Ryz:()=>Ri,OxP:()=>Ws,LEs:()=>Ln,Ec:()=>es,Pi5:()=>Rn,gmH:()=>gi,tS:()=>Oa,XxX:()=>ue,bCz:()=>In,nYS:()=>rs,yiT:()=>ia,NHl:()=>Ls,mO8:()=>ra,PXI:()=>Xo,bn5:()=>ta,Ywr:()=>zi,cMd:()=>ss,Bs6:()=>ea,G0k:()=>Ms,pyn:()=>sa,QeM:()=>Zo,aPX:()=>au,ITP:()=>$o,BY0:()=>Ni,MFw:()=>Rr,sBn:()=>kr,S3L:()=>As,XKQ:()=>sr,ESI:()=>Rl,uxz:()=>Ql,o8N:()=>Ds,u_r:()=>Rs,RlV:()=>Yi,gVA:()=>yo,M_G:()=>Mr,BpG:()=>wa,GRB:()=>Qd,kM6:()=>Zh,dO8:()=>Xh,jgM:()=>uo,FWq:()=>Pr,s3j:()=>Jc,hlw:()=>al,L0q:()=>ol,B7e:()=>nl,PGN:()=>rl,H_X:()=>Ht,S_d:()=>Al,_Tq:()=>ul,U7E:()=>cl,IOH:()=>ll,Z58:()=>Qe,yh2:()=>hu,ff$:()=>Ao,cWi:()=>Qh,NBt:()=>Sa,oNz:()=>Ud,QlU:()=>jl,Xey:()=>Pi,jft:()=>zu,_r8:()=>Kt,bTC:()=>Yh,Mtr:()=>Ie,ypk:()=>pe,mnM:()=>Ft,q7S:()=>Lu,bAZ:()=>ir,ABN:()=>Wh,VK6:()=>zd,Hj2:()=>ka,Df8:()=>Co,oOx:()=>Is,kxk:()=>We,DT1:()=>bn,FLG:()=>Zi,qN_:()=>Ga,Z37:()=>Tn,FtL:()=>El,Z6X:()=>ac,iQT:()=>Fe,ziO:()=>Ll,OEF:()=>ci,uuE:()=>Te,tiv:()=>rr,T$Y:()=>tc,EYj:()=>Fr,nOB:()=>en,Tap:()=>zt,FAs:()=>Il,B_P:()=>bl,aA5:()=>eu,J3s:()=>qa,Y0Q:()=>Dr,M4G:()=>Ji,l$l:()=>ec,dLy:()=>xi,WZP:()=>tt,eB6:()=>Gn,nFK:()=>po,l9z:()=>kl,YOF:()=>su,yhB:()=>re,J0N:()=>qo,Miz:()=>E,Bj4:()=>ho,Rcs:()=>hi,vJ4:()=>Ei,TqC:()=>ba,nM0:()=>la,X1u:()=>Xi,SpZ:()=>Hh,DX8:()=>vs,Yx$:()=>Wl,HK4:()=>Ul,yt5:()=>Sh,vAR:()=>pu,SE$:()=>vi,qE8:()=>It,Pz7:()=>lc,sX_:()=>ts,JuI:()=>qc,pxT:()=>yi,Nl$:()=>Vo,zDr:()=>Bu,OwT:()=>Cu,P$G:()=>Eu,mHV:()=>bu,kEA:()=>Su,Fx_:()=>Qu,WFC:()=>Tu,vKu:()=>wu,aDq:()=>vu,jIg:()=>Iu,UH3:()=>xu,AJO:()=>yu,U4:()=>Kh,xAc:()=>$h,_3Y:()=>Kd,K6X:()=>Td,C1Y:()=>zh,Aw1:()=>go,tm8:()=>tl,LBV:()=>il,A8$:()=>Pd,F5e:()=>Jd,ran:()=>Xd,c8L:()=>dl,o6M:()=>hl,hsx:()=>$e,l9E:()=>xl,aSf:()=>Ml,CcK:()=>Jh,nU8:()=>Ba,td6:()=>Lr,Zex:()=>cc,bkJ:()=>Rt,mXP:()=>Gu,vt$:()=>Fs,hCA:()=>Ve,pjR:()=>yt,U43:()=>ti,pSZ:()=>Yc,y17:()=>jc,Ew7:()=>li,hG1:()=>Zd,jVr:()=>Uu,_SZ:()=>Lt,xWn:()=>Th,ehJ:()=>Wc,t6s:()=>T,Eyn:()=>zo});var zo={};le.r(zo);le.d(zo,{getAttributeComponentSize:()=>Uh,getAttributePointerType:()=>Gh,getGLTypeFromSource:()=>Lh,getGlTypeSizeBytes:()=>ao,getMaxShaderComplexity:()=>Yo,isAttributeInSource:()=>Mh});var Oo={};le.r(Oo);le.d(Oo,{circle:()=>Bd,line:()=>lo,point:()=>Id,roundRect:()=>co,vector:()=>Ed});var Ho={};le.r(Ho);le.d(Ho,{ActionCompleteEvent:()=>ma,ActionStartEvent:()=>_a,ActivateEvent:()=>da,AddEvent:()=>va,CollisionEndEvent:()=>$s,CollisionPostSolveEvent:()=>cn,CollisionPreSolveEvent:()=>ln,CollisionStartEvent:()=>Ks,ContactEndEvent:()=>hn,ContactStartEvent:()=>an,DeactivateEvent:()=>ua,EnterTriggerEvent:()=>pa,EnterViewPortEvent:()=>ga,EventTypes:()=>on,ExitTriggerEvent:()=>fa,ExitViewPortEvent:()=>Aa,GameEvent:()=>bt,GameStartEvent:()=>Jo,GameStopEvent:()=>Ko,GamepadAxisEvent:()=>ha,GamepadButtonEvent:()=>aa,GamepadConnectEvent:()=>na,GamepadDisconnectEvent:()=>oa,HiddenEvent:()=>ca,InitializeEvent:()=>Us,KillEvent:()=>En,PostCollisionEvent:()=>rs,PostDebugDrawEvent:()=>ia,PostDrawEvent:()=>Ls,PostFrameEvent:()=>ra,PostKillEvent:()=>Xo,PostTransformDrawEvent:()=>ta,PostUpdateEvent:()=>zi,PreCollisionEvent:()=>ss,PreDebugDrawEvent:()=>ea,PreDrawEvent:()=>Ms,PreFrameEvent:()=>sa,PreKillEvent:()=>Zo,PreTransformDrawEvent:()=>$o,PreUpdateEvent:()=>Ni,RemoveEvent:()=>wa,VisibleEvent:()=>la});var qo={};le.r(qo);le.d(qo,{ConsoleAppender:()=>Wo,DrawUtil:()=>Oo,EasingFunctions:()=>Mt,LogLevel:()=>se,Logger:()=>lt,Observable:()=>ve,ScreenAppender:()=>Qh,addItemToArray:()=>Vc,contains:()=>Ph,delay:()=>Kr,fail:()=>Dh,getPosition:()=>Hs,isObject:()=>Vr,mergeDeep:()=>$r,omit:()=>kh,removeItemFromArray:()=>ks});function Bh(){if(typeof window>"u"&&(window={audioContext:function(){}}),typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(n){window.setInterval(n,1e3/60)}),typeof window<"u"&&!window.cancelAnimationFrame&&(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),typeof window<"u"&&!window.AudioContext){if(window.webkitAudioContext){const t=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(e){return new Promise((i,s)=>{t.call(this,e,i,s)})}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}typeof window<"u"&&!window.devicePixelRatio&&(window.devicePixelRatio=window.devicePixelRatio||1),typeof window<"u"&&!window.requestIdleCallback&&(window.requestIdleCallback=window.requestIdleCallback||function(n){const t=Date.now();return setTimeout(function(){n({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(n){clearTimeout(n)})}class de{static useCanvasGraphicsContext(){de.enable("use-canvas-context")}static useLegacyImageRenderer(){de.enable("use-legacy-image-renderer")}static freeze(){de._FROZEN=!0}static _reset(){de._FROZEN=!1,de._FLAGS={}}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");de._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");de._FLAGS[t]=!1}static isEnabled(t){return!!de._FLAGS[t]}static show(){return Object.keys(de._FLAGS)}}de._FROZEN=!1;de._FLAGS={};function ts(n,t){return{type:n,value:t}}class ke{constructor(){this._isCompleted=!1,this.promise=new Promise((t,e)=>{this._resolver=t,this._rejecter=e})}get isCompleted(){return this._isCompleted}resolve(t){this._isCompleted||(this._isCompleted=!0,this._resolver(t))}reject(t){this._isCompleted||(this._isCompleted=!0,this._rejecter(t))}}class Nt{constructor(){this._paused=!1,this._empty=!0,this._listeners={},this._listenersOnce={},this._pipes=[]}clear(){this._listeners={},this._listenersOnce={},this._pipes.length=0,this._empty=!0}on(t,e){var i;return this._empty=!1,this._listeners[t]=(i=this._listeners[t])!==null&&i!==void 0?i:[],this._listeners[t].push(e),{close:()=>this.off(t,e)}}once(t,e){var i;return this._empty=!1,this._listenersOnce[t]=(i=this._listenersOnce[t])!==null&&i!==void 0?i:[],this._listenersOnce[t].push(e),{close:()=>this.off(t,e)}}off(t,e){var i,s;if(e){const r=(i=this._listeners[t])===null||i===void 0?void 0:i.filter(a=>a!==e);this._listeners[t]=r;const o=(s=this._listenersOnce[t])===null||s===void 0?void 0:s.filter(a=>a!==e);this._listenersOnce[t]=o}else delete this._listeners[t]}emit(t,e){if(this._empty||this._paused)return;const i=this._listeners[t];if(i)for(let r=0;r<i.length;r++)i[r](e);const s=this._listenersOnce[t];if(this._listenersOnce[t]=[],s)for(let r=0;r<s.length;r++)s[r](e);for(let r=0;r<this._pipes.length;r++)this._pipes[r].emit(t,e)}pipe(t){if(this===t)throw Error("Cannot pipe to self");return this._empty=!1,this._pipes.push(t),{close:()=>{const e=this._pipes.indexOf(t);e>-1&&this._pipes.splice(e,1)}}}unpipe(t){const e=this._pipes.indexOf(t);e>-1&&this._pipes.splice(e,1)}pause(){this._paused=!0}unpause(){this._paused=!1}}var es;(function(n){n.Canvas="Canvas",n.Document="Document"})(es||(es={}));var Ht;(function(n){n.ShortestPath="shortest-path",n.LongestPath="longest-path",n.Clockwise="clockwise",n.CounterClockwise="counter-clockwise"})(Ht||(Ht={}));const Zn=4294967295;class Ds{constructor(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(let e=1;e<this._n;e++){const i=this._mt[e-1]^this._mt[e-1]>>>this._w-2;this._mt[e]=(this._f*((i&4294901760)>>>16)<<16)+this._f*(i&65535)+e>>>0}this._index=this._n}_twist(){const t=[0,this._a];let e=0,i=0;for(;i<this._n-this._m;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+this._m]^e>>>1^t[e&1]&Zn;for(;i<this._n-1;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+(this._m-this._n)]^e>>>1^t[e&1]&Zn;e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^t[e&1]&Zn,this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,e){return(e-t)*this.next()+t}integer(t,e){return Math.floor((e-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,e,i=!1){return i?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)}_pickSetWithoutDuplicates(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;const i=new Array(e);let s=0;const r=t.slice(0);for(;s<e;){const o=this.integer(0,r.length-1);i[s++]=r[o],r.splice(o,1)}return i}_pickSetWithDuplicates(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const i=new Array(e);for(let s=0;s<e;s++)i[s]=this.pickOne(t);return i}shuffle(t){const e=t.slice(0);let i;for(let s=0;s<e.length-2;s++){const r=this.integer(s,e.length-1);i=e[s],e[s]=e[r],e[r]=i}return e}range(t,e,i){const s=new Array(t);for(let r=0;r<t;r++)s[r]=this.integer(e,i);return s}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}}const re=Math.PI*2;function qc(n){return n>=0?n-Math.floor(n):n-Math.ceil(n)}function Lt(n){return n===0?0:n<0?-1:1}function It(n,t,e){return Math.min(Math.max(t,n),e)}function Sh(n,t,e){return Math.abs(n-t)<e}function vi(n){let t=n;if(n>=re)for(;t>=re;)t-=re;if(n<0)for(;t<0;)t+=re;return t}function Th(n){return 180/Math.PI*n}function Wc(n){return n/180*Math.PI}const jc=(n,t)=>Array.from(new Array(t-n+1),(e,i)=>i+n);function ti(n,t,e=new Ds){return e?e.floating(n,t):n+Math.random()*(t-n)}function Yc(n,t,e=new Ds){return e?e.integer(n,t):Math.round(ti(n,t))}class E{static get Zero(){return new E(0,0)}static get One(){return new E(1,1)}static get Half(){return new E(.5,.5)}static get Up(){return new E(0,-1)}static get Down(){return new E(0,1)}static get Left(){return new E(-1,0)}static get Right(){return new E(1,0)}static fromAngle(t){return new E(Math.cos(t),Math.sin(t))}static isValid(t){return!(t==null||isNaN(t.x)||isNaN(t.y)||t.x===1/0||t.y===1/0||t.x===-1/0||t.y===-1/0)}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static min(t,e){return new E(Math.min(t.x,e.x),Math.min(t.y,e.y))}static max(t,e){return new E(Math.max(t.x,e.x),Math.max(t.y,e.y))}constructor(t,e){this._x=0,this._y=0,this._x=t,this._y=e}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}setTo(t,e){this.x=t,this.y=e}equals(t,e=E.EQUALS_EPSILON){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}distance(t){if(!t)return Math.sqrt(this.x*this.x+this.y*this.y);const e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}squareDistance(t){t||(t=E.Zero);const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}clampMagnitude(t){const e=this.magnitude,i=It(e,0,t);return this.magnitude=i,this}get size(){return this.distance()}set size(t){const e=this.normalize().scale(t);this.setTo(e.x,e.y)}get magnitude(){return this.distance()}set magnitude(t){this.normalize().scale(t,this)}normalize(){const t=this.distance();return t===0?E.Zero:new E(this.x/t,this.y/t)}average(t){return this.add(t).scale(.5)}scale(t,e){const i=e||new E(0,0);return t instanceof E?(i.x=this.x*t.x,i.y=this.y*t.y):(i.x=this.x*t,i.y=this.y*t),i}add(t,e){return e?(e.x=this.x+t.x,e.y=this.y+t.y,e):new E(this.x+t.x,this.y+t.y)}sub(t,e){const i=e||new E(0,0),s=this.x-t.x,r=this.y-t.y;return i.x=s,i.y=r,i}addEqual(t){return this.setTo(this.x+t.x,this.y+t.y),this}subEqual(t){return this.setTo(this.x-t.x,this.y-t.y),this}scaleEqual(t){return this.setTo(this.x*t,this.y*t),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){if(t instanceof E)return this.x*t.y-this.y*t.x;if(typeof t=="number")return new E(t*this.y,-t*this.x)}static cross(t,e){return new E(-t*e.y,t*e.x)}perpendicular(){return new E(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return vi(Math.atan2(this.y,this.x))}angleBetween(t,e){const i=this.toAngle(),s=vi(t);let r=0,o=0;switch(s>i?r=s-i:r=(re-i+s)%re,o=(r-re)%re,e){case Ht.ShortestPath:return Math.abs(r)<Math.abs(o)?r:o;case Ht.LongestPath:return Math.abs(r)>Math.abs(o)?r:o;case Ht.Clockwise:return r;case Ht.CounterClockwise:return o}}rotate(t,e,i){const s=i||new E(0,0);e||(e=new E(0,0));const r=Math.sin(t),o=Math.cos(t),a=o*(this.x-e.x)-r*(this.y-e.y)+e.x,h=r*(this.x-e.x)+o*(this.y-e.y)+e.y;return s.x=a,s.y=h,s}clone(t){const e=t??new E(0,0);return e.x=this.x,e.y=this.y,e}toString(t){return t?`(${this.x.toFixed(t)}, ${this.y.toFixed(t)})`:`(${this.x}, ${this.y})`}}E.EQUALS_EPSILON=.001;function T(n,t){return new E(n,t)}class q{constructor(t,e,i,s){this.r=t,this.g=e,this.b=i,this.a=s??1}static fromRGB(t,e,i,s){return new q(t,e,i,s)}static fromRGBString(t){const e=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i;let i=null;if(i=t.match(e)){const s=parseInt(i[1],10),r=parseInt(i[2],10),o=parseInt(i[3],10);let a=1;return i[4]&&(a=parseFloat(i[4])),new q(s,r,o,a)}else throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){const e=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;let i=null;if(i=t.match(e)){const s=parseInt(i[1],16),r=parseInt(i[2],16),o=parseInt(i[3],16);let a=1;return i[4]&&(a=parseInt(i[4],16)/255),new q(s,r,o,a)}else throw new Error("Invalid hex string: "+t)}static fromHSL(t,e,i,s=1){return new Ne(t,e,i,s).toRGBA()}lighten(t=.1){const e=Ne.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=(1-e.l)*t,e.toRGBA()}darken(t=.1){const e=Ne.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()}saturate(t=.1){const e=Ne.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()}desaturate(t=.1){const e=Ne.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()}multiply(t){const e=t.r/255*this.r/255*255,i=t.g/255*this.g/255*255,s=t.b/255*this.b/255*255,r=t.a*this.a;return new q(e,i,s,r)}screen(t){const e=t.invert(),i=t.invert();return e.multiply(i).invert()}invert(){return new q(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){const e=(t.r+this.r)/2,i=(t.g+this.g)/2,s=(t.b+this.b)/2,r=(t.a+this.a)/2;return new q(e,i,s,r)}equal(t){return this.toString()===t.toString()}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){const e=Math.max(Math.round(t),0).toString(16);return e.length===1?"0"+e:e}toHex(){let t="#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b);return this.a!==1&&(t+=this._componentToHex(this.a*255)),t}toRGBA(){const t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return this.a!==void 0||this.a!==null?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return Ne.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(t){const e=t||new q(this.r,this.g,this.b,this.a);return e.r=this.r,e.g=this.g,e.b=this.b,e.a=this.a,e}static get Black(){return q.fromHex("#000000")}static get White(){return q.fromHex("#FFFFFF")}static get Gray(){return q.fromHex("#808080")}static get LightGray(){return q.fromHex("#D3D3D3")}static get DarkGray(){return q.fromHex("#A9A9A9")}static get Yellow(){return q.fromHex("#FFFF00")}static get Orange(){return q.fromHex("#FFA500")}static get Red(){return q.fromHex("#FF0000")}static get Vermilion(){return q.fromHex("#FF5B31")}static get Rose(){return q.fromHex("#FF007F")}static get Pink(){return q.fromHex("#FFC0CB")}static get Magenta(){return q.fromHex("#FF00FF")}static get Violet(){return q.fromHex("#7F00FF")}static get Purple(){return q.fromHex("#800080")}static get Blue(){return q.fromHex("#0000FF")}static get Azure(){return q.fromHex("#007FFF")}static get Cyan(){return q.fromHex("#00FFFF")}static get Viridian(){return q.fromHex("#59978F")}static get Teal(){return q.fromHex("#008080")}static get Green(){return q.fromHex("#00FF00")}static get Chartreuse(){return q.fromHex("#7FFF00")}static get Transparent(){return q.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return q.fromHex("#176BAA")}static get Brown(){return q.fromHex("#964B00")}}class Ne{constructor(t,e,i,s){this.h=t,this.s=e,this.l=i,this.a=s}static hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*(2/3-i)*6:t}static fromRGBA(t,e,i,s){t/=255,e/=255,i/=255;const r=Math.max(t,e,i),o=Math.min(t,e,i);let a,h;const l=(r+o)/2;if(r===o)a=h=0;else{const c=r-o;switch(h=l>.5?c/(2-r-o):c/(r+o),r){case t:a=(e-i)/c+(e<i?6:0);break;case e:a=(i-t)/c+2;break;case i:a=(t-e)/c+4;break}a/=6}return new Ne(a,h,l,s)}toRGBA(){let t,e,i;if(this.s===0)t=e=i=this.l;else{const s=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,r=2*this.l-s;t=Ne.hue2rgb(r,s,this.h+1/3),e=Ne.hue2rgb(r,s,this.h),i=Ne.hue2rgb(r,s,this.h-1/3)}return new q(t*255,e*255,i*255,this.a)}toString(){const t=this.h.toFixed(0),e=this.s.toFixed(0),i=this.l.toFixed(0),s=this.a.toFixed(0);return`hsla(${t}, ${e}, ${i}, ${s})`}}var se;(function(n){n[n.Debug=0]="Debug",n[n.Info=1]="Info",n[n.Warn=2]="Warn",n[n.Error=3]="Error",n[n.Fatal=4]="Fatal"})(se||(se={}));class lt{constructor(){if(this._appenders=[],this.defaultLevel=se.Info,this._logOnceSet=new Set,lt._INSTANCE)throw new Error("Logger is a singleton");return lt._INSTANCE=this,lt._INSTANCE.addAppender(new Wo),lt._INSTANCE}static getInstance(){return lt._INSTANCE==null&&(lt._INSTANCE=new lt),lt._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,e){t==null&&(t=this.defaultLevel);const i=this._appenders.length;for(let s=0;s<i;s++)t>=this.defaultLevel&&this._appenders[s].log(t,e)}_logOnce(t,e){const i=t+e.join("+");this._logOnceSet.has(i)||(this._logOnceSet.add(i),this._log(t,e))}debug(...t){this._log(se.Debug,t)}debugOnce(...t){this._logOnce(se.Debug,t)}info(...t){this._log(se.Info,t)}infoOnce(...t){this._logOnce(se.Info,t)}warn(...t){this._log(se.Warn,t)}warnOnce(...t){this._logOnce(se.Warn,t)}error(...t){this._log(se.Error,t)}errorOnce(...t){this._logOnce(se.Error,t)}fatal(...t){this._log(se.Fatal,t)}fatalOnce(...t){this._logOnce(se.Fatal,t)}}lt._INSTANCE=null;class Wo{log(t,e){if(!console&&!console.log&&console.warn&&console.error)return;const i=[];i.unshift.apply(i,e),i.unshift("["+se[t]+"] : "),t<se.Warn?console.log.apply?console.log.apply(console,i):console.log(i.join(" ")):t<se.Error?console.warn.apply?console.warn.apply(console,i):console.warn(i.join(" ")):console.error.apply?console.error.apply(console,i):console.error(i.join(" "))}}class Qh{constructor(t){var e,i;this._messages=[],this._pos=10,this._color=q.Black,this._options=t,this.canvas=document.createElement("canvas"),this._ctx=this.canvas.getContext("2d"),this.canvas.style.position="absolute",this.canvas.style.zIndex=(i=(e=t.zIndex)===null||e===void 0?void 0:e.toString())!==null&&i!==void 0?i:"99",document.body.appendChild(this.canvas),this._positionScreenAppenderCanvas(),t.engine.screen.events.on("resize",()=>{this._positionScreenAppenderCanvas()})}_positionScreenAppenderCanvas(){var t,e,i,s;const r=this._options;this.canvas.width=(t=r.width)!==null&&t!==void 0?t:r.engine.screen.resolution.width,this.canvas.height=(e=r.height)!==null&&e!==void 0?e:r.engine.screen.resolution.height,this.canvas.style.position="absolute";const o=r.engine.screen.screenToPageCoordinates(T(0,0));this.canvas.style.left=o.x+"px",this.canvas.style.top=o.y+"px",this._pos=(i=r.xPos)!==null&&i!==void 0?i:this._pos,this._color=(s=r.color)!==null&&s!==void 0?s:this._color}log(t,e){const i=e.join(",");this._ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this._messages.unshift("["+se[t]+"] : "+i);let s=10;this._messages=this._messages.slice(0,1e3);for(let r=0;r<this._messages.length;r++)this._ctx.fillStyle=this._color.toRGBA(),this._ctx.fillText(this._messages[r],this._pos,s),s+=10}}var Ft;(function(n){n.None="None",n.Top="Top",n.Bottom="Bottom",n.Left="Left",n.Right="Right"})(Ft||(Ft={}));(function(n){function t(i){return i===n.Top?n.Bottom:i===n.Bottom?n.Top:i===n.Left?n.Right:i===n.Right?n.Left:n.None}n.getOpposite=t;function e(i){return Math.abs(i.x)>=Math.abs(i.y)?i.x<=0?n.Left:n.Right:i.y<=0?n.Top:n.Bottom}n.fromDirection=e})(Ft||(Ft={}));class ht{constructor(t=0,e=0,i=0,s=0){this._points=[],typeof t=="object"?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):typeof t=="number"&&(this.left=t,this.top=e,this.right=i,this.bottom=s)}clone(t){const e=t||new ht(0,0,0,0);return e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e}reset(){this.left=0,this.top=0,this.bottom=0,this.right=0}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?Ft.Right:Ft.Left:t.y<0?Ft.Bottom:Ft.Top:Ft.None}static fromPoints(t){let e=1/0,i=1/0,s=-1/0,r=-1/0;for(let o=0;o<t.length;o++)t[o].x<e&&(e=t[o].x),t[o].x>s&&(s=t[o].x),t[o].y<i&&(i=t[o].y),t[o].y>r&&(r=t[o].y);return new ht(e,i,s,r)}static fromDimension(t,e,i=E.Half,s=E.Zero){return new ht(-t*i.x+s.x,-e*i.y+s.y,t-t*i.x+s.x,e-e*i.y+s.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return this.width===0||this.height===0}get center(){return new E((this.left+this.right)/2,(this.top+this.bottom)/2)}get topLeft(){return new E(this.left,this.top)}get bottomRight(){return new E(this.right,this.bottom)}get topRight(){return new E(this.right,this.top)}get bottomLeft(){return new E(this.left,this.bottom)}translate(t){return new ht(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,e=E.Zero){const i=this.getPoints().map(s=>s.rotate(t,e));return ht.fromPoints(i)}scale(t,e=E.Zero){const i=this.translate(e);return new ht(i.left*t.x,i.top*t.y,i.right*t.x,i.bottom*t.y)}transform(t){const e=t.data[0]*this.left,i=t.data[1]*this.left,s=t.data[0]*this.right,r=t.data[1]*this.right,o=t.data[2]*this.top,a=t.data[3]*this.top,h=t.data[2]*this.bottom,l=t.data[3]*this.bottom,c=t.getPosition(),d=Math.min(e,s)+Math.min(o,h)+c.x,A=Math.min(i,r)+Math.min(a,l)+c.y,u=Math.max(e,s)+Math.max(o,h)+c.x,p=Math.max(i,r)+Math.max(a,l)+c.y;return new ht({left:d,top:A,right:u,bottom:p})}getPerimeter(){const t=this.width,e=this.height;return 2*(t+e)}getPoints(){return(this._left!==this.left||this._right!==this.right||this._top!==this.top||this._bottom!==this.bottom)&&(this._points.length=0,this._points.push(new E(this.left,this.top)),this._points.push(new E(this.right,this.top)),this._points.push(new E(this.right,this.bottom)),this._points.push(new E(this.left,this.bottom)),this._left=this.left,this._right=this.right,this._top=this.top,this._bottom=this.bottom),this._points}rayCast(t,e=1/0){let i=-1/0,s=1/0;const r=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,o=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,a=(this.left-t.pos.x)*r,h=(this.right-t.pos.x)*r;i=Math.min(a,h),s=Math.max(a,h);const l=(this.top-t.pos.y)*o,c=(this.bottom-t.pos.y)*o;return i=Math.max(i,Math.min(l,c)),s=Math.min(s,Math.max(l,c)),s>=Math.max(0,i)&&i<e}rayCastTime(t,e=1/0){let i=-1/0,s=1/0;const r=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,o=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,a=(this.left-t.pos.x)*r,h=(this.right-t.pos.x)*r;i=Math.min(a,h),s=Math.max(a,h);const l=(this.top-t.pos.y)*o,c=(this.bottom-t.pos.y)*o;return i=Math.max(i,Math.min(l,c)),s=Math.min(s,Math.max(l,c)),s>=Math.max(0,i)&&i<e?i:-1}contains(t){return t instanceof E?this.left<=t.x&&this.top<=t.y&&t.y<=this.bottom&&t.x<=this.right:t instanceof ht?this.left<=t.left&&this.top<=t.top&&t.bottom<=this.bottom&&t.right<=this.right:!1}combine(t,e){const i=e||new ht(0,0,0,0),s=Math.min(this.left,t.left),r=Math.min(this.top,t.top),o=Math.max(this.right,t.right),a=Math.max(this.bottom,t.bottom);return i.left=s,i.top=r,i.right=o,i.bottom=a,i}get dimensions(){return new E(this.width,this.height)}overlaps(t,e){const i=e||0;if(t.hasZeroDimensions())return this.contains(t);if(this.hasZeroDimensions())return t.contains(this);const s=this.combine(t);return s.width+i<t.width+this.width&&s.height+i<t.height+this.height}intersect(t){const e=this.combine(t);if(e.width<t.width+this.width&&e.height<t.height+this.height&&!e.dimensions.equals(t.dimensions)&&!e.dimensions.equals(this.dimensions)){let i=0;this.right>=t.left&&this.right<=t.right?i=t.left-this.right:i=t.right-this.left;let s=0;return this.top<=t.bottom&&this.top>=t.top?s=t.bottom-this.top:s=t.top-this.bottom,Math.abs(i)<Math.abs(s)?new E(i,0):new E(0,s)}else if(e.dimensions.equals(t.dimensions)||e.dimensions.equals(this.dimensions)){let i=0;this.width-t.width>=0?this.right-t.right<=t.left-this.left?i=t.left-this.right:i=t.right-this.left:t.right-this.right<=this.left-t.left?i=this.left-t.right:i=this.right-t.left;let s=0;return this.height-t.height>=0?this.bottom-t.bottom<=t.top-this.top?s=t.top-this.bottom:s=t.bottom-this.top:t.bottom-this.bottom<=this.top-t.top?s=this.top-t.bottom:s=this.bottom-t.top,Math.abs(i)<Math.abs(s)?new E(i,0):new E(0,s)}else return null}intersectWithSide(t){const e=this.intersect(t);return ht.getSideFromIntersection(e)}draw(t,e=q.Yellow){t.debug.drawRect(this.left,this.top,this.width,this.height,{color:e})}}function Hs(n){if(n&&n.getBoundingClientRect){const t=n.getBoundingClientRect();return T(t.x+window.scrollX,t.y+window.scrollY)}return E.Zero}function Vc(n,t){return t.indexOf(n)===-1?(t.push(n),!0):!1}function ks(n,t){let e=-1;return(e=t.indexOf(n))>-1?(t.splice(e,1),!0):!1}function Ph(n,t){for(let e=0;e<n.length;e++)if(n[e]===t)return!0;return!1}function Dh(n){throw new Error(n)}function Kr(n,t){var e;const i=new ke;return((e=t?.schedule.bind(t))!==null&&e!==void 0?e:setTimeout)(()=>{i.resolve()},n),i.promise}function kh(n,t){const e={};for(const i in n)t.includes(i)||(e[i]=n[i]);return e}function Vr(n){return n&&typeof n=="object"&&!Array.isArray(n)}function $r(n,...t){if(!t.length)return n;const e=t.shift();if(Vr(n)&&Vr(e))for(const i in e)Vr(e[i])?(n[i]||Object.assign(n,{[i]:{}}),$r(n[i],e[i])):Object.assign(n,{[i]:e[i]});return $r(n,...t)}var oo;(function(n){n[n.X=12]="X",n[n.Y=13]="Y"})(oo||(oo={}));class Be{constructor(){this.data=new Float32Array(16),this._scaleX=1,this._scaleSignX=1,this._scaleY=1,this._scaleSignY=1}static ortho(t,e,i,s,r,o){const a=new Be;return a.data[0]=2/(e-t),a.data[1]=0,a.data[2]=0,a.data[3]=0,a.data[4]=0,a.data[5]=2/(s-i),a.data[6]=0,a.data[7]=0,a.data[8]=0,a.data[9]=0,a.data[10]=-2/(o-r),a.data[11]=0,a.data[12]=-(e+t)/(e-t),a.data[13]=-(s+i)/(s-i),a.data[14]=-(o+r)/(o-r),a.data[15]=1,a}clone(t){const e=t||new Be;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e.data[6]=this.data[6],e.data[7]=this.data[7],e.data[8]=this.data[8],e.data[9]=this.data[9],e.data[10]=this.data[10],e.data[11]=this.data[11],e.data[12]=this.data[12],e.data[13]=this.data[13],e.data[14]=this.data[14],e.data[15]=this.data[15],e}toDOMMatrix(){return new DOMMatrix([...this.data])}static fromFloat32Array(t){const e=new Be;return e.data=t,e}static identity(){const t=new Be;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}static translation(t,e){const i=Be.identity();return i.data[12]=t,i.data[13]=e,i}static scale(t,e){const i=Be.identity();return i.data[0]=t,i.data[5]=e,i.data[10]=1,i.data[15]=1,i}static rotation(t){const e=Be.identity();return e.data[0]=Math.cos(t),e.data[4]=-Math.sin(t),e.data[1]=Math.sin(t),e.data[5]=Math.cos(t),e}multiply(t,e){if(t instanceof E){const i=e||new E(0,0),s=t,r=s.x*this.data[0]+s.y*this.data[4]+this.data[12],o=s.x*this.data[1]+s.y*this.data[5]+this.data[13];return i.x=r,i.y=o,i}else{const i=e||new Be,s=t,r=this.data[0],o=this.data[1],a=this.data[2],h=this.data[3],l=this.data[4],c=this.data[5],d=this.data[6],A=this.data[7],u=this.data[8],p=this.data[9],v=this.data[10],C=this.data[11],y=this.data[12],b=this.data[13],P=this.data[14],I=this.data[15],Q=s.data[0],O=s.data[1],B=s.data[2],j=s.data[3],$=s.data[4],st=s.data[5],Z=s.data[6],S=s.data[7],z=s.data[8],f=s.data[9],X=s.data[10],ct=s.data[11],D=s.data[12],wt=s.data[13],K=s.data[14],pt=s.data[15];i.data[0]=r*Q+l*O+u*B+y*j,i.data[1]=o*Q+c*O+p*B+b*j,i.data[2]=a*Q+d*O+v*B+P*j,i.data[3]=h*Q+A*O+C*B+I*j,i.data[4]=r*$+l*st+u*Z+y*S,i.data[5]=o*$+c*st+p*Z+b*S,i.data[6]=a*$+d*st+v*Z+P*S,i.data[7]=h*$+A*st+C*Z+I*S,i.data[8]=r*z+l*f+u*X+y*ct,i.data[9]=o*z+c*f+p*X+b*ct,i.data[10]=a*z+d*f+v*X+P*ct,i.data[11]=h*z+A*f+C*X+I*ct,i.data[12]=r*D+l*wt+u*K+y*pt,i.data[13]=o*D+c*wt+p*K+b*pt,i.data[14]=a*D+d*wt+v*K+P*pt,i.data[15]=h*D+A*wt+C*K+I*pt;const M=this.getScale();return i._scaleSignX=Lt(M.x)*Lt(i._scaleSignX),i._scaleSignY=Lt(M.y)*Lt(i._scaleSignY),i}}translate(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],o=this.data[3],a=this.data[4],h=this.data[5],l=this.data[6],c=this.data[7],d=this.data[8],A=this.data[9],u=this.data[10],p=this.data[11],v=this.data[12],C=this.data[13],y=this.data[14],b=this.data[15],P=0,I=1;return this.data[12]=i*t+a*e+d*P+v*I,this.data[13]=s*t+h*e+A*P+C*I,this.data[14]=r*t+l*e+u*P+y*I,this.data[15]=o*t+c*e+p*P+b*I,this}setPosition(t,e){this.data[12]=t,this.data[13]=e}getPosition(){return T(this.data[12],this.data[13])}rotate(t){const e=this.data[0],i=this.data[1],s=this.data[2],r=this.data[3],o=this.data[4],a=this.data[5],h=this.data[6],l=this.data[7],c=Math.sin(t),d=Math.cos(t);return this.data[0]=d*e+c*o,this.data[1]=d*i+c*a,this.data[2]=d*s+c*h,this.data[3]=d*r+c*l,this.data[4]=d*o-c*e,this.data[5]=d*a-c*i,this.data[6]=d*h-c*s,this.data[7]=d*l-c*r,this}scale(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],o=this.data[3],a=this.data[4],h=this.data[5],l=this.data[6],c=this.data[7];return this.data[0]=i*t,this.data[1]=s*t,this.data[2]=r*t,this.data[3]=o*t,this.data[4]=a*e,this.data[5]=h*e,this.data[6]=l*e,this.data[7]=c*e,this}setRotation(t){const e=this.getScale(),i=Math.sin(t),s=Math.cos(t);this.data[0]=s*e.x,this.data[1]=i*e.y,this.data[4]=-i*e.x,this.data[5]=s*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return vi(t)}getScaleX(){const t=T(this.data[0],this.data[4]).magnitude;return this._scaleSignX*t}getScaleY(){const t=T(this.data[1],this.data[5]).magnitude;return this._scaleSignY*t}getScale(){return T(this.getScaleX(),this.getScaleY())}setScaleX(t){if(this._scaleX===t)return;this._scaleSignX=Lt(t);const e=T(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[4]=e.y*t,this._scaleX=t}setScaleY(t){if(this._scaleY===t)return;this._scaleSignY=Lt(t);const e=T(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[5]=e.y*t,this._scaleY=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(t){const i=1/this.getBasisDeterminant(),s=this.data[0],r=this.data[4],o=this.data[1],a=this.data[5],h=t||Be.identity();h.data[0]=a*i,h.data[1]=-o*i,h.data[4]=-r*i,h.data[5]=s*i;const l=this.data[12],c=this.data[13];return h.data[12]=-(l*h.data[0]+c*h.data[4]),h.data[13]=-(l*h.data[1]+c*h.data[5]),h}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===0&&this.data[4]===0&&this.data[5]===1&&this.data[6]===0&&this.data[7]===0&&this.data[8]===0&&this.data[9]===0&&this.data[10]===1&&this.data[11]===0&&this.data[12]===0&&this.data[13]===0&&this.data[14]===0&&this.data[15]===1}toString(){return`
[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]
[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]
[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]
[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]
`}}class te{constructor(){this.data=new Float64Array(6),this._scale=new Float64Array([1,1]),this._scaleSignX=1,this._scaleSignY=1}toDOMMatrix(){return new DOMMatrix([...this.data])}static identity(){const t=new te;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}static translation(t,e){const i=te.identity();return i.data[4]=t,i.data[5]=e,i}static scale(t,e){const i=te.identity();return i.data[0]=t,i.data[3]=e,i._scale[0]=t,i._scale[1]=e,i}static rotation(t){const e=te.identity();return e.data[0]=Math.cos(t),e.data[1]=Math.sin(t),e.data[2]=-Math.sin(t),e.data[3]=Math.cos(t),e}setPosition(t,e){this.data[4]=t,this.data[5]=e}getPosition(){return T(this.data[4],this.data[5])}rotate(t){const e=this.data[0],i=this.data[1],s=this.data[2],r=this.data[3],o=Math.sin(t),a=Math.cos(t);return this.data[0]=a*e+o*s,this.data[1]=a*i+o*r,this.data[2]=a*s-o*e,this.data[3]=a*r-o*i,this}translate(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],o=this.data[3],a=this.data[4],h=this.data[5];return this.data[4]=i*t+r*e+a,this.data[5]=s*t+o*e+h,this}scale(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],o=this.data[3];return this.data[0]=i*t,this.data[1]=s*t,this.data[2]=r*e,this.data[3]=o*e,this._scale[0]=t,this._scale[1]=e,this._scaleSignX=Lt(t),this._scaleSignY=Lt(e),this}determinant(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}inverse(t){const e=this.determinant();let i=e;e!==0&&(i=1/e);const s=this.data[0],r=this.data[2],o=this.data[1],a=this.data[3],h=t||te.identity();h.data[0]=a*i,h.data[1]=-o*i,h.data[2]=-r*i,h.data[3]=s*i;const l=this.data[4],c=this.data[5];return h.data[4]=-(l*h.data[0]+c*h.data[2]),h.data[5]=-(l*h.data[1]+c*h.data[3]),h}multiply(t,e){if(t instanceof E){const i=e||new E(0,0),s=t,r=s.x*this.data[0]+s.y*this.data[2]+this.data[4],o=s.x*this.data[1]+s.y*this.data[3]+this.data[5];return i.x=r,i.y=o,i}else{const i=e||new te,s=t,r=this.data[0],o=this.data[1],a=this.data[2],h=this.data[3],l=this.data[4],c=this.data[5],d=s.data[0],A=s.data[1],u=s.data[2],p=s.data[3],v=s.data[4],C=s.data[5];i.data[0]=r*d+a*A,i.data[1]=o*d+h*A,i.data[2]=r*u+a*p,i.data[3]=o*u+h*p,i.data[4]=r*v+a*C+l,i.data[5]=o*v+h*C+c;const y=this._scaleSignX,b=this._scaleSignY;return i._scaleSignX=y*Lt(i._scaleSignX),i._scaleSignY=b*Lt(i._scaleSignY),i}}multiplyQuadInPlace(t){const e=t[0]*this.data[0]+t[1]*this.data[2]+this.data[4],i=t[0]*this.data[1]+t[1]*this.data[3]+this.data[5];t[0]=e,t[1]=i;const s=t[2]*this.data[0]+t[3]*this.data[2]+this.data[4],r=t[2]*this.data[1]+t[3]*this.data[3]+this.data[5];t[2]=s,t[3]=r;const o=t[4]*this.data[0]+t[5]*this.data[2]+this.data[4],a=t[4]*this.data[1]+t[5]*this.data[3]+this.data[5];t[4]=o,t[5]=a;const h=t[6]*this.data[0]+t[7]*this.data[2]+this.data[4],l=t[6]*this.data[1]+t[7]*this.data[3]+this.data[5];t[6]=h,t[7]=l}to4x4(){const t=new Be;return t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=0,t.data[3]=0,t.data[4]=this.data[2],t.data[5]=this.data[3],t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=this.data[4],t.data[13]=this.data[5],t.data[14]=0,t.data[15]=1,t}setRotation(t){const e=this.getScale(),i=Math.sin(t),s=Math.cos(t);this.data[0]=s*e.x,this.data[1]=i*e.y,this.data[2]=-i*e.x,this.data[3]=s*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return vi(t)}getScaleX(){const t=this.data[0]*this.data[0]+this.data[2]*this.data[2];return t===1?this._scaleSignX:this._scaleSignX*Math.sqrt(t)}getScaleY(){const t=this.data[1]*this.data[1]+this.data[3]*this.data[3];return t===1?this._scaleSignY:this._scaleSignY*Math.sqrt(t)}getScale(){return T(this.getScaleX(),this.getScaleY())}setScaleX(t){if(t===this._scale[0])return;this._scaleSignX=Lt(t);const e=T(this.data[0]*this._scaleSignX,this.data[2]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[2]=e.y*t,this._scale[0]=t}setScaleY(t){if(t===this._scale[1])return;this._scaleSignY=Lt(t);const e=T(this.data[1]*this._scaleSignY,this.data[3]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[3]=e.y*t,this._scale[1]=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===1&&this.data[4]===0&&this.data[5]===0}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}clone(t){const e=t||new te;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e._scaleSignX=this._scaleSignX,e._scaleSignY=this._scaleSignY,e}toString(){return`
[${this.data[0]} ${this.data[2]} ${this.data[4]}]
[${this.data[1]} ${this.data[3]} ${this.data[5]}]
[0 0 1]
`}}class Qr{constructor(t,e,i=1){this.builder=t,this.cleaner=e,this._pool=[],this._size=0,this.grow(i)}grow(t){if(t>0){this._size+=t;for(let e=0;e<t;e++)this._pool.push(this.builder())}}rent(t=!1){return this._pool.length===0&&this.grow(this._size),t?this.cleaner(this._pool.pop()):this._pool.pop()}return(t){this._pool.push(t)}}class Zc{constructor(){this._pool=new Qr(()=>te.identity(),t=>t.reset(),100),this._transforms=[],this._currentTransform=this._pool.rent(!0)}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone(this._pool.rent())}restore(){this._pool.return(this._currentTransform),this._currentTransform=this._transforms.pop()}translate(t,e){return this._currentTransform.translate(t,e)}rotate(t){return this._currentTransform.rotate(t)}scale(t,e){return this._currentTransform.scale(t,e)}reset(){this._currentTransform.reset()}set current(t){this._currentTransform=t}get current(){return this._currentTransform}}class Xc{constructor(){this.opacity=1,this.z=0,this.tint=q.White,this.material=null}}class Fh{constructor(){this._pool=new Qr(()=>new Xc,t=>(t.opacity=1,t.z=0,t.tint=q.White,t.material=null,t),100),this.current=this._pool.rent(!0),this._states=[]}_cloneState(t){var e;return t.opacity=this.current.opacity,t.z=this.current.z,t.tint=(e=this.current.tint)===null||e===void 0?void 0:e.clone(),t.material=this.current.material,t}save(){this._states.push(this.current),this.current=this._cloneState(this._pool.rent())}restore(){this._pool.return(this.current),this.current=this._states.pop()}}const Jc={Complete:"complete",Load:"load",LoadStart:"loadstart",Progress:"progress",Error:"error"};class Pr{constructor(t,e,i=!1){this.path=t,this.responseType=e,this.bustCache=i,this.data=null,this.logger=lt.getInstance(),this.events=new Nt}isLoaded(){return this.data!==null}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise((t,e)=>{if(this.data!==null){this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),t(this.data);return}const i=new XMLHttpRequest;i.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),i.responseType=this.responseType,i.addEventListener("loadstart",s=>this.events.emit("loadstart",s)),i.addEventListener("progress",s=>this.events.emit("progress",s)),i.addEventListener("error",s=>this.events.emit("error",s)),i.addEventListener("load",s=>this.events.emit("load",s)),i.addEventListener("load",()=>{if(i.status!==0&&i.status!==200){this.logger.error("Failed to load resource ",this.path," server responded with error code",i.status),this.events.emit("error",i.response),e(new Error(i.statusText));return}if(i.response instanceof Blob&&i.response.type==="text/html"){const s=`Expected blob (usually image) data from the server when loading ${this.path}, but got HTML content instead!

Check your server configuration, for example Vite serves static files from the /public folder`;this.events.emit("error",i.response),e(new Error(s));return}this.data=i.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)}),i.send()})}}function Oe(n,t){return n&&(n.__isProxy===void 0?new Proxy(n,{set:(e,i,s)=>(e[i]!==s&&(e[i]=s,typeof i=="string"&&i[0]!=="_"&&t(e)),!0),get:(e,i)=>i!=="__isProxy"?e[i]:!0}):n)}const Rh=(n=[],t,e)=>({get:(i,s)=>s==="__isProxy"?!0:typeof i[s]=="object"&&i[s]!=null?new Proxy(i[s],Rh([...n,s],t,e)):i[s],set:(i,s,r)=>(typeof s=="string"&&s[0]!=="_"&&t(e),i[s]=r,!0)});function Kc(n,t){return n&&(n.__isProxy===void 0?new Proxy(n,Rh([],t,n)):n)}class qt{isStale(){return this._transformStale}get flipHorizontal(){return this._flipHorizontal}set flipHorizontal(t){this._flipHorizontal=t,this._transformStale=!0}get flipVertical(){return this._flipVertical}set flipVertical(t){this._flipVertical=t,this._transformStale=!0}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._transformStale=!0}get scale(){return this._scale}set scale(t){this._scale=Oe(t,()=>{this._transformStale=!0}),this._transformStale=!0}get origin(){return this._origin}set origin(t){t&&(this._origin=Oe(t,()=>{this._transformStale=!0})),this._transformStale=!0}constructor(t){var e,i,s,r,o,a,h;this.id=qt._ID++,this.transform=te.identity(),this._transformStale=!0,this.showDebug=!1,this._flipHorizontal=!1,this._flipVertical=!1,this._rotation=0,this.opacity=1,this._scale=E.One,this._width=0,this._height=0,t&&(this.origin=(e=t.origin)!==null&&e!==void 0?e:this.origin,this.flipHorizontal=(i=t.flipHorizontal)!==null&&i!==void 0?i:this.flipHorizontal,this.flipVertical=(s=t.flipVertical)!==null&&s!==void 0?s:this.flipVertical,this.rotation=(r=t.rotation)!==null&&r!==void 0?r:this.rotation,this.opacity=(o=t.opacity)!==null&&o!==void 0?o:this.opacity,this.scale=(a=t.scale)!==null&&a!==void 0?a:this.scale,this.tint=(h=t.tint)!==null&&h!==void 0?h:this.tint,t.width&&(this._width=t.width),t.height&&(this._height=t.height))}cloneGraphicOptions(){return{width:this.width/this.scale.x,height:this.height/this.scale.y,origin:this.origin?this.origin.clone():void 0,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():void 0,tint:this.tint?this.tint.clone():void 0}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(t){this._width=t,this._transformStale=!0}set height(t){this._height=t,this._transformStale=!0}get localBounds(){return ht.fromDimension(this.width,this.height,E.Zero)}draw(t,e,i){this._preDraw(t,e,i),this._drawImage(t,0,0),this._postDraw(t)}_preDraw(t,e,i){t.save(),t.translate(e,i),this._transformStale&&(this.transform.reset(),this.transform.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this._rotate(this.transform),this._flip(this.transform),this._transformStale=!1),t.multiply(this.transform),t.opacity=t.opacity*this.opacity,this.tint&&(t.tint=this.tint)}_rotate(t){var e;const i=this.scale.x>0?1:-1,s=this.scale.y>0?1:-1,r=(e=this.origin)!==null&&e!==void 0?e:T(this.width/2,this.height/2);t.translate(r.x,r.y),t.rotate(this.rotation),t.scale(i,s),t.translate(-r.x,-r.y)}_flip(t){this.flipHorizontal&&(t.translate(this.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height/this.scale.y),t.scale(1,-1))}_postDraw(t){this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}qt._ID=0;class We extends qt{static from(t,e){return new We({image:t,...e})}constructor(t){var e,i;super(t),this._logger=lt.getInstance(),this._dirty=!0,this.image=t.image;const{width:s,height:r}=t;this.sourceView=(e=t.sourceView)!==null&&e!==void 0?e:{x:0,y:0,width:s??0,height:r??0},this.destSize=(i=t.destSize)!==null&&i!==void 0?i:{width:s??0,height:r??0},this._updateSpriteDimensions(),this.image.ready.then(()=>{this._updateSpriteDimensions()})}get width(){return Math.abs(this.destSize.width*this.scale.x)}get height(){return Math.abs(this.destSize.height*this.scale.y)}set width(t){t/=Math.abs(this.scale.x),this.destSize.width=t,super.width=Math.ceil(this.destSize.width)}set height(t){t/=Math.abs(this.scale.y),this.destSize.height=t,super.height=Math.ceil(this.destSize.height)}_updateSpriteDimensions(){var t,e,i,s,r,o;const{width:a,height:h}=this.image;this.sourceView.width=((t=this.sourceView)===null||t===void 0?void 0:t.width)||a,this.sourceView.height=((e=this.sourceView)===null||e===void 0?void 0:e.height)||h,this.destSize.width=((i=this.destSize)===null||i===void 0?void 0:i.width)||((s=this.sourceView)===null||s===void 0?void 0:s.width)||a,this.destSize.height=((r=this.destSize)===null||r===void 0?void 0:r.height)||((o=this.sourceView)===null||o===void 0?void 0:o.height)||h,this.width=Math.ceil(this.destSize.width)*this.scale.x,this.height=Math.ceil(this.destSize.height)*this.scale.y}_preDraw(t,e,i){this.image.isLoaded()&&this._dirty&&(this._dirty=!1,this._updateSpriteDimensions()),super._preDraw(t,e,i)}_drawImage(t,e,i){this.image.isLoaded()?t.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,e,i,this.destSize.width,this.destSize.height):this._logger.warnOnce(`ImageSource ${this.image.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`)}clone(){return new We({image:this.image,sourceView:{...this.sourceView},destSize:{...this.destSize},...this.cloneGraphicOptions()})}}var ie;(function(n){n.Pixel="Pixel",n.Blended="Blended"})(ie||(ie={}));function Fs(n){switch(n){case ie.Pixel:return ie.Pixel;case ie.Blended:return ie.Blended;default:return}}var Ut;(function(n){n.Clamp="Clamp",n.Repeat="Repeat",n.Mirror="Mirror"})(Ut||(Ut={}));function Ve(n){switch(n){case Ut.Clamp:return Ut.Clamp;case Ut.Repeat:return Ut.Repeat;case Ut.Mirror:return Ut.Mirror;default:return Ut.Clamp}}class zt{constructor(t,e){var i;this._garbageCollector=e,this._textureMap=new Map,this._collect=s=>{var r;if(this._gl){const o=(r=s.dataset.originalSrc)!==null&&r!==void 0?r:s.constructor.name;return zt._LOGGER.debug(`WebGL Texture for ${o} collected`),this.delete(s),!0}return!1},this._gl=t,zt._MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE),this._garbageCollector&&(zt._LOGGER.debug("WebGL Texture collection interval:",this._garbageCollector.collectionInterval),(i=this._garbageCollector.garbageCollector)===null||i===void 0||i.registerCollector("texture",this._garbageCollector.collectionInterval,this._collect))}dispose(){for(const[t]of this._textureMap)this.delete(t);this._textureMap.clear(),this._gl=null}get(t){return this._textureMap.get(t)}has(t){return this._textureMap.has(t)}load(t,e,i=!1){var s,r;const o=this._gl;if(!o)return null;const{filtering:a,wrapping:h}={...e};let l=null;if(this.has(t)&&(l=this.get(t)),l)return i&&(o.bindTexture(o.TEXTURE_2D,l),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t)),(s=this._garbageCollector)===null||s===void 0||s.garbageCollector.touch(t),l;l=o.createTexture(),zt.checkImageSizeSupportedAndLog(t),o.bindTexture(o.TEXTURE_2D,l),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);let c;h&&(typeof h=="string"?c={x:h,y:h}:c={x:h.x,y:h.y});const{x:d,y:A}=c??zt.wrapping;switch(d){case Ut.Clamp:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);break;case Ut.Repeat:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT);break;case Ut.Mirror:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.MIRRORED_REPEAT);break;default:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE)}switch(A){case Ut.Clamp:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);break;case Ut.Repeat:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT);break;case Ut.Mirror:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.MIRRORED_REPEAT);break;default:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE)}const u=a??zt.filtering;return o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,u===ie.Pixel?o.NEAREST:o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,u===ie.Pixel?o.NEAREST:o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t),this._textureMap.set(t,l),(r=this._garbageCollector)===null||r===void 0||r.garbageCollector.addCollectableResource("texture",t),l}delete(t){const e=this._gl;if(e&&this.has(t)){const i=this.get(t);i&&(this._textureMap.delete(t),e.deleteTexture(i))}}static checkImageSizeSupportedAndLog(t){var e;const i=(e=t.dataset.originalSrc)!==null&&e!==void 0?e:"internal canvas bitmap";return t.width>zt._MAX_TEXTURE_SIZE||t.height>zt._MAX_TEXTURE_SIZE?(zt._LOGGER.error(`The image [${i}] provided to Excalibur is too large for the device's maximum texture size of (${zt._MAX_TEXTURE_SIZE}x${zt._MAX_TEXTURE_SIZE}) please resize to an image for excalibur to render properly.

Images will likely render as black rectangles.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!1):((t.width>4096||t.height>4096)&&zt._LOGGER.warn(`The image [${i}] provided to excalibur is too large may not work on all mobile devices, it is recommended you resize images to a maximum (4096x4096).

Images will likely render as black rectangles on some mobile platforms.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!0)}}zt._LOGGER=lt.getInstance();zt.filtering=ie.Blended;zt.wrapping={x:Ut.Clamp,y:Ut.Clamp};zt._MAX_TEXTURE_SIZE=4096;const Pt={Filtering:"filtering",WrappingX:"wrapping-x",WrappingY:"wrapping-y"};class ii{get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return this._src||(this._src=this.data.src),!!this._src}get image(){return this.data}constructor(t,e,i){this._logger=lt.getInstance(),this.data=new Image,this._readyFuture=new ke,this.ready=this._readyFuture.promise,this.path=t;let s=!1,r;typeof e=="boolean"?s=e:{filtering:i,wrapping:r,bustCache:s}={...e},this._resource=new Pr(t,"blob",s),this.filtering=i??this.filtering,typeof r=="string"?this.wrapping={x:r,y:r}:this.wrapping=r??this.wrapping,t.endsWith(".gif")&&this._logger.warn(`Use the ex.Gif type to load gifs, you may have mixed results with ${t} in ex.ImageSource. Fully supported: svg, jpg, bmp, and png`)}static fromHtmlImageElement(t,e){const i=new ii("");if(i._src="image-element",i.data=t,i.data.setAttribute("data-original-src","image-element"),e?.filtering?i.data.setAttribute(Pt.Filtering,e?.filtering):i.data.setAttribute(Pt.Filtering,ie.Blended),e?.wrapping){let s;typeof e.wrapping=="string"?s={x:e.wrapping,y:e.wrapping}:s={x:e.wrapping.x,y:e.wrapping.y},i.data.setAttribute(Pt.WrappingX,s.x),i.data.setAttribute(Pt.WrappingY,s.y)}else i.data.setAttribute(Pt.WrappingX,Ut.Clamp),i.data.setAttribute(Pt.WrappingY,Ut.Clamp);return zt.checkImageSizeSupportedAndLog(t),i._readyFuture.resolve(t),i}static fromHtmlCanvasElement(t,e){const i=new ii("");if(i._src="canvas-element-blob",i.data.setAttribute("data-original-src","canvas-element-blob"),e?.filtering?i.data.setAttribute(Pt.Filtering,e?.filtering):i.data.setAttribute(Pt.Filtering,ie.Blended),e?.wrapping){let s;typeof e.wrapping=="string"?s={x:e.wrapping,y:e.wrapping}:s={x:e.wrapping.x,y:e.wrapping.y},i.data.setAttribute(Pt.WrappingX,s.x),i.data.setAttribute(Pt.WrappingY,s.y)}else i.data.setAttribute(Pt.WrappingX,Ut.Clamp),i.data.setAttribute(Pt.WrappingY,Ut.Clamp);return zt.checkImageSizeSupportedAndLog(t),t.toBlob(s=>{const r=URL.createObjectURL(s);i.image.onload=()=>{URL.revokeObjectURL(r),i.data=i.image,i._readyFuture.resolve(i.image)},i.image.src=r}),i}static fromSvgString(t,e){const i=new Blob([t],{type:"image/svg+xml"}),s=URL.createObjectURL(i);return new ii(s,e)}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}async load(){var t,e,i,s;if(this.isLoaded())return this.data;try{let r;if(this.path.includes("data:image/"))r=this.path;else{const h=await this._resource.load();r=URL.createObjectURL(h)}const o=new Image,a=new ke;o.onload=()=>a.resolve(),o.src=r,o.setAttribute("data-original-src",this.path),await a.promise,this.data=o,zt.checkImageSizeSupportedAndLog(this.data)}catch(r){throw`Error loading ImageSource from path '${this.path}' with error [${r.message}]`}return this.data.setAttribute(Pt.Filtering,this.filtering),this.data.setAttribute(Pt.WrappingX,(e=(t=this.wrapping)===null||t===void 0?void 0:t.x)!==null&&e!==void 0?e:Ut.Clamp),this.data.setAttribute(Pt.WrappingY,(s=(i=this.wrapping)===null||i===void 0?void 0:i.y)!==null&&s!==void 0?s:Ut.Clamp),this._readyFuture.resolve(this.data),this.data}toSprite(t){return We.from(this,t)}unload(){this.data=new Image}}class bn extends qt{constructor(t){super(t),this._text="",this.alphabet="",this.shadow=void 0,this.caseInsensitive=!1,this.spacing=0,this.lineHeight=void 0,this._logger=lt.getInstance();const{alphabet:e,spriteSheet:i,caseInsensitive:s,spacing:r,shadow:o,lineHeight:a}=t;this.alphabet=e,this.spriteSheet=i,this.caseInsensitive=s??this.caseInsensitive,this.spacing=r??this.spacing,this.shadow=o??this.shadow,this.lineHeight=a??this.lineHeight}_getCharacterSprites(t){const e=[],i=this.caseInsensitive?t.toLocaleLowerCase():t,s=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let r=0;r<i.length;r++){const o=i[r];let a=s.indexOf(o);a===-1&&(a=0,this._logger.warnOnce(`SpriteFont - Cannot find letter '${o}' in configured alphabet '${s}'.`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."));const h=this.spriteSheet.sprites[a];h?e.push(h):(this._logger.warnOnce(`SpriteFont - Cannot find sprite for '${o}' at index '${a}' in configured SpriteSheet`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."))}return e}measureText(t,e){const i=this._getLinesFromText(t,e),s=i.reduce((h,l)=>h.length>l.length?h:l),r=this._getCharacterSprites(s);let o=0,a=0;for(const h of r)o+=h.width+this.spacing,a=Math.max(a,h.height);return ht.fromDimension(o*this.scale.x,a*i.length*this.scale.y,E.Zero)}_drawImage(t,e,i,s){var r;let o=0,a=0,h=0;const l=this._getLinesFromText(this._text,s);for(const c of l){for(const d of this._getCharacterSprites(c))d.draw(t,e+o,i+a),o+=d.width+this.spacing,h=Math.max(h,d.height);o=0,a+=(r=this.lineHeight)!==null&&r!==void 0?r:h}}render(t,e,i,s,r,o){this._text=e;const a=this.measureText(e,o);this.width=a.width,this.height=a.height,this.shadow&&(t.save(),t.translate(this.shadow.offset.x,this.shadow.offset.y),this._preDraw(t,s,r),this._drawImage(t,0,0,o),this._postDraw(t),t.restore()),this._preDraw(t,s,r),this._drawImage(t,0,0,o),this._postDraw(t)}clone(){return new bn({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}_getLinesFromText(t,e){var i;if(this._cachedText===t&&this._cachedRenderWidth===e&&(!((i=this._cachedLines)===null||i===void 0)&&i.length))return this._cachedLines;const s=t.split(`
`);if(e==null)return s;for(let r=0;r<s.length;r++){let o=s[r],a="";if(this.measureText(o).width>e){for(;this.measureText(o).width>e;)a=o[o.length-1]+a,o=o.slice(0,-1);s[r]=o,s[r+1]=a}}return this._cachedText=t,this._cachedLines=s,this._cachedRenderWidth=e,s}}class Dr extends We{constructor(t){super({image:t.image,sourceView:t.sourceView,destSize:{width:t.width,height:t.height},flipHorizontal:t.flipHorizontal,flipVertical:t.flipVertical,rotation:t.rotation,scale:t.scale,opacity:t.opacity,tint:t.tint,origin:t.origin}),this._ready=new ke,this.ready=this._ready.promise,this._options=t,this.image.isLoaded()?this._applyTiling():this.image.ready.then(()=>this._applyTiling())}static fromSprite(t,e){return new Dr({sourceView:{...t.sourceView},width:t.width,height:t.height,...e,image:t.image})}_applyTiling(){const{width:t,height:e,filtering:i,wrapping:s}={...this._options},r=document.createElement("canvas");r.width=this.sourceView.width,r.height=this.sourceView.height,r.getContext("2d").drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,0,0,this.sourceView.width,this.sourceView.height);const a=ii.fromHtmlCanvasElement(r,{wrapping:s??Ut.Repeat,filtering:i});t&&(this.destSize.width=t,this.sourceView.width=t),e&&(this.destSize.height=e,this.sourceView.height=e),this.sourceView.x=0,this.sourceView.y=0,this.image=a,this.image.ready.then(()=>this._ready.resolve())}}class Zi{constructor(t){this.sprites=[];const{sprites:e,rows:i,columns:s}=t;this.sprites=e,this.rows=i??1,this.columns=s??this.sprites.length}getSprite(t,e,i){var s,r,o,a,h,l,c,d,A;if(t>=this.columns||t<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1} columns`);if(e>=this.rows||e<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1} rows`);const u=t+e*this.columns,p=this.sprites[u];if(p){if(i){const v=p.clone();return v.flipHorizontal=(s=i.flipHorizontal)!==null&&s!==void 0?s:v.flipHorizontal,v.flipVertical=(r=i.flipVertical)!==null&&r!==void 0?r:v.flipVertical,v.width=(o=i.width)!==null&&o!==void 0?o:v.width,v.height=(a=i.height)!==null&&a!==void 0?a:v.height,v.rotation=(h=i.rotation)!==null&&h!==void 0?h:v.rotation,v.scale=(l=i.scale)!==null&&l!==void 0?l:v.scale,v.opacity=(c=i.opacity)!==null&&c!==void 0?c:v.opacity,v.tint=(d=i.tint)!==null&&d!==void 0?d:v.tint,v.origin=(A=i.origin)!==null&&A!==void 0?A:v.origin,v}return p}throw Error(`Invalid sprite coordinates (${t}, ${e})`)}getTiledSprite(t,e,i){if(t>=this.columns||t<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1} columns`);if(e>=this.rows||e<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1} rows`);const s=t+e*this.columns,r=this.sprites[s];if(r)return Dr.fromSprite(r,i);throw Error(`Invalid sprite coordinates (${t}, ${e})`)}static fromImageSourceWithSourceViews(t){const e=t.sourceViews.map(i=>new We({image:t.image,sourceView:i}));return new Zi({sprites:e})}static fromImageSource(t){var e;const i=[];t.spacing=(e=t.spacing)!==null&&e!==void 0?e:{};const{image:s,grid:{rows:r,columns:o,spriteWidth:a,spriteHeight:h},spacing:{originOffset:l,margin:c}}=t,d={x:0,y:0,...l},A={x:0,y:0,...c};for(let u=0;u<o;u++)for(let p=0;p<r;p++)i[u+p*o]=new We({image:s,sourceView:{x:u*a+A.x*u+d.x,y:p*h+A.y*p+d.y,width:a,height:h},destSize:{height:h,width:a}});return new Zi({sprites:i,rows:r,columns:o})}clone(){return new Zi({sprites:this.sprites.map(t=>t.clone()),rows:this.rows,columns:this.columns})}}const $c="data:image/png;base64,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";class jo{constructor(){this.fontSheet=$c,this.size=16,this.load()}load(){return this._imageSource=new ii(this.fontSheet),this._imageSource.load().then(()=>{this._spriteSheet=Zi.fromImageSource({image:this._imageSource,grid:{rows:4,columns:16,spriteWidth:16,spriteHeight:16}}),this._spriteFont=new bn({alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!'&."?-()+# `,caseInsensitive:!0,spriteSheet:this._spriteSheet,spacing:-6})})}write(t,e,i){this._imageSource.isLoaded()&&this._spriteFont.render(t,e,null,i.x,i.y)}}class td{constructor(t,e){this._gl=t,this._texture=e}use(){const t=this._gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture)}disable(){const t=this._gl;t.bindTexture(t.TEXTURE_2D,null)}}class Hr{constructor(t){var e,i;this.antialias=!1,this.samples=1,this._gl=t.gl,this.width=t.width,this.height=t.height,this.transparency=t.transparency,this.antialias=(e=t.antialias)!==null&&e!==void 0?e:this.antialias,this.samples=(i=t.samples)!==null&&i!==void 0?i:this._gl.getParameter(this._gl.MAX_SAMPLES);const s=this._gl;s.drawingBufferFormat?this.bufferFormat=s.drawingBufferFormat:this.transparency?this.bufferFormat=s.RGBA8:this.bufferFormat=s.RGB8,this._setupRenderBuffer(),this._setupFramebuffer()}setResolution(t,e){const i=this._gl;this.width=t,this.height=e,i.bindTexture(i.TEXTURE_2D,this._frameTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),this._renderBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,this._renderBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,Math.min(this.samples,i.getParameter(i.MAX_SAMPLES)),this.bufferFormat,this.width,this.height))}get renderBuffer(){return this._renderBuffer}get renderFrameBuffer(){return this._renderFrameBuffer}get frameBuffer(){return this._frameBuffer}get frameTexture(){return this._frameTexture}_setupRenderBuffer(){if(this.antialias){const t=this._gl;this._renderBuffer=t.createRenderbuffer(),this._renderFrameBuffer=t.createFramebuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._renderBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,Math.min(this.samples,t.getParameter(t.MAX_SAMPLES)),this.bufferFormat,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,this._renderFrameBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,this._renderBuffer)}}_setupFramebuffer(){const t=this._gl;this._frameTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._frameTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const e=t.COLOR_ATTACHMENT0;this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,this._frameTexture,0),this.disable()}toRenderSource(){return this.renderBuffer&&this.blitRenderBufferToFrameBuffer(),new td(this._gl,this._frameTexture)}blitToScreen(){const t=this._gl;this._renderBuffer?(t.bindFramebuffer(t.READ_FRAMEBUFFER,this.renderFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)):(t.bindFramebuffer(t.READ_FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR))}blitRenderBufferToFrameBuffer(){if(this._renderBuffer){const t=this._gl;t.bindFramebuffer(t.READ_FRAMEBUFFER,this.renderFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.frameBuffer),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)}}copyToTexture(t){const e=this._gl;this._renderBuffer&&this.blitRenderBufferToFrameBuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,this.width,this.height,0)}use(){const t=this._gl;this.antialias?t.bindFramebuffer(t.FRAMEBUFFER,this._renderFrameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this.width,this.height)}disable(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}}const ed=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
\r
out lowp vec4 v_color;\r
\r
uniform mat4 u_matrix;\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Passthrough the color\r
   v_color = a_color;\r
}`,id=`#version 300 es\r
precision mediump float;\r
\r
// Color\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  fragColor = v_color;\r
}`;function ao(n,t){switch(t){case n.INT:case n.UNSIGNED_INT:case n.FLOAT:return 4;case n.SHORT:return 2;case n.UNSIGNED_SHORT:return 2;case n.BYTE:return 1;case n.UNSIGNED_BYTE:return 1;default:return 1}}function Mh(n,t){const e=`(?<type>[a-z0-9]+)\\s+${t};`,s=new RegExp(e,"g").exec(n);return s?.length>0}function Lh(n,t,e){var i;const s=`(?<type>[a-z0-9]+)\\s+${e};`,o=new RegExp(s,"g").exec(t);switch((i=o?.groups)===null||i===void 0?void 0:i.type){case"float":case"vec2":case"vec3":case"vec4":return n.FLOAT;case"int":case"ivec2":case"ivec3":case"ivec4":return n.INT;case"uint":case"uvec2":case"uvec3":case"uvec4":return n.UNSIGNED_INT;case"bool":case"bvec2":case"bvec3":case"bvec4":return n.BOOL;case"short":return n.SHORT;case"ushort":return n.UNSIGNED_SHORT;case"ubyte":return n.UNSIGNED_BYTE;case"byte":return n.BYTE;default:return n.FLOAT}}function Uh(n,t){switch(t){case n.LOW_FLOAT:case n.HIGH_FLOAT:case n.FLOAT:return 1;case n.FLOAT_VEC2:return 2;case n.FLOAT_VEC3:return 3;case n.FLOAT_VEC4:return 4;case n.BYTE:return 1;case n.UNSIGNED_BYTE:return 1;case n.UNSIGNED_SHORT:case n.SHORT:return 1;default:return 1}}function Gh(n,t){switch(t){case n.LOW_FLOAT:case n.HIGH_FLOAT:case n.FLOAT:case n.FLOAT_VEC2:case n.FLOAT_VEC3:case n.FLOAT_VEC4:return n.FLOAT;case n.BYTE:return n.BYTE;case n.UNSIGNED_BYTE:return n.UNSIGNED_BYTE;case n.SHORT:return n.SHORT;case n.UNSIGNED_SHORT:return n.UNSIGNED_SHORT;default:return n.FLOAT}}function Yo(n,t){const e=s=>{const r=`#version 300 es
    precision mediump float;
    out vec4 fragColor;
    void main() {
      float index = 1.01;
      %%complexity%%
    }`;let o="";for(let a=0;a<s;a++)a===0?o+=`if (index <= ${a}.5) {
`:o+=`   else if (index <= ${a}.5) {
`,o+=`      fragColor = vec4(1.0);
`,o+=`   }
`;return r.replace("%%complexity%%",o)};let i=!1;do{const s=e(t),r=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(r,s),n.compileShader(r),i=n.getShaderParameter(r,n.COMPILE_STATUS),i||(t=t/2|0)}while(!i);return t}class Ie{get compiled(){return this._compiled}constructor(t){this._logger=lt.getInstance(),this.uniforms={},this.attributes={},this._compiled=!1;const{gl:e,vertexSource:i,fragmentSource:s,onPreLink:r,onPostCompile:o}=t;this._gl=e,this.vertexSource=i,this.fragmentSource=s,this._onPreLink=r,this._onPostCompile=o}dispose(){this._gl.deleteProgram(this.program),this._gl=null}use(){this._gl.useProgram(this.program),Ie._ACTIVE_SHADER_INSTANCE=this}isCurrentlyBound(){return Ie._ACTIVE_SHADER_INSTANCE===this}compile(){const t=this._gl,e=this._compileShader(t,this.vertexSource,t.VERTEX_SHADER),i=this._compileShader(t,this.fragmentSource,t.FRAGMENT_SHADER);this.program=this._createProgram(t,e,i);const s=this.getAttributes();for(const o of s)this.attributes[o.name]=o;const r=this.getUniforms();for(const o of r)this.uniforms[o.name]=o;return this._compiled=!0,this._onPostCompile&&this._onPostCompile(this),this.program}getUniforms(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),i=[];for(let s=0;s<e;s++){const r=t.getActiveUniform(this.program,s),o=t.getUniformLocation(this.program,r.name);i.push({name:r.name,glType:r.type,location:o})}return i}getAttributes(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),i=[];for(let s=0;s<e;s++){const r=t.getActiveAttrib(this.program,s),o=t.getAttribLocation(this.program,r.name);i.push({name:r.name,glType:Gh(t,r.type),size:Uh(t,r.type),location:o,normalized:!1})}return i}setTexture(t,e){const i=this._gl;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e)}setUniformInt(t,e){this.setUniform("uniform1i",t,~~e)}trySetUniformInt(t,e){return this.trySetUniform("uniform1i",t,~~e)}setUniformIntArray(t,e){this.setUniform("uniform1iv",t,e)}trySetUniformIntArray(t,e){return this.trySetUniform("uniform1iv",t,e)}setUniformBoolean(t,e){this.setUniform("uniform1i",t,e?1:0)}trySetUniformBoolean(t,e){return this.trySetUniform("uniform1i",t,e?1:0)}setUniformFloat(t,e){this.setUniform("uniform1f",t,e)}trySetUniformFloat(t,e){return this.trySetUniform("uniform1f",t,e)}setUniformFloatArray(t,e){this.setUniform("uniform1fv",t,e)}trySetUniformFloatArray(t,e){return this.trySetUniform("uniform1fv",t,e)}setUniformFloatVector(t,e){this.setUniform("uniform2f",t,e.x,e.y)}trySetUniformFloatVector(t,e){return this.trySetUniform("uniform2f",t,e.x,e.y)}setUniformFloatColor(t,e){this.setUniform("uniform4f",t,e.r/255,e.g/255,e.b/255,e.a)}trySetUniformFloatColor(t,e){return this.trySetUniform("uniform4f",t,e.r/255,e.g/255,e.b/255,e.a)}setUniformMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,e.data)}setUniformAffineMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,[e.data[0],e.data[1],0,0,e.data[2],e.data[3],0,0,0,0,1,0,e.data[4],e.data[5],0,1])}trySetUniformMatrix(t,e){return this.trySetUniform("uniformMatrix4fv",t,!1,e.data)}setUniform(t,e,...i){if(!this._compiled)throw Error(`Must compile shader before setting a uniform ${t}:${e}`);if(!this.isCurrentlyBound())throw Error("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms");const r=this._gl.getUniformLocation(this.program,e);if(r){const o=[r,...i];this._gl[t].apply(this._gl,o)}else throw Error(`Uniform ${t}:${e} doesn't exist or is not used in the shader source code, unused uniforms are optimized away by most browsers`)}trySetUniform(t,e,...i){if(!this._compiled)return this._logger.warn(`Must compile shader before setting a uniform ${t}:${e}`),!1;if(!this.isCurrentlyBound())return this._logger.warn("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms"),!1;const r=this._gl.getUniformLocation(this.program,e);if(r){const o=[r,...i];this._gl[t].apply(this._gl,o)}else return!1;return!0}_createProgram(t,e,i){const s=t.createProgram();if(s===null)throw Error("Could not create graphics shader program");if(t.attachShader(s,e),t.attachShader(s,i),this._onPreLink&&this._onPreLink(s),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw Error(`Could not link the program: [${t.getProgramInfoLog(s)}]`);return s}_compileShader(t,e,i){const s=t.VERTEX_SHADER===i?"vertex":"fragment",r=t.createShader(i);if(r===null)throw Error(`Could not build shader: [${e}]`);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){const a=t.getShaderInfoLog(r);throw Error(`Could not compile ${s} shader:

${a}${this._processSourceForError(e,a)}`)}return r}_processSourceForError(t,e){if(!t)return e;const i=t.split(`
`),s=e.search(/\d:\d/),r=e.indexOf(" ",s),[o,a]=e.slice(s,r).split(":").map(h=>Number(h));for(let h=0;h<i.length;h++)i[h]=`${h+1}: ${i[h]}${a===h+1?" <----- ERROR!":""}`;return`

Source:
`+i.join(`
`)}}Ie._ACTIVE_SHADER_INSTANCE=null;class hi{constructor(t){this.type="dynamic";const{gl:e,size:i,type:s,data:r}=t;if(this._gl=e,this.buffer=this._gl.createBuffer(),!r&&!i)throw Error("Must either provide data or a size to the VertexBuffer");r?this.bufferData=r:this.bufferData=new Float32Array(i),this.type=s??this.type,e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}unbind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,null)}upload(t){const e=this._gl;e.bindBuffer(e.ARRAY_BUFFER,this.buffer),t?e.bufferSubData(e.ARRAY_BUFFER,0,this.bufferData,0,t):e.bufferData(e.ARRAY_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}class Ei{get vertexBuffer(){return this._vertexBuffer}get attributes(){return this._attributes}constructor(t){this._logger=lt.getInstance(),this._suppressWarnings=!1,this._layout=[],this._attributes=[],this._vertexTotalSizeBytes=0,this._initialized=!1;const{gl:e,shader:i,vertexBuffer:s,attributes:r,suppressWarnings:o}=t;this._gl=e,this._vertexBuffer=s,this._attributes=r,this._shader=i,this._suppressWarnings=o,i&&this.initialize()}get totalVertexSizeBytes(){return this._vertexTotalSizeBytes}set shader(t){t&&this._shader!==t&&(this._shader=t,this.initialize())}get shader(){return this._shader}initialize(){if(this._initialized||!this._shader)return;if(!this._shader.compiled)throw Error("Shader not compiled, shader must be compiled before defining a vertex layout");this._vertexTotalSizeBytes=0,this._layout.length=0;const t=this._shader.attributes;for(const r of this._attributes){const o=t[r[0]];if(!o){if(!Mh(this._shader.vertexSource,r[0]))throw Error(`The attribute named: ${r[0]} size ${r[1]} not found in the shader source code:
 ${this._shader.vertexSource}`);this._suppressWarnings||this._logger.warn(`The attribute named: ${r[0]} size ${r[1]} not found in the compiled shader. This is possibly a bug:
 1. Not a bug, but should remove unused code - attribute "${r[0]}" is unused in vertex/fragment and has been automatically removed by glsl compiler.
 2. Definitely a bug, attribute "${r[0]}" in layout has been mistyped or is missing in shader, check vertex/fragment source.`);const a=Lh(this._gl,this._shader.vertexSource,r[0]);this._layout.push({name:r[0],glType:a,size:r[1],location:-1,normalized:!1})}if(o){if(o.size!==r[1])throw Error(`VertexLayout size definition for attribute: [${r[0]}, ${r[1]}], doesn't match shader source size ${o.size}:
 ${this._shader.vertexSource}`);this._layout.push(o)}}let e=0;for(const r of this._layout){const o=ao(this._gl,r.glType);this._vertexTotalSizeBytes+=o*r.size,e+=r.size}this._vertexBuffer.bufferData.length%e!==0&&this._logger.warn(`The vertex component size (${e})  does NOT divide evenly into the specified vertex buffer (${this._vertexBuffer.bufferData.length})`);const i=this._gl;this._vao=i.createVertexArray(),i.bindVertexArray(this._vao),this._vertexBuffer.bind();let s=0;for(const r of this._layout)r.location!==-1&&(r.glType===i.INT?i.vertexAttribIPointer(r.location,r.size,r.glType,this.totalVertexSizeBytes,s):i.vertexAttribPointer(r.location,r.size,r.glType,r.normalized,this.totalVertexSizeBytes,s),i.enableVertexAttribArray(r.location)),s+=ao(i,r.glType)*r.size;i.bindVertexArray(null),this._vertexBuffer.unbind(),this._initialized=!0}use(t=!1,e){if(!this._shader)throw Error("No shader is associated with this vertex layout, a shader must be set");const i=this._gl;if(!this._shader.isCurrentlyBound())throw Error("Shader associated with this vertex layout is not active! Call shader.use() before layout.use()");this._vertexBuffer.bind(),t&&this._vertexBuffer.upload(e),i.bindVertexArray(this._vao)}}class Gt{static clear(){Gt.DrawCallCount=0,Gt.DrawnImagesCount=0}}Gt.DrawCallCount=0;Gt.DrawnImagesCount=0;class sd{constructor(){this.type="ex.line",this.priority=0,this._maxLines=10922,this._vertexIndex=0,this._lineCount=0,this._startScratch=T(0,0),this._endScratch=T(0,0)}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ie({gl:t,vertexSource:ed,fragmentSource:id}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._vertexBuffer=new hi({gl:t,size:6*2*this._maxLines,type:"dynamic"}),this._layout=new Ei({gl:t,vertexBuffer:this._vertexBuffer,shader:this._shader,attributes:[["a_position",2],["a_color",4]]})}dispose(){this._vertexBuffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(t,e,i){this._isFull()&&this.flush(),this._lineCount++;const s=this._context.getTransform(),r=s.multiply(t,this._startScratch),o=s.multiply(e,this._endScratch),a=this._vertexBuffer.bufferData;a[this._vertexIndex++]=r.x,a[this._vertexIndex++]=r.y,a[this._vertexIndex++]=i.r/255,a[this._vertexIndex++]=i.g/255,a[this._vertexIndex++]=i.b/255,a[this._vertexIndex++]=i.a,a[this._vertexIndex++]=o.x,a[this._vertexIndex++]=o.y,a[this._vertexIndex++]=i.r/255,a[this._vertexIndex++]=i.g/255,a[this._vertexIndex++]=i.b/255,a[this._vertexIndex++]=i.a}_isFull(){return this._lineCount>=this._maxLines}hasPendingDraws(){return this._lineCount!==0}flush(){if(this._lineCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.LINES,0,this._lineCount*2),Gt.DrawnImagesCount+=this._lineCount,Gt.DrawCallCount++,this._vertexIndex=0,this._lineCount=0}}const rd=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
in float a_size;\r
out lowp vec4 v_color;\r
uniform mat4 u_matrix;\r
\r
void main() {\r
  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
  gl_PointSize = a_size * 2.0;\r
  v_color = a_color;\r
}`,nd=`#version 300 es\r
\r
precision mediump float;\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  float r = 0.0, delta = 0.0, alpha = 1.0;\r
  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\r
  r = dot(cxy, cxy);\r
\r
  delta = fwidth(r);\r
  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\r
  // "premultiply" the color by alpha\r
  vec4 color = v_color;\r
  color.a = color.a * alpha;\r
  color.rgb = color.rgb * color.a;\r
  fragColor = color;\r
}`;class od{constructor(){this.type="ex.point",this.priority=0,this._maxPoints=10922,this._pointCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ie({gl:t,vertexSource:rd,fragmentSource:nd}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._buffer=new hi({gl:t,size:7*this._maxPoints,type:"dynamic"}),this._layout=new Ei({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_color",4],["a_size",1]]})}dispose(){this._buffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(t,e,i){this._isFull()&&this.flush(),this._pointCount++;const s=this._context.getTransform(),r=this._context.opacity,o=this._context.snapToPixel,a=s.multiply(t);o&&(a.x=~~(a.x+yt),a.y=~~(a.y+yt));const h=this._buffer.bufferData;h[this._vertexIndex++]=a.x,h[this._vertexIndex++]=a.y,h[this._vertexIndex++]=e.r/255,h[this._vertexIndex++]=e.g/255,h[this._vertexIndex++]=e.b/255,h[this._vertexIndex++]=e.a*r,h[this._vertexIndex++]=i*Math.max(s.getScaleX(),s.getScaleY())}_isFull(){return this._pointCount>=this._maxPoints}hasPendingDraws(){return this._pointCount!==0}flush(){if(this._pointCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.POINTS,0,this._pointCount),Gt.DrawnImagesCount+=this._pointCount,Gt.DrawCallCount++,this._pointCount=0,this._vertexIndex=0}}const ad=`#version 300 es\r
in vec2 a_position;\r
\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
void main() {\r
  gl_Position = vec4(a_position, 0.0, 1.0);\r
\r
  // Pass the texcoord to the fragment shader.\r
  v_texcoord = a_texcoord;\r
}`,hd=`#version 300 es\r
precision mediump float;\r
\r
// Passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// The texture.\r
uniform sampler2D u_texture;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
   fragColor = texture(u_texture, v_texcoord);\r
}`;class ld{constructor(t){this._gl=t,this._shader=new Ie({gl:t,vertexSource:ad,fragmentSource:hd}),this._shader.compile(),this._buffer=new hi({gl:t,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Ei({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}renderWithPostProcessor(t){const e=this._gl,i=t.getShader();i.use(),t.getLayout().use(),e.activeTexture(e.TEXTURE0),i.trySetUniformInt("u_image",0),t.onDraw&&t.onDraw(),e.drawArrays(e.TRIANGLES,0,6)}renderToScreen(){const t=this._gl;this._shader.use(),this._layout.use(),t.drawArrays(t.TRIANGLES,0,6)}}class kr{constructor(t,e,i){this._logger=lt.getInstance(),this._gl=t,this.buffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer);const s=e*6;if(!i)this.bufferData=new Uint32Array(s);else{const a=Math.floor(16383.5);this.bufferGlType=t.UNSIGNED_SHORT,this.bufferData=new Uint16Array(s),e>a&&this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${a}) requested quads(${e})`)}let r=0;for(let o=0;o<s;o+=6)this.bufferData[o+0]=r+0,this.bufferData[o+1]=r+1,this.bufferData[o+2]=r+2,this.bufferData[o+3]=r+2,this.bufferData[o+4]=r+1,this.bufferData[o+5]=r+3,r+=4;t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}get size(){return this.bufferData.length}upload(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}const cd=`#version 300 es\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_texcoord;\r
\r
// Texture index\r
in lowp float v_textureIndex;\r
\r
// Textures in the current draw\r
uniform sampler2D u_textures[%%count%%];\r
\r
uniform bool u_pixelart;\r
\r
// Opacity\r
in float v_opacity;\r
\r
in vec4 v_tint;\r
\r
in vec2 v_res;\r
\r
out vec4 fragColor;\r
\r
// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\r
vec2 uv_iq(in vec2 uv, in vec2 texture_size) {\r
  vec2 pixel = uv * texture_size;\r
  \r
  vec2 seam=floor(pixel+.5);\r
  vec2 dudv=fwidth(pixel);\r
  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\r
  \r
  return pixel/texture_size;\r
}\r
\r
void main(){\r
  // In order to support the most efficient sprite batching, we have multiple\r
  // textures loaded into the gpu (usually 8) this picker logic skips over textures\r
  // that do not apply to a particular sprite.\r
  \r
  vec4 color=vec4(1.,0,0,1.);\r
  \r
  // GLSL is templated out to pick the right texture and set the vec4 color\r
  %%texture_picker%%\r
  \r
  color.rgb=color.rgb*v_opacity;\r
  color.a=color.a*v_opacity;\r
  fragColor=color*v_tint;\r
}`,dd=`#version 300 es\r
in vec2 a_position;\r
\r
// Opacity\r
in float a_opacity;\r
out float v_opacity;\r
\r
// UV coordinate\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
// Texture res\r
in vec2 a_res;\r
out vec2 v_res;\r
\r
// Texture number\r
in lowp float a_textureIndex;\r
out lowp float v_textureIndex;\r
\r
in vec4 a_tint;\r
out vec4 v_tint;\r
\r
uniform mat4 u_matrix;\r
\r
void main(){\r
  // Set the vertex position using the ortho transform matrix\r
  gl_Position=u_matrix*vec4(a_position,0.,1.);\r
  \r
  // Pass through the Opacity to the fragment shader\r
  v_opacity=a_opacity;\r
  // Pass through the UV coord to the fragment shader\r
  v_texcoord=a_texcoord;\r
\r
  v_res = a_res;\r
\r
  // Pass through the texture number to the fragment shader\r
  v_textureIndex=a_textureIndex;\r
  // Pass through the tint\r
  v_tint=a_tint;\r
}`;class ud{constructor(t){this.type="ex.image",this.priority=0,this._maxImages=10922,this._maxTextures=0,this._imageCount=0,this._textures=[],this._textureIndex=0,this._textureToIndex=new Map,this._images=new Set,this._vertexIndex=0,this._imageToWidth=new Map,this._imageToHeight=new Map,this._view=[0,0,0,0],this._dest=[0,0],this._quad=[0,0,0,0,0,0,0,0],this._defaultTint=q.White,this.pixelArtSampler=t.pixelArtSampler,this.uvPadding=t.uvPadding}initialize(t,e){this._gl=t,this._context=e;const i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),s=Yo(t,i);this._maxTextures=Math.min(i,s);const r=this._transformFragmentSource(cd,this._maxTextures);this._shader=new Ie({gl:t,fragmentSource:r,vertexSource:dd}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((o,a)=>a)),this._buffer=new hi({gl:t,size:12*4*this._maxImages,type:"dynamic"}),this._layout=new Ei({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_opacity",1],["a_res",2],["a_texcoord",2],["a_textureIndex",1],["a_tint",4]]}),this._quads=new kr(t,this._maxImages,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._textures.length=0,this._context=null,this._gl=null}_transformFragmentSource(t,e){let i=t.replace("%%count%%",e.toString()),s="";for(let r=0;r<e;r++)r===0?s+=`if (v_textureIndex <= ${r}.5) {
`:s+=`   else if (v_textureIndex <= ${r}.5) {
`,s+=`      vec2 uv = u_pixelart ? uv_iq(v_texcoord, v_res) : v_texcoord;
`,s+=`      color = texture(u_textures[${r}], uv);
`,s+=`   }
`;return i=i.replace("%%texture_picker%%",s),i}_addImageAsTexture(t){if(this._images.has(t))return;const e=t.getAttribute(Pt.Filtering),i=e?Fs(e):void 0,s=Ve(t.getAttribute(Pt.WrappingX)),r=Ve(t.getAttribute(Pt.WrappingY)),o=t.getAttribute("forceUpload")==="true",a=this._context.textureLoader.load(t,{filtering:i,wrapping:{x:s,y:r}},o);t.removeAttribute("forceUpload"),this._textures.indexOf(a)===-1&&(this._textures.push(a),this._textureToIndex.set(a,this._textureIndex++),this._images.add(t))}_bindTextures(t){for(let e=0;e<this._maxTextures;e++)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this._textures[e]||this._textures[0])}_getTextureIdForImage(t){var e;if(t){const i=this._context.textureLoader.get(t);return(e=this._textureToIndex.get(i))!==null&&e!==void 0?e:-1}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}draw(t,e,i,s,r,o,a,h,l){var c,d,A,u;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);const p=this._getImageWidth(t),v=this._getImageHeight(t);let C=p||s||0,y=v||r||0;this._view[0]=0,this._view[1]=0,this._view[2]=(c=s??p)!==null&&c!==void 0?c:0,this._view[3]=(d=r??v)!==null&&d!==void 0?d:0,this._dest[0]=e??1,this._dest[1]=i??1,o!==void 0&&a!==void 0&&h!==void 0&&l!==void 0&&(this._view[0]=e??1,this._view[1]=i??1,this._view[2]=(A=s??p)!==null&&A!==void 0?A:0,this._view[3]=(u=r??v)!==null&&u!==void 0?u:0,this._dest[0]=o,this._dest[1]=a,C=h,y=l),e=this._view[0],i=this._view[1];const b=this._view[2],P=this._view[3],I=this._context.getTransform(),Q=this._context.opacity,O=this._context.snapToPixel;this._quad[0]=this._dest[0],this._quad[1]=this._dest[1],this._quad[2]=this._dest[0]+C,this._quad[3]=this._dest[1],this._quad[4]=this._dest[0],this._quad[5]=this._dest[1]+y,this._quad[6]=this._dest[0]+C,this._quad[7]=this._dest[1]+y,I.multiplyQuadInPlace(this._quad),O&&(this._quad[0]=~~(this._quad[0]+Lt(this._quad[0])*yt),this._quad[1]=~~(this._quad[1]+Lt(this._quad[1])*yt),this._quad[2]=~~(this._quad[2]+Lt(this._quad[2])*yt),this._quad[3]=~~(this._quad[3]+Lt(this._quad[3])*yt),this._quad[4]=~~(this._quad[4]+Lt(this._quad[4])*yt),this._quad[5]=~~(this._quad[5]+Lt(this._quad[5])*yt),this._quad[6]=~~(this._quad[6]+Lt(this._quad[6])*yt),this._quad[7]=~~(this._quad[7]+Lt(this._quad[7])*yt));const B=this._context.tint||this._defaultTint,j=this._getTextureIdForImage(t),$=p||C,st=v||y,Z=(e+this.uvPadding)/$,S=(i+this.uvPadding)/st,z=(e+b-this.uvPadding)/$,f=(i+P-this.uvPadding)/st,X=p,ct=v,D=this._layout.vertexBuffer.bufferData;D[this._vertexIndex++]=this._quad[0],D[this._vertexIndex++]=this._quad[1],D[this._vertexIndex++]=Q,D[this._vertexIndex++]=X,D[this._vertexIndex++]=ct,D[this._vertexIndex++]=Z,D[this._vertexIndex++]=S,D[this._vertexIndex++]=j,D[this._vertexIndex++]=B.r/255,D[this._vertexIndex++]=B.g/255,D[this._vertexIndex++]=B.b/255,D[this._vertexIndex++]=B.a,D[this._vertexIndex++]=this._quad[4],D[this._vertexIndex++]=this._quad[5],D[this._vertexIndex++]=Q,D[this._vertexIndex++]=X,D[this._vertexIndex++]=ct,D[this._vertexIndex++]=Z,D[this._vertexIndex++]=f,D[this._vertexIndex++]=j,D[this._vertexIndex++]=B.r/255,D[this._vertexIndex++]=B.g/255,D[this._vertexIndex++]=B.b/255,D[this._vertexIndex++]=B.a,D[this._vertexIndex++]=this._quad[2],D[this._vertexIndex++]=this._quad[3],D[this._vertexIndex++]=Q,D[this._vertexIndex++]=X,D[this._vertexIndex++]=ct,D[this._vertexIndex++]=z,D[this._vertexIndex++]=S,D[this._vertexIndex++]=j,D[this._vertexIndex++]=B.r/255,D[this._vertexIndex++]=B.g/255,D[this._vertexIndex++]=B.b/255,D[this._vertexIndex++]=B.a,D[this._vertexIndex++]=this._quad[6],D[this._vertexIndex++]=this._quad[7],D[this._vertexIndex++]=Q,D[this._vertexIndex++]=X,D[this._vertexIndex++]=ct,D[this._vertexIndex++]=z,D[this._vertexIndex++]=f,D[this._vertexIndex++]=j,D[this._vertexIndex++]=B.r/255,D[this._vertexIndex++]=B.g/255,D[this._vertexIndex++]=B.b/255,D[this._vertexIndex++]=B.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0,4*12*this._imageCount),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._shader.setUniformBoolean("u_pixelart",this.pixelArtSampler),this._bindTextures(t),this._quads.bind(),t.drawElements(t.TRIANGLES,this._imageCount*6,this._quads.bufferGlType,0),Gt.DrawnImagesCount+=this._imageCount,Gt.DrawCallCount++,this._imageCount=0,this._vertexIndex=0,this._textures.length=0,this._textureIndex=0,this._textureToIndex.clear(),this._images.clear(),this._imageToWidth.clear(),this._imageToHeight.clear()}}const Ad=`#version 300 es\r
\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
in vec2 v_size; // in pixels\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness; // in pixels\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\r
    vec2 uv = v_uv;\r
    vec2 fragCoord = uv * v_size;\r
    float maxX = v_size.x - v_strokeThickness;\r
    float minX = v_strokeThickness;\r
    float maxY = v_size.y - v_strokeThickness;\r
    float minY = v_strokeThickness;\r
\r
    if (fragCoord.x < maxX && fragCoord.x > minX &&\r
        fragCoord.y < maxY && fragCoord.y > minY) {\r
      fragColor = v_color;\r
    } else {\r
      fragColor = v_strokeColor;\r
    }\r
    fragColor.a *= v_opacity;\r
    fragColor.rgb *= fragColor.a;\r
\r
    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\r
    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\r
\r
    // float fHalfBorderDist      = 0.0;\r
    // float fHalfBorderThickness = 0.0;\r
\r
    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \r
    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \r
    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else\r
    // {\r
    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\r
    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\r
    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\r
        \r
    //     float ellipse_ab    = v_radius-v_strokeThickness;\r
    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\r
    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \r
            \r
    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\r
    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\r
    // }\r
\r
    // vec4 v4FromColor = v_strokeColor;\r
    // v4FromColor.rgb *= v4FromColor.a;\r
    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\r
    // if (fHalfBorderDist < 0.0) {\r
    //     v4ToColor = v_color;\r
    //     v4ToColor.rgb *= v4ToColor.a;\r
    // }\r
\r
    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\r
\r
    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\r
    // gl_FragColor = finalColor;\r
}`,gd=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
in vec2 a_size;\r
out vec2 v_size;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through size\r
   v_size = a_size;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class pd{constructor(){this.type="ex.rectangle",this.priority=0,this._maxRectangles=10922,this._rectangleCount=0,this._vertexIndex=0,this._transparent=q.Transparent,this._scratch1=T(0,0),this._scratch2=T(0,0),this._scratch3=T(0,0),this._scratch4=T(0,0)}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ie({gl:t,fragmentSource:Ad,vertexSource:gd}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new hi({gl:t,size:16*4*this._maxRectangles,type:"dynamic"}),this._layout=new Ei({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_size",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new kr(t,this._maxRectangles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._rectangleCount>=this._maxRectangles}draw(...t){t[0]instanceof E&&t[1]instanceof E?this.drawLine.apply(this,t):this.drawRectangle.apply(this,t)}drawLine(t,e,i,s=1){this._isFull()&&this.flush(),this._rectangleCount++;const r=this._context.getTransform(),o=this._context.opacity,a=this._context.snapToPixel,h=e.sub(t),l=h.magnitude,c=h.normalize().perpendicular(),d=s/2,A=r.multiply(c.scale(d,this._scratch1).add(t,this._scratch1),this._scratch1),u=r.multiply(c.scale(-d,this._scratch2).add(t,this._scratch2),this._scratch2),p=r.multiply(c.scale(d,this._scratch3).add(e,this._scratch3),this._scratch3),v=r.multiply(c.scale(-d,this._scratch4).add(e,this._scratch4),this._scratch4);a&&(A.x=~~(A.x+yt),A.y=~~(A.y+yt),p.x=~~(p.x+yt),p.y=~~(p.y+yt),u.x=~~(u.x+yt),u.y=~~(u.y+yt),v.x=~~(v.x+yt),v.y=~~(v.y+yt));const C=0,y=0,b=1,P=1,I=this._transparent,Q=0,O=1,B=this._layout.vertexBuffer.bufferData;B[this._vertexIndex++]=A.x,B[this._vertexIndex++]=A.y,B[this._vertexIndex++]=C,B[this._vertexIndex++]=y,B[this._vertexIndex++]=l,B[this._vertexIndex++]=s,B[this._vertexIndex++]=o,B[this._vertexIndex++]=i.r/255,B[this._vertexIndex++]=i.g/255,B[this._vertexIndex++]=i.b/255,B[this._vertexIndex++]=i.a,B[this._vertexIndex++]=I.r/255,B[this._vertexIndex++]=I.g/255,B[this._vertexIndex++]=I.b/255,B[this._vertexIndex++]=I.a,B[this._vertexIndex++]=Q/O,B[this._vertexIndex++]=u.x,B[this._vertexIndex++]=u.y,B[this._vertexIndex++]=C,B[this._vertexIndex++]=P,B[this._vertexIndex++]=l,B[this._vertexIndex++]=s,B[this._vertexIndex++]=o,B[this._vertexIndex++]=i.r/255,B[this._vertexIndex++]=i.g/255,B[this._vertexIndex++]=i.b/255,B[this._vertexIndex++]=i.a,B[this._vertexIndex++]=I.r/255,B[this._vertexIndex++]=I.g/255,B[this._vertexIndex++]=I.b/255,B[this._vertexIndex++]=I.a,B[this._vertexIndex++]=Q/O,B[this._vertexIndex++]=p.x,B[this._vertexIndex++]=p.y,B[this._vertexIndex++]=b,B[this._vertexIndex++]=y,B[this._vertexIndex++]=l,B[this._vertexIndex++]=s,B[this._vertexIndex++]=o,B[this._vertexIndex++]=i.r/255,B[this._vertexIndex++]=i.g/255,B[this._vertexIndex++]=i.b/255,B[this._vertexIndex++]=i.a,B[this._vertexIndex++]=I.r/255,B[this._vertexIndex++]=I.g/255,B[this._vertexIndex++]=I.b/255,B[this._vertexIndex++]=I.a,B[this._vertexIndex++]=Q/O,B[this._vertexIndex++]=v.x,B[this._vertexIndex++]=v.y,B[this._vertexIndex++]=b,B[this._vertexIndex++]=P,B[this._vertexIndex++]=l,B[this._vertexIndex++]=s,B[this._vertexIndex++]=o,B[this._vertexIndex++]=i.r/255,B[this._vertexIndex++]=i.g/255,B[this._vertexIndex++]=i.b/255,B[this._vertexIndex++]=i.a,B[this._vertexIndex++]=I.r/255,B[this._vertexIndex++]=I.g/255,B[this._vertexIndex++]=I.b/255,B[this._vertexIndex++]=I.a,B[this._vertexIndex++]=Q/O}drawRectangle(t,e,i,s,r=q.Transparent,o=0){this._isFull()&&this.flush(),this._rectangleCount++;const a=this._context.getTransform(),h=this._context.opacity,l=this._context.snapToPixel,c=a.multiply(t.add(T(0,0))),d=a.multiply(t.add(T(e,0))),A=a.multiply(t.add(T(e,i))),u=a.multiply(t.add(T(0,i)));l&&(c.x=~~(c.x+yt),c.y=~~(c.y+yt),d.x=~~(d.x+yt),d.y=~~(d.y+yt),u.x=~~(u.x+yt),u.y=~~(u.y+yt),A.x=~~(A.x+yt),A.y=~~(A.y+yt));const p=0,v=0,C=1,y=1,b=this._layout.vertexBuffer.bufferData;b[this._vertexIndex++]=c.x,b[this._vertexIndex++]=c.y,b[this._vertexIndex++]=p,b[this._vertexIndex++]=v,b[this._vertexIndex++]=e,b[this._vertexIndex++]=i,b[this._vertexIndex++]=h,b[this._vertexIndex++]=s.r/255,b[this._vertexIndex++]=s.g/255,b[this._vertexIndex++]=s.b/255,b[this._vertexIndex++]=s.a,b[this._vertexIndex++]=r.r/255,b[this._vertexIndex++]=r.g/255,b[this._vertexIndex++]=r.b/255,b[this._vertexIndex++]=r.a,b[this._vertexIndex++]=o,b[this._vertexIndex++]=u.x,b[this._vertexIndex++]=u.y,b[this._vertexIndex++]=p,b[this._vertexIndex++]=y,b[this._vertexIndex++]=e,b[this._vertexIndex++]=i,b[this._vertexIndex++]=h,b[this._vertexIndex++]=s.r/255,b[this._vertexIndex++]=s.g/255,b[this._vertexIndex++]=s.b/255,b[this._vertexIndex++]=s.a,b[this._vertexIndex++]=r.r/255,b[this._vertexIndex++]=r.g/255,b[this._vertexIndex++]=r.b/255,b[this._vertexIndex++]=r.a,b[this._vertexIndex++]=o,b[this._vertexIndex++]=d.x,b[this._vertexIndex++]=d.y,b[this._vertexIndex++]=C,b[this._vertexIndex++]=v,b[this._vertexIndex++]=e,b[this._vertexIndex++]=i,b[this._vertexIndex++]=h,b[this._vertexIndex++]=s.r/255,b[this._vertexIndex++]=s.g/255,b[this._vertexIndex++]=s.b/255,b[this._vertexIndex++]=s.a,b[this._vertexIndex++]=r.r/255,b[this._vertexIndex++]=r.g/255,b[this._vertexIndex++]=r.b/255,b[this._vertexIndex++]=r.a,b[this._vertexIndex++]=o,b[this._vertexIndex++]=A.x,b[this._vertexIndex++]=A.y,b[this._vertexIndex++]=C,b[this._vertexIndex++]=y,b[this._vertexIndex++]=e,b[this._vertexIndex++]=i,b[this._vertexIndex++]=h,b[this._vertexIndex++]=s.r/255,b[this._vertexIndex++]=s.g/255,b[this._vertexIndex++]=s.b/255,b[this._vertexIndex++]=s.a,b[this._vertexIndex++]=r.r/255,b[this._vertexIndex++]=r.g/255,b[this._vertexIndex++]=r.b/255,b[this._vertexIndex++]=r.a,b[this._vertexIndex++]=o}hasPendingDraws(){return this._rectangleCount!==0}flush(){if(this._rectangleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._rectangleCount*6,this._quads.bufferGlType,0),Gt.DrawnImagesCount+=this._rectangleCount,Gt.DrawCallCount++,this._rectangleCount=0,this._vertexIndex=0}}const fd=`#version 300 es\r
precision highp float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness;\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  // make (0, 0) the center the uv \r
  vec2 uv = v_uv * 2.0 - 1.0;\r
\r
  vec4 color = v_color;\r
  vec4 strokeColor = v_strokeColor;\r
\r
  // circle border is at radius 1.0 \r
  // dist is > 0 when inside the circle \r
  float d = length(uv);\r
  float dist = 1.0 - length(uv);\r
\r
  // Fade based on fwidth\r
  float fade = fwidth(dot(uv, uv));\r
\r
  // if dist is greater than 0 step to 1;\r
  // when we cross this 0 threshold add a smooth fade\r
  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\r
\r
  // if dist is greater than the stroke thickness step to 1\r
  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\r
\r
  strokeColor.a *= fill * stroke;\r
  strokeColor.rgb *= strokeColor.a;\r
\r
  color.a *= fill * (1.0 - stroke);\r
  color.rgb *= color.a;\r
\r
  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\r
  finalColor.rgb = finalColor.rgb * v_opacity;\r
  finalColor.a = finalColor.a * v_opacity;\r
  fragColor = finalColor;\r
}`,_d=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class md{constructor(){this.type="ex.circle",this.priority=0,this._maxCircles=10922,this._circleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ie({gl:t,fragmentSource:fd,vertexSource:_d}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new hi({gl:t,size:14*4*this._maxCircles,type:"dynamic"}),this._layout=new Ei({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new kr(t,this._maxCircles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._circleCount>=this._maxCircles}draw(t,e,i,s=q.Transparent,r=0){this._isFull()&&this.flush(),this._circleCount++;const o=this._context.getTransform(),a=this._context.opacity,h=this._context.snapToPixel,l=o.multiply(t.add(T(-e,-e))),c=o.multiply(t.add(T(e,-e))),d=o.multiply(t.add(T(e,e))),A=o.multiply(t.add(T(-e,e)));h&&(l.x=~~(l.x+yt),l.y=~~(l.y+yt),c.x=~~(c.x+yt),c.y=~~(c.y+yt),A.x=~~(A.x+yt),A.y=~~(A.y+yt),d.x=~~(d.x+yt),d.y=~~(d.y+yt));const u=0,p=0,v=1,C=1,y=this._layout.vertexBuffer.bufferData;y[this._vertexIndex++]=l.x,y[this._vertexIndex++]=l.y,y[this._vertexIndex++]=u,y[this._vertexIndex++]=p,y[this._vertexIndex++]=a,y[this._vertexIndex++]=i.r/255,y[this._vertexIndex++]=i.g/255,y[this._vertexIndex++]=i.b/255,y[this._vertexIndex++]=i.a,y[this._vertexIndex++]=s.r/255,y[this._vertexIndex++]=s.g/255,y[this._vertexIndex++]=s.b/255,y[this._vertexIndex++]=s.a,y[this._vertexIndex++]=r/e,y[this._vertexIndex++]=A.x,y[this._vertexIndex++]=A.y,y[this._vertexIndex++]=u,y[this._vertexIndex++]=C,y[this._vertexIndex++]=a,y[this._vertexIndex++]=i.r/255,y[this._vertexIndex++]=i.g/255,y[this._vertexIndex++]=i.b/255,y[this._vertexIndex++]=i.a,y[this._vertexIndex++]=s.r/255,y[this._vertexIndex++]=s.g/255,y[this._vertexIndex++]=s.b/255,y[this._vertexIndex++]=s.a,y[this._vertexIndex++]=r/e,y[this._vertexIndex++]=c.x,y[this._vertexIndex++]=c.y,y[this._vertexIndex++]=v,y[this._vertexIndex++]=p,y[this._vertexIndex++]=a,y[this._vertexIndex++]=i.r/255,y[this._vertexIndex++]=i.g/255,y[this._vertexIndex++]=i.b/255,y[this._vertexIndex++]=i.a,y[this._vertexIndex++]=s.r/255,y[this._vertexIndex++]=s.g/255,y[this._vertexIndex++]=s.b/255,y[this._vertexIndex++]=s.a,y[this._vertexIndex++]=r/e,y[this._vertexIndex++]=d.x,y[this._vertexIndex++]=d.y,y[this._vertexIndex++]=v,y[this._vertexIndex++]=C,y[this._vertexIndex++]=a,y[this._vertexIndex++]=i.r/255,y[this._vertexIndex++]=i.g/255,y[this._vertexIndex++]=i.b/255,y[this._vertexIndex++]=i.a,y[this._vertexIndex++]=s.r/255,y[this._vertexIndex++]=s.g/255,y[this._vertexIndex++]=s.b/255,y[this._vertexIndex++]=s.a,y[this._vertexIndex++]=r/e}hasPendingDraws(){return this._circleCount!==0}flush(){if(this._circleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._circleCount*6,this._quads.bufferGlType,0),Gt.DrawnImagesCount+=this._circleCount,Gt.DrawCallCount++,this._circleCount=0,this._vertexIndex=0}}class In{constructor(t,e,i=100){this.builder=t,this.recycler=e,this.maxObjects=i,this.totalAllocations=0,this.index=0,this.objects=[],this.disableWarnings=!1,this._logger=lt.getInstance()}dispose(){this.objects.length=0}preallocate(){for(let t=0;t<this.maxObjects;t++)this.objects[t]=this.builder()}using(t){const e=t(this);return e?this.done(...e):this.done()}borrow(t){const e=this.get();t(e),this.index--}get(){return this.index===this.maxObjects&&(this.disableWarnings||this._logger.warn("Max pooled objects reached, possible memory leak? Doubling"),this.maxObjects=this.maxObjects*2),this.objects[this.index]?this.recycler?this.recycler(this.objects[this.index++]):this.objects[this.index++]:(this.totalAllocations++,this.objects[this.index++]=this.builder())}done(...t){this.index=0;for(const e of t){const i=this.objects.indexOf(e);this.objects[i]=this.builder(),this.totalAllocations++}return t}}class vd{constructor(){this.z=0,this.priority=0,this.renderer="",this.transform=te.identity(),this.state={z:0,opacity:1,tint:q.White,material:null},this.args=new Array(10)}}const wd=`#version 300 es
in vec2 a_position;

in vec2 a_uv;
out vec2 v_uv;

in vec2 a_screenuv;
out vec2 v_screenuv;

uniform mat4 u_matrix;
uniform mat4 u_transform;

void main() {
  // Set the vertex position using the ortho & transform matrix
  gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);

  // Pass through the UV coord to the fragment shader
  v_uv = a_uv;
  v_screenuv = a_screenuv;
}
`;class Nh{constructor(t){this._logger=lt.getInstance(),this._color=q.Transparent,this._initialized=!1,this._images=new Map,this._textures=new Map;const{color:e,name:i,vertexSource:s,fragmentSource:r,graphicsContext:o,images:a}=t;if(this._name=i??"anonymous material",this._vertexSource=s??wd,this._fragmentSource=r,this._color=e??this._color,!o)throw Error(`Material ${i} must be provided an excalibur webgl graphics context`);if(o instanceof wi?(this._graphicsContext=o,this._initialize(o)):this._logger.warn(`Material ${i} was created in 2D Canvas mode, currently only WebGL is supported`),a)for(const h in a)this.addImageSource(h,a[h])}_initialize(t){if(this._initialized)return;const e=t.__gl;this._maxTextureSlots=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)-2,this._shader=t.createShader({vertexSource:this._vertexSource,fragmentSource:this._fragmentSource}),this._shader.compile(),this._initialized=!0}get color(){return this._color}set color(t){this._color=t}get name(){var t;return(t=this._name)!==null&&t!==void 0?t:"anonymous material"}get isUsingScreenTexture(){return this._fragmentSource.includes("u_screen_texture")}update(t){this._shader&&(this._shader.use(),t(this._shader))}getShader(){return this._shader}addImageSource(t,e){this._images.size<this._maxTextureSlots?this._images.set(t,e):this._logger.warn(`Max number texture slots ${this._maxTextureSlots} have been reached for material "${this.name}", no more textures will be uploaded due to hardware constraints.`)}removeImageSource(t){const e=this._images.get(t);this._graphicsContext.textureLoader.delete(e.image),this._images.delete(t)}_loadImageSource(t){const e=t.image,i=e.getAttribute(Pt.Filtering),s=i?Fs(i):void 0,r=Ve(e.getAttribute(Pt.WrappingX)),o=Ve(e.getAttribute(Pt.WrappingY)),a=e.getAttribute("forceUpload")==="true",h=this._graphicsContext.textureLoader.load(e,{filtering:s,wrapping:{x:r,y:o}},a);return e.removeAttribute("forceUpload"),this._textures.has(t)||this._textures.set(t,h),h}uploadAndBind(t,e=2){let i=e;for(const[s,r]of this._images.entries()){if(!r.isLoaded()){this._logger.warnOnce(`Image named ${s} in material ${this.name} not loaded, nothing will be uploaded to the shader. Did you forget to add this to a loader? https://excaliburjs.com/docs/loaders/`);continue}const o=this._loadImageSource(r);t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,o),this._shader.trySetUniformInt(s,i),i++}}use(){if(this._initialized)this._shader.use(),this._shader.trySetUniformFloatColor("u_color",this._color);else throw Error(`Material ${this.name} not yet initialized, use the ExcaliburGraphicsContext.createMaterial() to work around this.`)}}class nh{constructor(){this.type="ex.material",this.priority=0,this._textures=[]}initialize(t,e){this._gl=t,this._context=e,this._buffer=new hi({gl:t,size:6*4,type:"dynamic"}),this._layout=new Ei({gl:t,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_screenuv",2]],suppressWarnings:!0}),this._quads=new kr(t,1,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._textures.length=0,this._context=null,this._gl=null}draw(t,e,i,s,r,o,a,h,l){var c,d,A,u;const p=this._gl,v=this._context.material;if(!v)return;const C=this._context.getTransform(),y=this._context.opacity,b=v.getShader(),P=this._layout.vertexBuffer.bufferData;let I=0,Q=t?.width||s||0,O=t?.height||r||0,B=[0,0,(c=s??t?.width)!==null&&c!==void 0?c:0,(d=r??t?.height)!==null&&d!==void 0?d:0],j=[e??1,i??1];o!==void 0&&a!==void 0&&h!==void 0&&l!==void 0&&(B=[e??1,i??1,(A=s??t?.width)!==null&&A!==void 0?A:0,(u=r??t?.height)!==null&&u!==void 0?u:0],j=[o,a],Q=h,O=l),e=B[0],i=B[1];const $=B[2],st=B[3],Z=T(j[0],j[1]),S=T(j[0]+Q,j[1]),z=T(j[0],j[1]+O),f=T(j[0]+Q,j[1]+O),X=t.width||Q,ct=t.height||O,D=e/X,wt=i/ct,K=(e+$-.01)/X,pt=(i+st-.01)/ct,M=C.getPosition(),F=M.add(f),nt=M.x/this._context.width,Ct=M.y/this._context.height,rt=F.x/this._context.width,Vt=F.y/this._context.height;P[I++]=Z.x,P[I++]=Z.y,P[I++]=D,P[I++]=wt,P[I++]=nt,P[I++]=Ct,P[I++]=z.x,P[I++]=z.y,P[I++]=D,P[I++]=pt,P[I++]=nt,P[I++]=Vt,P[I++]=S.x,P[I++]=S.y,P[I++]=K,P[I++]=wt,P[I++]=rt,P[I++]=Ct,P[I++]=f.x,P[I++]=f.y,P[I++]=K,P[I++]=pt,P[I++]=rt,P[I++]=Vt;const Re=this._addImageAsTexture(t);v.use(),this._layout.shader=b,this._layout.use(!0),b.trySetUniformFloat("u_time_ms",performance.now()),b.trySetUniformFloat("u_opacity",y),b.trySetUniformFloatVector("u_resolution",T(this._context.width,this._context.height)),b.trySetUniformFloatVector("u_graphic_resolution",T(X,ct)),b.trySetUniformFloatVector("u_size",T($,st)),b.trySetUniformMatrix("u_matrix",this._context.ortho),b.trySetUniformMatrix("u_transform",C.to4x4()),p.activeTexture(p.TEXTURE0+0),p.bindTexture(p.TEXTURE_2D,Re),b.trySetUniformInt("u_graphic",0),p.activeTexture(p.TEXTURE0+1),p.bindTexture(p.TEXTURE_2D,this._context.materialScreenTexture),b.trySetUniformInt("u_screen_texture",1),v.uploadAndBind(p),this._quads.bind(),p.drawElements(p.TRIANGLES,6,this._quads.bufferGlType,0),Gt.DrawnImagesCount++,Gt.DrawCallCount++}_addImageAsTexture(t){const e=t.getAttribute(Pt.Filtering),i=e?Fs(e):void 0,s=Ve(t.getAttribute(Pt.WrappingX)),r=Ve(t.getAttribute(Pt.WrappingY)),o=t.getAttribute("forceUpload")==="true",a=this._context.textureLoader.load(t,{filtering:i,wrapping:{x:s,y:r}},o);return t.removeAttribute("forceUpload"),this._textures.indexOf(a)===-1&&this._textures.push(a),a}hasPendingDraws(){return!1}flush(){}}const yd=`#version 300 es\r
precision mediump float;\r
\r
uniform float deltaMs;\r
uniform float maxLifeMs;\r
uniform vec2 gravity;\r
uniform vec2 focus;\r
uniform float focusAccel;\r
uniform mat4 u_matrix;\r
uniform mat4 u_transform;\r
uniform float startSize;\r
uniform float endSize;\r
// uniform sampler2D obstacle;\r
\r
layout(location=0)in vec2 position;\r
layout(location=1)in vec2 velocity;\r
layout(location=2)in float rotation;\r
layout(location=3)in float angularVelocity;\r
layout(location=4)in float lifeMs;\r
\r
// TODO z index to handle buffer wrapping?\r
\r
// DO NOT RE-ORDER\r
out vec2 finalPosition;\r
out vec2 finalVelocity;\r
out float finalRotation;\r
out float finalAngularVelocity;\r
out float finalLifeMs;\r
void main(){\r
  // Evolve particle\r
  float seconds = deltaMs / 1000.;\r
  // euler integration\r
  // Weird artifact of re-using the same buffer layout for update/draw\r
  // we need differently named variables\r
  vec2 finalGravity = gravity + normalize(focus - position) * focusAccel;\r
  finalVelocity = velocity + finalGravity * seconds;\r
  finalPosition = position + velocity * seconds + finalGravity * .5 * seconds * seconds;\r
  finalRotation = rotation + angularVelocity * seconds;\r
  finalAngularVelocity = angularVelocity;\r
  finalLifeMs = clamp(lifeMs - deltaMs, 0., maxLifeMs);\r
\r
  // Collision mask sampling\r
  // vec2 samplePoint = finalPosition / vec2(width, height);\r
  // vec4 collides = texture(obstacle, samplePoint);\r
  // if (distance(collides,vec4(0.)) > .01) {\r
  //   // non opaque means we collide! recalc final pos/vel\r
  //   vec2 newVelocity = velocity * -.1;// lose energy\r
  //   finalVelocity = newVelocity + gravity * seconds;\r
  //   finalPosition = position + newVelocity * seconds + gravity * .5 * seconds * seconds;\r
  // }\r
\r
  float lifePercent = finalLifeMs / maxLifeMs;\r
  vec2 transformedPos = (u_matrix * u_transform * vec4(finalPosition,0.,1.)).xy;\r
  float scale = sqrt(u_transform[0][0] * u_transform[0][0] + u_transform[1][1] * u_transform[1][1]);\r
  gl_Position = vec4(transformedPos, 1.0 - lifePercent, 1.); // use life percent to sort z\r
  gl_PointSize = mix(startSize, endSize, 1.0 - lifePercent) * scale;\r
}`,Cd=`#version 300 es\r
precision mediump float;\r
\r
uniform sampler2D graphic;\r
uniform bool useTexture;\r
uniform float maxLifeMs;\r
\r
uniform vec4 beginColor;\r
uniform vec4 endColor;\r
uniform bool fade;\r
uniform float startOpacity;\r
\r
in float finalRotation;\r
in float finalLifeMs;\r
out vec4 fragColor;\r
\r
void main(){\r
\r
  float lifePct = finalLifeMs / maxLifeMs;\r
\r
  if (useTexture) {\r
    /** Draw texture */\r
    if (lifePct <= 0.) discard;\r
    float mid = .5;\r
    float cosine = cos(finalRotation);\r
    float sine = sin(finalRotation);\r
    vec2 rotated = vec2(cosine * (gl_PointCoord.x - mid) + sine * (gl_PointCoord.y - mid) + mid,\r
                        cosine * (gl_PointCoord.y - mid) - sine * (gl_PointCoord.x - mid) + mid);\r
    vec4 color = texture(graphic, rotated);\r
    fragColor = color * (fade ? lifePct : 1.0);\r
  } else {\r
    /** Draw circle */\r
    if (lifePct <= 0.) discard;\r
    vec2 uv = gl_PointCoord.xy * 2.0 - 1.0;\r
    float dist = 1.0 - length(uv);\r
    float edge = fwidth(dot(uv, uv));\r
    float circle = smoothstep(-edge/2.0, edge/2.0, dist);\r
    vec3 color = mix(beginColor.rgb, endColor.rgb, 1.0 - lifePct);\r
    fragColor.rgb = color;\r
    fragColor.a = startOpacity * circle * (fade ? lifePct : 1.0);// * mix(beginColor.a, endColor.a, 1.0 - lifePct);\r
    fragColor.rgb *= fragColor.a;\r
  }\r
}`;var Ae;(function(n){n.World="world",n.Screen="screen"})(Ae||(Ae={}));class ho extends E{constructor(t){super(0,0),this._getX=t.getX,this._getY=t.getY,this._setX=t.setX,this._setY=t.setY}get x(){return this._x=this._getX()}set x(t){this._setX(t),this._x=t}get y(){return this._y=this._getY()}set y(t){this._setY(t),this._y=t}}class Qi extends E{constructor(t,e){super(t.x,t.y),this.original=t,this.change=e}get x(){return this._x=this.original.x}set x(t){t!==this._x&&(this.change(t,this._y),this._x=this.original.x=t)}get y(){return this._y=this.original.y}set y(t){t!==this._y&&(this.change(this._x,t),this._y=this.original.y=t)}setTo(t,e){this.x=t,this.y=e}}class xi{constructor(){this._parent=null,this._children=[],this._pos=new Qi(T(0,0),()=>{this.flagDirty()}),this._globalPos=new ho({getX:()=>this.matrix.data[4],getY:()=>this.matrix.data[5],setX:t=>{if(this.parent){const{x:e}=this.parent.inverse.multiply(T(t,this.pos.y));this.pos.x=e}else this.pos.x=t;t!==this.matrix.data[4]&&this.flagDirty()},setY:t=>{if(this.parent){const{y:e}=this.parent.inverse.multiply(T(this.pos.x,t));this.pos.y=e}else this.pos.y=t;t!==this.matrix.data[5]&&this.flagDirty()}}),this._rotation=0,this._scale=new Qi(T(1,1),()=>{this.flagDirty()}),this._globalScale=new ho({getX:()=>this.parent?this.matrix.getScaleX():this.scale.x,getY:()=>this.parent?this.matrix.getScaleY():this.scale.y,setX:t=>{if(this.parent){const e=this.parent.globalScale.x;this.scale.x=t/e}else this.scale.x=t},setY:t=>{if(this.parent){const e=this.parent.globalScale.y;this.scale.y=t/e}else this.scale.y=t}}),this._z=0,this._isDirty=!1,this._isInverseDirty=!1,this._matrix=te.identity(),this._inverse=te.identity(),this._scratch=te.identity()}get parent(){return this._parent}set parent(t){if(this._parent){const e=this._parent._children.indexOf(this);e>-1&&this._parent._children.splice(e,1)}this._parent=t,this._parent&&this._parent._children.push(this),this.flagDirty()}get children(){return this._children}set pos(t){this._pos.x=t.x,this._pos.y=t.y}get pos(){return this._pos}set globalPos(t){let e=t.clone();this.parent&&(e=this.parent.inverse.multiply(t)),e.equals(this._pos)||(this._pos=e,this.flagDirty())}get globalPos(){return this._globalPos}set rotation(t){const e=vi(t);e!==this._rotation&&this.flagDirty(),this._rotation=e}get rotation(){return this._rotation}set globalRotation(t){let e=0;this.parent&&(e=this.parent.globalRotation);const i=vi(t+e);i!==this._rotation&&this.flagDirty(),this._rotation=i}get globalRotation(){return this.parent?this.matrix.getRotation():this.rotation}set scale(t){this._scale.x=t.x,this._scale.y=t.y}get scale(){return this._scale}set globalScale(t){let e=T(1,1);this.parent&&(e=this.parent.globalScale),this.scale=t.scale(T(1/e.x,1/e.y))}get globalScale(){return this._globalScale}set z(t){this._z=t,this.flagDirty()}get z(){return this._z}set globalZ(t){this.parent?this.z=t-this.parent.globalZ:this.z=t}get globalZ(){return this.parent?this.z+this.parent.globalZ:this.z}get matrix(){return this._isDirty&&(this.parent===null?this._calculateMatrix().clone(this._matrix):this.parent.matrix.multiply(this._calculateMatrix()).clone(this._matrix),this._isDirty=!1),this._matrix}get inverse(){return this._isInverseDirty&&(this.matrix.inverse(this._inverse),this._isInverseDirty=!1),this._inverse}_calculateMatrix(){return this._scratch.data[0]=Math.cos(this._rotation),this._scratch.data[1]=Math.sin(this._rotation),this._scratch.data[2]=-Math.sin(this._rotation),this._scratch.data[3]=Math.cos(this.rotation),this._scratch.data[4]=this._pos.x,this._scratch.data[5]=this._pos.y,this._scratch.scale(this._scale.x,this._scale.y),this._scratch}flagDirty(){this._isDirty=!0,this._isInverseDirty=!0;for(let t=0;t<this._children.length;t++)this._children[t].flagDirty()}apply(t){return this.matrix.multiply(t)}applyInverse(t){return this.inverse.multiply(t)}setTransform(t,e,i){this._pos.x=t.x,this._pos.y=t.y,this._rotation=vi(e),this._scale.x=i.x,this._scale.y=i.y,this.flagDirty()}isMirrored(){const t=Lt(this.scale.x)>>>31,e=Lt(this.scale.y)>>>31;return!!(t^e)}clone(t){const e=t??new xi;return this._pos.clone(e._pos),e._z=this._z,e._rotation=this._rotation,this._scale.clone(e._scale),e.flagDirty(),e}cloneWithParent(t){const e=t??new xi;return this._pos.clone(e._pos),e._z=this._z,e._rotation=this._rotation,this._scale.clone(e._scale),e.parent=this.parent,e.flagDirty(),e}toString(){return this.matrix.toString()}}function zh(n){return!!n&&!!n.prototype&&!!n.prototype.constructor}function xd(n){return!!n?.clone}class Ue{constructor(){this.owner=void 0}clone(){const t=new this.constructor;for(const e in this)if(this.hasOwnProperty(e)){const i=this[e];xd(i)&&e!=="owner"&&e!=="clone"?t[e]=i.clone():t[e]=i}return t}}class ve{constructor(){this.observers=[],this.subscriptions=[]}register(t){this.observers.push(t)}subscribe(t){this.subscriptions.push(t)}unregister(t){const e=this.observers.indexOf(t);e!==-1&&this.observers.splice(e,1)}unsubscribe(t){const e=this.subscriptions.indexOf(t);e!==-1&&this.subscriptions.splice(e,1)}notifyAll(t){const e=this.observers.length;for(let s=0;s<e;s++)this.observers[s].notify(t);const i=this.subscriptions.length;for(let s=0;s<i;s++)this.subscriptions[s](t)}clear(){this.observers.length=0,this.subscriptions.length=0}}class tt extends Ue{constructor(){super(...arguments),this._logger=lt.getInstance(),this._parentComponent=null,this._transform=new xi,this._addChildTransform=t=>{const e=t.get(tt);e&&(e._transform.parent=this._transform,e._parentComponent=this)},this.zIndexChanged$=new ve,this._coordPlane=Ae.World}get(){return this._transform}onAdd(t){for(const e of t.children)this._addChildTransform(e);t.childrenAdded$.subscribe(e=>this._addChildTransform(e)),t.childrenRemoved$.subscribe(e=>{const i=e.get(tt);i&&(i._transform.parent=null,i._parentComponent=null)})}onRemove(t){this._transform.parent=null,this._parentComponent=null}get z(){return this._transform.z}set z(t){const e=this._transform.z;this._transform.z=t,e!==t&&this.zIndexChanged$.notifyAll(t)}get globalZ(){return this._transform.globalZ}set globalZ(t){this._transform.globalZ=t}get coordPlane(){return this._parentComponent?this._parentComponent.coordPlane:this._coordPlane}set coordPlane(t){var e;this._parentComponent?this._logger.warn(`Cannot set coordinate plane on child entity ${(e=this.owner)===null||e===void 0?void 0:e.name}, children inherit their coordinate plane from their parents.`):this._coordPlane=t}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get globalPos(){return this._transform.globalPos}set globalPos(t){this._transform.globalPos=t}get rotation(){return this._transform.rotation}set rotation(t){this._transform.rotation=t}get globalRotation(){return this._transform.globalRotation}set globalRotation(t){this._transform.globalRotation=t}get scale(){return this._transform.scale}set scale(t){this._transform.scale=t}get globalScale(){return this._transform.globalScale}set globalScale(t){this._transform.globalScale=t}applyInverse(t){return this._transform.applyInverse(t)}apply(t){return this._transform.apply(t)}clone(){const t=new tt;return t._transform=this._transform.clone(),t}}var Js;(function(n){n.Forward="forward",n.Backward="backward"})(Js||(Js={}));var Ge;(function(n){n.End="end",n.Loop="loop",n.PingPong="pingpong",n.Freeze="freeze"})(Ge||(Ge={}));const bd={Frame:"frame",Loop:"loop",End:"end"};class ze extends qt{constructor(t){var e,i,s;super(t),this.events=new Nt,this.frames=[],this.strategy=Ge.Loop,this.frameDuration=100,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._pingPongDirection=1,this._done=!1,this._playing=!0,this._speed=1,this._reversed=!1,this.frames=t.frames,this.speed=(e=t.speed)!==null&&e!==void 0?e:this.speed,this.strategy=(i=t.strategy)!==null&&i!==void 0?i:this.strategy,this.frameDuration=t.totalDuration?t.totalDuration/this.frames.length:(s=t.frameDuration)!==null&&s!==void 0?s:this.frameDuration,t.reverse&&this.reverse(),this.goToFrame(0)}clone(){return new ze({frames:this.frames.map(t=>({...t})),frameDuration:this.frameDuration,speed:this.speed,reverse:this._reversed,strategy:this.strategy,...this.cloneGraphicOptions()})}get width(){const t=this.currentFrame;return t&&t.graphic?Math.abs(t.graphic.width*this.scale.x):0}get height(){const t=this.currentFrame;return t&&t.graphic?Math.abs(t.graphic.height*this.scale.y):0}static fromSpriteSheet(t,e,i,s=Ge.Loop){const r=t.sprites.length-1,o=e.filter(a=>a<0||a>r);return o.length&&ze._LOGGER.warn(`Indices into SpriteSheet were provided that don't exist: ${o.join(",")} no frame will be shown`),new ze({frames:t.sprites.filter((a,h)=>e.indexOf(h)>-1).map(a=>({graphic:a,duration:i})),strategy:s})}static fromSpriteSheetCoordinates(t){var e;const{spriteSheet:i,frameCoordinates:s,durationPerFrame:r,durationPerFrameMs:o,speed:a,strategy:h,reverse:l}=t,c=(e=r??o)!==null&&e!==void 0?e:100,d=[];for(const A of s){const{x:u,y:p,duration:v,options:C}=A,y=i.getSprite(u,p,C);y?d.push({graphic:y,duration:v??c}):ze._LOGGER.warn(`Skipping frame! SpriteSheet does not have coordinate (${u}, ${p}), please check your SpriteSheet to confirm that sprite exists`)}return new ze({frames:d,strategy:h,speed:a,reverse:l})}get speed(){return this._speed}set speed(t){this._speed=It(Math.abs(t),0,1/0)}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get currentFrameIndex(){return this._currentFrame}get currentFrameTimeLeft(){return this._timeLeftInFrame}get isPlaying(){return this._playing}get isReversed(){return this._reversed}reverse(){this.frames=this.frames.slice().reverse(),this._reversed=!this._reversed}get direction(){return!!(this._reversed&&this._pingPongDirection===1)?Js.Backward:Js.Forward}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._done=!1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=this.frameDuration;const t=this.frames[this._currentFrame];t&&(this._timeLeftInFrame=t?.duration||this.frameDuration)}get canFinish(){switch(this.strategy){case Ge.End:case Ge.Freeze:return!0;default:return!1}}get done(){return this._done}goToFrame(t,e){this._currentFrame=t,this._timeLeftInFrame=e??this.frameDuration;const i=this.frames[this._currentFrame];i&&!this._done&&(this._timeLeftInFrame=e??(i?.duration||this.frameDuration),this.events.emit("frame",{...i,frameIndex:this.currentFrameIndex}))}_nextFrame(){const t=this._currentFrame;if(this._done)return t;let e=-1;switch(this.strategy){case Ge.Loop:{e=(t+1)%this.frames.length,e===0&&this.events.emit("loop",this);break}case Ge.End:{e=t+1,e>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break}case Ge.Freeze:{e=It(t+1,0,this.frames.length-1),e>=this.frames.length-1&&(this._done=!0,this.events.emit("end",this));break}case Ge.PingPong:{t+this._pingPongDirection>=this.frames.length&&(this._pingPongDirection=-1,this.events.emit("loop",this)),t+this._pingPongDirection<0&&(this._pingPongDirection=1,this.events.emit("loop",this)),e=t+this._pingPongDirection%this.frames.length;break}}return e}tick(t,e=0){this._idempotencyToken!==e&&(this._idempotencyToken=e,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",{...this.currentFrame,frameIndex:this.currentFrameIndex})),this._timeLeftInFrame-=t*this._speed,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame())))}_drawImage(t,e,i){this.currentFrame&&this.currentFrame.graphic&&this.currentFrame.graphic.draw(t,e,i)}}ze._LOGGER=lt.getInstance();class bs extends qt{constructor(t){var e;super(t),this._logger=lt.getInstance(),this.useAnchor=!0,this.members=[],this.members=t.members,this.useAnchor=(e=t.useAnchor)!==null&&e!==void 0?e:this.useAnchor,this._updateDimensions()}clone(){return new bs({members:[...this.members],...this.cloneGraphicOptions()})}_updateDimensions(){const t=this.localBounds;return this.width=t.width,this.height=t.height,t}get localBounds(){const t=new ht;for(const e of this.members)if(e instanceof qt)e.localBounds.combine(t,t);else{const{graphic:i,offset:s,useBounds:r}=e;i?(r===void 0?!0:r)&&i.localBounds.translate(s).combine(t,t):this._logger.warnOnce(`Graphics group member has an null or undefined graphic, member definition: ${JSON.stringify(e)}.`)}return t}_isAnimationOrGroup(t){return t instanceof ze||t instanceof bs}tick(t,e){for(const i of this.members){let s;i instanceof qt?s=i:s=i.graphic,this._isAnimationOrGroup(s)&&s.tick(t,e)}}reset(){for(const t of this.members){let e;t instanceof qt?e=t:e=t.graphic,this._isAnimationOrGroup(e)&&e.reset()}}_preDraw(t,e,i){this._updateDimensions(),super._preDraw(t,this.useAnchor?e:0,this.useAnchor?i:0)}_drawImage(t,e,i){const s=E.Zero;for(const r of this.members){let o;r instanceof qt?o=r:(o=r.graphic,r.offset.clone(s)),o&&(t.save(),t.translate(e,i),o.draw(t,s.x,s.y),this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore())}}}class Rs extends qt{constructor(t){var e,i,s,r,o,a,h,l,c,d;super(kh({...t},["width","height"])),this.lineCap="butt",this.quality=1,this._dirty=!0,this._smoothing=!1,this._color=Oe(q.Black,()=>this.flagDirty()),this._lineWidth=1,this._lineDash=[],this._padding=0,t&&(this.quality=(e=t.quality)!==null&&e!==void 0?e:this.quality,this.color=(i=t.color)!==null&&i!==void 0?i:q.Black,this.strokeColor=t?.strokeColor,this.smoothing=(s=t.smoothing)!==null&&s!==void 0?s:this.smoothing,this.lineWidth=(r=t.lineWidth)!==null&&r!==void 0?r:this.lineWidth,this.lineDash=(o=t.lineDash)!==null&&o!==void 0?o:this.lineDash,this.lineCap=(a=t.lineCap)!==null&&a!==void 0?a:this.lineCap,this.padding=(h=t.padding)!==null&&h!==void 0?h:this.padding,this.filtering=(l=t.filtering)!==null&&l!==void 0?l:this.filtering),this._bitmap=document.createElement("canvas");const A=(c=t?.width)!==null&&c!==void 0?c:this._bitmap.width,u=(d=t?.height)!==null&&d!==void 0?d:this._bitmap.height;this.width=A,this.height=u;const p=this._bitmap.getContext("2d");if(p)this._ctx=p;else throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic")}cloneRasterOptions(){return{color:this.color?this.color.clone():void 0,strokeColor:this.strokeColor?this.strokeColor.clone():void 0,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,lineCap:this.lineCap,quality:this.quality,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return Math.abs(this._getTotalWidth()*this.scale.x)}set width(t){t/=Math.abs(this.scale.x),this._bitmap.width=t,this._originalWidth=t,this.flagDirty()}get height(){return Math.abs(this._getTotalHeight()*this.scale.y)}set height(t){t/=Math.abs(this.scale.y),this._bitmap.height=t,this._originalHeight=t,this.flagDirty()}_getTotalWidth(){var t;return(((t=this._originalWidth)!==null&&t!==void 0?t:this._bitmap.width)+this.padding*2)*1}_getTotalHeight(){var t;return(((t=this._originalHeight)!==null&&t!==void 0?t:this._bitmap.height)+this.padding*2)*1}get localBounds(){return ht.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,E.Zero)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this.flagDirty()}get color(){return this._color}set color(t){this.flagDirty(),this._color=Oe(t,()=>this.flagDirty())}get strokeColor(){return this._strokeColor}set strokeColor(t){this.flagDirty(),t&&(this._strokeColor=Oe(t,()=>this.flagDirty()))}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(t){this._lineDash=t,this.flagDirty()}get padding(){return this._padding}set padding(t){this._padding=t,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperties(this._ctx),this.execute(this._ctx),this._ctx.restore()}_applyRasterProperties(t){var e,i,s,r;this._bitmap.width=this._getTotalWidth()*this.quality,this._bitmap.height=this._getTotalHeight()*this.quality,this._bitmap.setAttribute("filtering",this.filtering),this._bitmap.setAttribute("forceUpload","true"),t.scale(this.quality,this.quality),t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash((e=this.lineDash)!==null&&e!==void 0?e:t.getLineDash()),t.lineCap=this.lineCap,t.strokeStyle=(s=(i=this.strokeColor)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:"",t.fillStyle=(r=this.color)===null||r===void 0?void 0:r.toString()}_drawImage(t,e,i){this._dirty&&this.rasterize(),t.scale(1/this.quality,1/this.quality),t.drawImage(this._bitmap,e,i)}}var tn;(function(n){n.Em="em",n.Rem="rem",n.Px="px",n.Pt="pt",n.Percent="%"})(tn||(tn={}));var en;(function(n){n.Left="left",n.Right="right",n.Center="center",n.Start="start",n.End="end"})(en||(en={}));var sn;(function(n){n.Top="top",n.Hanging="hanging",n.Middle="middle",n.Alphabetic="alphabetic",n.Ideographic="ideographic",n.Bottom="bottom"})(sn||(sn={}));var rn;(function(n){n.Normal="normal",n.Italic="italic",n.Oblique="oblique"})(rn||(rn={}));var nn;(function(n){n.LeftToRight="ltr",n.RightToLeft="rtl"})(nn||(nn={}));function lo(n,t=q.Red,e,i,s,r,o=1,a="butt"){n.save(),n.beginPath(),n.lineWidth=o,n.lineCap=a,n.strokeStyle=t.toString(),n.moveTo(e,i),n.lineTo(s,r),n.closePath(),n.stroke(),n.restore()}function Id(n,t=q.Red,e){n.beginPath(),n.strokeStyle=t.toString(),n.arc(e.x,e.y,5,0,Math.PI*2),n.closePath(),n.stroke()}function Ed(n,t,e,i,s=1){const r=t?t.toString():"blue",o=i.scale(s);n.beginPath(),n.strokeStyle=r,n.moveTo(e.x,e.y),n.lineTo(e.x+o.x,e.y+o.y),n.closePath(),n.stroke()}function co(n,t,e,i,s,r=5,o=q.White,a=null){let h;if(typeof r=="number")h={tl:r,tr:r,br:r,bl:r};else{const l={tl:0,tr:0,br:0,bl:0};for(const c in l)if(l.hasOwnProperty(c)){const d=c;h[d]=r[d]||l[d]}}n.beginPath(),n.moveTo(t+h.tl,e),n.lineTo(t+i-h.tr,e),n.quadraticCurveTo(t+i,e,t+i,e+h.tr),n.lineTo(t+i,e+s-h.br),n.quadraticCurveTo(t+i,e+s,t+i-h.br,e+s),n.lineTo(t+h.bl,e+s),n.quadraticCurveTo(t,e+s,t,e+s-h.bl),n.lineTo(t,e+h.tl),n.quadraticCurveTo(t,e,t+h.tl,e),n.closePath(),a&&(n.fillStyle=a.toString(),n.fill()),o&&(n.strokeStyle=o.toString(),n.stroke())}function Bd(n,t,e,i,s=q.White,r=null){n.beginPath(),n.arc(t,e,i,0,Math.PI*2),n.closePath(),r&&(n.fillStyle=r.toString(),n.fill()),s&&(n.strokeStyle=s.toString(),n.stroke())}class _s{constructor(t,e,i,s){this.font=t,this.text=e,this.color=i,this.maxWidth=s,this._textFragments=[],this.disposed=!1,this._dirty=!0,this.canvas=document.createElement("canvas");const r=this.canvas.getContext("2d");if(!r)throw new Error("Unable to create FontTextInstance, internal canvas failed to create");this.ctx=r,this.dimensions=this.measureText(e),this._setDimension(this.dimensions,this.ctx),this._lastHashCode=this.getHashCode()}measureText(t,e){if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);let i=null;e!=null?i=this._getLinesFromText(t,e):i=t.split(`
`);const s=i.reduce((A,u)=>A.length>u.length?A:u);this._applyFont(this.ctx);const r=this.ctx.measureText(s);let o=Math.abs(r.actualBoundingBoxAscent)+Math.abs(r.actualBoundingBoxDescent);const a=o*i.length;o=a;const h=a-Math.abs(r.actualBoundingBoxAscent),l=0,c=0;return new ht({left:l-Math.abs(r.actualBoundingBoxLeft)-this.font.padding,top:c-Math.abs(r.actualBoundingBoxAscent)-this.font.padding,bottom:c+h+this.font.padding,right:l+Math.abs(r.actualBoundingBoxRight)+this.font.padding})}_setDimension(t,e){let i=1;this.font.lineHeight&&(i=this.font.lineHeight/this.font.size),e.canvas.width=(t.width+this.font.padding*2)*2*this.font.quality,e.canvas.height=(t.height+this.font.padding*2)*2*this.font.quality*i}static getHashCode(t,e,i){var s;return e+"__hashcode__"+t.fontString+t.showDebug+t.textAlign+t.baseAlign+t.direction+t.lineHeight+JSON.stringify(t.shadow)+(t.padding.toString()+t.smoothing.toString()+t.lineWidth.toString()+t.lineDash.toString()+((s=t.strokeColor)===null||s===void 0?void 0:s.toString())+(i?i.toString():t.color.toString()))}getHashCode(t=!0){return _s.getHashCode(this.font,this.text,t?this.color:void 0)}_applyRasterProperties(t){var e,i,s;t.translate(this.font.padding,this.font.padding),t.imageSmoothingEnabled=this.font.smoothing,t.lineWidth=this.font.lineWidth,t.setLineDash((e=this.font.lineDash)!==null&&e!==void 0?e:t.getLineDash()),t.strokeStyle=(s=(i=this.font.strokeColor)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:"",t.fillStyle=this.color.toString()}_applyFont(t){t.resetTransform(),t.translate(this.font.padding+t.canvas.width/2,this.font.padding+t.canvas.height/2),t.scale(this.font.quality,this.font.quality),t.textAlign=this.font.textAlign,t.textBaseline=this.font.baseAlign,t.font=this.font.fontString,t.direction=this.font.direction,this.font.shadow&&(this.font.shadow.color&&(t.shadowColor=this.font.shadow.color.toString()),this.font.shadow.blur&&(t.shadowBlur=this.font.shadow.blur),this.font.shadow.offset&&(t.shadowOffsetX=this.font.shadow.offset.x,t.shadowOffsetY=this.font.shadow.offset.y))}_drawText(t,e,i){this._applyRasterProperties(t),this._applyFont(t);for(let s=0;s<e.length;s++){const r=e[s];this.color&&t.fillText(r,0,s*i),this.font.strokeColor&&t.strokeText(r,0,s*i)}this.font.showDebug&&(lo(t,q.Green,-t.canvas.width/2,0,t.canvas.width/2,0,2),lo(t,q.Red,0,-t.canvas.height/2,0,t.canvas.height/2,2))}_splitTextBitmap(t){const e=[];let i=0,s=0;const r=Math.min(4096,t.canvas.width),o=Math.min(4096,t.canvas.height);for(;i<t.canvas.width;){for(;s<t.canvas.height;){const a=document.createElement("canvas");a.width=r,a.height=o;const h=a.getContext("2d");if(!h)throw new Error("Unable to split internal FontTextInstance bitmap, failed to create internal canvas");h.drawImage(t.canvas,i,s,r,o,0,0,r,o),e.push({x:i,y:s,canvas:a}),s+=o}i+=r,s=0}return e}flagDirty(){this._dirty=!0}render(t,e,i,s){var r;if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);this._ex=t;const o=this.getHashCode();if(this._lastHashCode!==o&&(this._dirty=!0),this._dirty){this.dimensions=this.measureText(this.text,s),this._setDimension(this.dimensions,this.ctx);const a=this._getLinesFromText(this.text,s),h=(r=this.font.lineHeight)!==null&&r!==void 0?r:this.dimensions.height/a.length;if(this._drawText(this.ctx,a,h),t instanceof wi)for(const l of this._textFragments)t.textureLoader.delete(l.canvas);if(this._textFragments=this._splitTextBitmap(this.ctx),t instanceof wi)for(const l of this._textFragments)t.textureLoader.load(l.canvas,{filtering:this.font.filtering},!0);this._lastHashCode=o,this._dirty=!1}for(const a of this._textFragments)t.drawImage(a.canvas,0,0,a.canvas.width,a.canvas.height,a.x/this.font.quality+e-this.ctx.canvas.width/this.font.quality/2,a.y/this.font.quality+i-this.ctx.canvas.height/this.font.quality/2,a.canvas.width/this.font.quality,a.canvas.height/this.font.quality)}dispose(){if(this.disposed=!0,this.dimensions=void 0,this.canvas=void 0,this.ctx=void 0,this._ex instanceof wi)for(const t of this._textFragments)this._ex.textureLoader.delete(t.canvas);this._textFragments.length=0}_getLinesFromText(t,e){var i;if(this._cachedText===t&&this._cachedRenderWidth===e&&(!((i=this._cachedLines)===null||i===void 0)&&i.length))return this._cachedLines;const s=t.split(`
`);if(e==null)return s;for(let r=0;r<s.length;r++){let o=s[r],a="";if(this.measureText(o).width>e){for(;this.measureText(o).width>e;)a=o[o.length-1]+a,o=o.slice(0,-1);s[r]=o,s[r+1]=a}}return this._cachedText=t,this._cachedLines=s,this._cachedRenderWidth=e,s}}class kt{static measureText(t,e,i){const s=_s.getHashCode(e,t);if(kt._MEASURE_CACHE.has(s))return kt._MEASURE_CACHE.get(s);kt._LOGGER.debug("Font text measurement cache miss");const r=e.measureTextWithoutCache(t,i);return kt._MEASURE_CACHE.set(s,r),r}static getTextInstance(t,e,i){const s=_s.getHashCode(e,t,i);let r=kt._TEXT_CACHE.get(s);return r||(r=new _s(e,t,i),kt._TEXT_CACHE.set(s,r),kt._LOGGER.debug("Font text instance cache miss")),kt._TEXT_USAGE.set(r,performance.now()),r}static checkAndClearCache(){const t=[],e=new Set;for(const[s,r]of kt._TEXT_USAGE.entries())if(r+kt.FONT_TIMEOUT<performance.now())kt._LOGGER.debug(`Text cache entry timed out ${s.text}`),t.push(s),s.dispose();else{const o=s.getHashCode(!1);e.add(o)}t.forEach(s=>{kt._TEXT_USAGE.delete(s)}),this._TEXT_CACHE.clear();for(const[s]of this._TEXT_USAGE.entries())this._TEXT_CACHE.set(s.getHashCode(),s);const i=new Map;for(const s of e)kt._MEASURE_CACHE.has(s)&&i.set(s,kt._MEASURE_CACHE.get(s));this._MEASURE_CACHE.clear(),this._MEASURE_CACHE=i}static get cacheSize(){return kt._TEXT_USAGE.size}static clearCache(){for(const[t]of kt._TEXT_USAGE.entries())t.dispose();kt._TEXT_USAGE.clear(),kt._TEXT_CACHE.clear(),kt._MEASURE_CACHE.clear()}}kt.FONT_TIMEOUT=500;kt._LOGGER=lt.getInstance();kt._TEXT_USAGE=new Map;kt._TEXT_CACHE=new Map;kt._MEASURE_CACHE=new Map;class is extends qt{constructor(t={}){var e,i,s,r,o,a,h,l,c,d,A,u,p,v,C,y,b,P,I,Q;super(t),this.filtering=ie.Blended,this.quality=2,this.padding=2,this.smoothing=!1,this.lineWidth=1,this.lineDash=[],this.color=q.Black,this.family="sans-serif",this.style=rn.Normal,this.bold=!1,this.unit=tn.Px,this.textAlign=en.Left,this.baseAlign=sn.Top,this.direction=nn.LeftToRight,this.lineHeight=void 0,this.size=10,this._textBounds=new ht,this._textMeasurement=new _s(this,"",q.Black),this.smoothing=(e=t?.smoothing)!==null&&e!==void 0?e:this.smoothing,this.padding=(i=t?.padding)!==null&&i!==void 0?i:this.padding,this.color=(s=t?.color)!==null&&s!==void 0?s:this.color,this.strokeColor=(r=t?.strokeColor)!==null&&r!==void 0?r:this.strokeColor,this.lineDash=(o=t?.lineDash)!==null&&o!==void 0?o:this.lineDash,this.lineWidth=(a=t?.lineWidth)!==null&&a!==void 0?a:this.lineWidth,this.filtering=(h=t?.filtering)!==null&&h!==void 0?h:this.filtering,this.family=(l=t?.family)!==null&&l!==void 0?l:this.family,this.style=(c=t?.style)!==null&&c!==void 0?c:this.style,this.bold=(d=t?.bold)!==null&&d!==void 0?d:this.bold,this.size=(A=t?.size)!==null&&A!==void 0?A:this.size,this.unit=(u=t?.unit)!==null&&u!==void 0?u:this.unit,this.textAlign=(p=t?.textAlign)!==null&&p!==void 0?p:this.textAlign,this.baseAlign=(v=t?.baseAlign)!==null&&v!==void 0?v:this.baseAlign,this.direction=(C=t?.direction)!==null&&C!==void 0?C:this.direction,this.lineHeight=(y=t?.lineHeight)!==null&&y!==void 0?y:this.lineHeight,this.quality=(b=t?.quality)!==null&&b!==void 0?b:this.quality,t?.shadow&&(this.shadow={},this.shadow.blur=(P=t.shadow.blur)!==null&&P!==void 0?P:this.shadow.blur,this.shadow.offset=(I=t.shadow.offset)!==null&&I!==void 0?I:this.shadow.offset,this.shadow.color=(Q=t.shadow.color)!==null&&Q!==void 0?Q:this.shadow.color)}clone(){return new is({...this.cloneGraphicOptions(),size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:void 0})}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get localBounds(){return this._textBounds}_drawImage(t,e,i){}_rotate(t){var e;const i=(e=this.origin)!==null&&e!==void 0?e:this._textBounds.center;t.translate(i.x,i.y),t.rotate(this.rotation),t.translate(-i.x,-i.y)}_flip(t){this.flipHorizontal&&(t.translate(this._textBounds.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,-this._textBounds.height/2/this.scale.y),t.scale(1,-1))}measureTextWithoutCache(t,e){return this._textMeasurement.measureText(t,e)}measureText(t,e){return kt.measureText(t,this,e)}_postDraw(t){t.restore()}render(t,e,i,s,r,o){const a=kt.getTextInstance(e,this,i);this._textBounds=a.dimensions,this._preDraw(t,s,r),a.render(t,s,r,o),this._postDraw(t)}}class Fr extends qt{constructor(t){var e,i;super(t),this._text="",this._textWidth=0,this._textHeight=0,this.font=(e=t.font)!==null&&e!==void 0?e:new is,this.color=(i=t.color)!==null&&i!==void 0?i:this.color,this.text=t.text,this.maxWidth=t.maxWidth}clone(){var t,e;return new Fr({text:this.text.slice(),color:(e=(t=this.color)===null||t===void 0?void 0:t.clone())!==null&&e!==void 0?e:q.Black,font:this.font.clone(),maxWidth:this.maxWidth})}get text(){return this._text}set text(t){this._text=t,this._calculateDimension()}get font(){return this._font}set font(t){this._font=t}get width(){return this._textWidth===0&&this._calculateDimension(),this._textWidth*this.scale.x}get height(){return this._textHeight===0&&this._calculateDimension(),this._textHeight*this.scale.y}_calculateDimension(){const{width:t,height:e}=this.font.measureText(this._text,this.maxWidth);this._textWidth=t,this._textHeight=e}get localBounds(){return this.font.measureText(this._text,this.maxWidth).scale(this.scale)}_rotate(t){}_flip(t){}_preDraw(t,e,i){(this.isStale()||this.font.isStale())&&(this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity),this.font.tint=this.tint,super._preDraw(t,e,i)}_drawImage(t,e,i){var s;let r=q.Black;this.font instanceof is&&(r=(s=this.color)!==null&&s!==void 0?s:this.font.color);const{width:o,height:a}=this.font.measureText(this._text,this.maxWidth);this._textWidth=o,this._textHeight=a,this.font.render(t,this._text,r,e,i,this.maxWidth),this.font.showDebug&&(t.debug.drawRect(e-o,i-a,o*2,a*2),this.maxWidth!=null&&t.debug.drawRect(e,i,this.maxWidth,this.height,{color:q.Yellow}))}}function Vo(n){return!!n.tick}class Wt extends Ue{get visible(){return this.isVisible}set visible(t){this.isVisible=t}get offset(){return this._offset}set offset(t){this._offset=new Qi(t,()=>this.recalculateBounds()),this.recalculateBounds()}get anchor(){return this._anchor}set anchor(t){this._anchor=new Qi(t,()=>this.recalculateBounds()),this.recalculateBounds()}get color(){return this._color}set color(t){if(t){this._color=t.clone();const e=this.graphics.current;(e instanceof Rs||e instanceof Fr)&&(e.color=this._color)}}constructor(t){super(),this._logger=lt.getInstance(),this._current="default",this._graphics={},this._options={},this.material=null,this.isVisible=!0,this.forceOnScreen=!1,this.opacity=1,this._offset=new Qi(E.Zero,()=>this.recalculateBounds()),this._anchor=new Qi(E.Half,()=>this.recalculateBounds()),this.flipHorizontal=!1,this.flipVertical=!1,this.copyGraphics=!1,t={visible:this.isVisible,graphics:{},...t};const{current:e,anchor:i,color:s,opacity:r,visible:o,graphics:a,offset:h,copyGraphics:l,onPreDraw:c,onPostDraw:d,onPreTransformDraw:A,onPostTransformDraw:u}=t;for(const[p,v]of Object.entries(a))v instanceof qt?this._graphics[p]=v:(this._graphics[p]=v.graphic,this._options[p]=v.options);this.offset=h??this.offset,this.opacity=r??this.opacity,this.anchor=i??this.anchor,this.color=s??this.color,this.copyGraphics=l??this.copyGraphics,this.onPreDraw=c??this.onPreDraw,this.onPostDraw=d??this.onPostDraw,this.onPreDraw=A??this.onPreTransformDraw,this.onPostTransformDraw=u??this.onPostTransformDraw,this.isVisible=!!o,this._current=e??this._current,e&&this._graphics[e]&&this.use(e)}getGraphic(t){return this._graphics[t]}getOptions(t){return this._options[t]}getNames(){return Object.keys(this._graphics)}get current(){return this._graphics[this._current]}get currentOptions(){return this._options[this._current]}get graphics(){return this._graphics}get options(){return this._options}add(t,e,i){let s="default",r=null,o;if(typeof t=="string"&&e instanceof qt&&(s=t,r=e,o=i),t instanceof qt&&!(e instanceof qt)&&(r=t,o=e),!r)throw new Error("Need to provide a graphic or valid graphic string");return this._graphics[s]=this.copyGraphics?r.clone():r,this._options[s]=this.copyGraphics?{...o}:o,s==="default"&&this.use("default"),r}remove(t){delete this._graphics[t],delete this._options[t],this._current===t&&(this._current="default",this.recalculateBounds())}use(t,e){var i;if(t instanceof qt){let s=t;this.copyGraphics&&(s=t.clone()),this._current="default",this._graphics[this._current]=s,this._options[this._current]=e}else this._current=t,this._options[this._current]=e,this._current in this._graphics||this._logger.warn(`Graphic ${this._current} is not registered with the graphics component owned by ${(i=this.owner)===null||i===void 0?void 0:i.name}. Nothing will be drawn.`);return this.recalculateBounds(),this.current}hide(){this._current="ex.none"}set localBounds(t){this._localBounds=t}recalculateBounds(){let t=new ht;const e=this._graphics[this._current],i=this._options[this._current];if(!e){this._localBounds=t;return}let s=this.anchor,r=this.offset;i?.anchor&&(s=i.anchor),i?.offset&&(r=i.offset);const o=e.localBounds,a=-o.width*s.x+r.x,h=-o.height*s.y+r.y;e instanceof bs&&!e.useAnchor?t=e?.localBounds.combine(t):t=e?.localBounds.translate(T(a,h)).combine(t),this._localBounds=t}get localBounds(){return(!this._localBounds||this._localBounds.hasZeroDimensions())&&this.recalculateBounds(),this._localBounds}get bounds(){let t=this.localBounds;if(this.owner){const e=this.owner.get(tt);e&&(t=t.transform(e.get().matrix))}return t}update(t,e=0){const i=this.current;i&&Vo(i)&&i.tick(t,e)}clone(){const t=new Wt;return t._graphics={...this._graphics},t._options={...this._options},t.offset=this.offset.clone(),this.color&&(t.color=this.color.clone()),t.opacity=this.opacity,t.anchor=this.anchor.clone(),t.copyGraphics=this.copyGraphics,t.onPreDraw=this.onPreDraw,t.onPostDraw=this.onPostDraw,t.isVisible=this.isVisible,t}}var on;(function(n){n.Kill="kill",n.PreKill="prekill",n.PostKill="postkill",n.PreDraw="predraw",n.PostDraw="postdraw",n.PreDebugDraw="predebugdraw",n.PostDebugDraw="postdebugdraw",n.PreUpdate="preupdate",n.PostUpdate="postupdate",n.PreFrame="preframe",n.PostFrame="postframe",n.PreCollision="precollision",n.CollisionStart="collisionstart",n.CollisionEnd="collisionend",n.PostCollision="postcollision",n.Initialize="initialize",n.Activate="activate",n.Deactivate="deactivate",n.ExitViewport="exitviewport",n.EnterViewport="enterviewport",n.ExitTrigger="exit",n.EnterTrigger="enter",n.Connect="connect",n.Disconnect="disconnect",n.Button="button",n.Axis="axis",n.Visible="visible",n.Hidden="hidden",n.Start="start",n.Stop="stop",n.PointerUp="pointerup",n.PointerDown="pointerdown",n.PointerMove="pointermove",n.PointerEnter="pointerenter",n.PointerLeave="pointerleave",n.PointerCancel="pointercancel",n.PointerWheel="pointerwheel",n.Up="up",n.Down="down",n.Move="move",n.Enter="enter",n.Leave="leave",n.Cancel="cancel",n.Wheel="wheel",n.Press="press",n.Release="release",n.Hold="hold",n.PointerDragStart="pointerdragstart",n.PointerDragEnd="pointerdragend",n.PointerDragEnter="pointerdragenter",n.PointerDragLeave="pointerdragleave",n.PointerDragMove="pointerdragmove",n.ActionStart="actionstart",n.ActionComplete="actioncomplete",n.Add="add",n.Remove="remove"})(on||(on={}));class bt{constructor(){this.other=null,this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class En extends bt{constructor(t){super(),this.self=t,this.target=t}}class Zo extends bt{constructor(t){super(),this.self=t,this.target=t}}class Xo extends bt{constructor(t){super(),this.self=t,this.target=t}}class Jo extends bt{constructor(t){super(),this.self=t,this.target=t}}class Ko extends bt{constructor(t){super(),this.self=t,this.target=t}}class Ms extends bt{constructor(t,e,i){super(),this.ctx=t,this.elapsed=e,this.self=i,this.target=i}}class Ls extends bt{constructor(t,e,i){super(),this.ctx=t,this.elapsed=e,this.self=i,this.target=i}}class $o extends bt{constructor(t,e,i){super(),this.ctx=t,this.elapsed=e,this.self=i,this.target=i}}class ta extends bt{constructor(t,e,i){super(),this.ctx=t,this.elapsed=e,this.self=i,this.target=i}}class ea extends bt{constructor(t,e){super(),this.ctx=t,this.self=e,this.target=e}}class ia extends bt{constructor(t,e){super(),this.ctx=t,this.self=e,this.target=e}}class Ni extends bt{constructor(t,e,i){super(),this.engine=t,this.elapsed=e,this.self=i,this.target=i}}class zi extends bt{constructor(t,e,i){super(),this.engine=t,this.elapsed=e,this.self=i,this.target=i}}class sa extends bt{constructor(t,e){super(),this.engine=t,this.prevStats=e,this.target=t}}class ra extends bt{constructor(t,e){super(),this.engine=t,this.stats=e,this.target=t}}class na extends bt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class oa extends bt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class aa extends bt{constructor(t,e,i,s){super(),this.button=t,this.index=e,this.value=i,this.self=s,this.target=s}}class ha extends bt{constructor(t,e,i){super(),this.axis=t,this.value=e,this.self=i,this.target=i}}class la extends bt{constructor(t){super(),this.self=t,this.target=t}}class ca extends bt{constructor(t){super(),this.self=t,this.target=t}}class ss extends bt{constructor(t,e,i,s,r){super(),this.self=t,this.other=e,this.side=i,this.intersection=s,this.contact=r,this.target=t}}class rs extends bt{constructor(t,e,i,s,r){super(),this.self=t,this.other=e,this.side=i,this.intersection=s,this.contact=r,this.target=t}}class an{constructor(t,e,i,s){this.self=t,this.other=e,this.side=i,this.contact=s}}class hn{constructor(t,e,i,s){this.self=t,this.other=e,this.side=i,this.lastContact=s}}class ln{constructor(t,e,i,s,r){this.self=t,this.other=e,this.side=i,this.intersection=s,this.contact=r}}class cn{constructor(t,e,i,s,r){this.self=t,this.other=e,this.side=i,this.intersection=s,this.contact=r}}class Ks extends bt{constructor(t,e,i,s){super(),this.self=t,this.other=e,this.side=i,this.contact=s,this.target=t}}class $s extends bt{constructor(t,e,i,s){super(),this.self=t,this.other=e,this.side=i,this.lastContact=s,this.target=t}}class Us extends bt{constructor(t,e){super(),this.engine=t,this.self=e,this.target=e}}class da extends bt{constructor(t,e){super(),this.context=t,this.self=e,this.target=e}}class ua extends bt{constructor(t,e){super(),this.context=t,this.self=e,this.target=e}}class Aa extends bt{constructor(t){super(),this.self=t,this.target=t}}class ga extends bt{constructor(t){super(),this.self=t,this.target=t}}class pa extends bt{constructor(t,e){super(),this.self=t,this.entity=e,this.target=t}}class fa extends bt{constructor(t,e){super(),this.self=t,this.entity=e,this.target=t}}class _a extends bt{constructor(t,e){super(),this.action=t,this.self=e,this.target=e}}class ma extends bt{constructor(t,e){super(),this.action=t,this.self=e,this.target=e}}class va extends bt{constructor(t,e){super(),this.engine=t,this.self=e,this.target=e}}class wa extends bt{constructor(t,e){super(),this.engine=t,this.self=e,this.target=e}}class Sd{constructor(t){this.data=t,this.type="Component Added"}}function Td(n){return!!n&&n.type==="Component Added"}class Qd{constructor(t){this.data=t,this.type="Component Removed"}}function Pd(n){return!!n&&n.type==="Component Removed"}const Dd={Add:"add",Remove:"remove",Initialize:"initialize",PreUpdate:"preupdate",PostUpdate:"postupdate",Kill:"kill"};class _e{constructor(t,e){this.id=_e._ID++,this.name=`Entity#${this.id}`,this.events=new Nt,this._tags=new Set,this.componentAdded$=new ve,this.componentRemoved$=new ve,this.tagAdded$=new ve,this.tagRemoved$=new ve,this.components=new Map,this.componentValues=[],this._componentsToRemove=[],this.scene=null,this.isActive=!0,this._parent=null,this.childrenAdded$=new ve,this.childrenRemoved$=new ve,this._children=[],this._isInitialized=!1,this._isAdded=!1;let i,s;if(Array.isArray(t))i=t,s=e;else if(t&&typeof t=="object"){const{components:r,name:o,silenceWarnings:a}=t;i=r??[],s=o}if(s&&(this.name=s),i)for(const r of i)this.addComponent(r)}get active(){return this.isActive}set active(t){this.isActive=t}kill(){this.isActive&&(this.isActive=!1,this.unparent()),this.emit("kill",new En(this))}isKilled(){return!this.isActive}get tags(){return this._tags}hasTag(t){return this._tags.has(t)}addTag(t){return this._tags.add(t),this.tagAdded$.notifyAll(t),this}removeTag(t){return this._tags.delete(t),this.tagRemoved$.notifyAll(t),this}get types(){return Array.from(this.components.keys())}getComponents(){return Array.from(this.components.values())}hasAll(t){for(let e=0;e<t.length;e++)if(!this.components.has(t[e]))return!1;return!0}hasAllTags(t){for(let e=0;e<t.length;e++)if(!this.tags.has(t[e]))return!1;return!0}get(t){return this.components.get(t)}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(t){if(t.parent===null){if(this.getAncestors().includes(t))throw new Error("Cycle detected, cannot add entity");this._children.push(t),t._parent=this,this.childrenAdded$.notifyAll(t)}else throw new Error("Entity already has a parent, cannot add without unparenting");return this}removeChild(t){return t.parent===this&&(ks(t,this._children),t._parent=null,this.childrenRemoved$.notifyAll(t)),this}removeAllChildren(){for(let t=this.children.length-1;t>=0;t--)this.removeChild(this.children[t]);return this}getAncestors(){const t=[this];let e=this.parent;for(;e;)t.push(e),e=e.parent;return t.reverse()}getDescendants(){let t=[this],e=[this];for(;e.length>0;){const i=e.pop();i&&(e=e.concat(i.children),t=t.concat(i.children))}return t}clone(){const t=new _e;for(const e of this.types){const i=this.get(e);i&&t.addComponent(i.clone())}for(const e of this.children)t.addChild(e.clone());return t}addTemplate(t,e=!1){for(const i of t.getComponents())this.addComponent(i.clone(),e);for(const i of t.children)this.addChild(i.clone().addTemplate(i));return this}_getClassHierarchyRoot(t){var e,i;let s=t,r=(e=Object.getPrototypeOf(s.prototype))===null||e===void 0?void 0:e.constructor;for(;r&&r!==Object&&r!==Ue;)s=r,r=(i=Object.getPrototypeOf(s.prototype))===null||i===void 0?void 0:i.constructor;return s}addComponent(t,e=!1){if(this.has(t.constructor))if(e)this.removeComponent(t.constructor,!0);else return this;if(t.dependencies&&t.dependencies.length)for(const s of t.dependencies)this.addComponent(new s);t.owner=this;const i=this._getClassHierarchyRoot(t.constructor);return this.components.set(i,t),this.components.set(t.constructor,t),this.componentValues.push(t),t.onAdd&&t.onAdd(this),this.componentAdded$.notifyAll(t),this}removeComponent(t,e=!1){let i;if(zh(t)?i=t:i=t.constructor,e){const s=this.components.get(i);if(s){this.componentRemoved$.notifyAll(s),s.owner=void 0,s.onRemove&&s.onRemove(this);const o=this.componentValues.indexOf(s);o>-1&&this.componentValues.splice(o,1)}const r=this._getClassHierarchyRoot(i);this.components.delete(r),this.components.delete(i)}else this._componentsToRemove.push(i);return this}clearComponents(){const t=this.types;for(const e of t)this.removeComponent(e)}processComponentRemoval(){for(const t of this._componentsToRemove)this.removeComponent(t,!0);this._componentsToRemove.length=0}has(t){return this.components.has(t)}get isInitialized(){return this._isInitialized}get isAdded(){return this._isAdded}_initialize(t){this.isInitialized||(this.onInitialize(t),this.events.emit("initialize",new Us(t,this)),this._isInitialized=!0)}_add(t){!this.isAdded&&this.isActive&&(this.onAdd(t),this.events.emit("add",new va(t,this)),this._isAdded=!0)}_remove(t){this.isAdded&&!this.isActive&&(this.onRemove(t),this.events.emit("remove",new wa(t,this)),this._isAdded=!1)}_preupdate(t,e){this.events.emit("preupdate",new Ni(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.events.emit("postupdate",new zi(t,e,this)),this.onPostUpdate(t,e)}onInitialize(t){}onAdd(t){}onRemove(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}update(t,e){this._initialize(t),this._add(t),this._preupdate(t,e);for(const i of this.children)i.update(t,e);this._postupdate(t,e),this._remove(t)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){e?this.events.off(t,e):this.events.off(t)}}_e._ID=0;class Dt extends Ue{constructor(){super(...arguments),this.vel=E.Zero,this.acc=E.Zero,this.scaleFactor=E.Zero,this.angularVelocity=0,this.torque=0,this.inertia=1}}class me{static integrate(t,e,i,s){const r=s/1e3;e.vel.addEqual(i.scale(r,me._ACC)),t.pos.add(e.vel.scale(r,me._VEL),me._POS).addEqual(i.scale(.5*r*r,me._VEL_ACC)),e.angularVelocity+=e.torque*(1/e.inertia)*r;const o=t.rotation+e.angularVelocity*r;t.scale.add(e.scaleFactor.scale(r,this._SCALE_FACTOR),me._SCALE),t.get().setTransform(me._POS,o,me._SCALE)}}me._POS=new E(0,0);me._SCALE=new E(1,1);me._ACC=new E(0,0);me._VEL=new E(0,0);me._VEL_ACC=new E(0,0);me._SCALE_FACTOR=new E(0,0);class Bn extends _e{constructor(t){super({silenceWarnings:!0}),this.beginColor=q.White,this.endColor=q.White,this.life=300,this.fade=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=q.White,this.size=5,this.sizeRate=0,this.visible=!0,this.isOffscreen=!1,this.particleTransform=Ze.Global,this.name=`Particle#${this.id}`,this.addComponent(this.transform=new tt),this.addComponent(this.motion=new Dt),this.addComponent(this.graphics=new Wt),this.configure(t)}registerEmitter(t){if(this._emitter=t,this.particleTransform===Ze.Global){const e=this._emitter.transform.globalPos;this.transform.pos=this.transform.pos.add(e),this.motion.vel=this.motion.vel.rotate(this._emitter.transform.globalRotation)}}configure(t){var e,i,s,r,o,a,h,l,c,d,A,u,p,v;this.particleTransform=(e=t.transform)!==null&&e!==void 0?e:this.particleTransform,this.life=(i=t.life)!==null&&i!==void 0?i:this.life,this.fade=(s=t.fade)!==null&&s!==void 0?s:this.fade,this.size=(r=t.size)!==null&&r!==void 0?r:this.size,this.endColor=(o=t.endColor)!==null&&o!==void 0?o:this.endColor.clone(),this.beginColor=(a=t.beginColor)!==null&&a!==void 0?a:this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.graphic=t.graphic,this.graphics.opacity=(h=t.opacity)!==null&&h!==void 0?h:this.graphics.opacity,this.transform.pos=(l=t.pos)!==null&&l!==void 0?l:this.transform.pos,this.transform.rotation=(c=t.rotation)!==null&&c!==void 0?c:0,this.transform.scale=T(1,1),this.motion.vel=(d=t.vel)!==null&&d!==void 0?d:this.motion.vel,this.motion.angularVelocity=(A=t.angularVelocity)!==null&&A!==void 0?A:0,this.motion.acc=(u=t.acc)!==null&&u!==void 0?u:this.motion.acc,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.graphics.opacity/this.life,this.startSize=(p=t.startSize)!==null&&p!==void 0?p:0,this.endSize=(v=t.endSize)!==null&&v!==void 0?v:0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.size=this.startSize),this.graphic?(this.graphics.use(this.graphic),this.graphics.onPostDraw=void 0):(this.graphics.localBounds=ht.fromDimension(this.size,this.size,E.Half),this.graphics.onPostDraw=C=>{C.save(),C.debug.drawPoint(T(0,0),{color:this._currentColor,size:this.size}),C.restore()})}kill(){var t;!((t=this._emitter)===null||t===void 0)&&t.isActive?this._emitter.removeParticle(this):super.kill()}update(t,e){this.life=this.life-e,this.life<0&&this.kill(),this.fade&&(this.graphics.opacity=It(this._aRate*this.life,1e-4,1)),this.startSize&&this.endSize&&this.startSize>0&&this.endSize>0&&(this.size=It(this.sizeRate*e+this.size,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=It(this._currentColor.r+this._rRate*e,0,255),this._currentColor.g=It(this._currentColor.g+this._gRate*e,0,255),this._currentColor.b=It(this._currentColor.b+this._bRate*e,0,255),this._currentColor.a=this.graphics.opacity;let i=this.motion.acc;this.focus&&(i=this.focus.sub(this.transform.pos).normalize().scale(this.focusAccel||0).scale(e/1e3)),me.integrate(this.transform,this.motion,i,e)}}Bn.DefaultConfig={beginColor:q.White,endColor:q.White,life:300,fade:!1,size:5,graphic:void 0,startSize:void 0,endSize:void 0};var Ze;(function(n){n.Global="global",n.Local="local"})(Ze||(Ze={}));class Oh{constructor(){this.type="ex.particle",this.priority=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ie({gl:t,vertexSource:yd,fragmentSource:Cd,onPreLink:i=>{t.transformFeedbackVaryings(i,["finalPosition","finalVelocity","finalRotation","finalAngularVelocity","finalLifeMs"],t.INTERLEAVED_ATTRIBS)}}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho)}_getTexture(t){const e=t.getAttribute(Pt.Filtering),i=e?Fs(e):void 0,s=Ve(t.getAttribute(Pt.WrappingX)),r=Ve(t.getAttribute(Pt.WrappingY)),o=t.getAttribute("forceUpload")==="true",a=this._context.textureLoader.load(t,{filtering:i,wrapping:{x:s,y:r}},o);return t.removeAttribute("forceUpload"),a}draw(t,e){var i,s,r,o,a,h,l,c,d;const A=this._gl;this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho);const u=t.particle.transform===Ze.Local?this._context.getTransform():this._context.getTransform().multiply(t.emitter.transform.get().inverse);this._shader.setUniformAffineMatrix("u_transform",u),this._shader.setUniformBoolean("fade",!!t.particle.fade),this._shader.setUniformBoolean("useTexture",!!t.particle.graphic),this._shader.setUniformFloat("maxLifeMs",(i=t.particle.life)!==null&&i!==void 0?i:2e3),this._shader.setUniformFloat("deltaMs",e),this._shader.setUniformFloatVector("gravity",(s=t.particle.acc)!==null&&s!==void 0?s:T(0,0)),this._shader.setUniformFloatColor("beginColor",(r=t.particle.beginColor)!==null&&r!==void 0?r:q.Transparent),this._shader.setUniformFloatColor("endColor",(o=t.particle.endColor)!==null&&o!==void 0?o:q.Transparent);let p=(a=t.particle.startSize)!==null&&a!==void 0?a:0,v=(h=t.particle.endSize)!==null&&h!==void 0?h:0;const C=(l=t.particle.size)!==null&&l!==void 0?l:0;if(C>0&&(p=C,v=C),this._shader.setUniformFloat("startSize",p??10),this._shader.setUniformFloat("endSize",v??10),this._shader.setUniformFloat("startOpacity",(c=t.particle.opacity)!==null&&c!==void 0?c:1),t.particle.focus&&(this._shader.setUniformFloatVector("focus",t.particle.focus),this._shader.setUniformFloat("focusAccel",(d=t.particle.focusAccel)!==null&&d!==void 0?d:0)),t.particle.graphic){const y=t.particle.graphic,b=this._getTexture(y.image.image);A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,b),this._shader.setUniformInt("graphic",0)}t.draw(A)}hasPendingDraws(){return!1}flush(){}dispose(){}}const kd=`#version 300 es\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_texcoord;\r
\r
// Textures in the current draw\r
uniform sampler2D u_textures[%%count%%];\r
\r
uniform bool u_pixelart;\r
\r
in float v_texture_index;\r
\r
in float v_opacity;\r
\r
in vec4 v_tint;\r
\r
// texture resolution\r
in vec2 v_res;\r
\r
in vec2 v_size;\r
\r
in vec2 v_uv_min;\r
in vec2 v_uv_max;\r
\r
out vec4 fragColor;\r
\r
// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\r
vec2 uv_iq(in vec2 uv, in vec2 texture_size) {\r
  vec2 pixel = uv * texture_size;\r
\r
  vec2 seam=floor(pixel+.5);\r
  vec2 dudv=fwidth(pixel);\r
  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\r
\r
  return pixel/texture_size;\r
}\r
\r
float lerp(float from, float to, float rel){\r
  return ((1. - rel) * from) + (rel * to);\r
}\r
\r
float invLerp(float from, float to, float value){\r
  return (value - from) / (to - from);\r
}\r
\r
float remap(float origFrom, float origTo, float targetFrom, float targetTo, float value){\r
  float rel = invLerp(origFrom, origTo, value);\r
  return lerp(targetFrom, targetTo, rel);\r
}\r
\r
void main(){\r
  // In order to support the most efficient sprite batching, we have multiple\r
  // textures loaded into the gpu (usually 8) this picker logic skips over textures\r
  // that do not apply to a particular sprite.\r
\r
  vec4 color=vec4(1.,0,0,1.);\r
  vec2 remapped_uv = v_texcoord;\r
  remapped_uv.x = remap(0.,1., v_uv_min.x, v_uv_max.x, v_texcoord.x);\r
  remapped_uv.y = remap(0.,1., v_uv_min.y, v_uv_max.y, v_texcoord.y);\r
  vec2 uv = u_pixelart ? uv_iq(remapped_uv, v_size) : remapped_uv;\r
\r
  // GLSL is templated out to pick the right texture and set the vec4 color\r
  %%texture_picker%%\r
\r
  color.rgb = color.rgb * v_opacity;\r
  color.a = color.a * v_opacity;\r
  fragColor = color * v_tint;\r
}`,Fd=`#version 300 es\r
layout(location=0) in vec2 pos;\r
layout(location=1) in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
layout(location=2) in vec2 a_offset;\r
layout(location=3) in vec2 a_mat_column1;\r
layout(location=4) in vec2 a_mat_column2;\r
layout(location=5) in vec2 a_mat_column3;\r
\r
layout(location=6) in float a_opacity;\r
out float v_opacity;\r
\r
// Texture resolution (could be bigger than a_size)\r
layout(location=7) in vec2 a_res;\r
out vec2 v_res;\r
\r
// Final size of graphic\r
layout(location=8) in vec2 a_size;\r
out vec2 v_size;\r
\r
layout(location=9) in lowp float a_texture_index;\r
out lowp float v_texture_index;\r
\r
layout(location=10) in vec2 a_uv_min;\r
out vec2 v_uv_min;\r
\r
layout(location=11) in vec2 a_uv_max;\r
out vec2 v_uv_max;\r
\r
layout(location=12) in vec4 a_tint;\r
out vec4 v_tint;\r
\r
uniform mat4 u_matrix;\r
\r
void main(){\r
  mat4 world_mat = mat4(\r
    a_mat_column1.x, a_mat_column1.y, 0., 0.,\r
    a_mat_column2.x, a_mat_column2.y, 0., 0.,\r
    0.             , 0.             , 1., 0.,\r
    a_mat_column3.x, a_mat_column3.y, 0., 1.\r
  );\r
\r
  vec2 newPos = vec2(pos.x * a_res.x, pos.y * a_res.y);\r
  gl_Position = u_matrix * world_mat * vec4(newPos + a_offset, 0., 1.);\r
\r
  v_opacity = a_opacity;\r
  v_texcoord = a_texcoord;\r
  v_uv_min = a_uv_min;\r
  v_uv_max = a_uv_max;\r
  v_res = a_res;\r
  v_size = a_size;\r
  v_texture_index = a_texture_index;\r
  v_tint = a_tint;\r
}`;class Rd{constructor(t){this.type="ex.image-v2",this.priority=0,this._maxImages=2e4,this._maxTextures=0,this._components=22,this._imageCount=0,this._textures=[],this._textureIndex=0,this._textureToIndex=new Map,this._images=new Set,this._vertexIndex=0,this._imageToWidth=new Map,this._imageToHeight=new Map,this._view=[0,0,0,0],this._dest=[0,0],this._defaultTint=q.White,this.pixelArtSampler=t.pixelArtSampler,this.uvPadding=t.uvPadding}initialize(t,e){this._gl=t,this._context=e;const i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),s=Yo(t,i);this._maxTextures=Math.min(i,s);const r=this._transformFragmentSource(kd,this._maxTextures);this._shader=new Ie({gl:t,fragmentSource:r,vertexSource:Fd}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((d,A)=>A)),this._vao=t.createVertexArray(),t.bindVertexArray(this._vao),this._quadMesh=new Float32Array([0,0,0,0,0,1,0,1,1,0,1,0,1,0,1,0,0,1,0,1,1,1,1,1]),this._meshBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._meshBuffer),t.bufferData(t.ARRAY_BUFFER,this._quadMesh,t.STATIC_DRAW),t.vertexAttribPointer(0,2,t.FLOAT,!1,16,0),t.enableVertexAttribArray(0),t.vertexAttribPointer(1,2,t.FLOAT,!1,16,8),t.enableVertexAttribArray(1),t.bindBuffer(t.ARRAY_BUFFER,null);const o=this._components;this._transformData=new hi({gl:t,size:o*this._maxImages,type:"dynamic"}),this._transformData.bind();let a=0,h=2;const l=4,c=o*4;t.vertexAttribPointer(h++,2,t.FLOAT,!1,c,a),t.enableVertexAttribArray(2),a+=2*l,t.vertexAttribPointer(h++,2,t.FLOAT,!1,c,a),t.enableVertexAttribArray(3),a+=2*l,t.vertexAttribPointer(h++,2,t.FLOAT,!1,c,a),t.enableVertexAttribArray(4),a+=2*l,t.vertexAttribPointer(h++,2,t.FLOAT,!1,c,a),t.enableVertexAttribArray(5),a+=2*l,t.vertexAttribPointer(h++,1,t.FLOAT,!1,c,a),t.enableVertexAttribArray(6),a+=1*l,t.vertexAttribPointer(h++,2,t.FLOAT,!1,c,a),t.enableVertexAttribArray(7),a+=2*l,t.vertexAttribPointer(h++,2,t.FLOAT,!1,c,a),t.enableVertexAttribArray(8),a+=2*l,t.vertexAttribPointer(h++,1,t.FLOAT,!1,c,a),t.enableVertexAttribArray(9),a+=1*l,t.vertexAttribPointer(h++,2,t.FLOAT,!1,c,a),t.enableVertexAttribArray(10),a+=2*l,t.vertexAttribPointer(h++,2,t.FLOAT,!1,c,a),t.enableVertexAttribArray(11),a+=2*l,t.vertexAttribPointer(h++,4,t.FLOAT,!1,c,a),t.enableVertexAttribArray(12),a+=4*l,t.vertexAttribDivisor(2,1),t.vertexAttribDivisor(3,1),t.vertexAttribDivisor(4,1),t.vertexAttribDivisor(5,1),t.vertexAttribDivisor(6,1),t.vertexAttribDivisor(7,1),t.vertexAttribDivisor(8,1),t.vertexAttribDivisor(9,1),t.vertexAttribDivisor(10,1),t.vertexAttribDivisor(11,1),t.vertexAttribDivisor(12,1),t.bindVertexArray(null)}_bindData(t){const e=this._components;this._transformData.bind(),this._transformData.upload(e*this._imageCount),t.bindVertexArray(this._vao)}dispose(){this._transformData.dispose(),this._shader.dispose(),this._textures.length=0,this._context=null,this._gl=null}_transformFragmentSource(t,e){let i=t.replace("%%count%%",e.toString()),s="";for(let r=0;r<e;r++)r===0?s+=`if (v_texture_index <= ${r}.5) {
`:s+=`   else if (v_texture_index <= ${r}.5) {
`,s+=`      color = texture(u_textures[${r}], uv);
`,s+=`   }
`;return i=i.replace("%%texture_picker%%",s),i}_addImageAsTexture(t){if(this._images.has(t))return;const e=t.getAttribute(Pt.Filtering),i=e?Fs(e):void 0,s=Ve(t.getAttribute(Pt.WrappingX)),r=Ve(t.getAttribute(Pt.WrappingY)),o=t.getAttribute("forceUpload")==="true",a=this._context.textureLoader.load(t,{filtering:i,wrapping:{x:s,y:r}},o);t.removeAttribute("forceUpload"),this._textures.indexOf(a)===-1&&(this._textures.push(a),this._textureToIndex.set(a,this._textureIndex++),this._images.add(t))}_bindTextures(t){const e=Math.min(this._textureIndex,this._maxTextures);for(let i=0;i<e;i++)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,this._textures[i]||this._textures[0])}_getTextureIdForImage(t){var e;if(t){const i=this._context.textureLoader.get(t);return(e=this._textureToIndex.get(i))!==null&&e!==void 0?e:-1}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}draw(t,e,i,s,r,o,a,h,l){var c,d,A,u;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);const p=this._getImageWidth(t),v=this._getImageHeight(t);let C=p||s||0,y=v||r||0;this._view[0]=0,this._view[1]=0,this._view[2]=(c=s??p)!==null&&c!==void 0?c:0,this._view[3]=(d=r??v)!==null&&d!==void 0?d:0,this._dest[0]=e??1,this._dest[1]=i??1,o!==void 0&&a!==void 0&&h!==void 0&&l!==void 0&&(this._view[0]=e??1,this._view[1]=i??1,this._view[2]=(A=s??p)!==null&&A!==void 0?A:0,this._view[3]=(u=r??v)!==null&&u!==void 0?u:0,this._dest[0]=o,this._dest[1]=a,C=h,y=l),e=this._view[0],i=this._view[1];const b=this._view[2],P=this._view[3],I=this._context.getTransform(),Q=this._context.opacity;this._context.snapToPixel&&(this._dest[0]=~~(this._dest[0]+yt),this._dest[1]=~~(this._dest[1]+yt));const B=this._context.tint||this._defaultTint,j=this._getTextureIdForImage(t),$=p||C,st=v||y,Z=(e+this.uvPadding)/$,S=(i+this.uvPadding)/st,z=(e+b-this.uvPadding)/$,f=(i+P-this.uvPadding)/st,X=p,ct=v,D=this._transformData.bufferData;D[this._vertexIndex++]=this._dest[0],D[this._vertexIndex++]=this._dest[1],D[this._vertexIndex++]=I.data[0],D[this._vertexIndex++]=I.data[1],D[this._vertexIndex++]=I.data[2],D[this._vertexIndex++]=I.data[3],D[this._vertexIndex++]=I.data[4],D[this._vertexIndex++]=I.data[5],D[this._vertexIndex++]=Q,D[this._vertexIndex++]=C,D[this._vertexIndex++]=y,D[this._vertexIndex++]=X,D[this._vertexIndex++]=ct,D[this._vertexIndex++]=j,D[this._vertexIndex++]=Z,D[this._vertexIndex++]=S,D[this._vertexIndex++]=z,D[this._vertexIndex++]=f,D[this._vertexIndex++]=B.r/255,D[this._vertexIndex++]=B.g/255,D[this._vertexIndex++]=B.b/255,D[this._vertexIndex++]=B.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const t=this._gl;this._shader.use(),this._bindData(t),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._shader.setUniformBoolean("u_pixelart",this.pixelArtSampler),this._bindTextures(t),t.drawArraysInstanced(t.TRIANGLES,0,6,this._imageCount),Gt.DrawnImagesCount+=this._imageCount,Gt.DrawCallCount++,t.bindVertexArray(null),this._imageCount=0,this._vertexIndex=0,this._textures.length=0,this._textureIndex=0,this._textureToIndex.clear(),this._images.clear(),this._imageToWidth.clear(),this._imageToHeight.clear()}}const yt=1e-4;class Md{constructor(t){this._webglCtx=t,this._debugText=new jo}drawRect(t,e,i,s,r={color:q.Black}){this.drawLine(T(t,e),T(t+i,e),{...r}),this.drawLine(T(t+i,e),T(t+i,e+s),{...r}),this.drawLine(T(t+i,e+s),T(t,e+s),{...r}),this.drawLine(T(t,e+s),T(t,e),{...r})}drawLine(t,e,i){var s;this._webglCtx.draw("ex.line",t,e,(s=i?.color)!==null&&s!==void 0?s:q.Black)}drawPoint(t,e={color:q.Black,size:5}){this._webglCtx.draw("ex.point",t,e.color,e.size)}drawText(t,e){this._debugText.write(this._webglCtx,t,e)}}class wi{get z(){return this._state.current.z}set z(t){this._state.current.z=t}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}get ortho(){return this._ortho}checkIfResolutionSupported(t){let e=!0;return(t.width>4096||t.height>4096)&&(e=!1),e}constructor(t){this._logger=lt.getInstance(),this._renderers=new Map,this._lazyRenderersFactory=new Map,this.imageRenderer=de.isEnabled("use-legacy-image-renderer")?"ex.image":"ex.image-v2",this._isDrawLifecycle=!1,this.useDrawSorting=!0,this._drawCallPool=new In(()=>new vd,void 0,4e3),this._drawCallIndex=0,this._drawCalls=new Array(4e3).fill(null),this._postProcessTargets=[],this._postprocessors=[],this._transform=new Zc,this._state=new Fh,this.snapToPixel=!1,this.smoothing=!1,this.pixelArtSampler=!1,this.uvPadding=.01,this.backgroundColor=q.ExcaliburBlue,this.multiSampleAntialiasing=!0,this.transparency=!0,this._isContextLost=!1,this._disposed=!1,this._imageToWidth=new Map,this._imageToHeight=new Map,this.debug=new Md(this),this._totalPostProcessorTime=0;const{canvasElement:e,context:i,enableTransparency:s,antialiasing:r,uvPadding:o,multiSampleAntialiasing:a,pixelArtSampler:h,powerPreference:l,snapToPixel:c,backgroundColor:d,useDrawSorting:A,garbageCollector:u,handleContextLost:p,handleContextRestored:v}=t;if(this.__gl=i??e.getContext("webgl2",{antialias:r??this.smoothing,premultipliedAlpha:!1,alpha:s??this.transparency,depth:!1,powerPreference:l??"high-performance"}),!this.__gl)throw Error("Failed to retrieve webgl context from browser");p&&this.__gl.canvas.addEventListener("webglcontextlost",p,!1),v&&this.__gl.canvas.addEventListener("webglcontextrestored",v,!1),this.__gl.canvas.addEventListener("webglcontextlost",()=>{this._isContextLost=!0}),this.__gl.canvas.addEventListener("webglcontextrestored",()=>{this._isContextLost=!1}),this.textureLoader=new zt(this.__gl,u),this.snapToPixel=c??this.snapToPixel,this.smoothing=r??this.smoothing,this.transparency=s??this.transparency,this.pixelArtSampler=h??this.pixelArtSampler,this.uvPadding=o??this.uvPadding,this.multiSampleAntialiasing=typeof a=="boolean"?a:this.multiSampleAntialiasing,this.samples=typeof a=="object"?a.samples:void 0,this.backgroundColor=d??this.backgroundColor,this.useDrawSorting=A??this.useDrawSorting,this._drawCallPool.disableWarnings=!0,this._drawCallPool.preallocate(),this._init()}dispose(){if(!this._disposed){this._disposed=!0,this.textureLoader.dispose();for(const t of this._renderers.values())t.dispose();this._renderers.clear(),this._drawCallPool.dispose(),this._drawCalls.length=0,this.__gl=null}}_init(){const t=this.__gl;if(this._ortho=Be.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.depthMask(!1),this.register(new ud({uvPadding:this.uvPadding,pixelArtSampler:this.pixelArtSampler})),this.register(new nh),this.register(new pd),this.register(new md),this.register(new od),this.register(new sd),this.lazyRegister("ex.particle",()=>new Oh),this.register(new Rd({uvPadding:this.uvPadding,pixelArtSampler:this.pixelArtSampler})),this.materialScreenTexture=t.createTexture(),!this.materialScreenTexture)throw new Error("Could not create screen texture!");t.bindTexture(t.TEXTURE_2D,this.materialScreenTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),this._screenRenderer=new ld(t),this._renderTarget=new Hr({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height}),this._postProcessTargets=[new Hr({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height}),new Hr({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height})],this._msaaTarget=new Hr({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height,antialias:this.multiSampleAntialiasing,samples:this.samples})}register(t){this._renderers.set(t.type,t),t.initialize(this.__gl,this)}lazyRegister(t,e){this._lazyRenderersFactory.set(t,e)}get(t){let e=this._renderers.get(t);if(!e){const i=this._lazyRenderersFactory.get(t);i&&(this._logger.debug("lazy init renderer:",t),e=i(),this.register(e))}return e}_isCurrentRenderer(t){return!this._currentRenderer||this._currentRenderer===t}beginDrawLifecycle(){this._isDrawLifecycle=!0}endDrawLifecycle(){this._isDrawLifecycle=!1}draw(t,...e){if(this._isDrawLifecycle||this._logger.warnOnce(`Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.
If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`),this._isContextLost){this._logger.errorOnce(`Unable to draw ${t}, the webgl context is lost`);return}const i=this.get(t);if(i)if(this.useDrawSorting){const s=this._drawCallPool.get();s.z=this._state.current.z,s.priority=i.priority,s.renderer=t,this.getTransform().clone(s.transform),s.state.z=this._state.current.z,s.state.opacity=this._state.current.opacity,s.state.tint=this._state.current.tint,s.state.material=this._state.current.material,s.args[0]=e[0],s.args[1]=e[1],s.args[2]=e[2],s.args[3]=e[3],s.args[4]=e[4],s.args[5]=e[5],s.args[6]=e[6],s.args[7]=e[7],s.args[8]=e[8],s.args[9]=e[9],this._drawCalls[this._drawCallIndex++]=s}else this._currentRenderer||(this._currentRenderer=i),this._isCurrentRenderer(i)||this._currentRenderer.flush(),i.draw(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9]),this._currentRenderer=i;else throw Error(`No renderer with name ${t} has been registered`)}resetTransform(){this._transform.reset()}updateViewport(t){const e=this.__gl;this._ortho=this._ortho=Be.ortho(0,t.width,t.height,0,400,-400),this._renderTarget.setResolution(e.canvas.width,e.canvas.height),this._msaaTarget.setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[0].setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[1].setResolution(e.canvas.width,e.canvas.height)}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}drawImage(t,e,i,s,r,o,a,h,l){if(!(s===0||r===0)){{if(h===0||l===0)return;if(this._getImageWidth(t)===0||this._getImageHeight(t)===0)return}if(!t){lt.getInstance().warn("Cannot draw a null or undefined image"),console.trace&&console.trace();return}this._state.current.material?this.draw("ex.material",t,e,i,s,r,o,a,h,l):this.imageRenderer==="ex.image"?this.draw(this.imageRenderer,t,e,i,s,r,o,a,h,l):this.draw(this.imageRenderer,t,e,i,s,r,o,a,h,l)}}drawLine(t,e,i,s=1){this.draw("ex.rectangle",t,e,i,s)}drawRectangle(t,e,i,s,r,o){this.draw("ex.rectangle",t,e,i,s,r,o)}drawCircle(t,e,i,s,r){this.draw("ex.circle",t,e,i,s,r)}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(t,e){this._transform.translate(this.snapToPixel?~~(t+yt):t,this.snapToPixel?~~(e+yt):e)}rotate(t){this._transform.rotate(t)}scale(t,e){this._transform.scale(t,e)}transform(t){this._transform.current=t}getTransform(){return this._transform.current}multiply(t){this._transform.current.multiply(t,this._transform.current)}addPostProcessor(t){this._postprocessors.push(t),t.initialize(this.__gl)}removePostProcessor(t){const e=this._postprocessors.indexOf(t);e!==-1&&this._postprocessors.splice(e,1)}clearPostProcessors(){this._postprocessors.length=0}updatePostProcessors(t){for(const e of this._postprocessors){const i=e.getShader();i.use();const s=i.getUniforms();this._totalPostProcessorTime+=t,s.find(r=>r.name==="u_time_ms")&&i.setUniformFloat("u_time_ms",this._totalPostProcessorTime),s.find(r=>r.name==="u_elapsed_ms")&&i.setUniformFloat("u_elapsed_ms",t),s.find(r=>r.name==="u_resolution")&&i.setUniformFloatVector("u_resolution",T(this.width,this.height)),e.onUpdate&&e.onUpdate(t)}}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return new Nh({...t,graphicsContext:this})}createShader(t){const e=this.__gl,{vertexSource:i,fragmentSource:s}=t,r=new Ie({gl:e,vertexSource:i,fragmentSource:s});return r.compile(),r}clear(){const t=this.__gl;(this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget).use(),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT)}flush(){var t;if(this._isContextLost){this._logger.errorOnce("Unable to flush the webgl context is lost");return}let e=this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget;if(e.use(),this.useDrawSorting){for(let o=this._drawCallIndex;o<this._drawCalls.length;o++)this._drawCalls[o]=null;const i=new Map;for(const[o]of this._renderers){let a=0;for(a=0;a<this._drawCallIndex&&this._drawCalls[a].renderer!==o;a++);i.set(o,a)}this._drawCalls.sort((o,a)=>{if(o===null||a===null)return 0;const h=o.z-a.z,l=i.get(o.renderer)-i.get(a.renderer),c=o.priority-a.priority;return h===0?c===0?l:c:h});const s=this._transform.current,r=this._state.current;if(this._drawCalls.length&&this._drawCallIndex){let o=this._drawCalls[0].renderer,a=this.get(o);for(let h=0;h<this._drawCallIndex;h++)this._transform.current=this._drawCalls[h].transform,this._state.current=this._drawCalls[h].state,this._drawCalls[h].renderer!==o&&(a.flush(),o=this._drawCalls[h].renderer,a=this.get(o)),a instanceof nh&&(!((t=this.material)===null||t===void 0)&&t.isUsingScreenTexture)&&(e.copyToTexture(this.materialScreenTexture),e.use()),a.draw(...this._drawCalls[h].args);a.hasPendingDraws()&&a.flush()}this._transform.current=s,this._state.current=r,this._drawCallPool.done(),this._drawCallIndex=0,this._imageToHeight.clear(),this._imageToWidth.clear()}else for(const i of this._renderers.values())i.hasPendingDraws()&&i.flush();e.disable(),this._postprocessors.length>0&&e.toRenderSource().use();for(let i=0;i<this._postprocessors.length;i++)e=this._postProcessTargets[i%2],this._postProcessTargets[i%2].use(),this._screenRenderer.renderWithPostProcessor(this._postprocessors[i]),this._postProcessTargets[i%2].toRenderSource().use();e.blitToScreen()}}const jt=1e-4;class Ld{constructor(t){this._ex=t,this._debugText=new jo}drawRect(t,e,i,s){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~(t+jt):t,this._ex.snapToPixel?~~(e+jt):e,this._ex.snapToPixel?~~(i+jt):i,this._ex.snapToPixel?~~(s+jt):s),this._ex.__ctx.restore()}drawLine(t,e,i={color:q.Black}){var s,r;this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=(r=(s=i.color)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:"",this._ex.__ctx.moveTo(this._ex.snapToPixel?~~(t.x+jt):t.x,this._ex.snapToPixel?~~(t.y+jt):t.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~(e.x+jt):e.x,this._ex.snapToPixel?~~(e.y+jt):e.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(t,e={color:q.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=e.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~(t.x+jt):t.x,this._ex.snapToPixel?~~(t.y+jt):t.y,e.size,0,Math.PI*2),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawText(t,e){this._debugText.write(this._ex,t,e)}}class dn{get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(t){this.__ctx.imageSmoothingEnabled=t}constructor(t){this.useDrawSorting=!1,this.z=0,this.backgroundColor=q.ExcaliburBlue,this._state=new Fh,this.snapToPixel=!1,this.debug=new Ld(this);const{canvasElement:e,context:i,enableTransparency:s,snapToPixel:r,antialiasing:o,backgroundColor:a}=t;if(this.__ctx=i??e.getContext("2d",{alpha:s??!0}),!this.__ctx)throw new Error("Cannot build new ExcaliburGraphicsContext2D for some reason!");this.backgroundColor=a??this.backgroundColor,this.snapToPixel=r??this.snapToPixel,this.smoothing=o??this.smoothing}resetTransform(){this.__ctx.resetTransform()}updateViewport(t){}drawImage(t,e,i,s,r,o,a,h,l){if(s===0||r===0)return;if(h===0||l===0)return;if(t.width===0||t.height===0)return;this.__ctx.globalAlpha=this.opacity;const c=[t,e,i,s,r,o,a,h,l].filter(d=>d!==void 0).map(d=>typeof d=="number"&&this.snapToPixel?~~d:d);this.__ctx.drawImage.apply(this.__ctx,c),Gt.DrawCallCount++,Gt.DrawnImagesCount=1}drawLine(t,e,i,s=1){this.__ctx.save(),this.__ctx.beginPath(),this.__ctx.strokeStyle=i.toString(),this.__ctx.moveTo(this.snapToPixel?~~(t.x+jt):t.x,this.snapToPixel?~~(t.y+jt):t.y),this.__ctx.lineTo(this.snapToPixel?~~(e.x+jt):e.x,this.snapToPixel?~~(e.y+jt):e.y),this.__ctx.lineWidth=s,this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}drawRectangle(t,e,i,s){this.__ctx.save(),this.__ctx.fillStyle=s.toString(),this.__ctx.fillRect(this.snapToPixel?~~(t.x+jt):t.x,this.snapToPixel?~~(t.y+jt):t.y,this.snapToPixel?~~(e+jt):e,this.snapToPixel?~~(i+jt):i),this.__ctx.restore()}drawCircle(t,e,i,s,r){this.__ctx.save(),this.__ctx.beginPath(),s&&(this.__ctx.strokeStyle=s.toString()),r&&(this.__ctx.lineWidth=r),this.__ctx.fillStyle=i.toString(),this.__ctx.arc(this.snapToPixel?~~(t.x+jt):t.x,this.snapToPixel?~~(t.y+jt):t.y,e,0,Math.PI*2),this.__ctx.fill(),s&&this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}save(){this.__ctx.save(),this._state.save()}restore(){this.__ctx.restore(),this._state.restore()}translate(t,e){this.__ctx.translate(this.snapToPixel?~~(t+jt):t,this.snapToPixel?~~(e+jt):e)}rotate(t){this.__ctx.rotate(t)}scale(t,e){this.__ctx.scale(t,e)}getTransform(){throw new Error("Not implemented")}multiply(t){this.__ctx.setTransform(this.__ctx.getTransform().multiply(t.toDOMMatrix()))}addPostProcessor(t){}removePostProcessor(t){}clearPostProcessors(){}updatePostProcessors(t){}beginDrawLifecycle(){}endDrawLifecycle(){}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return null}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),Gt.clear()}flush(){}dispose(){this.__ctx=void 0}}var oe;(function(n){n.Fixed="Fixed",n.FitContainerAndFill="FitContainerAndFill",n.FitScreenAndFill="FitScreenAndFill",n.FitContainerAndZoom="FitContainerAndZoom",n.FitScreenAndZoom="FitScreenAndZoom",n.FitScreen="FitScreen",n.FillScreen="FillScreen",n.FitContainer="FitContainer",n.FillContainer="FillContainer"})(oe||(oe={}));class uo{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}const Ud={ScreenResize:"resize",PixelRatioChange:"pixelratio",FullScreenChange:"fullscreen"};class Ao{constructor(t){var e,i,s,r;this.events=new Nt,this._antialiasing=!0,this._canvasImageRendering="auto",this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullscreen=!1,this._isDisposed=!1,this._logger=lt.getInstance(),this._fullscreenChangeHandler=()=>{this._isDisposed||(this._isFullscreen=!this._isFullscreen,this._logger.debug("Fullscreen Change",this._isFullscreen),this.events.emit("fullscreen",{fullscreen:this.isFullscreen}))},this._pixelRatioChangeHandler=()=>{this._isDisposed||(this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._listenForPixelRatio(),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport(),this.events.emit("pixelratio",{pixelRatio:this.pixelRatio}))},this._resizeHandler=()=>{if(this._isDisposed)return;const o=this.parent;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(o),this.applyResolutionAndViewport(),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})},this._devicePixelRatio=this._calculateDevicePixelRatio(),this._contentArea=new ht,this._unsafeArea=new ht,this.viewport=t.viewport,this.resolution=(e=t.resolution)!==null&&e!==void 0?e:{...this.viewport},this._contentResolution=this.resolution,this._displayMode=(i=t.displayMode)!==null&&i!==void 0?i:oe.Fixed,this._canvas=t.canvas,this.graphicsContext=t.context,this._antialiasing=(s=t.antialiasing)!==null&&s!==void 0?s:this._antialiasing,this._canvasImageRendering=(r=t.canvasImageRendering)!==null&&r!==void 0?r:this._canvasImageRendering,this._browser=t.browser,this._pixelRatioOverride=t.pixelRatio,this._applyDisplayMode(),this._listenForPixelRatio(),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler),this.applyResolutionAndViewport()}_listenForPixelRatio(){this._mediaQueryList&&!this._mediaQueryList.addEventListener&&this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener?this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler,{once:!0}):this._mediaQueryList.addListener(this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this.events.clear(),this._browser.window.off("resize",this._resizeHandler),this._browser.window.clear(),this._resizeObserver&&this._resizeObserver.disconnect(),this.parent.removeEventListener("resize",this._resizeHandler),this._mediaQueryList.removeEventListener?this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler):this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler),this._canvas=null)}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get worldToPagePixelRatio(){if(this._canvas){const t=this.worldToPageCoordinates(E.Zero);return this.worldToPageCoordinates(T(1,0)).sub(t).x}else return 1}get pixelRatioOverride(){return this._pixelRatioOverride}set pixelRatioOverride(t){this._pixelRatioOverride=t}get isHiDpi(){return this.pixelRatio!==1}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get parent(){switch(this.displayMode){case oe.FillContainer:case oe.FitContainer:case oe.FitContainerAndFill:case oe.FitContainerAndZoom:return this.canvas.parentElement||document.body;default:return window}}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution={...this.resolution},this.viewport={...this.viewport}}peekViewport(){return this._viewportStack[this._viewportStack.length-1]}peekResolution(){return this._resolutionStack[this._resolutionStack.length-1]}popResolutionAndViewport(){this._resolutionStack.length&&this._viewportStack.length&&(this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop())}applyResolutionAndViewport(){if(this.graphicsContext instanceof wi&&!this.graphicsContext.checkIfResolutionSupported({width:this.scaledWidth,height:this.scaledHeight})&&(this._logger.warnOnce(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio}) are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly. Try reducing the resolution or disabling Hi DPI scaling to avoid this (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`),!this.pixelRatioOverride)){let s=Math.max(1,this.pixelRatio-.5),r=!1;for(;s>1&&!r;){s=Math.max(1,s-.5);const o=this._resolution.width*s,a=this._resolution.height*s;r=this.graphicsContext.checkIfResolutionSupported({width:o,height:a})}this.pixelRatioOverride=s,this._logger.warnOnce(`Scaled resolution too big attempted recovery! Pixel ratio was automatically reduced to (${this.pixelRatio}) to avoid 4k texture limit. Setting \`ex.Engine({pixelRatio: ...}) will override any automatic recalculation, do so at your own risk.\`  (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`)}this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this._canvasImageRendering==="auto"?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",this._canvas.style.imageRendering===""&&(this._canvas.style.imageRendering="crisp-edges"));const t=this.viewport.widthUnit==="percent"?"%":"px",e=this.viewport.heightUnit==="percent"?"%":"px";this._canvas.style.width=this.viewport.width+t,this._canvas.style.height=this.viewport.height+e,this.graphicsContext.updateViewport(this.resolution),this.graphicsContext.resetTransform(),this.graphicsContext.smoothing=this._antialiasing,this.graphicsContext instanceof dn&&this.graphicsContext.scale(this.pixelRatio,this.pixelRatio),document.documentElement.style.setProperty("--ex-pixel-ratio",this.worldToPagePixelRatio.toString())}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this.graphicsContext.smoothing=this._antialiasing}get isFullScreen(){return this._isFullscreen}get isFullscreen(){return this._isFullscreen}goFullScreen(t){return this.enterFullscreen(t)}enterFullscreen(t){var e,i,s,r,o,a;if(t){const h=document.getElementById(t);if(h?.requestFullscreen||h?.webkitRequestFullscreen){if(h.getAttribute("ex-fullscreen-listener")||(h.setAttribute("ex-fullscreen-listener","true"),h.addEventListener("fullscreenchange",this._fullscreenChangeHandler)),h.requestFullscreen)return(e=h.requestFullscreen())!==null&&e!==void 0?e:Promise.resolve();if(h.webkitRequestFullscreen)return(i=h.webkitRequestFullscreen())!==null&&i!==void 0?i:Promise.resolve()}}return!((s=this._canvas)===null||s===void 0)&&s.requestFullscreen?(o=(r=this._canvas)===null||r===void 0?void 0:r.requestFullscreen())!==null&&o!==void 0?o:Promise.resolve():this._canvas.webkitRequestFullscreen?(a=this._canvas.webkitRequestFullscreen())!==null&&a!==void 0?a:Promise.resolve():(this._logger.warnOnce("Could not go fullscreen, is this an iPhone? Currently Apple does not support fullscreen on iPhones"),Promise.resolve())}exitFullScreen(){return this.exitFullscreen()}exitFullscreen(){return document.exitFullscreen()}_viewportToPixels(t){return{width:t.widthUnit==="percent"?this.canvas.offsetWidth:t.width,height:t.heightUnit==="percent"?this.canvas.offsetHeight:t.height}}pageToScreenCoordinates(t){let e=t.x,i=t.y;this._isFullscreen||(e-=Hs(this._canvas).x,i-=Hs(this._canvas).y);const s=this._viewportToPixels(this.viewport);if(this._isFullscreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const r=window.innerWidth/this.aspectRatio,o=(window.innerHeight-r)/2;i=(i-o)/r*s.height,e=e/window.innerWidth*s.width}else{const r=window.innerHeight*this.aspectRatio,o=(window.innerWidth-r)/2;e=(e-o)/r*s.width,i=i/window.innerHeight*s.height}return e=e/s.width*this.resolution.width,i=i/s.height*this.resolution.height,e=e-this.contentArea.left,i=i-this.contentArea.top,new E(e,i)}screenToPageCoordinates(t){let e=t.x,i=t.y;const s=this._viewportToPixels(this.viewport);if(e=e/this.resolution.width*s.width,i=i/this.resolution.height*s.height,this._isFullscreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const r=window.innerWidth/this.aspectRatio,o=(window.innerHeight-r)/2;i=i/s.height*r+o,e=e/s.width*window.innerWidth}else{const r=window.innerHeight*this.aspectRatio,o=(window.innerWidth-r)/2;e=e/s.width*r+o,i=i/s.height*window.innerHeight}return this._isFullscreen||(e+=Hs(this._canvas).x,i+=Hs(this._canvas).y),new E(e,i)}screenToWorldCoordinates(t){return t=t.add(T(this.contentArea.left,this.contentArea.top)),this._camera?this._camera.inverse.multiply(t):t.sub(T(this.resolution.width/2,this.resolution.height/2))}worldToScreenCoordinates(t){return this._camera?this._camera.transform.multiply(t):t.add(T(this.resolution.width/2,this.resolution.height/2))}pageToWorldCoordinates(t){const e=this.pageToScreenCoordinates(t);return this.screenToWorldCoordinates(e)}worldToPageCoordinates(t){const e=this.worldToScreenCoordinates(t);return this.screenToPageCoordinates(e)}getWorldBounds(){return ht.fromDimension(this.resolution.width,this.resolution.height,E.Half).scale(T(1/this._camera.zoom,1/this._camera.zoom)).rotate(this._camera.rotation).translate(this._camera.drawPos)}getScreenBounds(){return ht.fromDimension(this.resolution.width,this.resolution.height,E.Zero,E.Zero)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get width(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get height(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get halfDrawHeight(){return this.drawHeight/2}get center(){return T(this.halfDrawWidth,this.halfDrawHeight)}get contentArea(){return this._contentArea}get unsafeArea(){return this._unsafeArea}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.aspectRatio;let e=0,i=0;window.innerWidth/t<window.innerHeight?(e=window.innerWidth,i=window.innerWidth/t):(e=window.innerHeight*t,i=window.innerHeight),this.viewport={width:e,height:i},this._contentArea=ht.fromDimension(this.resolution.width,this.resolution.height,E.Zero),this._unsafeArea=ht.fromDimension(this.resolution.width,this.resolution.height,E.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitScreenAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndFill(t,e),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndFill(){this.canvas.style.width="100%",this.canvas.style.height="100%",this._computeFitAndFill(this.canvas.offsetWidth,this.canvas.offsetHeight,{width:100,widthUnit:"percent",height:100,heightUnit:"percent"}),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndFill(t,e,i){if(this.viewport=i??{width:t,height:e},t/e<=this._contentResolution.width/this._contentResolution.height){this.resolution={width:t*this._contentResolution.width/t,height:t*this._contentResolution.width/t*e/t};const s=(this.resolution.height-this._contentResolution.height)/2;this._contentArea=new ht({top:s,left:0,right:this._contentResolution.width,bottom:this.resolution.height-s}),this._unsafeArea=new ht({top:-s,left:0,right:this._contentResolution.width,bottom:this.resolution.height+s})}else{this.resolution={width:e*this._contentResolution.height/e*t/e,height:e*this._contentResolution.height/e};const s=(this.resolution.width-this._contentResolution.width)/2;this._contentArea=new ht({top:0,left:s,right:this.resolution.width-s,bottom:this._contentResolution.height}),this._unsafeArea=new ht({top:0,left:-s,right:this.resolution.width+s,bottom:this._contentResolution.height})}}_computeFitScreenAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndZoom(t,e),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndZoom(){this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="relative";const t=this.canvas.parentElement;t.style.overflow="hidden";const{offsetWidth:e,offsetHeight:i}=this.canvas;this._computeFitAndZoom(e,i),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndZoom(t,e){const i=this.aspectRatio;let s=0,r=0;t/i<e?(s=t,r=t/i):(s=e*i,r=e);const o=t/s,a=e/r,h=Math.max(o,a),l=s*h,c=r*h;l>t?this.canvas.style.left=-(l-t)/2+"px":this.canvas.style.left="",c>e?this.canvas.style.top=-(c-e)/2+"px":this.canvas.style.top="",this.viewport={width:l,height:c};const d=ht.fromDimension(this.viewport.width,this.viewport.height,E.Zero);if(this.viewport.width>t){const A=(this.viewport.width-t)/this.viewport.width*this.resolution.width;d.top=0,d.left=A/2,d.right=this.resolution.width-A/2,d.bottom=this.resolution.height}if(this.viewport.height>e){const A=(this.viewport.height-e)/this.viewport.height*this.resolution.height;d.top=A/2,d.left=0,d.bottom=this.resolution.height-A/2,d.right=this.resolution.width}this._contentArea=d}_computeFitContainer(){const t=this.aspectRatio;let e=0,i=0,s="pixel",r="pixel";const o=this.canvas.parentElement;o.clientWidth/t<o.clientHeight?(this.canvas.style.width="100%",e=100,s="percent",i=this.canvas.offsetWidth/t):(this.canvas.style.height="100%",i=100,r="percent",e=this.canvas.offsetHeight*t),this.viewport={width:e,widthUnit:s,height:i,heightUnit:r},this._contentArea=ht.fromDimension(this.resolution.width,this.resolution.height,E.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_applyDisplayMode(){this._setResolutionAndViewportByDisplayMode(this.parent),this.parent instanceof Window?this._browser.window.on("resize",this._resizeHandler):(this._resizeObserver=new ResizeObserver(()=>{this._resizeHandler()}),this._resizeObserver.observe(this.parent)),this.parent.addEventListener("resize",this._resizeHandler)}_setResolutionAndViewportByDisplayMode(t){this.displayMode===oe.FillContainer&&(this.canvas.style.width="100%",this.canvas.style.height="100%",this.viewport={width:100,widthUnit:"percent",height:100,heightUnit:"percent"},this.resolution={width:this.canvas.offsetWidth,height:this.canvas.offsetHeight}),this.displayMode===oe.FillScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution),this._contentArea=ht.fromDimension(this.resolution.width,this.resolution.height,E.Zero),this.displayMode===oe.FitScreen&&this._computeFit(),this.displayMode===oe.FitContainer&&this._computeFitContainer(),this.displayMode===oe.FitScreenAndFill&&this._computeFitScreenAndFill(),this.displayMode===oe.FitContainerAndFill&&this._computeFitContainerAndFill(),this.displayMode===oe.FitScreenAndZoom&&this._computeFitScreenAndZoom(),this.displayMode===oe.FitContainerAndZoom&&this._computeFitContainerAndZoom()}}class tr{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}function Gd(n){return!!n.playbackState}class Xi{static unlock(){return new Promise((e,i)=>{if(Xi._UNLOCKED||!tr.create())return e(!0);const s=setTimeout(()=>{lt.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),e(!1)},200),r=tr.create();r.resume().then(()=>{const o=r.createBuffer(1,1,22050),a=r.createBufferSource();let h=!1;a.buffer=o,a.connect(r.destination),a.onended=()=>h=!0,a.start(0),setTimeout(()=>{Gd(a)?(a.playbackState===a.PLAYING_STATE||a.playbackState===a.FINISHED_STATE)&&(Xi._UNLOCKED=!0):(r.currentTime>0||h)&&(Xi._UNLOCKED=!0)},0),clearTimeout(s),e(!0)},()=>{i()})})}static isUnlocked(){return this._UNLOCKED}}Xi._UNLOCKED=!1;class Sn extends Rs{get ctx(){return this._ctx}constructor(t={}){super(t),this._options=t}clone(){return new Sn({...this._options,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){var e,i;!((e=this._options)===null||e===void 0)&&e.draw&&((i=this._options)===null||i===void 0||i.draw(t)),this._options.cache||this.flagDirty()}}class ya{}ya.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class Tn{constructor(){this.states=new Map}get currentState(){return this._currentState}set currentState(t){this._currentState=t}static create(t,e){const i=new Tn;i.data=e;for(const s in t.states)i.states.set(s,{name:s,...t.states[s]});for(const s of i.states.values())for(const r of s.transitions)if(r!=="*"&&!i.states.has(r))throw Error(`Invalid state machine, state [${s.name}] has a transition to another state that doesn't exist [${r}]`);return i.currentState=i.startState=i.states.get(t.start),i}in(t){return this.currentState.name===t}go(t,e){var i,s;if(this.currentState.transitions.includes(t)||this.currentState.transitions.includes("*")){const r=this.states.get(t);return this.currentState.onExit&&((i=this.currentState)===null||i===void 0?void 0:i.onExit({to:r.name,data:this.data}))===!1||r?.onEnter&&r?.onEnter({from:this.currentState.name,eventData:e,data:this.data})===!1?!1:(this.currentState=r,!((s=this.currentState)===null||s===void 0)&&s.onState&&this.currentState.onState(),!0)}return!1}update(t){this.currentState.onUpdate&&this.currentState.onUpdate(this.data,t)}save(t){localStorage.setItem(t,JSON.stringify({currentState:this.currentState.name,data:this.data}))}restore(t){const e=JSON.parse(localStorage.getItem(t));this.currentState=this.states.get(e.currentState),this.data=e.data}}class Hh{_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.value=this._playbackRate,this._instance.connect(this._volumeNode),this._volumeNode.connect(this._audioContext.destination)}_handleEnd(){this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)})}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)}))}get loop(){return this._loop}set volume(t){t=It(t,0,1),this._volume=t,this._stateMachine.in("PLAYING")&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}get duration(){var t;return(t=this._duration)!==null&&t!==void 0?t:this.getTotalPlaybackDuration()}set duration(t){this._duration=t}constructor(t){this._src=t,this._audioContext=tr.create(),this._volumeNode=this._audioContext.createGain(),this._playingFuture=new ke,this._stateMachine=Tn.create({start:"STOPPED",states:{PLAYING:{onEnter:({data:e})=>{this._createNewBufferSource(),this._handleEnd(),this.loop?this._instance.start(0,e.pausedAt*this._playbackRate):this._instance.start(0,e.pausedAt*this._playbackRate,this.duration),e.startedAt=this._audioContext.currentTime-e.pausedAt,e.pausedAt=0},onState:()=>this._playStarted(),onExit:({to:e})=>{e==="STOPPED"&&this._playingFuture.resolve(!0),this._instance.onended=null,this._instance.disconnect(),this._instance.stop(0),this._instance=null},transitions:["STOPPED","PAUSED","SEEK"]},SEEK:{onEnter:({eventData:e,data:i})=>{i.pausedAt=(e??0)/this._playbackRate,i.startedAt=0},transitions:["*"]},STOPPED:{onEnter:({data:e})=>{e.pausedAt=0,e.startedAt=0,this._playingFuture.resolve(!0)},transitions:["PLAYING","PAUSED","SEEK"]},PAUSED:{onEnter:({data:e})=>{e.pausedAt=this._audioContext.currentTime-e.startedAt},transitions:["PLAYING","STOPPED","SEEK"]}}},{startedAt:0,pausedAt:0}),this._volume=1,this._loop=!1,this._playStarted=()=>{},this._playbackRate=1,this._createNewBufferSource()}isPlaying(){return this._stateMachine.in("PLAYING")}isPaused(){return this._stateMachine.in("PAUSED")||this._stateMachine.in("SEEK")}isStopped(){return this._stateMachine.in("STOPPED")}play(t=()=>{}){return this._playStarted=t,this._stateMachine.go("PLAYING"),this._playingFuture.promise}pause(){this._stateMachine.go("PAUSED")}stop(){this._stateMachine.go("STOPPED")}seek(t){this._stateMachine.go("PAUSED"),this._stateMachine.go("SEEK",t)}getTotalPlaybackDuration(){return this._src.duration}getPlaybackPosition(){const{pausedAt:t,startedAt:e}=this._stateMachine.data;return t?t*this._playbackRate:e?(this._audioContext.currentTime-e)*this._playbackRate:0}set playbackRate(t){this._instance.playbackRate.value=this._playbackRate=t}get playbackRate(){return this._instance.playbackRate.value}}class Ca extends bt{set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}constructor(t,e="MediaEvent"){super(),this.target=t,this._name=e}stopPropagation(){}action(){}propagate(){}layPath(t){}}class Wi extends Ca{constructor(t,e){super(t,"NativeSoundEvent"),this.track=e}}class qh extends Ca{constructor(t,e){super(t,"NativeSoundProcessedEvent"),this._processedData=e,this.data=this._processedData}}function Nd(n){try{const t=new Audio,e=/.*\.([A-Za-z0-9]+)(?:(?:\?|\#).*)*$/,i=n.match(e)[1];return!!t.canPlayType("audio/"+i)}catch(t){return lt.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}const zd={VolumeChange:"volumechange",Processed:"processed",Pause:"pause",Stop:"stop",PlaybackEnd:"playbackend",Resume:"resume",PlaybackStart:"playbackstart"};class Wh{set loop(t){this._loop=t;for(const e of this._tracks)e.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(const e of this._tracks)e.volume=this._volume;this.events.emit("volumechange",new Wi(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}set duration(t){this._duration=t}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}constructor(...t){this.events=new Nt,this.logger=lt.getInstance(),this._loop=!1,this._volume=1,this._isStopped=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._playbackRate=1,this._audioContext=tr.create(),this._resource=new Pr("",ya.type.arraybuffer);for(const e of t)if(Nd(e)){this.path=e;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",t.join(", ")),this.logger.warn("Attempting to use",t[0]),this.path=t[0])}isLoaded(){return!!this.data}async load(){var t,e;if(this.data)return this.data;const i=await this._resource.load(),s=await this.decodeAudio(i.slice(0));return this._duration=(e=(t=this._duration)!==null&&t!==void 0?t:s?.duration)!==null&&e!==void 0?e:void 0,this.events.emit("processed",new qh(this,s)),this.data=s}async decodeAudio(t){try{return await this._audioContext.decodeAudioData(t.slice(0))}catch{return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),await Promise.reject()}}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())}),this._engine.on("visible",()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)}),this._engine.on("start",()=>{this._isStopped=!1}),this._engine.on("stop",()=>{this.stop(),this._isStopped=!0}))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some(t=>t.isPlaying())}isPaused(){return this._tracks.some(t=>t.isPaused())}isStopped(){return this._tracks.some(t=>t.isStopped())}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t||this.volume,this.isPaused()?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const t of this._tracks)t.pause();this.events.emit("pause",new Wi(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const t of this._tracks)t.stop();this.events.emit("stop",new Wi(this)),this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._tracks.forEach(e=>{e.playbackRate=this._playbackRate})}seek(t,e=0){this._tracks.length===0&&this._getTrackInstance(this.data),this._tracks[e].seek(t)}getTotalPlaybackDuration(){return this.isLoaded()?this.data.duration:(this.logger.warnOnce(`Sound from ${this.path} is not loaded, cannot return total playback duration.Did you forget to add Sound to a loader? https://excaliburjs.com/docs/loaders/`),0)}getPlaybackPosition(t=0){return this._tracks.length?this._tracks[t].getPlaybackPosition():0}getTrackId(t){return this._tracks.indexOf(t)}async _resumePlayback(){if(this.isPaused()){const t=[];for(const e of this._tracks)t.push(e.play().then(()=>(this._tracks.splice(this.getTrackId(e),1),!0)));this.events.emit("resume",new Wi(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),await Promise.all(t)}return!0}async _startPlayback(){const t=this._getTrackInstance(this.data),e=await t.play(()=>{this.events.emit("playbackstart",new Wi(this,t)),this.logger.debug("Playing new instance for sound",this.path)});this.events.emit("playbackend",new Wi(this,t));const i=this.getTrackId(t);return i!==-1&&this._tracks.splice(i,1),e}_getTrackInstance(t){var e;const i=new Hh(t);return i.loop=this.loop,i.volume=this.volume,i.duration=(e=this.duration)!==null&&e!==void 0?e:0,i.playbackRate=this._playbackRate,this._tracks.push(i),i}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}const Od={BeforeLoad:"beforeload",AfterLoad:"afterload",UserAction:"useraction",LoadResourceStart:"loadresourcestart",LoadResourceEnd:"loadresourceend"};function go(n){var t,e;return!!n?.prototype&&!!(!((e=(t=n?.prototype)===null||t===void 0?void 0:t.constructor)===null||e===void 0)&&e.name)}class er{get resources(){return this._resources}constructor(t){var e;this.events=new Nt,this.canvas=new Sn({filtering:ie.Blended,smoothing:!0,cache:!1,draw:this.onDraw.bind(this)}),this._resources=[],this._numLoaded=0,this._totalTimeMs=0,this._loadingFuture=new ke,t&&(!((e=t.loadables)===null||e===void 0)&&e.length)&&this.addResources(t.loadables)}onInitialize(t){this.engine=t,this.canvas.width=this.engine.screen.resolution.width,this.canvas.height=this.engine.screen.resolution.height}async onUserAction(){return await Promise.resolve()}async onBeforeLoad(){}async onAfterLoad(){await Kr(500,this.engine.clock)}addResource(t){this._resources.push(t)}addResources(t){let e=0;const i=t.length;for(e;e<i;e++)this.addResource(t[e])}markResourceComplete(){this._numLoaded++}get progress(){const t=this._resources.length;return t>0?It(this._numLoaded,0,t)/t:1}isLoaded(){return this._numLoaded===this._resources.length}onUpdate(t,e){this._totalTimeMs+=e}onDraw(t){const e=this._totalTimeMs/1e3;t.fillStyle=q.Black.toRGBA(),t.fillRect(0,0,this.engine.screen.resolution.width,this.engine.screen.resolution.height),t.save(),t.translate(this.engine.screen.resolution.width/2,this.engine.screen.resolution.height/2);const i=e*10;t.strokeStyle="white",t.lineWidth=10,t.lineCap="round",t.arc(0,0,40,i,i+Math.PI*3/2),t.stroke(),t.fillStyle="white",t.font="16px sans-serif";const s=(this.progress*100).toFixed(0)+"%",r=t.measureText(s),o=Math.abs(r.actualBoundingBoxLeft)+Math.abs(r.actualBoundingBoxRight),a=Math.abs(r.actualBoundingBoxAscent)+Math.abs(r.actualBoundingBoxDescent);t.fillText(s,-o/2,a/2),t.restore()}areResourcesLoaded(){return this._resources.length===0?Promise.resolve():this._loadingFuture.promise}async load(){await this.onBeforeLoad(),this.events.emit("beforeload"),this.canvas.flagDirty(),await Promise.all(this._resources.map(async t=>{this.events.emit("loadresourcestart",t),await t.load().finally(()=>{this._numLoaded++,this.canvas.flagDirty(),this.events.emit("loadresourceend",t)})}));for(const t of this._resources)t instanceof Wh&&t.wireEngine(this.engine);return this._loadingFuture.resolve(),this.canvas.flagDirty(),await this.onUserAction(),this.events.emit("useraction"),await Xi.unlock(),await this.onAfterLoad(),this.events.emit("afterload"),this.data=this._resources}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}const Hd="data:image/png;base64,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";var qd=le(851);class ns extends er{get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.onload=()=>this._imageLoaded.resolve(),this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){const t=document.getElementById("excalibur-play-root");return t&&(this._playButtonRootElement=t),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}constructor(t){const e=Array.isArray(t)?{loadables:t}:t;super(e),this._logger=lt.getInstance(),this._originalOptions={loadables:[]},this.events=new Nt,this._playButtonShown=!1,this.logo=Hd,this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=q.White,this.backgroundColor="#176BAA",this._imageLoaded=new ke,this.suppressPlayButton=!1,this._playButtonStyles=qd.A.toString(),this.playButtonText="Play game",this.startButtonFactory=()=>{let i=document.getElementById("excalibur-play");return i||(i=document.createElement("button")),i.id="excalibur-play",i.textContent=this.playButtonText,i.style.display="none",i},this._originalOptions={...ns._DEFAULT_LOADER_OPTIONS,...e}}onInitialize(t){this.engine=t,this.screen=t.screen,this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height,this.screen.events.on("resize",()=>{this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height})}async showPlayButton(){var t,e;if(this.suppressPlayButton)this.hidePlayButton(),await Kr(500,(t=this.engine)===null||t===void 0?void 0:t.clock);else{const i=()=>{try{this._positionPlayButton()}catch{}};return!((e=this.engine)===null||e===void 0)&&e.browser&&this.engine.browser.window.on("resize",i),this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",r=>{r.key==="Enter"&&this._playButton.click()}),this._positionPlayButton(),await new Promise(r=>{const o=a=>{var h;if(a.stopPropagation(),this.hidePlayButton(),!((h=this.engine)===null||h===void 0)&&h.browser&&this.engine.browser.window.off("resize",i),this._originalOptions.fullscreenAfterLoad)try{this._logger.info("requesting fullscreen"),this._originalOptions.fullscreenContainer instanceof HTMLElement?this._originalOptions.fullscreenContainer.requestFullscreen():this.engine.screen.enterFullscreen(this._originalOptions.fullscreenContainer)}catch(l){this._logger.error("could not go fullscreen",l)}r()};this._playButton.addEventListener("click",o),this._playButton.addEventListener("touchend",o),this._playButton.addEventListener("pointerup",o),this.engine&&this.engine.input.gamepads.once("button",()=>o(new Event("button")))})}}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}async onUserAction(){var t;await Kr(200,(t=this.engine)===null||t===void 0?void 0:t.clock),this.canvas.flagDirty(),await this.showPlayButton()}async onBeforeLoad(){this.screen.pushResolutionAndViewport(),this.screen.resolution={width:this.canvas.width,height:this.canvas.height},this.screen.applyResolutionAndViewport();const t=this._image;await this._imageLoaded.promise,await t?.decode()}async onAfterLoad(){this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport(),this.dispose()}_positionPlayButton(){if(this.engine){const{x:t,y:e,width:i,height:s}=this.engine.canvas.getBoundingClientRect();if(this._playButtonRootElement){const r=this._playButton.clientWidth,o=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=`${t+i/2-r/2}px`,this._playButtonRootElement.style.top=`${e+s/2-o/2+100}px`)}}}onDraw(t){const e=this.engine.canvasHeight/this.engine.pixelRatio,i=this.engine.canvasWidth/this.engine.pixelRatio;this._positionPlayButton(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,i,e);let s=e/2;const r=Math.min(this.logoWidth,i*.75);let o=i/2-r/2;this.logoPosition&&(o=this.logoPosition.x,s=this.logoPosition.y);const a=Math.floor(r*(this.logoHeight/this.logoWidth)),h=this.engine.screen.antialiasing;if(this.engine.screen.antialiasing=!0,this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,o,s,r,a):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,o,s-a-20,r,a),!this.suppressPlayButton&&this._playButtonShown){this.engine.screen.antialiasing=h;return}let l=o,c=s;this.loadingBarPosition&&(l=this.loadingBarPosition.x,c=this.loadingBarPosition.y),t.lineWidth=2,co(t,l,c,r,20,10,this.loadingBarColor);const d=r*this.progress,A=5,u=d-A*2,p=20-A*2;co(t,l+A,c+A,u>10?u:10,p,5,null,this.loadingBarColor),this.engine.screen.antialiasing=h}}ns._DEFAULT_LOADER_OPTIONS={loadables:[],fullscreenAfterLoad:!1,fullscreenContainer:void 0};const oh={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class jh{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("2d"))},arrayBufferSupport:function(){const t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch{return!1}return t.responseType==="arraybuffer"},dataUrlSupport:function(){return document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")===0},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return this._features===null&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t=`%cSUPPORTED BROWSER FEATURES
==========================%c
`;const e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],i=this.getBrowserFeatures();for(const s of Object.keys(oh))i[s]?(t+="(%c✓%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%c✗%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+oh[s]+`
`;e.unshift(t),console.log.apply(console,e)}_loadBrowserFeatures(){return{canvas:this._criticalTests.canvasSupport(),arraybuffer:this._criticalTests.arrayBufferSupport(),dataurl:this._criticalTests.dataUrlSupport(),objecturl:this._criticalTests.objectUrlSupport(),rgba:this._criticalTests.rgbaSupport(),webaudio:this._warningTest.webAudioSupport(),webgl:this._warningTest.webglSupport(),gamepadapi:!!navigator.getGamepads}}test(){let t=!1;for(const e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),lt.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(const e in this._warningTest)this._warningTest[e]()||lt.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",e);return!0}}var gt;(function(n){n.PreventCollision="PreventCollision",n.Passive="Passive",n.Active="Active",n.Fixed="Fixed"})(gt||(gt={}));class si{static create(t,e){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t)){const s=this._GROUPS.get(t);if(s.mask===e)return s;throw new Error(`Collision group ${t} already exists with a different mask!`)}const i=new bi(t,this._CURRENT_BIT,e!==void 0?e:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,i),i}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}}si._STARTING_BIT=1;si._MAX_GROUPS=32;si._CURRENT_GROUP=1;si._CURRENT_BIT=si._STARTING_BIT;si._GROUPS=new Map;class bi{constructor(t,e,i){this._name=t,this._category=e,this._mask=i}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){const e=this.category&t.mask,i=this.mask&t.category;return e!==0&&i!==0}invert(){const t=si.create("~("+this.name+")",~this.mask|0);return t._category=~this.category,t}static combine(t){const e=t.map(r=>r.name).join("+"),s=~t.reduce((r,o)=>o.category|r,0);return si.create(e,s)}static collidesWith(t){const e=`collidesWith(${t.map(s=>s.name).join("+")})`,i=t.reduce((s,r)=>r.category|s,0);return si.create(e,i)}toString(){return`
category: ${this.category.toString(2).padStart(32,"0")}
mask:     ${(this.mask>>>0).toString(2).padStart(32,"0")}
    `}}bi.All=new bi("Collide with all groups",-1,-1);class we{constructor(t,e){this.colliderA=t,this.colliderB=e,this.id=null,this.id=we.calculatePairHash(t.id,e.id)}static canCollide(t,e){var i,s;if(t.id===e.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.localBounds.hasZeroDimensions()||e.localBounds.hasZeroDimensions())return!1;const r=(i=t?.owner)===null||i===void 0?void 0:i.get(Bt),o=(s=e?.owner)===null||s===void 0?void 0:s.get(Bt);return!(!r||!o||!r.group.canCollide(o.group)||r.collisionType===gt.Fixed&&o.collisionType===gt.Fixed||o.collisionType===gt.PreventCollision||r.collisionType===gt.PreventCollision||!r.isActive||!o.isActive)}get canCollide(){const t=this.colliderA,e=this.colliderB;return we.canCollide(t,e)}collide(){return this.colliderA.collide(this.colliderB)}hasCollider(t){return t===this.colliderA||t===this.colliderB}static calculatePairHash(t,e){return t.value<e.value?`#${t.value}+${e.value}`:`#${e.value}+${t.value}`}}class Rr{constructor(t,e){this.min=t,this.max=e}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class po{constructor(t){this.parent=t,this.parent=t||null,this.data=null,this.bounds=new ht,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class xa{constructor(t,e=new ht(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this._config=t,this.worldBounds=e,this.root=null,this.nodes={}}_insert(t){if(this.root===null){this.root=t,this.root.parent=null;return}const e=t.bounds;let i=this.root;for(;!i.isLeaf();){const a=i.left,h=i.right,l=i.bounds.getPerimeter(),d=i.bounds.combine(e).getPerimeter(),A=2*d,u=2*(d-l);let p=0;const v=e.combine(a.bounds);let C,y;a.isLeaf()?p=v.getPerimeter()+u:(y=a.bounds.getPerimeter(),C=v.getPerimeter(),p=C-y+u);let b=0;const P=e.combine(h.bounds);if(h.isLeaf()?b=P.getPerimeter()+u:(y=h.bounds.getPerimeter(),C=P.getPerimeter(),b=C-y+u),A<p&&A<b)break;p<b?i=a:i=h}const s=i.parent,r=new po(s);r.bounds=e.combine(i.bounds),r.height=i.height+1,s!==null?(s.left===i?s.left=r:s.right=r,r.left=i,r.right=t,i.parent=r,t.parent=r):(r.left=i,r.right=t,i.parent=r,t.parent=r,this.root=r);let o=t.parent;for(;o;){if(o=this._balance(o),!o.left)throw new Error("Parent of current leaf cannot have a null left child"+o);if(!o.right)throw new Error("Parent of current leaf cannot have a null right child"+o);o.height=1+Math.max(o.left.height,o.right.height),o.bounds=o.left.bounds.combine(o.right.bounds),o=o.parent}}_remove(t){if(t===this.root){this.root=null;return}const e=t.parent,i=e.parent;let s;if(e.left===t?s=e.right:s=e.left,i){i.left===e?i.left=s:i.right=s,s.parent=i;let r=i;for(;r;)r=this._balance(r),r.bounds=r.left.bounds.combine(r.right.bounds),r.height=1+Math.max(r.left.height,r.right.height),r=r.parent}else this.root=s,s.parent=null}trackCollider(t){const e=new po;e.data=t,e.bounds=t.bounds,e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.id.value]=e,this._insert(e)}updateCollider(t){var e;const i=this.nodes[t.id.value];if(!i)return!1;const s=t.bounds;if(!this.worldBounds.contains(s))return lt.getInstance().warn("Collider with id "+t.id.value+" is outside the world bounds and will no longer be tracked for physics"),this.untrackCollider(t),!1;if(i.bounds.contains(s))return!1;if(this._remove(i),s.left-=this._config.boundsPadding,s.top-=this._config.boundsPadding,s.right+=this._config.boundsPadding,s.bottom+=this._config.boundsPadding,t.owner){const r=(e=t.owner)===null||e===void 0?void 0:e.get(Bt);if(r){const o=r.vel.x*32/1e3*this._config.velocityMultiplier,a=r.vel.y*32/1e3*this._config.velocityMultiplier;o<0?s.left+=o:s.right+=o,a<0?s.top+=a:s.bottom+=a}}return i.bounds=s,this._insert(i),!0}untrackCollider(t){const e=this.nodes[t.id.value];e&&(this._remove(e),this.nodes[t.id.value]=null,delete this.nodes[t.id.value])}_balance(t){if(t===null)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;const e=t.left,i=t.right,s=t,r=e,o=i,a=e.left,h=e.right,l=i.left,c=i.right,d=o.height-r.height;if(d>1)return o.left=s,o.parent=s.parent,s.parent=o,o.parent?o.parent.left===s?o.parent.left=o:o.parent.right=o:this.root=o,l.height>c.height?(o.right=l,s.right=c,c.parent=s,s.bounds=r.bounds.combine(c.bounds),o.bounds=s.bounds.combine(l.bounds),s.height=1+Math.max(r.height,c.height),o.height=1+Math.max(s.height,l.height)):(o.right=c,s.right=l,l.parent=s,s.bounds=r.bounds.combine(l.bounds),o.bounds=s.bounds.combine(c.bounds),s.height=1+Math.max(r.height,l.height),o.height=1+Math.max(s.height,c.height)),o;if(d<-1){if(r.left=s,r.parent=s.parent,s.parent=r,r.parent)if(r.parent.left===s)r.parent.left=r;else{if(r.parent.right!==s)throw"Error rotating Dynamic Tree";r.parent.right=r}else this.root=r;return a.height>h.height?(r.right=a,s.left=h,h.parent=s,s.bounds=o.bounds.combine(h.bounds),r.bounds=s.bounds.combine(a.bounds),s.height=1+Math.max(o.height,h.height),r.height=1+Math.max(s.height,a.height)):(r.right=h,s.left=a,a.parent=s,s.bounds=o.bounds.combine(a.bounds),r.bounds=s.bounds.combine(h.bounds),s.height=1+Math.max(o.height,a.height),r.height=1+Math.max(s.height,h.height)),r}return t}getHeight(){return this.root===null?0:this.root.height}query(t,e){const i=t.bounds,s=r=>{if(r&&r.bounds.overlaps(i))if(r.isLeaf()&&r.data!==t){if(e.call(t,r.data))return!0}else return s(r.left)||s(r.right);return!1};s(this.root)}rayCastQuery(t,e=1/0,i){const s=r=>{if(r&&r.bounds.rayCast(t,e))if(r.isLeaf()){if(i.call(t,r.data))return!0}else return s(r.left)||s(r.right);return!1};s(this.root)}getNodes(){const t=e=>e?[e].concat(t(e.left),t(e.right)):[];return t(this.root)}debug(t){const e=i=>{i&&(i.isLeaf()?i.bounds.draw(t,q.Green):i.bounds.draw(t,q.White),i.left&&e(i.left),i.right&&e(i.right))};e(this.root)}}class Yi{constructor(t,e){this.pos=t,this.dir=e.normalize()}intersect(t){const e=t.begin.sub(this.pos);if(this.dir.cross(t.getSlope())===0&&e.cross(this.dir)!==0)return-1;const i=this.dir.cross(t.getSlope());if(i===0)return-1;const s=e.cross(t.getSlope())/i;if(s>=0){const r=e.cross(this.dir)/i/t.getLength();if(r>=0&&r<=1)return s}return-1}intersectPoint(t){const e=this.intersect(t);return e<0?null:this.getPoint(e)}getPoint(t){return this.pos.add(this.dir.scale(t))}}class un{constructor(t){this._config=t,this._pairs=new Set,this._collisionPairCache=[],this._colliders=[],this._dynamicCollisionTree=new xa(t.dynamicTree)}getColliders(){return this._colliders}query(t){const e=[];return t instanceof ht?this._dynamicCollisionTree.query({id:ts("collider",-1),owner:null,bounds:t},i=>(e.push(i),!1)):this._dynamicCollisionTree.query({id:ts("collider",-1),owner:null,bounds:new ht(t.x,t.y,t.x,t.y)},i=>(e.push(i),!1)),e}rayCast(t,e){var i,s,r;const o=[],a=(i=e?.maxDistance)!==null&&i!==void 0?i:1/0,h=e?.collisionGroup,l=h?h.category:(s=e?.collisionMask)!==null&&s!==void 0?s:bi.All.category,c=(r=e?.searchAllColliders)!==null&&r!==void 0?r:!1;return this._dynamicCollisionTree.rayCastQuery(t,a,d=>{const u=d.owner.get(Bt);if(e?.ignoreCollisionGroupAll&&u.group===bi.All)return!1;const p=(l&u.group.category)!==0;if(u?.group&&!p)return!1;const v=d.rayCast(t,a);if(v){if(e?.filter){if(e.filter(v)&&(o.push(v),!c))return!0}else if(o.push(v),!c)return!0}return!1}),o}track(t){if(!t){lt.getInstance().warn("Cannot track null collider");return}if(t instanceof he){const e=t.getColliders();for(const i of e)i.owner=t.owner,this._colliders.push(i),this._dynamicCollisionTree.trackCollider(i)}else this._colliders.push(t),this._dynamicCollisionTree.trackCollider(t)}untrack(t){if(!t){lt.getInstance().warn("Cannot untrack a null collider");return}if(t instanceof he){const e=t.getColliders();for(const i of e){const s=this._colliders.indexOf(i);s!==-1&&this._colliders.splice(s,1),this._dynamicCollisionTree.untrackCollider(i)}}else{const e=this._colliders.indexOf(t);e!==-1&&this._colliders.splice(e,1),this._dynamicCollisionTree.untrackCollider(t)}}_pairExists(t,e){const i=we.calculatePairHash(t.id,e.id);return this._pairs.has(i)}broadphase(t,e,i){const s=e/1e3,r=t.filter(a=>{var h,l;const c=(h=a.owner)===null||h===void 0?void 0:h.get(Bt);return((l=a.owner)===null||l===void 0?void 0:l.isActive)&&c.collisionType!==gt.PreventCollision});this._collisionPairCache=[],this._pairs.clear();let o;for(let a=0,h=r.length;a<h;a++)o=r[a],this._dynamicCollisionTree.query(o,l=>{if(!this._pairExists(o,l)&&we.canCollide(o,l)){const c=new we(o,l);this._pairs.add(c.id),this._collisionPairCache.push(c)}return!1});if(i&&(i.physics.pairs=this._collisionPairCache.length),this._config.continuous.checkForFastBodies)for(const a of r){const h=a.owner.get(Bt);if(h.collisionType!==gt.Active)continue;const l=h.vel.magnitude*s+h.acc.magnitude*.5*s*s,c=Math.min(a.bounds.height,a.bounds.width);if(this._config.continuous.disableMinimumSpeedForFastBody||l>c/2){i&&i.physics.fastBodies++;const d=h.globalPos.sub(h.oldPos),A=a.center,u=a.getFurthestPoint(h.vel),p=u.sub(d),v=new Yi(p,h.vel);v.pos=v.pos.add(v.dir.scale(-2*this._config.continuous.surfaceEpsilon));let C,y=new E(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(v,l+this._config.continuous.surfaceEpsilon*2,b=>{if(!this._pairExists(a,b)&&we.canCollide(a,b)){const P=b.rayCast(v,l+this._config.continuous.surfaceEpsilon*10);if(P){const I=P.point.sub(p);I.magnitude<y.magnitude&&(y=I,C=b)}}return!1}),C&&E.isValid(y)){const b=new we(a,C);this._pairs.has(b.id)||(this._pairs.add(b.id),this._collisionPairCache.push(b));const P=A.sub(u);h.globalPos=p.add(P).add(y).add(v.dir.scale(10*this._config.continuous.surfaceEpsilon)),a.update(h.transform.get()),i&&i.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,e){let i=[];for(let s=0;s<t.length;s++){const r=t[s].collide();if(i=i.concat(r),e&&r.length>0)for(const o of r)e.physics.contacts.set(o.id,o)}return e&&(e.physics.collisions+=i.length),i}update(t){let e=0;const i=t.length;for(let s=0;s<i;s++)this._dynamicCollisionTree.updateCollider(t[s])&&e++;return e}debug(t){this._dynamicCollisionTree.debug(t)}}class Oi{constructor(){this.id=ts("collider",Oi._ID++),this.composite=null,this.events=new Nt,this.offset=E.Zero}touching(t){return!!this.collide(t)}}Oi._ID=0;var ir;(function(n){n.Arcade="arcade",n.Realistic="realistic"})(ir||(ir={}));var Ii;(function(n){n.None="none",n.VerticalFirst="vertical-first",n.HorizontalFirst="horizontal-first"})(Ii||(Ii={}));const ba={vertical:1,horizontal:2},Ia={horizontal:1,vertical:2},Ea={horizontal:0,vertical:0};var Is;(function(n){n.DynamicTree="dynamic-tree",n.SparseHashGrid="sparse-hash-grid"})(Is||(Is={}));const yi=()=>({enabled:!0,gravity:T(0,0).clone(),solver:ir.Arcade,substep:1,colliders:{compositeStrategy:"together"},continuous:{checkForFastBodies:!0,disableMinimumSpeedForFastBody:!1,surfaceEpsilon:.1},bodies:{canSleepByDefault:!1,sleepEpsilon:.07,wakeThreshold:.07*3,sleepBias:.9,defaultMass:10},spatialPartition:Is.SparseHashGrid,sparseHashGrid:{size:100},dynamicTree:{boundsPadding:5,velocityMultiplier:2},arcade:{contactSolveBias:Ii.None},realistic:{contactSolveBias:Ii.None,positionIterations:3,velocityIterations:8,slop:1,steeringFactor:.2,warmStart:!0}});class he extends Oi{set compositeStrategy(t){this._compositeStrategy=t}get compositeStrategy(){return this._compositeStrategy}constructor(t){super(),this._collisionProcessor=new un({...yi()}),this._dynamicAABBTree=new xa({boundsPadding:5,velocityMultiplier:2}),this._colliders=[];for(const e of t)this.addCollider(e)}clearColliders(){this._colliders=[]}addCollider(t){let e;t instanceof he?(e=t.getColliders(),e.forEach(i=>i.offset.addEqual(t.offset))):e=[t];for(const i of e)i.events.pipe(this.events),i.composite=this,this._colliders.push(i),this._collisionProcessor.track(i),this._dynamicAABBTree.trackCollider(i)}removeCollider(t){t.events.pipe(this.events),t.composite=null,ks(t,this._colliders),this._collisionProcessor.untrack(t),this._dynamicAABBTree.untrackCollider(t)}getColliders(){return this._colliders}get worldPos(){var t,e;return((e=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&e!==void 0?e:E.Zero).add(this.offset)}get center(){var t,e;return((e=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&e!==void 0?e:E.Zero).add(this.offset)}get bounds(){var t,e;const i=this.getColliders();return i.reduce((r,o)=>r.combine(o.bounds),(e=(t=i[0])===null||t===void 0?void 0:t.bounds)!==null&&e!==void 0?e:new ht().translate(this.worldPos)).translate(this.offset)}get localBounds(){var t,e;const i=this.getColliders();return i.reduce((r,o)=>r.combine(o.localBounds),(e=(t=i[0])===null||t===void 0?void 0:t.localBounds)!==null&&e!==void 0?e:new ht)}get axes(){const t=this.getColliders();let e=[];for(const i of t)e=e.concat(i.axes);return e}getFurthestPoint(t){const e=this.getColliders(),i=[];for(const o of e)i.push(o.getFurthestPoint(t));let s=i[0],r=-Number.MAX_VALUE;for(const o of i){const a=o.dot(t);a>r&&(s=o,r=a)}return s}getInertia(t){const e=this.getColliders();let i=0;for(const s of e)i+=s.getInertia(t);return i}collide(t){let e=[t];t instanceof he&&(e=t.getColliders());const i=[];for(const r of e)this._dynamicAABBTree.query(r,o=>(i.push(new we(r,o)),!1));let s=[];for(const r of i)s=s.concat(r.collide());return s}getClosestLineBetween(t){const e=this.getColliders(),i=[];if(t instanceof he){const s=t.getColliders();for(const r of e)for(const o of s){const a=r.getClosestLineBetween(o);a&&i.push(a)}}else for(const s of e){const r=t.getClosestLineBetween(s);r&&i.push(r)}if(i.length){let s=i[0].getLength(),r=i[0];for(const o of i){const a=o.getLength();a<s&&(s=a,r=o)}return r}return null}contains(t){const e=this.getColliders();for(const i of e)if(i.contains(t))return!0;return!1}rayCast(t,e){const i=this.getColliders(),s=[];for(const r of i){const o=r.rayCast(t,e);o&&s.push(o)}if(s.length){let r=s[0],o=r.point.dot(t.dir);for(const a of s){const h=t.dir.dot(a.point);h<o&&(r=a,o=h)}return r}return null}project(t){const e=this.getColliders(),i=[];for(const s of e){const r=s.project(t);r&&i.push(r)}if(i.length){const s=new Rr(i[0].min,i[0].max);for(const r of i)s.min=Math.min(r.min,s.min),s.max=Math.max(r.max,s.max);return s}return null}update(t){if(t){const e=this.getColliders();for(const i of e)i.owner=this.owner,i.update(t)}}debug(t,e,i){const s=this.getColliders();t.save(),t.translate(this.offset.x,this.offset.y);for(const r of s)r.debug(t,e,i);t.restore()}clone(){const t=new he(this._colliders.map(e=>e.clone()));return t.offset=this.offset.clone(),t}}class Yt{constructor(t,e){this.begin=t,this.end=e}clone(t){const e=t||new Yt(this.begin.clone(),this.end.clone());return e.begin=this.begin.clone(e.begin),e.end=this.end.clone(e.end),e}transform(t,e){const i=e||new Yt(E.Zero,E.Zero);return i.begin=t.multiply(this.begin,i.begin),i.end=t.multiply(this.end,i.end),i}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this._normal?this._normal:this._normal=this.end.sub(this.begin).normal()}dir(){return this._dir?this._dir:this._dir=this.end.sub(this.begin)}getPoints(){return[this.begin,this.end]}getSlope(){if(this._slope)return this._slope;const t=this.begin,e=this.end,i=t.distance(e);return this._slope=e.sub(t).scale(1/i)}getEdge(){const t=this.begin;return this.end.sub(t)}getLength(){const t=this.begin,e=this.end;return t.distance(e)}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new Yt(this.end,this.begin)}below(t){return(this.end.x-this.begin.x)*(t.y-this.begin.y)-(this.end.y-this.begin.y)*(t.x-this.begin.x)>=0}clip(t,e,i=!0){let s=t;i&&(s=s.normalize());const r=s.dot(this.begin)-e,o=s.dot(this.end)-e,a=[];if(r<=0&&a.push(this.begin),o<=0&&a.push(this.end),r*o<0){const h=r/(r-o);a.push(this.begin.add(this.end.sub(this.begin).scale(h)))}return a.length!==2?null:new Yt(a[0],a[1])}distanceToPoint(t,e=!1){const i=t.x,s=t.y,r=this.getLength(),o=this.end.y-this.begin.y,a=this.end.x-this.begin.x,h=(o*i-a*s+this.end.x*this.begin.y-this.end.y*this.begin.x)/r;return e?h:Math.abs(h)}findVectorToPoint(t){const e=this.begin.sub(t),i=this.getSlope();return e.sub(i.scale(e.dot(i)))}findPoint(t=null,e=null){const i=this.slope,s=this.intercept;if(t!==null)return new E(t,i*t+s);if(e!==null)return new E((e-s)/i,e);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,e=0;if(typeof arguments[0]=="number"&&typeof arguments[1]=="number")t=new E(arguments[0],arguments[1]),e=arguments[2]||0;else if(arguments[0]instanceof E)t=arguments[0],e=arguments[1]||0;else throw"Could not determine the arguments for Vector.hasPoint";const i=t.x-this.begin.x,s=t.y-this.begin.y,r=this.end.x-this.begin.x,o=this.end.y-this.begin.y,a=i*o-s*r;return Math.abs(a)>e?!1:Math.abs(r)>=Math.abs(o)?r>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:o>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y}}function Xn(n,t){const i=n.dir(),s=t.dir(),r=i.dot(i),o=s.dot(s);if(r<1e-9&&o<1e-9)return new Yt(n.begin,t.begin);if(r<1e-9){const C=It(s.dot(n.begin.sub(t.begin))/o,0,1),y=t.begin.add(s.scale(C));return new Yt(n.begin,y)}if(o<1e-9){const C=It(i.dot(t.begin.sub(n.begin))/r,0,1),y=n.begin.add(i.scale(C));return new Yt(y,t.begin)}const a=n.begin.sub(t.begin),h=r,l=o,c=s.dot(a),d=h*l-Math.pow(i.dot(s),2);let A=0,u=0;Math.abs(d)>1e-9?A=It((i.dot(s)*c-l*i.dot(a))/d,0,1):A=It(i.dot(a)/h,0,1),Math.abs(l)>1e-9?u=It((i.dot(s)*A+c)/l,0,1):u=0;const p=n.begin.add(i.scale(A)),v=t.begin.add(s.scale(u));return new Yt(p,v)}const ri={PolygonPolygonClosestLine(n,t){const e=n.getSides(),i=t.getSides();let s=Number.MAX_VALUE,r=null;for(let o=0;o<e.length;o++)for(let a=0;a<i.length;a++){const h=Xn(e[o],i[a]),l=h.getLength();l<s&&(s=l,r=h)}return r},PolygonEdgeClosestLine(n,t){const i=t.worldPos.sub(n.worldPos),s=new Yi(n.worldPos,i),r=n.rayCast(s).point.add(s.dir.scale(.1)),o=n.getClosestFace(r),a=t.asLine();return Xn(o.face,a)},PolygonCircleClosestLine(n,t){const e=t.worldPos,i=e.sub(n.worldPos),s=new Yi(n.worldPos,i.normalize()),r=n.rayCast(s).point.add(s.dir.scale(.1)),o=n.getClosestFace(r),a=o.face.begin,h=o.face.getEdge();let l=(h.x*(e.x-a.x)+h.y*(e.y-a.y))/(h.x*h.x+h.y*h.y);l>1?l=1:l<0&&(l=0);const c=Math.sqrt(Math.pow(a.x+h.x*l-e.x,2)+Math.pow(a.y+h.y*l-e.y,2))-t.radius,d=(a.x+h.x*l-e.x)*t.radius/(t.radius+c),A=(a.y+h.y*l-e.y)*t.radius/(t.radius+c);return new Yt(h.scale(l).add(a),new E(e.x+d,e.y+A))},CircleCircleClosestLine(n,t){const i=t.worldPos.sub(n.worldPos),r=n.worldPos.sub(t.worldPos),o=new Yi(n.worldPos,i),a=new Yi(t.worldPos,r),h=n.rayCast(o),l=t.rayCast(a);return new Yt(h.point,l.point)},CircleEdgeClosestLine(n,t){const e=n.worldPos,i=t.asLine(),s=i.begin,r=i.getEdge(),o=s,a=r;let h=(a.x*(e.x-o.x)+a.y*(e.y-o.y))/(a.x*a.x+a.y*a.y);h>1?h=1:h<0&&(h=0);const l=Math.sqrt(Math.pow(o.x+a.x*h-e.x,2)+Math.pow(o.y+a.y*h-e.y,2))-n.radius,c=(o.x+a.x*h-e.x)*n.radius/(n.radius+l),d=(o.y+a.y*h-e.y)*n.radius/(n.radius+l);return new Yt(a.scale(h).add(o),new E(e.x+c,e.y+d))},EdgeEdgeClosestLine(n,t){const e=n.asLine(),i=t.asLine();return Xn(e,i)}};class ge extends Oi{get worldPos(){return this._globalMatrix.getPosition()}get radius(){var t;if(this._radius)return this._radius;const e=this._transform,i=(t=e?.globalScale)!==null&&t!==void 0?t:E.One;return this._radius=this._naturalRadius*Math.min(i.x,i.y)}set radius(t){var e;const i=this._transform,s=(e=i?.globalScale)!==null&&e!==void 0?e:E.One;this._naturalRadius=t/Math.min(s.x,s.y),this._localBoundsDirty=!0,this._radius=t}constructor(t){super(),this.offset=E.Zero,this._globalMatrix=te.identity(),this._localBoundsDirty=!0,this.offset=t.offset||E.Zero,this.radius=t.radius||0,this._globalMatrix.translate(this.offset.x,this.offset.y)}clone(){return new ge({offset:this.offset.clone(),radius:this.radius})}get center(){return this._globalMatrix.getPosition()}contains(t){var e,i;return((i=(e=this._transform)===null||e===void 0?void 0:e.pos)!==null&&i!==void 0?i:this.offset).distance(t)<=this.radius}rayCast(t,e=1/0){var i,s;const r=this.center,o=t.dir,a=t.pos,h=r.sub(a),l=o.scale(h.dot(o)),d=h.sub(l).magnitude;if(d>this.radius)return null;{let A=0;if(Sh(d,this.radius,1e-4)){if(A=-o.dot(a.sub(r)),A>0&&A<e){const u=t.getPoint(A);return{point:u,normal:u.sub(r).normalize(),collider:this,body:(i=this.owner)===null||i===void 0?void 0:i.get(Bt),distance:A}}return null}else{const u=Math.sqrt(Math.pow(o.dot(a.sub(r)),2)-Math.pow(a.sub(r).distance(),2)+Math.pow(this.radius,2)),p=-o.dot(a.sub(r))+u,v=-o.dot(a.sub(r))-u,C=[];p>=0&&C.push(p),v>=0&&C.push(v);const y=Math.min(...C);if(y<=e){const b=t.getPoint(y);return{point:b,normal:b.sub(r).normalize(),collider:this,body:(s=this.owner)===null||s===void 0?void 0:s.get(Bt),distance:y}}return null}}}getClosestLineBetween(t){if(t instanceof ge)return ri.CircleCircleClosestLine(this,t);if(t instanceof ue)return ri.PolygonCircleClosestLine(t,this).flip();if(t instanceof Se)return ri.CircleEdgeClosestLine(this,t).flip();throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof ge)return je.CollideCircleCircle(this,t);if(t instanceof ue)return je.CollideCirclePolygon(this,t);if(t instanceof Se)return je.CollideCircleEdge(this,t);throw new Error(`Circle could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}getFurthestLocalPoint(t){return t.normalize().scale(this.radius)}get bounds(){return this.localBounds.transform(this._globalMatrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=new ht(-this._naturalRadius,-this._naturalRadius,+this._naturalRadius,+this._naturalRadius),this._localBoundsDirty=!1),this._localBounds}get axes(){return[]}getInertia(t){return t*this.radius*this.radius/2}update(t){var e;this._transform=t,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y),this._radius=void 0}project(t){const e=[],s=this.center.dot(t);return e.push(s),e.push(s+this.radius),e.push(s-this.radius),new Rr(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e,i){var s,r,o,a;const{lineWidth:h}={lineWidth:1,...i},l=this._transform,c=(s=l?.globalScale)!==null&&s!==void 0?s:E.One,d=(r=l?.globalRotation)!==null&&r!==void 0?r:0,A=(o=l?.globalPos)!==null&&o!==void 0?o:E.Zero;t.save(),t.translate(A.x,A.y),t.rotate(d),t.scale(c.x,c.y),t.drawCircle((a=this.offset)!==null&&a!==void 0?a:E.Zero,this._naturalRadius,q.Transparent,e,h),t.restore()}}class ji{constructor(t,e,i,s,r,o,a,h){var l,c,d,A,u,p;if(this._canceled=!1,this.bodyA=null,this.bodyB=null,this.colliderA=t,this.colliderB=e,this.mtv=i,this.normal=s,this.tangent=r,this.points=o,this.localPoints=a,this.info=h,this.id=we.calculatePairHash(t.id,e.id),t.composite||e.composite){const v=((l=t.composite)===null||l===void 0?void 0:l.compositeStrategy)==="separate"?t.id:(d=(c=t.composite)===null||c===void 0?void 0:c.id)!==null&&d!==void 0?d:t.id,C=((A=e.composite)===null||A===void 0?void 0:A.compositeStrategy)==="separate"?e.id:(p=(u=e.composite)===null||u===void 0?void 0:u.id)!==null&&p!==void 0?p:e.id;this.id+="|"+we.calculatePairHash(v,C)}this.colliderA.owner&&(this.bodyA=this.colliderA.owner.get(Bt)),this.colliderB.owner&&(this.bodyB=this.colliderB.owner.get(Bt))}matchAwake(){const t=this.bodyA,e=this.bodyB;t&&e&&t.isSleeping!==e.isSleeping&&(t.isSleeping&&t.collisionType!==gt.Fixed&&e.sleepMotion>=t.wakeThreshold&&(t.isSleeping=!1),e.isSleeping&&e.collisionType!==gt.Fixed&&t.sleepMotion>=e.wakeThreshold&&(e.isSleeping=!1))}isCanceled(){return this._canceled}cancel(){this._canceled=!0}bias(t){if(t!==this.colliderA&&t!==this.colliderB)throw new Error("Collider must be either colliderA or colliderB from this contact");if(t===this.colliderA)return this;const e=this.colliderA,i=this.colliderB;return this.colliderB=e,this.colliderA=i,this.mtv=this.mtv.negate(),this.normal=this.normal.negate(),this.tangent=this.tangent.negate(),this}}class Yh{constructor(){this.axis=T(0,0),this.localAxis=T(0,0),this.side=new Yt(T(0,0),T(0,0)),this.localSide=new Yt(T(0,0),T(0,0)),this.point=T(0,0),this.localPoint=T(0,0)}}class Kt{static findPolygonPolygonSeparation(t,e){if(e.transform.matrix.determinant()===0)return Kt.findPolygonPolygonSeparationDegenerate(t,e);let i=-Number.MAX_VALUE,s=-1,r;const o=e.transform.inverse.multiply(t.transform.matrix,Kt._SCRATCH_MATRIX),a=o.getRotation(),h=t.normals,l=t.points,c=e.points;for(let u=0;u<l.length;u++){const p=h[u].rotate(a,Kt._ZERO,Kt._SCRATCH_NORMAL),v=o.multiply(l[u],Kt._SCRATCH_POINT);let C=Number.MAX_VALUE,y;for(let b=0;b<c.length;b++){const P=p.dot(c[b].sub(v,Kt._SCRATCH_SUB_POINT));P<C&&(C=P,y=c[b])}C>i&&(i=C,s=u,r=y)}const d=(s+1)%l.length,A=Kt.SeparationPool.get();return A.collider=t,A.separation=i,i>0||(h[s].clone(A.localAxis),h[s].rotate(t.transform.rotation,Kt._ZERO,A.axis),t.transform.matrix.multiply(l[s],A.side.begin),t.transform.matrix.multiply(l[d],A.side.end),e.transform.matrix.multiply(r,A.point),A.sideId=s,r.clone(A.localPoint),l[s].clone(A.localSide.begin),l[d].clone(A.localSide.end)),A}static findCirclePolygonSeparation(t,e){const i=e.axes,r=e.center.sub(t.worldPos),o=e.getFurthestPoint(r.negate());i.push(o.sub(t.worldPos).normalize());let a=Number.MAX_VALUE,h=null,l=-1;for(let c=0;c<i.length;c++){const d=e.project(i[c]),A=t.project(i[c]),u=d.getOverlap(A);if(u<=0)return null;u<a&&(a=u,h=i[c],l=c)}return l<0?null:h.normalize().scale(a)}static findPolygonPolygonSeparationDegenerate(t,e){let i=-Number.MAX_VALUE,s=null,r=null,o=-1,a=null;const h=t.getSides(),l=t.getLocalSides();for(let c=0;c<h.length;c++){const d=h[c],A=d.normal(),u=e.getFurthestPoint(A.negate()),p=d.distanceToPoint(u,!0);p>i&&(i=p,s=d,r=A,o=c,a=u)}return{collider:t,separation:r?i:99,axis:r,side:s,localSide:l[o],sideId:o,point:a,localPoint:r?e.getFurthestLocalPoint(r.negate()):null}}}Kt.SeparationPool=new In(()=>new Yh,n=>n,500);Kt._ZERO=T(0,0);Kt._SCRATCH_POINT=T(0,0);Kt._SCRATCH_SUB_POINT=T(0,0);Kt._SCRATCH_NORMAL=T(0,0);Kt._SCRATCH_MATRIX=te.identity();Kt.SeparationPool.disableWarnings=!0;const Wd=E.Zero,jd=E.Zero,Yd=te.identity(),je={CollideCircleCircle(n,t){const e=n.worldPos,i=t.worldPos,s=n.radius+t.radius,r=e.distance(i);if(r>s)return[];const o=s-r,a=i.sub(e).normalize(),h=a.perpendicular(),l=a.scale(o),c=n.getFurthestPoint(a),d=n.getFurthestLocalPoint(a),A={collider:n,separation:o,axis:a,point:c};return[new ji(n,t,l,a,h,[c],[d],A)]},CollideCirclePolygon(n,t){var e,i;let s=Kt.findCirclePolygonSeparation(n,t);if(!s)return[];s=s.dot(t.center.sub(n.center))<0?s.negate():s;const o=n.getFurthestPoint(s),h=((i=(e=n.owner)===null||e===void 0?void 0:e.get(tt))!==null&&i!==void 0?i:new tt).applyInverse(o),l=s.normalize(),c={collider:n,separation:-s.magnitude,axis:l,point:o,localPoint:h,side:t.findSide(l.negate()),localSide:t.findLocalSide(l.negate())};return[new ji(n,t,s,l,l.perpendicular(),[o],[h],c)]},CollideCircleEdge(n,t){const e=n.center,i=t.asLine(),s=i.end.sub(i.begin),r=s.dot(i.end.sub(e)),o=s.dot(e.sub(i.begin)),a=t.asLine(),h=t.asLocalLine();if(o<=0){const y=i.begin.sub(e),b=y.dot(y);if(b>n.radius*n.radius)return[];const P=y.normalize(),I=n.radius-Math.sqrt(b),Q={collider:n,separation:I,axis:P,point:a.begin,side:a,localSide:h};return[new ji(n,t,P.scale(I),P,P.perpendicular(),[a.begin],[h.begin],Q)]}if(r<=0){const y=i.end.sub(e),b=y.dot(y);if(b>n.radius*n.radius)return[];const P=y.normalize(),I=n.radius-Math.sqrt(b),Q={collider:n,separation:I,axis:P,point:a.end,side:a,localSide:h};return[new ji(n,t,P.scale(I),P,P.perpendicular(),[a.end],[h.end],Q)]}const l=s.dot(s),c=i.begin.scale(r).add(i.end.scale(o)).scale(1/l),d=e.sub(c),A=d.dot(d);if(A>n.radius*n.radius)return[];let u=s.perpendicular();u.dot(e.sub(i.begin))<0&&(u.x=-u.x,u.y=-u.y),u=u.normalize();const p=n.radius-Math.sqrt(A),v=u.scale(p),C={collider:n,separation:p,axis:u,point:c,side:a,localSide:h};return[new ji(n,t,v,u.negate(),u.negate().perpendicular(),[c],[c.sub(t.worldPos)],C)]},CollideEdgeEdge(){return[]},CollidePolygonEdge(n,t){var e;const i=n.center,r=t.center.sub(i).normalize(),o=new ue({points:[t.begin,t.end,t.end.add(r.scale(100)),t.begin.add(r.scale(100))],offset:t.offset});o.owner=t.owner,((e=t.owner)===null||e===void 0?void 0:e.get(tt))&&o.update(t.owner.get(tt).get());const h=this.CollidePolygonPolygon(n,o);return h.length&&(h[0].colliderB=t,h[0].id=we.calculatePairHash(n.id,t.id)),h},CollidePolygonPolygon(n,t){const e=Kt.findPolygonPolygonSeparation(n,t);if(e.separation>0)return[];const i=Kt.findPolygonPolygonSeparation(t,n);if(i.separation>0)return[];const s=e.separation>i.separation?e:i,r=s.collider===n?t:n,o=s.collider===n?n:t,a=r.transform.inverse.multiply(o.transform.matrix,Yd),h=a.getRotation(),l=o.normals[s.sideId].rotate(h,Wd,jd);let c=Number.MAX_VALUE,d=0;for(let y=0;y<r.normals.length;y++){const b=l.dot(r.normals[y]);b<c&&(c=b,d=y)}if(!s.localSide||!s.localAxis||!s.axis)return[];const A=s.localSide.transform(a),u=s.localAxis.perpendicular().negate().rotate(h),v=new Yt(r.points[d],r.points[(d+1)%r.points.length]).clip(u.negate(),-u.dot(A.begin),!1);let C=null;if(v&&(C=v.clip(u,u.dot(A.end),!1)),C){const y=[],b=[],P=C.getPoints();for(let O=0;O<P.length;O++){const B=P[O];A.below(B)&&(y.push(B),b.push(r.transform.apply(B)))}let I=s.axis,Q=I.perpendicular();return t.center.sub(n.center).dot(I)<0&&(I=I.negate(),Q=I.perpendicular()),[new ji(n,t,I.scale(-s.separation),I,Q,b,y,s)]}return[]},FindContactSeparation(n,t){var e,i,s,r;const o=n.colliderA,a=(i=(e=n.bodyA)===null||e===void 0?void 0:e.transform)!==null&&i!==void 0?i:new tt,h=n.colliderB,l=(r=(s=n.bodyB)===null||s===void 0?void 0:s.transform)!==null&&r!==void 0?r:new tt;if(o instanceof ge&&h instanceof ge){const c=o.radius+h.radius,d=a.pos.distance(l.pos);return-(c-d)}if(o instanceof ue&&h instanceof ue&&n.info.localSide){let c,d;return n.info.collider===o?(c=new Yt(a.apply(n.info.localSide.begin).add(o.offset),a.apply(n.info.localSide.end).add(o.offset)),d=l.apply(t).add(h.offset)):(c=new Yt(l.apply(n.info.localSide.begin).add(h.offset),l.apply(n.info.localSide.end).add(h.offset)),d=a.apply(t).add(o.offset)),c.distanceToPoint(d,!0)}if(o instanceof ue&&h instanceof ge||h instanceof ue&&o instanceof ge){const c=a.apply(t);if(n.info.side)return n.info.side.distanceToPoint(c,!0)}if(o instanceof Se&&h instanceof ue||h instanceof Se&&o instanceof ue){let c;if(n.info.collider===o?c=l.apply(t):c=a.apply(t),n.info.side)return n.info.side.distanceToPoint(c,!0)}if(o instanceof ge&&h instanceof Se||h instanceof ge&&o instanceof Se){const c=l.apply(t);let d;o instanceof ge&&(d=o.getFurthestPoint(n.normal));const A=c.distance(d);if(n.info.side)return A>0?-A:0}return 0}};class Se extends Oi{constructor(t){var e;super(),this._globalMatrix=te.identity(),this.begin=t.begin||E.Zero,this.end=t.end||E.Zero,this.offset=(e=t.offset)!==null&&e!==void 0?e:E.Zero}clone(){return new Se({begin:this.begin.clone(),end:this.end.clone()})}get worldPos(){var t;const e=this._transform;return(t=e?.globalPos.add(this.offset))!==null&&t!==void 0?t:this.offset}get center(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.average(e)}_getTransformedBegin(){return this._globalMatrix.multiply(this.begin)}_getTransformedEnd(){return this._globalMatrix.multiply(this.end)}getSlope(){const t=this._getTransformedBegin(),e=this._getTransformedEnd(),i=t.distance(e);return e.sub(t).scale(1/i)}getLength(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)}contains(){return!1}rayCast(t,e=1/0){var i;const s=this._getTransformedBegin().sub(t.pos);if(t.dir.cross(this.getSlope())===0&&s.cross(t.dir)!==0)return null;const r=t.dir.cross(this.getSlope());if(r===0)return null;const o=s.cross(this.getSlope())/r;if(o>=0&&o<=e){const a=s.cross(t.dir)/r/this.getLength();if(a>=0&&a<=1)return{distance:o,normal:this.asLine().normal(),collider:this,body:(i=this.owner)===null||i===void 0?void 0:i.get(Bt),point:t.getPoint(o)}}return null}getClosestLineBetween(t){if(t instanceof ge)return ri.CircleEdgeClosestLine(t,this);if(t instanceof ue)return ri.PolygonEdgeClosestLine(t,this).flip();if(t instanceof Se)return ri.EdgeEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof ge)return je.CollideCircleEdge(t,this);if(t instanceof ue)return je.CollidePolygonEdge(t,this);if(t instanceof Se)return je.CollideEdgeEdge();throw new Error(`Edge could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this._getTransformedBegin(),i=this._getTransformedEnd();return t.dot(e)>0?e:i}_boundsFromBeginEnd(t,e,i=10){return new ht(Math.min(t.x,e.x)-i,Math.min(t.y,e.y)-i,Math.max(t.x,e.x)+i,Math.max(t.y,e.y)+i)}get bounds(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return this._boundsFromBeginEnd(t,e)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new Yt(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new Yt(this.begin,this.end)}get axes(){const e=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),i=[];return i.push(e),i.push(e.negate()),i.push(e.normal()),i.push(e.normal().negate()),i}getInertia(t){const e=this.end.sub(this.begin).distance()/2;return t*e*e}update(t){var e;this._transform=t,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){const e=[],i=[this._getTransformedBegin(),this._getTransformedEnd()],s=i.length;for(let r=0;r<s;r++)e.push(i[r].dot(t));return new Rr(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e){const i=this._getTransformedBegin(),s=this._getTransformedEnd();t.drawLine(i,s,e,2),t.drawCircle(i,2,e),t.drawCircle(s,2,e)}}class ae{static registerGraphicsContext(t){ae._ctx=t}static draw(t){this._drawCalls.push(t)}static drawPoint(t,e){ae.draw(i=>{i.debug.drawPoint(t,e)})}static drawLine(t,e,i){ae.draw(s=>{s.debug.drawLine(t,e,i)})}static drawLines(t,e){t.length>1&&ae.draw(i=>{for(let s=0;s<t.length-1;s++)i.debug.drawLine(t[s],t[s+1],e)})}static drawText(t,e){ae.draw(i=>{i.debug.drawText(t,e)})}static drawPolygon(t,e){t.length>1&&ae.draw(i=>{const s=t[0],r=[...t,s];for(let o=0;o<r.length-1;o++)i.debug.drawLine(r[o],r[o+1],e)})}static drawCircle(t,e,i){const{color:s,strokeColor:r,width:o}={color:q.Black,strokeColor:void 0,width:void 0,...i};ae.draw(a=>{a.drawCircle(t,e,s,r,o)})}static drawBounds(t,e){ae.draw(i=>{i.debug.drawRect(t.left,t.top,t.width,t.height,e)})}static drawRay(t,e){const{distance:i,color:s}={color:q.Blue,distance:10,...e};ae.draw(r=>{const o=t.pos,a=t.pos.add(t.dir.scale(i));r.debug.drawLine(o,a,{color:s})})}static flush(t){t.save(),t.z=ae.z;for(const e of ae._drawCalls)e(t);t.restore(),ae.clear()}static clear(){ae._drawCalls.length=0}}ae._drawCalls=[];ae.z=1/0;class ue extends Oi{flagDirty(){this._localBoundsDirty=!0,this._localSidesDirty=!0,this._transformedPointsDirty=!0,this._sidesDirty=!0}get normals(){return this._normals}set points(t){if(t.length<3)throw new Error("PolygonCollider cannot be created with less that 3 points");this._points=t,this._checkAndUpdateWinding(this._points),this._calculateNormals(),this.flagDirty()}_calculateNormals(){const t=[];for(let e=0;e<this._points.length;e++)t.push(this._points[(e+1)%this._points.length].sub(this._points[e]).normal());this._normals=t}get points(){return this._points}get transform(){return this._transform}constructor(t){var e;super(),this._logger=lt.getInstance(),this._transform=new xi,this._transformedPoints=[],this._sides=[],this._localSides=[],this._transformedPointsDirty=!0,this._sidesDirty=!0,this._localSidesDirty=!0,this._localBoundsDirty=!0,this.offset=(e=t.offset)!==null&&e!==void 0?e:E.Zero,this._transform.pos.x+=this.offset.x,this._transform.pos.y+=this.offset.y,this.points=t.points,this.isConvex()||t.suppressConvexWarning||this._logger.warn("Excalibur only supports convex polygon colliders and will not behave properly.Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles"),this._calculateTransformation()}_checkAndUpdateWinding(t){this._isCounterClockwiseWinding(t)||t.reverse()}_isCounterClockwiseWinding(t){let e=0;for(let i=0;i<t.length;i++)e+=(t[(i+1)%t.length].x-t[i].x)*(t[(i+1)%t.length].y+t[i].y);return e<0}isConvex(){if(this.points.length<3)return!1;let t=this.points[this.points.length-2],e=this.points[this.points.length-1],i=Math.atan2(e.y-t.y,e.x-t.x),s=0,r=0,o=0;for(const[a,h]of this.points.entries()){if(t=e,s=i,e=h,i=Math.atan2(e.y-t.y,e.x-t.x),t.equals(e))return!1;let l=i-s;if(l<=-Math.PI?l+=Math.PI*2:l>Math.PI&&(l-=Math.PI*2),a===0){if(l===0)return!1;r=l>0?1:-1}else if(r*l<=0)return!1;o+=l}return Math.abs(Math.round(o/(Math.PI*2)))===1}tessellate(){const t=[];for(let e=1;e<this.points.length-2;e++)t.push([this.points[0],this.points[e+1],this.points[e+2]]);return t.push([this.points[0],this.points[1],this.points[2]]),new he(t.map(e=>pe.Polygon(e)))}triangulate(){if(this.points.length<3)throw Error("Invalid polygon");const t=[],e=[...this.points].reverse();let i=e.length;function s(d){return d===0?i-1:d-1}function r(d){return d===i-1?0:d+1}function o(d){const A=s(d),u=r(d),p=e[A],v=e[d],C=e[u],y=p.sub(v),b=C.sub(v);return!(y.cross(b)<0)}const a=e.map((d,A)=>o(A));function h(d,A,u,p){const v=u.sub(A),C=p.sub(u),y=A.sub(p),b=d.sub(A),P=d.sub(u),I=d.sub(p),Q=v.cross(b),O=C.cross(P),B=y.cross(I);return!(Q>0||O>0||B>0)}function l(){for(let d=0;d<i;d++)if(a[d]){const A=s(d),u=r(d),p=e[A],v=e[d],C=e[u];let y=!0;for(let b=0;b<i;b++){if(b===d||b===A||b===u)continue;const P=e[b];if(h(P,p,v,C)){y=!1;break}}if(y)return d}for(let d=0;d<i;d++)if(a[d])return d;return 0}function c(d){const A=s(d),u=r(d),p=e[A],v=e[d],C=e[u];t.push([p,v,C]),e.splice(d,1),a.splice(d,1),i--}for(;i>3;){const d=l();c(d);for(let A=0;A<i;A++)a[A]=o(A)}return t.push([e[0],e[1],e[2]]),new he(t.map(d=>pe.Polygon(d,E.Zero,!0)))}clone(){return new ue({offset:this.offset.clone(),points:this.points.map(t=>t.clone())})}get worldPos(){return this._transform.pos}get center(){return this.bounds.center}_calculateTransformation(){const t=this.points,e=t.length;this._transformedPoints.length=0;for(let i=0;i<e;i++)this._transformedPoints[i]=this._transform.apply(t[i].clone())}getTransformedPoints(){return this._transformedPointsDirty&&(this._calculateTransformation(),this._transformedPointsDirty=!1),this._transformedPoints}getSides(){if(this._sidesDirty){const t=[],e=this.getTransformedPoints(),i=e.length;for(let s=0;s<i;s++)t.push(new Yt(e[s],e[(s+1)%i]));this._sides=t,this._sidesDirty=!1}return this._sides}getLocalSides(){if(this._localSidesDirty){const t=[],e=this.points,i=e.length;for(let s=0;s<i;s++)t.push(new Yt(e[s],e[(s+1)%i]));this._localSides=t,this._localSidesDirty=!1}return this._localSides}findSide(t){const e=this.getSides();let i=e[0],s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const o=e[r],h=o.normal().dot(t);h>s&&(i=o,s=h)}return i}findLocalSide(t){const e=this.getLocalSides();let i=e[0],s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const o=e[r],h=o.normal().dot(t);h>s&&(i=o,s=h)}return i}get axes(){const t=[],e=this.getSides();for(let i=0;i<e.length;i++)t.push(e[i].normal());return t}update(t){t&&(t.cloneWithParent(this._transform),this._transformedPointsDirty=!0,this._sidesDirty=!0,(this.offset.x!==0||this.offset.y!==0)&&(this._transform.pos.x+=this.offset.x,this._transform.pos.y+=this.offset.y),this._transform.isMirrored()&&(this.points=this.points.map(e=>T(e.x*Lt(this._transform.scale.x),e.y*Lt(this._transform.scale.y))),this._transform.scale.x=Math.abs(this._transform.scale.x),this._transform.scale.y=Math.abs(this._transform.scale.y)))}contains(t){const e=this._transform.applyInverse(t),i=new Yi(e,new E(1,0));let s=0;const r=this.getLocalSides();for(let o=0;o<r.length;o++){const a=r[o];i.intersect(a)>=0&&s++}return s%2!==0}getClosestLineBetween(t){if(t instanceof ge)return ri.PolygonCircleClosestLine(this,t);if(t instanceof ue)return ri.PolygonPolygonClosestLine(this,t);if(t instanceof Se)return ri.PolygonEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof ge)return je.CollideCirclePolygon(t,this);if(t instanceof ue)return je.CollidePolygonPolygon(this,t);if(t instanceof Se)return je.CollidePolygonEdge(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this.getTransformedPoints();let i=null,s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const o=t.dot(e[r]);o>s&&(s=o,i=e[r])}return i}getFurthestLocalPoint(t){const e=this.points;let i=e[0],s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const o=t.dot(e[r]);o>s&&(s=o,i=e[r])}return i}getClosestFace(t){const e=this.getSides();let i=Number.POSITIVE_INFINITY,s=-1,r=-1;for(let o=0;o<e.length;o++){const a=e[o].distanceToPoint(t);a<i&&(i=a,s=o,r=a)}return s!==-1?{distance:e[s].normal().scale(r),face:e[s]}:null}get bounds(){return this.localBounds.transform(this._transform.matrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=ht.fromPoints(this.points),this._localBoundsDirty=!1),this._localBounds}getInertia(t){if(this._cachedMass===t&&this._cachedInertia)return this._cachedInertia;let e=0,i=0;const s=this.points;for(let r=0;r<s.length;r++){const o=(r+1)%s.length,a=s[o].cross(s[r]);e+=a*(s[r].dot(s[r])+s[r].dot(s[o])+s[o].dot(s[o])),i+=a}return this._cachedMass=t,this._cachedInertia=t/6*(e/i)}rayCast(t,e=1/0){var i;const s=this.getSides(),r=s.length;let o=Number.MAX_VALUE,a,h=-1;for(let l=0;l<r;l++){const c=t.intersect(s[l]);c>=0&&c<o&&c<=e&&(o=c,a=s[l],h=l)}return h>=0?{collider:this,distance:o,body:(i=this.owner)===null||i===void 0?void 0:i.get(Bt),point:t.getPoint(o),normal:a.normal()}:null}project(t){const e=this.getTransformedPoints(),i=e.length;let s=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let o=0;o<i;o++){const a=e[o].dot(t);s=Math.min(s,a),r=Math.max(r,a)}return new Rr(s,r)}debug(t,e,i){const s=this.getTransformedPoints();ae.drawPolygon(s,{color:e})}}class pe{static Box(t,e,i=E.Half,s=E.Zero){return new ue({points:new ht(-t*i.x,-e*i.y,t-t*i.x,e-e*i.y).getPoints(),offset:s})}static Polygon(t,e=E.Zero,i=!1){return new ue({points:t,offset:e,suppressConvexWarning:i})}static Circle(t,e=E.Zero){return new ge({radius:t,offset:e})}static Edge(t,e){return new Se({begin:t,end:e})}static Capsule(t,e,i=E.Zero){const s=lt.getInstance();return t===e&&s.warn("A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider"),e>=t?new he([pe.Circle(t/2,T(0,-e/2+t/2).add(i)),pe.Box(t,e-t,E.Half,i),pe.Circle(t/2,T(0,e/2-t/2).add(i))]):new he([pe.Circle(e/2,T(-t/2+e/2,0).add(i)),pe.Box(t-e,e,E.Half,i),pe.Circle(e/2,T(t/2-e/2,0).add(i))])}}class ee extends Ue{constructor(t){super(),this.events=new Nt,this.$colliderAdded=new ve,this.$colliderRemoved=new ve,this._collidersToRemove=[],this.set(t)}get(){return this._collider}set(t){return this.clear(),t&&(this._collider=t,this._collider.owner=this.owner,t.events.pipe(this.events),this.$colliderAdded.notifyAll(t),this.update()),t}clear(){this._collider&&(this._collidersToRemove.push(this._collider),this._collider=null)}processColliderRemoval(){for(const t of this._collidersToRemove)t.events.unpipe(this.events),this.$colliderRemoved.notifyAll(t),t.owner=null}clone(){return new ee(this._collider.clone())}get bounds(){var t,e;return(e=(t=this._collider)===null||t===void 0?void 0:t.bounds)!==null&&e!==void 0?e:new ht}get localBounds(){var t,e;return(e=(t=this._collider)===null||t===void 0?void 0:t.localBounds)!==null&&e!==void 0?e:new ht}update(){var t;const e=(t=this.owner)===null||t===void 0?void 0:t.get(tt);this._collider&&(this._collider.owner=this.owner,e&&this._collider.update(e.get()))}collide(t){let e=this._collider,i=t._collider;if(!e||!i)return[];let s=!1;if(i instanceof he&&(e=i,i=this._collider,s=!0),this._collider){const r=e.collide(i);return r?(s&&r.forEach(o=>{o.mtv=o.mtv.negate(),o.normal=o.normal.negate(),o.tangent=o.normal.perpendicular(),o.colliderA=this._collider,o.colliderB=t._collider}),r):[]}return[]}onAdd(t){this._collider&&this.update(),this.events.on("precollision",e=>{const i=e;t.events.emit("precollision",new ss(i.self,i.other,i.side,i.intersection,i.contact)),t instanceof ye&&t.onPreCollisionResolve(i.self,i.other,i.side,i.contact)}),this.events.on("postcollision",e=>{const i=e;t.events.emit("postcollision",new rs(i.self,i.other,i.side,i.intersection,i.contact)),t instanceof ye&&t.onPostCollisionResolve(i.self,i.other,i.side,i.contact)}),this.events.on("collisionstart",e=>{const i=e;t.events.emit("collisionstart",new Ks(i.self,i.other,i.side,i.contact)),t instanceof ye&&t.onCollisionStart(i.self,i.other,i.side,i.contact)}),this.events.on("collisionend",e=>{const i=e;t.events.emit("collisionend",new $s(i.self,i.other,i.side,i.lastContact)),t instanceof ye&&t.onCollisionEnd(i.self,i.other,i.side,i.lastContact)})}onRemove(){this.events.clear(),this.$colliderRemoved.notifyAll(this._collider)}useBoxCollider(t,e,i=E.Half,s=E.Zero){const r=pe.Box(t,e,i,s);return this.set(r)}usePolygonCollider(t,e=E.Zero){const i=pe.Polygon(t,e);return this.set(i)}useCircleCollider(t,e=E.Zero){const i=pe.Circle(t,e);return this.set(i)}useEdgeCollider(t,e){const i=pe.Edge(t,e);return this.set(i)}useCompositeCollider(t){return this.set(new he(t))}}var be;(function(n){n.Rotation="rotation",n.X="x",n.Y="y"})(be||(be={}));class Bt extends Ue{constructor(t){var e,i,s;super(),this.dependencies=[tt,Dt],this.id=ts("body",Bt._ID++),this.events=new Nt,this.oldTransform=new xi,this.__oldTransformCaptured=!1,this.enableFixedUpdateInterpolate=!0,this.collisionType=gt.PreventCollision,this.group=bi.All,this._sleeping=!1,this.bounciness=.2,this.friction=.99,this.useGravity=!0,this.limitDegreeOfFreedom=[],this._oldGlobalPos=E.Zero,this.oldVel=new E(0,0),this.oldAcc=E.Zero,this._impulseScratch=T(0,0),this._distanceFromCenterScratch=T(0,0),t?(this.collisionType=(e=t.type)!==null&&e!==void 0?e:this.collisionType,this.group=(i=t.group)!==null&&i!==void 0?i:this.group,this.useGravity=(s=t.useGravity)!==null&&s!==void 0?s:this.useGravity,this._bodyConfig={...yi().bodies,...t.config}):this._bodyConfig={...yi().bodies},this.updatePhysicsConfig(this._bodyConfig),this._mass=Bt._DEFAULT_CONFIG.defaultMass}get matrix(){return this.transform.get().matrix}updatePhysicsConfig(t){this._bodyConfig={...yi().bodies,...t},this.canSleep=this._bodyConfig.canSleepByDefault,this.sleepMotion=this._bodyConfig.sleepEpsilon*5,this.wakeThreshold=this._bodyConfig.wakeThreshold}static updateDefaultPhysicsConfig(t){Bt._DEFAULT_CONFIG=t}get mass(){return this._mass}set mass(t){this._mass=t,this._cachedInertia=void 0,this._cachedInverseInertia=void 0}get inverseMass(){return this.collisionType===gt.Fixed?0:1/this.mass}get sleeping(){return this.isSleeping}get isSleeping(){return this._sleeping}setSleeping(t){this.isSleeping=t}set isSleeping(t){this._sleeping=t,t?(this.vel=E.Zero,this.acc=E.Zero,this.angularVelocity=0,this.sleepMotion=0):this.sleepMotion=this._bodyConfig.sleepEpsilon*5}updateMotion(){this._sleeping&&(this.isSleeping=!0);const t=this.vel.magnitude*this.vel.magnitude+Math.abs(this.angularVelocity*this.angularVelocity),e=this._bodyConfig.sleepBias;this.sleepMotion=e*this.sleepMotion+(1-e)*t,this.sleepMotion=It(this.sleepMotion,0,10*this._bodyConfig.sleepEpsilon),this.canSleep&&this.sleepMotion<this._bodyConfig.sleepEpsilon&&(this.isSleeping=!0)}get inertia(){if(this._cachedInertia)return this._cachedInertia;const t=this.owner.get(ee);if(t){t.$colliderAdded.subscribe(()=>{this._cachedInertia=null}),t.$colliderRemoved.subscribe(()=>{this._cachedInertia=null});const e=t.get();if(e)return this._cachedInertia=e.getInertia(this.mass)}return 0}get inverseInertia(){return this._cachedInverseInertia?this._cachedInverseInertia:this._cachedInverseInertia=this.collisionType===gt.Fixed?0:1/this.inertia}get active(){var t;return!!(!((t=this.owner)===null||t===void 0)&&t.isActive)}get isActive(){var t;return!!(!((t=this.owner)===null||t===void 0)&&t.isActive)}get center(){return this.globalPos}onAdd(t){var e,i;this.transform=(e=this.owner)===null||e===void 0?void 0:e.get(tt),this.motion=(i=this.owner)===null||i===void 0?void 0:i.get(Dt)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get globalPos(){return this.transform.globalPos}set globalPos(t){this.transform.globalPos=t}get oldPos(){return this.oldTransform.pos}get oldGlobalPos(){return this._oldGlobalPos}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t}get torque(){return this.motion.torque}set torque(t){this.motion.torque=t}get oldRotation(){return this.oldTransform.rotation}get rotation(){return this.transform.globalRotation}set rotation(t){this.transform.globalRotation=t}get scale(){return this.transform.globalScale}set scale(t){this.transform.globalScale=t}get oldScale(){return this.oldTransform.scale}get scaleFactor(){return this.motion.scaleFactor}set scaleFactor(t){this.motion.scaleFactor=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}applyImpulse(t,e){if(this.collisionType!==gt.Active)return;const i=e.scale(this.inverseMass,this._impulseScratch);if(this.limitDegreeOfFreedom.indexOf(be.X)>-1&&(i.x=0),this.limitDegreeOfFreedom.indexOf(be.Y)>-1&&(i.y=0),this.vel.addEqual(i),!this.limitDegreeOfFreedom.includes(be.Rotation)){const s=t.sub(this.globalPos,this._distanceFromCenterScratch);this.angularVelocity+=this.inverseInertia*s.cross(e)}}applyLinearImpulse(t){if(this.collisionType!==gt.Active)return;const e=t.scale(this.inverseMass);this.limitDegreeOfFreedom.includes(be.X)&&(e.x=0),this.limitDegreeOfFreedom.includes(be.Y)&&(e.y=0),this.vel=this.vel.add(e)}applyAngularImpulse(t,e){if(this.collisionType===gt.Active&&!this.limitDegreeOfFreedom.includes(be.Rotation)){const i=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*i.cross(e)}}captureOldTransform(){this.__oldTransformCaptured=!0;const t=this.transform.get();t.clone(this.oldTransform),this.oldTransform.parent=t.parent,this.oldVel.setTo(this.vel.x,this.vel.y),this.oldAcc.setTo(this.acc.x,this.acc.y),this.oldGlobalPos.setTo(this.globalPos.x,this.globalPos.y)}clone(){return super.clone()}}Bt._ID=0;Bt._DEFAULT_CONFIG={...yi().bodies};class Mr extends Rs{constructor(t){super(t),this.width=t.width,this.height=t.height,this.rasterize()}clone(){return new Mr({width:this.width,height:this.height,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.color&&t.fillRect(0,0,this.width,this.height),this.strokeColor&&t.strokeRect(0,0,this.width,this.height)}}class Qn extends Rs{get radius(){return this._radius}set radius(t){this._radius=t,this.width=this._radius*2,this.height=this._radius*2,this.flagDirty()}constructor(t){var e,i,s;super(t),this._radius=0;const r=(e=t.lineWidth)!==null&&e!==void 0?e:t.strokeColor?1:0;this.padding=(i=t.padding)!==null&&i!==void 0?i:2+r/2,this.radius=t.radius,this.filtering=(s=t.filtering)!==null&&s!==void 0?s:ie.Blended,this.rasterize()}clone(){return new Qn({radius:this.radius,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.radius>0&&(t.beginPath(),t.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.color&&t.fill(),this.strokeColor&&t.stroke())}}class Ri extends Ue{constructor(t){var e,i;super(),this.useColliderShape=!0,this.useGraphicsBounds=!0,this.useColliderShape=(e=t?.useColliderShape)!==null&&e!==void 0?e:this.useColliderShape,this.useGraphicsBounds=(i=t?.useGraphicsBounds)!==null&&i!==void 0?i:this.useGraphicsBounds,this.localBounds=t?.localBounds}}class Mt{static CreateReversibleEasingFunction(t){return(e,i,s,r)=>s<i?i-(t(e,s,i,r)-s):t(e,i,s,r)}static CreateVectorEasingFunction(t){return(e,i,s,r)=>new E(t(e,i.x,s.x,r),t(e,i.y,s.y,r))}}Mt.Linear=Mt.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,e*n/i+t));Mt.EaseInQuad=Mt.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i,e*n*n+t));Mt.EaseOutQuad=Mt.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i,-e*n*(n-2)+t));Mt.EaseInOutQuad=Mt.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i/2,n<1?e/2*n*n+t:(n--,-e/2*(n*(n-2)-1)+t)));Mt.EaseInCubic=Mt.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i,e*n*n*n+t));Mt.EaseOutCubic=Mt.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i,n--,e*(n*n*n+1)+t));Mt.EaseInOutCubic=Mt.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i/2,n<1?e/2*n*n*n+t:(n-=2,e/2*(n*n*n+2)+t)));class Vh{constructor(t){this._actions=[],this._currentAction=null,this._completedActions=[],this._entity=t}add(t){this._actions.push(t)}remove(t){const e=this._actions.indexOf(t);this._actions.splice(e,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}getIncompleteActions(){return this._actions}getCurrentAction(){return this._currentAction}hasNext(){return this._actions.length>0}isComplete(){return this._actions.length===0}reset(){this._actions=this.getActions();const t=this._actions.length;for(let e=0;e<t;e++)this._actions[e].reset();this._completedActions=[]}update(t){if(this._actions.length>0&&(this._currentAction!==this._actions[0]&&(this._currentAction=this._actions[0],this._entity.emit("actionstart",new _a(this._currentAction,this._entity))),this._currentAction.update(t),this._currentAction.isComplete(this._entity))){this._entity.emit("actioncomplete",new ma(this._currentAction,this._entity));const e=this._actions.shift();e&&this._completedActions.push(e)}}}let Vd=0;function Rt(){return Vd++}class Zh{constructor(t,e,i){this.id=Rt(),this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new Gr(t),this._actionQueue=this._repeatContext.getQueue(),this._repeat=i,this._originalRepeat=i,this._repeatBuilder(this._repeatContext),this._repeat--}update(t){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class Xh{constructor(t,e){this.id=Rt(),this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new Gr(t),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(t){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}function Jh(n,t,e){return(1-e)*n+t*e}function Ba(n,t,e,i){const s=(n-t+re)%re>=Math.PI,r=Math.abs(t-n),o=re-r;let a=0,h=0;r>o?(a=o,h=r):(a=r,h=o);let l=0,c=1;switch(e){case Ht.ShortestPath:l=a,c=s?1:-1;break;case Ht.LongestPath:l=h,c=s?-1:1;break;case Ht.Clockwise:c=1,l=s?a:h;break;case Ht.CounterClockwise:c=-1,l=s?h:a;break}return n+c*(l*i)}function Lr(n,t,e){return n.scale(1-e).add(t.scale(e))}function Kh(n,t,e){return(e-n)/(t-n)}function $h(n,t,e){const i=e.sub(n),s=t.sub(n),r=i.x/s.x,o=i.y/s.y;return Math.min(r,o)}function li(n,t,e,i,s){const r=Kh(n,t,s);return Jh(e,i,r)}function Zd(n,t,e,i,s){const r=$h(n,t,s);return Lr(e,i,r)}function tl(n){return n.offset instanceof E&&typeof n.duration=="number"}class el{constructor(t,e){var i;if(this.entity=t,this.id=Rt(),this._started=!1,this._stopped=!1,this._easing=Mt.Linear,this._offset=e.offset,this._easing=(i=e.easing)!==null&&i!==void 0?i:this._easing,this._tx=t.get(tt),this._motion=t.get(Dt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only MoveBy on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._start=this._tx.pos.clone(),this._end=this._start.add(this._offset),this._started=!0),this._currentMs-=t;const e=It(li(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),i=this._tx.pos,s=this._easing(e,this._start.x,this._end.x,1),r=this._easing(e,this._start.y,this._end.y,1),o=(s-i.x)/(t/1e3),a=(r-i.y)/(t/1e3);this._motion.vel.x=o,this._motion.vel.y=a,this.isComplete(this.entity)&&(this._tx.pos=T(this._end.x,this._end.y),this._motion.vel=T(0,0))}isComplete(t){return this._stopped||this._currentMs<0}stop(){this._motion.vel=T(0,0),this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class fo{constructor(t,e,i,s){if(this.id=Rt(),this._started=!1,this._stopped=!1,this._entity=t,this._tx=t.get(tt),this._motion=t.get(Dt),this._speed=s,this._offset=new E(e,i),s<=0)throw lt.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+s),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new E(this._tx.pos.x,this._tx.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.magnitude,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._entity)?(this._tx.pos=T(this._end.x,this._end.y),this._motion.vel=T(0,0)):this._motion.vel=this._dir.scale(this._speed)}isComplete(t){const e=t.get(tt);return this._stopped||e.pos.distance(this._start)>=this._distance}stop(){this._motion.vel=T(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function il(n){return n.pos instanceof E&&typeof n.duration=="number"}class sl{constructor(t,e){var i;if(this.entity=t,this.id=Rt(),this._started=!1,this._stopped=!1,this._easing=Mt.Linear,this._end=e.pos,this._easing=(i=e.easing)!==null&&i!==void 0?i:this._easing,this._tx=t.get(tt),this._motion=t.get(Dt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only moveTo on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._start=this._tx.pos.clone(),this._started=!0),this._currentMs-=t;const e=It(li(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),i=this._tx.pos,s=this._easing(e,this._start.x,this._end.x,1),r=this._easing(e,this._start.y,this._end.y,1),o=(s-i.x)/(t/1e3),a=(r-i.y)/(t/1e3);this._motion.vel.x=o,this._motion.vel.y=a,this.isComplete(this.entity)&&(this._tx.pos=T(this._end.x,this._end.y),this._motion.vel=T(0,0))}isComplete(t){return this._stopped||this._currentMs<0}stop(){this._motion.vel=T(0,0),this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class _o{constructor(t,e,i,s){this.entity=t,this.id=Rt(),this._started=!1,this._stopped=!1,this._tx=t.get(tt),this._motion=t.get(Dt),this._end=new E(e,i),this._speed=s}update(t){this._started||(this._started=!0,this._start=new E(this._tx.pos.x,this._tx.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const e=this._dir.scale(this._speed);this._motion.vel=T(e.x,e.y),this.isComplete(this.entity)&&(this._tx.pos=T(this._end.x,this._end.y),this._motion.vel=T(0,0))}isComplete(t){const e=t.get(tt);return this._stopped||new E(e.pos.x,e.pos.y).distance(this._start)>=this._distance}stop(){this._motion.vel=T(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function Xd(n){return typeof n.angle=="number"&&typeof n.duration=="number"}class rl{constructor(t,e){var i;if(this.entity=t,this.id=Rt(),this._started=!1,this._stopped=!1,this._endAngle=0,this._startAngle=0,this._endAngle=e.angle,this._tx=t.get(tt),this._motion=t.get(Dt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only RotateTo on Entities with TransformComponents.`);this._durationMs=e.duration,this._rotationType=(i=e.rotationType)!==null&&i!==void 0?i:Ht.ShortestPath,this._currentMs=this._durationMs}update(t){this._started||(this._startAngle=this._tx.rotation,this._started=!0),this._currentMs-=t;const e=It(li(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),i=Ba(this._startAngle,this._endAngle,this._rotationType,e),s=this._tx.rotation,r=(i-s)/(t/1e3);this._motion.angularVelocity=r,this.isComplete(this.entity)&&(this._tx.rotation=this._endAngle,this._motion.angularVelocity=0)}isComplete(t){return this._stopped||this._currentMs<0}stop(){this._motion.angularVelocity=0,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class nl{constructor(t,e,i,s){this.id=Rt(),this._started=!1,this._stopped=!1,this._tx=t.get(tt),this._motion=t.get(Dt),this._end=e,this._speed=i,this._rotationType=s||Ht.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation;const e=Math.abs(this._end-this._start),i=re-e;switch(e>i?(this._shortDistance=i,this._longDistance=e):(this._shortDistance=e,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+re)%re>=Math.PI,this._rotationType){case Ht.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case Ht.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case Ht.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case Ht.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function Jd(n){return typeof n.angleRadiansOffset=="number"&&typeof n.duration=="number"}class ol{constructor(t,e){var i;if(this.entity=t,this.id=Rt(),this._started=!1,this._stopped=!1,this._offset=0,this._startAngle=0,this._endAngle=0,this._offset=e.angleRadiansOffset,this._tx=t.get(tt),this._motion=t.get(Dt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only RotateBy on Entities with TransformComponents.`);this._durationMs=e.duration,this._rotationType=(i=e.rotationType)!==null&&i!==void 0?i:Ht.ShortestPath,this._currentMs=this._durationMs}update(t){this._started||(this._startAngle=this._tx.rotation,this._endAngle=vi(this._startAngle+this._offset),this._started=!0),this._currentMs-=t;const e=It(li(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),i=Ba(this._startAngle,this._endAngle,this._rotationType,e),s=this._tx.rotation,r=(i-s)/(t/1e3);this._motion.angularVelocity=r,this.isComplete()&&(this._tx.rotation=this._endAngle,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.angularVelocity=0,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class al{constructor(t,e,i,s){this.id=Rt(),this._started=!1,this._stopped=!1,this._tx=t.get(tt),this._motion=t.get(Dt),this._speed=i,this._offset=e,this._rotationType=s||Ht.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation,this._end=this._start+this._offset;const e=Math.abs(this._end-this._start),i=re-e;switch(e>i?(this._shortDistance=i,this._longDistance=e):(this._shortDistance=e,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+re)%re>=Math.PI,this._rotationType){case Ht.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case Ht.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case Ht.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case Ht.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._start=void 0,this._currentNonCannonAngle=void 0,this._distance=void 0}}function hl(n){return typeof n.scale=="object"&&typeof n.duration=="number"}class ll{constructor(t,e){if(this.entity=t,this.id=Rt(),this._started=!1,this._stopped=!1,this._endScale=T(1,1),this._startScale=T(1,1),this._endScale=e.scale,this._tx=t.get(tt),this._motion=t.get(Dt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only ScaleTo on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._startScale=this._tx.scale,this._started=!0),this._currentMs-=t;const e=It(li(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),i=Lr(this._startScale,this._endScale,e),s=this._tx.scale,r=i.sub(s).scale(1/(t/1e3));this._motion.scaleFactor=r,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.scaleFactor=E.Zero,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class cl{constructor(t,e,i,s,r){this.id=Rt(),this._started=!1,this._stopped=!1,this._tx=t.get(tt),this._motion=t.get(Dt),this._endX=e,this._endY=i,this._speedX=s,this._speedY=r}update(t){if(this._started||(this._started=!0,this._startX=this._tx.scale.x,this._startY=this._tx.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._tx.scale.x-this._startX)>=this._distanceX)this._motion.scaleFactor.x=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.x=this._speedX*e}if(Math.abs(this._tx.scale.y-this._startY)>=this._distanceY)this._motion.scaleFactor.y=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.y=this._speedY*e}this.isComplete()&&(this._tx.scale=T(this._endX,this._endY),this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startX)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startY)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}function dl(n){return typeof n.scaleOffset=="object"&&typeof n.duration=="number"}class ul{constructor(t,e){if(this.entity=t,this.id=Rt(),this._started=!1,this._stopped=!1,this._endScale=T(1,1),this._scaleOffset=T(0,0),this._startScale=T(1,1),this._scaleOffset=e.scaleOffset,this._tx=t.get(tt),this._motion=t.get(Dt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only ScaleBy on Entities with TransformComponents.`);this._durationMs=e.duration,this._currentMs=this._durationMs}update(t){this._started||(this._startScale=this._tx.scale,this._endScale=this._startScale.add(this._scaleOffset),this._started=!0),this._currentMs-=t;const e=It(li(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1),i=Lr(this._startScale,this._endScale,e),s=this._tx.scale,r=i.sub(s).scale(1/(t/1e3));this._motion.scaleFactor=r,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.angularVelocity=0)}isComplete(){return this._stopped||this._currentMs<0}stop(){this._motion.scaleFactor=E.Zero,this._stopped=!0,this._currentMs=0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}}class Al{constructor(t,e,i,s){this.id=Rt(),this._started=!1,this._stopped=!1,this._tx=t.get(tt),this._motion=t.get(Dt),this._offset=new E(e,i),this._speedX=this._speedY=s}update(t){this._started||(this._started=!0,this._startScale=this._tx.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._motion.scaleFactor.x=this._speedX*this._directionX,this._motion.scaleFactor.y=this._speedY*this._directionY,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startScale.x)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startScale.y)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class ah{constructor(t){this.id=Rt(),this._hasBeenCalled=!1,this._method=t}update(t){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class gl{constructor(t,e,i,s,r){this.easingFcn=r,this.id=Rt(),this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new E(0,0),this._lerpEnd=new E(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(tt),this._motion=t.get(Dt),this._lerpDuration=s,this._lerpEnd=new E(e,i)}_initialize(){this._lerpStart=new E(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,i=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?i=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):i=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=T((e-this._tx.pos.x)/(t/1e3),(i-this._tx.pos.y)/(t/1e3))):(this._tx.pos=T(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=E.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=T(0,0),this._stopped=!0}}class pl{constructor(t,e,i,s,r){this.easingFcn=r,this.id=Rt(),this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new E(0,0),this._lerpEnd=new E(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(tt),this._motion=t.get(Dt),this._lerpDuration=s,this._offset=new E(e,i)}_initialize(){this._lerpStart=new E(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0,this._lerpEnd=this._lerpStart.add(this._offset)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,i=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?i=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):i=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=T((e-this._tx.pos.x)/(t/1e3),(i-this._tx.pos.y)/(t/1e3))):(this._tx.pos=T(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=E.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=T(0,0),this._stopped=!0}}class fl{constructor(t,e,i,s=1){this.id=Rt(),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._graphics=t.get(Wt),this._timeVisible=e,this._timeNotVisible=i,this._duration=(e+i)*s}update(t){this._started||(this._started=!0,this._elapsedTime=0,this._totalTime=0),this._graphics&&(this._elapsedTime+=t,this._totalTime+=t,this._graphics.isVisible&&this._elapsedTime>=this._timeVisible&&(this._graphics.isVisible=!1,this._elapsedTime=0),!this._graphics.isVisible&&this._elapsedTime>=this._timeNotVisible&&(this._graphics.isVisible=!0,this._elapsedTime=0),this.isComplete()&&(this._graphics.isVisible=!0))}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._graphics&&(this._graphics.isVisible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._elapsedTime=0,this._totalTime=0}}class _l{constructor(t,e,i){this.id=Rt(),this._multiplier=1,this._started=!1,this._stopped=!1,this._graphics=t.get(Wt),this._endOpacity=e,this._remainingTime=this._originalTime=i}update(t){this._graphics&&(this._started||(this._started=!0,this._remainingTime=this._originalTime,this._endOpacity<this._graphics.opacity?this._multiplier=-1:this._multiplier=1),this._remainingTime>0&&(this._graphics.opacity+=this._multiplier*(Math.abs(this._graphics.opacity-this._endOpacity)*t)/this._remainingTime),this._remainingTime-=t,this.isComplete()&&(this._graphics.opacity=this._endOpacity),lt.getInstance().debug("[Action fade] Actor opacity:",this._graphics.opacity))}isComplete(){return this._stopped||this._remainingTime<=0}stop(){this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._remainingTime=this._originalTime}}class ml{constructor(t){this.id=Rt(),this._elapsedTime=0,this._started=!1,this._stopped=!1,this._delay=t}update(t){this._started||(this._started=!0),this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1,this._stopped=!1}}class vl{constructor(t){this.id=Rt(),this._stopped=!1,this._entity=t}update(t){this._entity.get(ms).clearActions(),this._entity.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class mo{constructor(t,e,i){this.id=Rt(),this._started=!1,this._stopped=!1,this._tx=t.get(tt),this._motion=t.get(Dt),this._followTx=e.get(tt),this._followMotion=e.get(Dt),this._current=new E(this._tx.pos.x,this._tx.pos.y),this._end=new E(this._followTx.pos.x,this._followTx.pos.y),this._maximumDistance=i!==void 0?i:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._followMotion.vel.x,2)+Math.pow(this._followMotion.vel.y,2));if(e!==0&&(this._speed=e),this._current=T(this._tx.pos.x,this._tx.pos.y),this._end=T(this._followTx.pos.x,this._followTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const i=this._dir.scale(this._speed);this._motion.vel=T(i.x,i.y)}else this._motion.vel=T(0,0);this.isComplete()&&(this._tx.pos=T(this._end.x,this._end.y),this._motion.vel=T(0,0))}stop(){this._motion.vel=T(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1,this._stopped=!1}}class vo{constructor(t,e,i){this.id=Rt(),this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._tx=t.get(tt),this._motion=t.get(Dt),this._meetTx=e.get(tt),this._meetMotion=e.get(Dt),this._current=new E(this._tx.pos.x,this._tx.pos.y),this._end=new E(this._meetTx.pos.x,this._meetTx.pos.y),this._speed=i||0,i!==void 0&&(this._speedWasSpecified=!0)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._meetMotion.vel.x,2)+Math.pow(this._meetMotion.vel.y,2));e!==0&&!this._speedWasSpecified&&(this._speed=e),this._current=T(this._tx.pos.x,this._tx.pos.y),this._end=T(this._meetTx.pos.x,this._meetTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const i=this._dir.scale(this._speed);this._motion.vel=T(i.x,i.y),this.isComplete()&&(this._tx.pos=T(this._end.x,this._end.y),this._motion.vel=T(0,0))}isComplete(){return this._stopped||this._distanceBetween<=1}stop(){this._motion.vel=T(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._distanceBetween=1/0}}class wl{constructor(t,e,i=1e3){var s;this.id=Rt(),this._stopped=!1,this._started=!1,this._total=0,this._currentDuration=0,this._graphics=t.get(Wt),this._duration=i,this._entity=t,this._material=(s=t.scene)===null||s===void 0?void 0:s.engine.graphicsContext.createMaterial({name:"flash-material",color:e,fragmentSource:`#version 300 es
    
        precision mediump float;
        uniform float u_blend;
        uniform sampler2D u_graphic;
        uniform vec4 u_color;
    
        in vec2 v_uv; 
        out vec4 color;
    
        void main() { 
            vec4 textureColor = texture(u_graphic, v_uv); 
            color = mix(textureColor, u_color, u_blend * textureColor.a);
            color.rgb = color.rgb * color.a;
        }`}),this._total=i}update(t){var e;this._started||(this._started=!0,this._total=this._duration,this._currentDuration=this._duration,this._entity.graphics.material=this._material),this._graphics&&(this._currentDuration-=t,this._graphics&&((e=this._material)===null||e===void 0||e.update(i=>{i.trySetUniformFloat("u_blend",this._currentDuration/this._total)})),this.isComplete()&&(this._entity.graphics.material=null))}isComplete(){return this._stopped||this._currentDuration<=0}stop(){this._graphics&&(this._graphics.isVisible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class Ur{constructor(t){var e;if(this._distLookup=[],this.quality=4,t.controlPoints.length!==4)throw new Error("Only cubic bezier curves are supported");this._controlPoints=[...t.controlPoints],this.quality=(e=t.quality)!==null&&e!==void 0?e:this.quality,this._calculateLookup()}get arcLength(){return this._arcLength}get controlPoints(){return this._controlPoints}set controlPoints(t){this._controlPoints=[...t],this._calculateLookup()}setControlPoint(t,e){this._controlPoints[t]=e,this._calculateLookup()}_calculateLookup(){let t=0;this._distLookup.length=0;let e=this.controlPoints[0];const i=this.controlPoints.length*this.quality;for(let s=0;s<i;s++){const r=s/(i-1),o=this.getPoint(r),a=e.distance(o);t+=a,this._distLookup.push(t),e=o}this._arcLength=t}_getTimeGivenDistance(t){const e=this._distLookup.length,i=this.arcLength;if(t>=0&&t<i){for(let s=0;s<e-1;s++)if(this._distLookup[s]<=t&&t<this._distLookup[s+1])return li(this._distLookup[s],this._distLookup[s+1],s/(e-1),(s+1)/(e-1),t)}return t/i}getPoint(t){const e=[...this.controlPoints];for(let i=1;i<e.length;i++)for(let s=0;s<e.length-i;s++)e[s]=Lr(e[s],e[s+1],t);return e[0]}getTangent(t){const e=t*t,i=this.controlPoints[0],s=this.controlPoints[1],r=this.controlPoints[2],o=this.controlPoints[3];return i.scale(-3*e+6*t-3).add(s.scale(9*e-12*t+3).add(r.scale(-9*e+6*t).add(o.scale(3*e)))).normalize()}getUniformTangent(t){const e=t*this.arcLength,i=this._getTimeGivenDistance(e);return this.getTangent(i)}getNormal(t){return this.getTangent(t).normal()}getUniformNormal(t){return this.getUniformTangent(t).normal()}getUniformPoint(t){const e=t*this.arcLength,i=this._getTimeGivenDistance(e);return this.getPoint(i)}clone(){return new Ur({controlPoints:[...this.controlPoints],quality:this.quality})}}class yl{constructor(t,e){var i;if(this.id=Rt(),this._started=!1,this._stopped=!1,this._mode="dynamic",this._entity=t,this._tx=this._entity.get(tt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);this._curve=new Ur({controlPoints:[T(0,0),...e.controlPoints],quality:e.quality}),this._durationMs=e.duration,this._mode=(i=e.mode)!==null&&i!==void 0?i:this._mode,this._currentMs=this._durationMs}update(t){this._started||(this._curve.setControlPoint(0,this._tx.globalPos.clone()),this._started=!0),this._currentMs-=t;const e=It(li(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1);this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(e):this._tx.pos=this._curve.getUniformPoint(e),this.isComplete(this._entity)&&(this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(1):this._tx.pos=this._curve.getUniformPoint(1))}isComplete(t){return this._stopped||this._currentMs<0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}stop(){this._stopped=!0,this._currentMs=0}}class Cl{constructor(t,e){var i;if(this.id=Rt(),this._started=!1,this._stopped=!1,this._mode="dynamic",this._entity=t,this._tx=this._entity.get(tt),!this._tx)throw new Error(`Entity ${t.name} has no TransformComponent, can only curveTo on Entities with TransformComponents.`);this._curve=this._curve=new Ur({controlPoints:[T(0,0),...e.controlPoints],quality:e.quality}),this._durationMs=e.duration,this._mode=(i=e.mode)!==null&&i!==void 0?i:this._mode,this._currentMs=this._durationMs}update(t){this._started||(this._curve.setControlPoint(0,this._tx.globalPos),this._curve.setControlPoint(1,this._curve.controlPoints[1].add(this._tx.globalPos)),this._curve.setControlPoint(2,this._curve.controlPoints[2].add(this._tx.globalPos)),this._curve.setControlPoint(3,this._curve.controlPoints[3].add(this._tx.globalPos)),this._started=!0),this._currentMs-=t;const e=It(li(0,this._durationMs,0,1,this._durationMs-this._currentMs),0,1);this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(e):this._tx.pos=this._curve.getUniformPoint(e),this.isComplete(this._entity)&&(this._mode==="dynamic"?this._tx.pos=this._curve.getPoint(1):this._tx.pos=this._curve.getUniformPoint(1))}isComplete(t){return this._stopped||this._currentMs<0}reset(){this._currentMs=this._durationMs,this._started=!1,this._stopped=!1}stop(){this._stopped=!0}}class Gr{constructor(t){this._entity=t,this._queue=new Vh(t)}getQueue(){return this._queue}update(t){this._queue.update(t)}clearActions(){this._queue.clearActions()}runAction(t){return t.reset(),this._queue.add(t),this}curveBy(t){return this._queue.add(new Cl(this._entity,t)),this}curveTo(t){return this._queue.add(new yl(this._entity,t)),this}easeTo(...t){var e,i;let s=0,r=0,o=0,a=Mt.Linear;return t[0]instanceof E?(s=t[0].x,r=t[0].y,o=t[1],a=(e=t[2])!==null&&e!==void 0?e:a):(s=t[0],r=t[1],o=t[2],a=(i=t[3])!==null&&i!==void 0?i:a),this._queue.add(new gl(this._entity,s,r,o,a)),this}easeBy(...t){var e,i;let s=0,r=0,o=0,a=Mt.Linear;return t[0]instanceof E?(s=t[0].x,r=t[0].y,o=t[1],a=(e=t[2])!==null&&e!==void 0?e:a):(s=t[0],r=t[1],o=t[2],a=(i=t[3])!==null&&i!==void 0?i:a),this._queue.add(new pl(this._entity,s,r,o,a)),this}moveTo(t,e,i){let s=0,r=0,o=0;return t instanceof E?(s=t.x,r=t.y,o=+(e??0),this._queue.add(new _o(this._entity,s,r,o))):typeof t=="number"&&typeof e=="number"&&typeof i=="number"?(s=t,r=e,o=i,this._queue.add(new _o(this._entity,s,r,o))):il(t)&&this._queue.add(new sl(this._entity,t)),this}moveBy(t,e,i){let s=0,r=0,o=0;return t instanceof E&&typeof e=="number"?(s=t.x,r=t.y,o=e,this._queue.add(new fo(this._entity,s,r,o))):typeof t=="number"&&typeof e=="number"&&typeof i=="number"?(s=t,r=e,o=i,this._queue.add(new fo(this._entity,s,r,o))):tl(t)&&this._queue.add(new el(this._entity,t)),this}rotateTo(t,e,i){return typeof t=="number"&&typeof e=="number"?this._queue.add(new nl(this._entity,t,e,i)):typeof t=="object"&&this._queue.add(new rl(this._entity,t)),this}rotateBy(t,e,i){return typeof t=="object"?this._queue.add(new ol(this._entity,t)):this._queue.add(new al(this._entity,t,e,i)),this}scaleTo(t,e,i,s){let r=1,o=1,a=0,h=0;return hl(t)?(this._queue.add(new ll(this._entity,t)),this):(t instanceof E&&e instanceof E&&(r=t.x,o=t.y,a=e.x,h=e.y),typeof t=="number"&&typeof e=="number"&&(r=t,o=e,a=i,h=s),this._queue.add(new cl(this._entity,r,o,a,h)),this)}scaleBy(t,e,i){if(dl(t))return this._queue.add(new ul(this._entity,t)),this;let s=1,r=1;return t instanceof E&&(s=t.x,r=t.y,i=e),typeof t=="number"&&typeof e=="number"&&(s=t,r=e),this._queue.add(new Al(this._entity,s,r,i)),this}blink(t,e,i=1){return this._queue.add(new fl(this._entity,t,e,i)),this}fade(t,e){return this._queue.add(new _l(this._entity,t,e)),this}flash(t,e=1e3){return this._queue.add(new wl(this._entity,t,e)),this}delay(t){return this._queue.add(new ml(t)),this}die(){return this._queue.add(new vl(this._entity)),this}callMethod(t){return this._queue.add(new ah(t)),this}repeat(t,e){return e?(this._queue.add(new Zh(this._entity,t,e)),this):(this.repeatForever(t),this)}repeatForever(t){return this._queue.add(new Xh(this._entity,t)),this}follow(t,e){return e===void 0?this._queue.add(new mo(this._entity,t)):this._queue.add(new mo(this._entity,t,e)),this}meet(t,e){return e===void 0?this._queue.add(new vo(this._entity,t)):this._queue.add(new vo(this._entity,t,e)),this}toPromise(){return new Promise(e=>{this._queue.add(new ah(()=>{e()}))})}}class ms extends Ue{constructor(){super(...arguments),this.dependencies=[tt,Dt],this._ctx=null}onAdd(t){this._ctx=new Gr(t)}onRemove(){this._ctx=null}_getCtx(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no context available");return this._ctx}getQueue(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no queue available");return this._ctx.getQueue()}runAction(t){if(!this._ctx)throw new Error("Actions component not attached to an entity, cannot run action");return this._ctx.runAction(t)}update(t){var e;return(e=this._ctx)===null||e===void 0?void 0:e.update(t)}clearActions(){var t;(t=this._ctx)===null||t===void 0||t.clearActions()}curveBy(t){return this._getCtx().curveBy.apply(this._ctx,[t])}curveTo(t){return this._getCtx().curveTo.apply(this._ctx,[t])}easeTo(...t){return this._getCtx().easeTo.apply(this._ctx,t)}easeBy(...t){return this._getCtx().easeBy.apply(this._ctx,t)}moveTo(t,e,i){return this._getCtx().moveTo.apply(this._ctx,[t,e,i])}moveBy(t,e,i){return this._getCtx().moveBy.apply(this._ctx,[t,e,i])}rotateTo(t,e,i){return this._getCtx().rotateTo.apply(this._ctx,[t,e,i])}rotateBy(t,e,i){return this._getCtx().rotateBy.apply(this._ctx,[t,e,i])}scaleTo(t,e,i,s){return this._getCtx().scaleTo.apply(this._ctx,[t,e,i,s])}scaleBy(t,e,i){return this._getCtx().scaleBy.apply(this._ctx,[t,e,i])}blink(t,e,i){return this._getCtx().blink(t,e,i)}fade(t,e){return this._getCtx().fade(t,e)}flash(t,e=1e3){return this._getCtx().flash(t,e)}delay(t){return this._getCtx().delay(t)}die(){return this._getCtx().die()}callMethod(t){return this._getCtx().callMethod(t)}repeat(t,e){return this._getCtx().repeat(t,e)}repeatForever(t){return this._getCtx().repeatForever(t)}follow(t,e){return this._getCtx().follow(t,e)}meet(t,e){return this._getCtx().meet(t,e)}toPromise(){return this._getCtx().toPromise()}}function Kd(n){return n instanceof ye}const $d={CollisionStart:"collisionstart",CollisionEnd:"collisionend",PreCollision:"precollision",PostCollision:"postcollision",Kill:"kill",PreKill:"prekill",PostKill:"postkill",PreDraw:"predraw",PostDraw:"postdraw",PreTransformDraw:"pretransformdraw",PostTransformDraw:"posttransformdraw",PreDebugDraw:"predebugdraw",PostDebugDraw:"postdebugdraw",PointerUp:"pointerup",PointerDown:"pointerdown",PointerEnter:"pointerenter",PointerLeave:"pointerleave",PointerMove:"pointermove",PointerCancel:"pointercancel",Wheel:"pointerwheel",PointerDrag:"pointerdragstart",PointerDragEnd:"pointerdragend",PointerDragEnter:"pointerdragenter",PointerDragLeave:"pointerdragleave",PointerDragMove:"pointerdragmove",EnterViewPort:"enterviewport",ExitViewPort:"exitviewport",ActionStart:"actionstart",ActionComplete:"actioncomplete"};class ye extends _e{get pos(){return this.transform.pos}set pos(t){this.transform.pos=t.clone()}get oldPos(){return this.body.oldPos}get oldGlobalPos(){return this.body.oldGlobalPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t.clone()}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t.clone()}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}get scale(){return this.get(tt).scale}set scale(t){this.get(tt).scale=t}get anchor(){return this._anchor}set anchor(t){this._anchor=Oe(t,e=>this._handleAnchorChange(e)),this._handleAnchorChange(t)}_handleAnchorChange(t){this.graphics&&(this.graphics.anchor=t)}get offset(){return this._offset}set offset(t){this._offset=Oe(t,e=>this._handleOffsetChange(e)),this._handleOffsetChange(t)}_handleOffsetChange(t){this.graphics&&(this.graphics.offset=t)}get isOffScreen(){return this.hasTag("ex.offscreen")}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.events.on("pointerdragstart",this._pointerDragStartHandler),this.events.on("pointerdragend",this._pointerDragEndHandler),this.events.on("pointerdragmove",this._pointerDragMoveHandler),this.events.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.events.off("pointerdragstart",this._pointerDragStartHandler),this.events.off("pointerdragend",this._pointerDragEndHandler),this.events.off("pointerdragmove",this._pointerDragMoveHandler),this.events.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this.graphics.color}set color(t){this.graphics.color=t}constructor(t){super(),this.events=new Nt,this._anchor=Oe(E.Half,$=>this._handleAnchorChange($)),this._offset=Oe(E.Zero,$=>this._handleOffsetChange($)),this.logger=lt.getInstance(),this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=$=>{this._dragging&&(this.pos=$.worldPos)},this._pointerDragLeaveHandler=$=>{this._dragging&&(this.pos=$.worldPos)};const{name:e,x:i,y:s,pos:r,coordPlane:o,scale:a,width:h,height:l,radius:c,collider:d,vel:A,acc:u,rotation:p,angularVelocity:v,z:C,color:y,visible:b,opacity:P,anchor:I,offset:Q,collisionType:O,collisionGroup:B,silenceWarnings:j}={...t};this.name=e??this.name,this.anchor=I??ye.defaults.anchor.clone(),this.offset=Q??E.Zero,this.transform=new tt,this.addComponent(this.transform),this.pos=r??T(i??0,s??0),this.rotation=p??0,this.scale=a??T(1,1),this.z=C??0,this.transform.coordPlane=o??Ae.World,this._silenceWarnings=j??!1,this.pointer=new Ri,this.addComponent(this.pointer),this.graphics=new Wt({anchor:this.anchor,offset:this.offset,opacity:P}),this.addComponent(this.graphics),this.motion=new Dt,this.addComponent(this.motion),this.vel=A??E.Zero,this.acc=u??E.Zero,this.angularVelocity=v??0,this.actions=new ms,this.addComponent(this.actions),this.body=new Bt,this.addComponent(this.body),this.body.collisionType=O??gt.Passive,B&&(this.body.group=B),y&&(this.color=y),d?(this.collider=new ee(d),this.addComponent(this.collider)):c?(this.collider=new ee(pe.Circle(c)),this.addComponent(this.collider),y&&this.graphics.add(new Qn({color:y,radius:c}))):h>0&&l>0?(this.collider=new ee(pe.Box(h,l,this.anchor)),this.addComponent(this.collider),y&&h&&l&&this.graphics.add(new Mr({color:y,width:h,height:l}))):(this.collider=new ee,this.addComponent(this.collider)),this.graphics.isVisible=b??!0}clone(){const t=new ye({silenceWarnings:this._silenceWarnings,color:this.color.clone(),anchor:this.anchor.clone(),offset:this.offset.clone()});t.clearComponents(),t.processComponentRemoval(),t.addComponent(t.transform=this.transform.clone(),!0),t.addComponent(t.pointer=this.pointer.clone(),!0),t.addComponent(t.graphics=this.graphics.clone(),!0),t.addComponent(t.motion=this.motion.clone(),!0),t.addComponent(t.actions=this.actions.clone(),!0),t.addComponent(t.body=this.body.clone(),!0),t.addComponent(t.collider=this.collider.clone(),!0);const e=[this.transform,this.pointer,this.graphics,this.motion,this.actions,this.body,this.collider],i=this.getComponents();for(const s of i)e.includes(s)||t.addComponent(s.clone(),!0);return t}onInitialize(t){}_initialize(t){super._initialize(t);for(const e of this.children)e._initialize(t)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_prekill(t){this.events.emit("prekill",new Zo(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){this.events.emit("postkill",new Xo(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.events.emit("kill",new En(this)),super.kill(),this._postkill(this.scene)):this.logger.warn(`Cannot kill actor named "${this.name}", it was never added to the Scene`)}unkill(){this.isActive=!0}isKilled(){return!this.isActive}get z(){return this.get(tt).z}set z(t){this.get(tt).z=t}get center(){const t=this.getGlobalPos();return new E(t.x+this.width/2-this.anchor.x*this.width,t.y+this.height/2-this.anchor.y*this.height)}get localCenter(){return new E(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this.collider.localBounds.width*this.getGlobalScale().x}get height(){return this.collider.localBounds.height*this.getGlobalScale().y}getGlobalRotation(){return this.get(tt).globalRotation}get globalRotation(){return this.get(tt).globalRotation}getGlobalPos(){return this.get(tt).globalPos}get globalPos(){return this.get(tt).globalPos}getGlobalScale(){return this.get(tt).globalScale}get globalScale(){return this.get(tt).globalScale}get globalZ(){return this.get(tt).globalZ}contains(t,e,i=!1){const s=T(t,e),r=this.get(ee);r.update();const o=r.get();if(!o)return!1;const a=o.contains(s);return i?a||this.children.some(h=>h.contains(t,e,!0)):a}within(t,e){const i=this.get(ee),s=t.get(ee),r=i.get(),o=s.get();return r&&o?r.getClosestLineBetween(o).getLength()<=e:!1}update(t,e){this._initialize(t),this._add(t),this._preupdate(t,e),this._postupdate(t,e),this._remove(t)}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreCollisionResolve(t,e,i,s){}onPostCollisionResolve(t,e,i,s){}onCollisionStart(t,e,i,s){}onCollisionEnd(t,e,i,s){}_preupdate(t,e){this.events.emit("preupdate",new Ni(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.events.emit("postupdate",new zi(t,e,this)),this.onPostUpdate(t,e)}}ye.defaults={anchor:E.Half};function xl(n){return n instanceof Sa}class Sa extends ye{constructor(t){var e,i;super({...t}),this.get(tt).coordPlane=Ae.Screen,this.anchor=(e=t?.anchor)!==null&&e!==void 0?e:T(0,0),this.body.collisionType=(i=t?.collisionType)!==null&&i!==void 0?i:gt.PreventCollision,this.pointer.useGraphicsBounds=!0,this.pointer.useColliderShape=!1,!t?.collider&&t?.width>0&&t?.height>0&&this.collider.useBoxCollider(this.width,this.height,this.anchor)}_initialize(t){this._engine=t,super._initialize(t)}contains(t,e,i=!0){if(i)return super.contains(t,e);const s=this._engine.worldToScreenCoordinates(new E(t,e));return super.contains(s.x,s.y)}}class Ji{get complete(){return this._complete}constructor(t){var e;this._logger=lt.getInstance(),this.id=0,this._elapsedTime=0,this._totalTimeAlive=0,this._running=!1,this._numberOfTicks=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this.randomRange=[0,0],this._baseInterval=10,this._generateRandomInterval=()=>this._baseInterval+this.random.integer(this.randomRange[0],this.randomRange[1]),this._complete=!1,this.scene=null;const i=(e=t.action)!==null&&e!==void 0?e:t.fcn,s=t.interval,r=t.repeats,o=t.numberOfRepeats,a=t.randomRange,h=t.random;if(o&&o>=0&&(this.maxNumberOfRepeats=o,!r))throw new Error("repeats must be set to true if numberOfRepeats is set");if(this.id=Ji._MAX_ID++,this._callbacks=[],this._baseInterval=this.interval=s,a){if(a[0]>a[1])throw new Error("min value must be lower than max value for range");this.random=h??new Ds,this.randomRange=a,this.interval=this._generateRandomInterval(),this.on(()=>{this.interval=this._generateRandomInterval()})}this.repeats=r||this.repeats,i&&this.on(i)}on(t){this._callbacks.push(t)}off(t){const e=this._callbacks.indexOf(t);this._callbacks.splice(e,1)}update(t){this._running&&(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this._complete=!0,this._running=!1,this._elapsedTime=0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach(e=>{e.call(this)}),this._numberOfTicks++,this.repeats?this._elapsedTime=0:(this._complete=!0,this._running=!1,this._elapsedTime=0)))}reset(t,e){if(t&&t>=0&&(this._baseInterval=this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}get timeToNextAction(){return this.complete?0:this.interval-this._elapsedTime}get timeElapsedTowardNextAction(){return this._elapsedTime}get isRunning(){return this._running}pause(){return this._running=!1,this}resume(){return this._running=!0,this}start(){return this.scene||this._logger.warn("Cannot start a timer not part of a scene, timer wont start until added"),this._running=!0,this.complete&&(this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0),this}stop(){return this._running=!1,this._elapsedTime=0,this._numberOfTicks=0,this}cancel(){this.pause(),this.scene&&this.scene.cancelTimer(this)}}Ji._MAX_ID=0;class Pn extends Ue{constructor(t){super(),this.parallaxFactor=T(1,1),this.parallaxFactor=t??this.parallaxFactor}}class Dn extends Ue{constructor(t,e=!0){super(),this.draw=t,this.useTransform=e}}function hh(n){return n&&n._dispatchPointerEvents&&n._processPointerToObject}class tu{get events(){return this.object.events}init(t,e,i){this.object=t,this.contains=e,this.active=i}}class Ta{constructor(){this._proxyPool=new Qr(()=>new tu,t=>t,100),this._objectToProxy=new Map,this._proxies=[],this._lastFrameObjectToPointers=new Map,this._currentFrameObjectToPointers=new Map}addObject(t,e,i){const s=this._proxyPool.rent(!1);s.init(t,e,i),this._proxies.push(s),this._objectToProxy.set(t,s)}_getProxy(t){const e=this._objectToProxy.get(t);if(e)return e;throw new Error("No PointerTargetProxy for object")}removeObject(t){const e=this._objectToProxy.get(t);if(e){const i=this._proxies.indexOf(e);i>-1&&this._proxies.splice(i,1),this._proxyPool.return(e)}}_objectCurrentlyUnderPointer(t,e){return!!(this._currentFrameObjectToPointers.has(t)&&this._currentFrameObjectToPointers.get(t).includes(e))}_objectWasUnderPointer(t,e){return!!(this._lastFrameObjectToPointers.has(t)&&this._lastFrameObjectToPointers.get(t).includes(e))}_entered(t,e){return this._objectCurrentlyUnderPointer(t,e)&&!this._lastFrameObjectToPointers.has(t)}_left(t,e){return!this._currentFrameObjectToPointers.has(t)&&this._objectWasUnderPointer(t,e)}addPointerToObject(t,e){const i=this._objectToProxy.get(t);i&&this._addPointerToProxy(i,e)}_addPointerToProxy(t,e){if(!this._currentFrameObjectToPointers.has(t)){this._currentFrameObjectToPointers.set(t,[e]);return}const i=this._currentFrameObjectToPointers.get(t);this._currentFrameObjectToPointers.set(t,i.concat(e))}dispatchEvents(t,e){const i=new Set(this._lastFrameObjectToPointers.keys()),s=new Set(this._currentFrameObjectToPointers.keys());let r,o,a;for(let h=0;h<e.length;h++){const l=e[h],c=this._getProxy(l);if(hh(l)&&l._dispatchPointerEvents(t),i.has(c)||s.has(c)){a=this._processDownAndEmit(t,c),o=this._processUpAndEmit(t,c),r=this._processMoveAndEmit(t,c);const d=[...r.values(),...a.values(),...o.values()];this._processEnterLeaveAndEmit(t,c,d),this._processCancelAndEmit(t,c),this._processWheelAndEmit(t,c)}}}processPointerToObject(t,e){for(let i=0;i<e.length;i++){const s=e[i],r=this._getProxy(s);hh(s)&&s._processPointerToObject(t);for(const[o,a]of t.currentFramePointerCoords.entries())r.contains(a)&&this._addPointerToProxy(r,o)}}clear(){this._lastFrameObjectToPointers.clear(),this._lastFrameObjectToPointers=new Map(this._currentFrameObjectToPointers),this._currentFrameObjectToPointers.clear()}_processDownAndEmit(t,e){const i=new Map;for(const s of t.currentFrameDown)s.active&&this._objectCurrentlyUnderPointer(e,s.pointerId)&&(e.events.emit("pointerdown",s),t.isDragStart(s.pointerId)&&e.events.emit("pointerdragstart",s)),i.set(s.pointerId,s);return i}_processUpAndEmit(t,e){const i=new Map;for(const s of t.currentFrameUp)s.active&&this._objectCurrentlyUnderPointer(e,s.pointerId)&&(e.events.emit("pointerup",s),t.isDragEnd(s.pointerId)&&e.events.emit("pointerdragend",s)),i.set(s.pointerId,s);return i}_processMoveAndEmit(t,e){const i=new Map;for(const s of t.currentFrameMove)s.active&&e.active()&&this._objectCurrentlyUnderPointer(e,s.pointerId)&&(e.events.emit("pointermove",s),t.isDragging(s.pointerId)&&e.events.emit("pointerdragmove",s)),i.set(s.pointerId,s);return i}_processEnterLeaveAndEmit(t,e,i){for(const s of i){if(s.active&&e.active()&&this._entered(e,s.pointerId)){e.events.emit("pointerenter",s),t.isDragging(s.pointerId)&&e.events.emit("pointerdragenter",s);break}if(s.active&&e.active()&&(this._left(e,s.pointerId)||this._objectCurrentlyUnderPointer(e,s.pointerId)&&s.type==="up")){e.events.emit("pointerleave",s),t.isDragging(s.pointerId)&&e.events.emit("pointerdragleave",s);break}}}_processCancelAndEmit(t,e){for(const i of t.currentFrameCancel)i.active&&e.active()&&this._objectCurrentlyUnderPointer(e,i.pointerId)&&e.events.emit("pointercancel",i)}_processWheelAndEmit(t,e){for(const i of t.currentFrameWheel)i.active&&e.active()&&this._objectCurrentlyUnderPointer(e,0)&&e.events.emit("pointerwheel",i)}}const eu={PreUpdate:"preupdate",PostUpdate:"postupdate",PreDraw:"predraw",PostDraw:"postdraw",PointerUp:"pointerup",PointerDown:"pointerdown",PointerMove:"pointermove",PointerCancel:"pointercancel"};class bl extends _e{flagCollidersDirty(){this._collidersDirty=!0}flagTilesDirty(){for(let t=0;t<this.tiles.length;t++)this.tiles[t]&&this.tiles[t].flagDirty()}get x(){var t;return(t=this.transform.pos.x)!==null&&t!==void 0?t:0}set x(t){var e;!((e=this.transform)===null||e===void 0)&&e.pos&&(this.get(tt).pos=T(t,this.y))}get y(){var t,e;return(e=(t=this.transform)===null||t===void 0?void 0:t.pos.y)!==null&&e!==void 0?e:0}set y(t){var e;!((e=this.transform)===null||e===void 0)&&e.pos&&(this.transform.pos=T(this.x,t))}get z(){var t;return(t=this.transform.z)!==null&&t!==void 0?t:0}set z(t){this.transform&&(this.transform.z=t)}get rotation(){var t,e;return(e=(t=this.transform)===null||t===void 0?void 0:t.rotation)!==null&&e!==void 0?e:0}set rotation(t){this.transform&&(this.transform.rotation=t)}get scale(){var t,e;return(e=(t=this.transform)===null||t===void 0?void 0:t.scale)!==null&&e!==void 0?e:E.One}set scale(t){var e;!((e=this.transform)===null||e===void 0)&&e.scale&&(this.transform.scale=t)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get vel(){return this._motion.vel}set vel(t){this._motion.vel=t}get width(){return this.tileWidth*this.columns*this.scale.x}get height(){return this.tileHeight*this.rows*this.scale.y}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}constructor(t){var e,i,s;super([],t.name),this.events=new Nt,this._token=0,this.logger=lt.getInstance(),this.tiles=[],this._rows=[],this._cols=[],this.renderFromTopOfGraphic=!1,this.meshingLookBehind=10,this._collidersDirty=!0,this._oldRotation=0,this._originalOffsets=new WeakMap,this.meshingLookBehind=(e=t.meshingLookBehind)!==null&&e!==void 0?e:this.meshingLookBehind,this.addComponent(new tt),this.addComponent(new Dt),this.addComponent(new Bt({type:gt.Fixed})),this.addComponent(new Wt({onPostDraw:(o,a)=>this.draw(o,a)})),this.addComponent(new Dn((o,a)=>this.debug(o,a),!1)),this.addComponent(new ee),this.addComponent(new Ri),this.pointer=this.get(Ri),this._graphics=this.get(Wt),this.transform=this.get(tt),this._motion=this.get(Dt),this.collider=this.get(ee),this._composite=this.collider.useCompositeCollider([]),this.transform.pos=(i=t.pos)!==null&&i!==void 0?i:E.Zero,this._oldPos=this.transform.pos.clone(),this._oldScale=this.transform.scale.clone(),this.renderFromTopOfGraphic=(s=t.renderFromTopOfGraphic)!==null&&s!==void 0?s:this.renderFromTopOfGraphic,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.rows=t.rows,this.columns=t.columns,this._pointerEventDispatcher=new Ta,this.tiles=new Array(this.rows*this.columns),this._rows=new Array(this.rows),this._cols=new Array(this.columns);let r=[];for(let o=0;o<this.columns;o++){for(let a=0;a<this.rows;a++){const h=new Il({x:o,y:a,map:this});h.map=this,this.tiles[o+a*this.columns]=h,this._pointerEventDispatcher.addObject(h,l=>h.bounds.contains(l.worldPos),()=>!0),r.push(h),this._rows[a]||(this._rows[a]=[]),this._rows[a].push(h)}this._cols[o]=r,r=[]}this._graphics.localBounds=new ht({left:0,top:0,right:this.columns*this.tileWidth*this.scale.x,bottom:this.rows*this.tileHeight*this.scale.y})}_initialize(t){super._initialize(t),this._engine=t}_getOrSetColliderOriginalOffset(t){var e;if(this._originalOffsets.has(t))return(e=this._originalOffsets.get(t))!==null&&e!==void 0?e:E.Zero;{const i=t.offset;return this._originalOffsets.set(t,i),i}}_updateColliders(){this.collider.$colliderRemoved.notifyAll(this._composite),this._composite.clearColliders();const t=[];this._composite=this.collider.useCompositeCollider([]);let e=null;const i=(r,o)=>r&&o?r.top===o.top&&r.bottom===o.bottom&&r.right===o.left:!1,s=(r,o,a=this.meshingLookBehind)=>{if(!r)return!1;for(let h=o.length-1;h>=0;h--){if(a--<0)return!1;const l=o[h];if(i(l,r))return o[h]=l.combine(r),!0}return!1};for(let r=0;r<this.columns;r++){for(let o=0;o<this.rows;o++){const a=this.tiles[r+o*this.columns];if(a.solid)if(a.getColliders().length>0){for(const h of a.getColliders()){const l=this._getOrSetColliderOriginalOffset(h);h.offset=T(a.x*this.tileWidth*this.scale.x,a.y*this.tileHeight*this.scale.y).add(l),h.owner=this,this._composite.addCollider(h)}e&&!s(e,t)&&t.push(e),e=null}else e?e=e.combine(a.defaultGeometry):e=a.defaultGeometry;else e&&!s(e,t)&&t.push(e),e=null}e&&!s(e,t)&&t.push(e),e=null}for(const r of t){const o=pe.Box(r.width,r.height,E.Zero,T(r.left-this.pos.x,r.top-this.pos.y));o.owner=this,this._composite.addCollider(o)}this.collider.update(),this.collider.$colliderAdded.notifyAll(this._composite)}getTileByIndex(t){var e;return(e=this.tiles[t])!==null&&e!==void 0?e:null}getTile(t,e){return t<0||e<0||t>=this.columns||e>=this.rows?null:this.tiles[t+e*this.columns]}getTileByPoint(t){const{x:e,y:i}=this._getTileCoordinates(t),s=this.getTile(e,i);return e>=0&&i>=0&&e<this.columns&&i<this.rows&&s?s:null}_getTileCoordinates(t){t=this.transform.applyInverse(t);const e=Math.floor(t.x/this.tileWidth),i=Math.floor(t.y/this.tileHeight);return{x:e,y:i}}getRows(){return this._rows}getColumns(){return this._cols}getOnScreenTiles(){let t=this._engine.screen.getWorldBounds();const e=this.get(Pn);if(e&&this.isInitialized){let u=this.pos;const p=E.One.sub(e.parallaxFactor),v=this._engine.currentScene.camera.pos.scale(p);u=u.sub(v),t=t.translate(u)}const i=this.transform.coordPlane===Ae.Screen?this._engine.screen.getScreenBounds():t,s=this._getTileCoordinates(i.topLeft),r=this._getTileCoordinates(i.topRight),o=this._getTileCoordinates(i.bottomRight),a=this._getTileCoordinates(i.bottomLeft),h=Math.min(It(s.x,0,this.columns-1),It(r.x,0,this.columns-1)),l=Math.min(It(s.y,0,this.rows-1),It(r.y,0,this.rows-1)),c=Math.max(It(o.x,0,this.columns-1),It(a.x,0,this.columns-1)),d=Math.max(It(o.y,0,this.rows-1),It(a.y,0,this.rows-1)),A=[];for(let u=h;u<=c;u++)for(let p=l;p<=d;p++)A.push(this.getTile(u,p));return A}_processPointerToObject(t){this._pointerEventDispatcher.processPointerToObject(t,this.tiles)}_dispatchPointerEvents(t){this._pointerEventDispatcher.dispatchEvents(t,this.tiles)}update(t,e){this._initialize(t),this.onPreUpdate(t,e),this.emit("preupdate",new Ni(t,e,this)),(!this._oldPos.equals(this.pos)||this._oldRotation!==this.rotation||!this._oldScale.equals(this.scale))&&(this.flagCollidersDirty(),this.flagTilesDirty()),this._collidersDirty&&(this._collidersDirty=!1,this._updateColliders()),this._pointerEventDispatcher.clear(),this._token++,this.pos.clone(this._oldPos),this._oldRotation=this.rotation,this.scale.clone(this._oldScale),this.transform.pos=this.pos,this.onPostUpdate(t,e),this.emit("postupdate",new zi(t,e,this))}draw(t,e){if(!this.isInitialized)return;this.emit("predraw",new Ms(t,e,this));let i,s,r;const o=this.getOnScreenTiles();for(let a=0;a<o.length;a++){const h=o[a],l=h.getGraphicsOffsets();for(i=h.getGraphics(),s=0,r=i.length;s<r;s++){const c=i[s],d=l[s];if(c){Vo(c)&&c?.tick(e,this._token);const A=this.renderFromTopOfGraphic?0:c.height-this.tileHeight;c.draw(t,h.x*this.tileWidth+d.x,h.y*this.tileHeight-A+d.y)}}}this.emit("postdraw",new Ls(t,e,this))}debug(t,e){const{showAll:i,showGrid:s,gridColor:r,gridWidth:o,showSolidBounds:a,solidBoundsColor:h,showColliderGeometry:l}=e.tilemap,{geometryColor:c,geometryLineWidth:d,geometryPointSize:A}=e.collider,u=this.tileWidth*this.columns*this.scale.x,p=this.tileHeight*this.rows*this.scale.y,v=this.pos;if(s||i){for(let C=0;C<this.rows+1;C++){const y=T(0,C*this.tileHeight*this.scale.y);t.drawLine(v.add(y),v.add(T(u,y.y)),r,o)}for(let C=0;C<this.columns+1;C++){const y=T(C*this.tileWidth*this.scale.x,0);t.drawLine(v.add(y),v.add(T(y.x,p)),r,o)}}if(i||a||l){const C=this._composite.getColliders();t.save(),t.translate(this.pos.x,this.pos.y),t.scale(this.scale.x,this.scale.y);for(const y of C){const b=y.localBounds,P=y.worldPos.sub(this.pos);a&&t.drawRectangle(P,b.width,b.height,h)}if(t.restore(),l)for(const y of C)y.debug(t,c,{lineWidth:d,pointSize:A})}if(i||a){if(t.save(),t.z=999,a)for(let C=0;C<this.tiles.length;C++)this.tiles[C].bounds.draw(t);t.restore()}}}class Il{get pos(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._pos}get width(){return this._width}get height(){return this._height}get solid(){return this._solid}set solid(t){var e;(e=this.map)===null||e===void 0||e.flagCollidersDirty(),this._solid=t}getGraphics(){return this._graphics}getGraphicsOffsets(){return this._offsets}addGraphic(t,e){this._graphics.push(t),e?.offset?this._offsets.push(e.offset):this._offsets.push(E.Zero)}removeGraphic(t){const e=this._graphics.indexOf(t);e>-1&&(this._graphics.splice(e,1),this._offsets.splice(e,1))}clearGraphics(){this._graphics.length=0,this._offsets.length=0}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}constructor(t){var e,i;this._posDirty=!1,this.events=new Nt,this._solid=!1,this._graphics=[],this._offsets=[],this._colliders=[],this.data=new Map,this.x=t.x,this.y=t.y,this.map=t.map,this._width=t.map.tileWidth*this.map.scale.x,this._height=t.map.tileHeight*this.map.scale.y,this.solid=(e=t.solid)!==null&&e!==void 0?e:this.solid,this._graphics=(i=t.graphics)!==null&&i!==void 0?i:[],this._recalculate()}flagDirty(){return this._posDirty=!0}_recalculate(){const t=this.map.pos.add(T(this.x*this.map.tileWidth,this.y*this.map.tileHeight));this._geometry=new ht(t.x,t.y,t.x+this.map.tileWidth,t.y+this.map.tileHeight),this._width=this.map.tileWidth*this.map.scale.x,this._height=this.map.tileHeight*this.map.scale.y,this._pos=this.map.pos.add(T(this.x*this._width,this.y*this._height)),this._bounds=new ht(this._pos.x,this._pos.y,this._pos.x+this._width,this._pos.y+this._height),this.map.rotation&&(this._bounds=this._bounds.rotate(this.map.rotation,this.map.pos)),this._posDirty=!1}get bounds(){return this._posDirty&&this._recalculate(),this._bounds}get defaultGeometry(){return this._geometry}get center(){return this._posDirty&&this._recalculate(),new E(this._pos.x+this._width/2,this._pos.y+this._height/2)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){e?this.events.off(t,e):this.events.off(t)}}class El{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new Bl(t))}lockToActorAxis(t,e){this.camera.addStrategy(new Sl(t,e))}elasticToActor(t,e,i){this.camera.addStrategy(new Tl(t,e,i))}radiusAroundActor(t,e){this.camera.addStrategy(new Ql(t,e))}limitCameraBounds(t){this.camera.addStrategy(new Pl(t))}}var An;(function(n){n[n.X=0]="X",n[n.Y=1]="Y"})(An||(An={}));class Bl{constructor(t){this.target=t,this.action=(e,i,s,r)=>e.center}}class Sl{constructor(t,e){this.target=t,this.axis=e,this.action=(i,s,r,o)=>{const a=i.center,h=s.getFocus();return this.axis===An.X?new E(a.x,h.y):new E(h.x,a.y)}}}class Tl{constructor(t,e,i){this.target=t,this.cameraElasticity=e,this.cameraFriction=i,this.action=(s,r,o,a)=>{const h=s.center;let l=r.getFocus(),c=r.vel.clone();const d=h.sub(l).scale(this.cameraElasticity);c=c.add(d);const A=c.scale(-1).scale(this.cameraFriction);return c=c.add(A),l=l.add(c),l}}}class Ql{constructor(t,e){this.target=t,this.radius=e,this.action=(i,s,r,o)=>{const a=i.center,h=s.getFocus(),l=a.sub(h),c=l.magnitude;if(c>=this.radius){const d=c-this.radius;return h.add(l.normalize().scale(d))}return h}}}class Pl{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(e,i,s,r)=>{const o=i.getFocus();this.boundSizeChecked||((e.bottom-e.top<s.drawHeight||e.right-e.left<s.drawWidth)&&lt.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let a=o.x,h=o.y;return o.x<e.left+s.halfDrawWidth?a=e.left+s.halfDrawWidth:o.x>e.right-s.halfDrawWidth&&(a=e.right-s.halfDrawWidth),o.y<e.top+s.halfDrawHeight?h=e.top+s.halfDrawHeight:o.y>e.bottom-s.halfDrawHeight&&(h=e.bottom-s.halfDrawHeight),T(a,h)}}}const iu={Initialize:"initialize",PreUpdate:"preupdate",PostUpdate:"postupdate"};class Dl{constructor(){this.events=new Nt,this.transform=te.identity(),this.inverse=te.identity(),this._cameraStrategies=[],this.strategy=new El(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this._angularVelocity=0,this._posChanged=!1,this._pos=new Qi(E.Zero,()=>{this._posChanged=!0}),this.drawPos=this.pos.clone(),this._oldPos=this.pos.clone(),this.vel=E.Zero,this.acc=E.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=Mt.EaseInOutCubic,this._easing=Mt.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1,this._snapPos=T(0,0)}get zoom(){return this._z}set zoom(t){this._z=t,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this._angularVelocity}set angularVelocity(t){this._angularVelocity=t}get pos(){return this._pos}set pos(t){this._posChanged=!0,this._pos=new Qi(t,()=>{this._posChanged=!0})}hasChanged(){return this._posChanged}get x(){return this.pos.x}set x(t){!this._follow&&!this._cameraMoving&&(this.pos=T(t,this.pos.y))}get y(){return this.pos.y}set y(t){!this._follow&&!this._cameraMoving&&(this.pos=T(this.pos.x,t))}get dx(){return this.vel.x}set dx(t){this.vel=T(t,this.vel.y)}get dy(){return this.vel.y}set dy(t){this.vel=T(this.vel.x,t)}get ax(){return this.acc.x}set ax(t){this.acc=T(t,this.acc.y)}get ay(){return this.acc.y}set ay(t){this.acc=T(this.acc.x,t)}getFocus(){return this.pos}move(t,e,i=Mt.EaseInOutCubic){if(typeof i!="function")throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise(s=>{this._lerpResolve=s}),this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=i,this._lerpPromise)}shake(t,e,i){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=i}zoomOverTime(t,e=0,i=Mt.EaseInOutCubic){if(this._zoomPromise=new Promise(s=>{this._zoomResolve=s}),e)this._isZooming=!0,this._zoomEasing=i,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.zoom,this._zoomEnd=t;else return this._isZooming=!1,this.zoom=t,Promise.resolve(!0);return this._zoomPromise}get viewport(){return this._viewport?this._viewport:new ht(0,0,0,0)}addStrategy(t){this._cameraStrategies.push(t)}removeStrategy(t){ks(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,e){this.events.emit("preupdate",new Ni(t,e,this)),this.onPreUpdate(t,e)}onPreUpdate(t,e){}_postupdate(t,e){this.events.emit("postupdate",new zi(t,e,this)),this.onPostUpdate(t,e)}onPostUpdate(t,e){}get isInitialized(){return this._isInitialized}_initialize(t){if(!this.isInitialized){this._engine=t,this._screen=t.screen;const e=this._screen.contentArea;let i=T(e.width/2,e.height/2);if(!this._engine.loadingComplete){const s=this._screen.peekResolution();s&&(i=T(s.width/2,s.height/2))}this._halfWidth=i.x,this._halfHeight=i.y,this._posChanged||(this.pos=i),this.pos.clone(this.drawPos),this.updateTransform(this.pos),this.runStrategies(t,t.clock.elapsed()),this.updateViewport(),this.updateTransform(this.pos),this.pos.clone(this._oldPos),this.onInitialize(t),this.events.emit("initialize",new Us(t,this)),this._isInitialized=!0}}onInitialize(t){}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}runStrategies(t,e){for(const i of this._cameraStrategies)this.pos=i.action.call(i,i.target,this,t,e)}updateViewport(){this._viewport=new ht(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight)}update(t,e){if(this._initialize(t),this._preupdate(t,e),this.pos.clone(this._oldPos),this.pos=this.pos.add(this.vel.scale(e/1e3)),this.zoom+=this.dz*e/1e3,this.vel=this.vel.add(this.acc.scale(e/1e3)),this.dz+=this.az*e/1e3,this.rotation+=this.angularVelocity*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const i=this._zoomEasing,s=i(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=s,this._currentZoomTime+=e}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const s=Mt.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=s,this._currentLerpTime+=e}else{this.pos=this._lerpEnd;const i=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(i)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=(Math.random()*this._shakeMagnitudeX|0)+1,this._yShake=(Math.random()*this._shakeMagnitudeY|0)+1),this.runStrategies(t,e),this.updateViewport(),this.updateTransform(this.pos),this._postupdate(t,e),this._posChanged=!1}draw(t){if(this.pos.clone(this.drawPos),this._engine.fixedUpdateTimestep){const e=this._engine.currentFrameLagMs/this._engine.fixedUpdateTimestep,i=this.pos.scale(e).add(this._oldPos.scale(1-e));i.clone(this.drawPos),this.updateTransform(i)}if(t.snapToPixel){const e=this.drawPos.clone(this._snapPos);e.x=~~(e.x+yt*Lt(e.x)),e.y=~~(e.y+yt*Lt(e.y)),e.clone(this.drawPos),this.updateTransform(e)}t.multiply(this.transform)}updateTransform(t){const e=this._screen.resolution.width/this.zoom,i=this._screen.resolution.height/this.zoom,s=T(-t.x+e/2+this._xShake,-t.y+i/2+this._yShake);this.transform.reset(),this.transform.scale(this.zoom,this.zoom),this.transform.translate(e/2,i/2),this.transform.rotate(this.rotation),this.transform.translate(-e/2,-i/2),this.transform.translate(s.x,s.y),this.transform.inverse(this.inverse)}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}const su={ExitTrigger:"exit",EnterTrigger:"enter"};class kl extends ye{constructor(t){var e,i,s,r;super({...t}),this.events=new Nt,this.filter=(e=t.filter)!==null&&e!==void 0?e:()=>!0,this.repeat=(i=t.repeat)!==null&&i!==void 0?i:-1,this.action=(s=t.action)!==null&&s!==void 0?s:()=>{},this.target=t.target,this.graphics.isVisible=(r=t.visible)!==null&&r!==void 0?r:!1,this.body.collisionType=gt.Passive,this.events.on("collisionstart",({other:o})=>{this._matchesTarget(o.owner)&&(this.events.emit("enter",new pa(this,o.owner)),this._dispatchAction(o.owner),this.repeat===0&&this.kill())}),this.events.on("collisionend",({other:o})=>{this._matchesTarget(o.owner)&&this.events.emit("exit",new fa(this,o.owner))})}_matchesTarget(t){return this.filter(t)&&(this.target===void 0||this.target===t)}_dispatchAction(t){this.repeat!==0&&(this.action.call(this,t),this.repeat--)}}const ci={Highest:-1/0,Higher:-5,Average:0,Lower:5,Lowest:1/0};var Te;(function(n){n.Update="update",n.Draw="draw"})(Te||(Te={}));class Fe{}Fe.priority=ci.Average;class Fl{constructor(t){this._world=t,this.entities=[],this._entityIndex={},this._childAddedHandlerMap=new Map,this._childRemovedHandlerMap=new Map,this._createChildAddedHandler=()=>e=>{this.addEntity(e)},this._createChildRemovedHandler=()=>e=>{this.removeEntity(e,!1)},this._entitiesToRemove=[]}updateEntities(t,e){for(let i=0;i<this.entities.length;i++){const s=this.entities[i];s.update(t.engine,e),s.isActive||this.removeEntity(s)}}findEntitiesForRemoval(){for(let t=0;t<this.entities.length;t++){const e=this.entities[t];e.isActive||this.removeEntity(e)}}addEntity(t){if(t.isActive=!0,t.scene=this._world.scene,t&&!this._entityIndex[t.id]){this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.children.forEach(s=>{s.scene=t.scene,this.addEntity(s)});const e=this._createChildAddedHandler();this._childAddedHandlerMap.set(t,e);const i=this._createChildRemovedHandler();this._childRemovedHandlerMap.set(t,i),t.childrenAdded$.subscribe(e),t.childrenRemoved$.subscribe(i)}}removeEntity(t,e=!0){var i,s;let r=0;t instanceof _e?r=t.id:r=t;const o=this._entityIndex[r];if(o&&o.isActive&&(o.isActive=!1),o&&e){this._entitiesToRemove.push(o);return}if(delete this._entityIndex[r],o){o.scene=null,ks(o,this.entities),this._world.queryManager.removeEntity(o),o.children.forEach(l=>{l.scene=null,this.removeEntity(l,e)});const a=this._childAddedHandlerMap.get(o);a&&o.childrenAdded$.unsubscribe(a);const h=this._childRemovedHandlerMap.get(o);h&&o.childrenRemoved$.unsubscribe(h),!((s=(i=this._world)===null||i===void 0?void 0:i.scene)===null||s===void 0)&&s.engine&&this._world.scene.engine.stats.currFrame.actors.killed++}}processEntityRemovals(){for(let t=0;t<this._entitiesToRemove.length;t++){const e=this._entitiesToRemove[t];e.isActive||this.removeEntity(e,!1)}this._entitiesToRemove.length=0}processComponentRemovals(){for(let t=0;t<this.entities.length;t++)this.entities[t].processComponentRemoval()}getById(t){return this._entityIndex[t]}getByName(t){return this.entities.filter(e=>e.name===t)}clear(){for(let t=this.entities.length-1;t>=0;t--)this.removeEntity(this.entities[t])}}class sr{constructor(t){if(this.requiredComponents=t,this.components=new Set,this.entities=[],this.entityAdded$=new ve,this.entityRemoved$=new ve,t.length===0)throw new Error("Cannot create query without components");for(const e of t)this.components.add(e);this.id=sr.createId(t)}static createId(t){return t.slice().map(e=>e.name).sort().join("-")}checkAndAdd(t){return!this.entities.includes(t)&&t.hasAll(Array.from(this.components))?(this.entities.push(t),this.entityAdded$.notifyAll(t),!0):!1}removeEntity(t){const e=this.entities.indexOf(t);e>-1&&(this.entities.splice(e,1),this.entityRemoved$.notifyAll(t))}getEntities(t){return t&&this.entities.sort(t),this.entities}}class rr{constructor(t){if(this.requiredTags=t,this.tags=new Set,this.entities=[],this.entityAdded$=new ve,this.entityRemoved$=new ve,t.length===0)throw new Error("Cannot create tag query without tags");for(const e of t)this.tags.add(e);this.id=rr.createId(t)}static createId(t){return t.slice().sort().join("-")}checkAndAdd(t){return!this.entities.includes(t)&&t.hasAllTags(Array.from(this.tags))?(this.entities.push(t),this.entityAdded$.notifyAll(t),!0):!1}removeEntity(t){const e=this.entities.indexOf(t);e>-1&&(this.entities.splice(e,1),this.entityRemoved$.notifyAll(t))}getEntities(t){return t&&this.entities.sort(t),this.entities}}class Rl{constructor(t){this._world=t,this._queries=new Map,this._addComponentHandlers=new Map,this._removeComponentHandlers=new Map,this._componentToQueriesIndex=new Map,this._tagQueries=new Map,this._addTagHandlers=new Map,this._removeTagHandlers=new Map,this._tagToQueriesIndex=new Map,this._createAddComponentHandler=e=>i=>{this.addComponent(e,i)},this._createRemoveComponentHandler=e=>i=>{this.removeComponent(e,i)},this._createAddTagHandler=e=>i=>{this.addTag(e,i)},this._createRemoveTagHandler=e=>i=>{this.removeTag(e,i)}}createQuery(t){const e=sr.createId(t);if(this._queries.has(e))return this._queries.get(e);const i=new sr(t);this._queries.set(i.id,i);for(const s of t){const r=this._componentToQueriesIndex.get(s);r?r.push(i):this._componentToQueriesIndex.set(s,[i])}for(const s of this._world.entities)this.addEntity(s);return i}createTagQuery(t){const e=rr.createId(t);if(this._tagQueries.has(e))return this._tagQueries.get(e);const i=new rr(t);this._tagQueries.set(i.id,i);for(const s of t){const r=this._tagToQueriesIndex.get(s);r?r.push(i):this._tagToQueriesIndex.set(s,[i])}for(const s of this._world.entities)this.addEntity(s);return i}addEntity(t){const e=this._addComponentHandlers.get(t),i=this._removeComponentHandlers.get(t),s=e??this._createAddComponentHandler(t),r=i??this._createRemoveComponentHandler(t);this._addComponentHandlers.set(t,s),this._removeComponentHandlers.set(t,r);const o=this._addTagHandlers.get(t),a=this._removeTagHandlers.get(t),h=o??this._createAddTagHandler(t),l=a??this._createRemoveTagHandler(t);this._addTagHandlers.set(t,h),this._removeTagHandlers.set(t,l);for(const c of this._queries.values())c.checkAndAdd(t);for(const c of this._tagQueries.values())c.checkAndAdd(t);t.componentAdded$.subscribe(s),t.componentRemoved$.subscribe(r),t.tagAdded$.subscribe(h),t.tagRemoved$.subscribe(l)}removeEntity(t){const e=this._addComponentHandlers.get(t),i=this._removeComponentHandlers.get(t);for(const o of this._queries.values())o.removeEntity(t);e&&t.componentAdded$.unsubscribe(e),i&&t.componentRemoved$.unsubscribe(i);const s=this._addTagHandlers.get(t),r=this._removeTagHandlers.get(t);for(const o of this._tagQueries.values())o.removeEntity(t);s&&t.tagAdded$.unsubscribe(s),r&&t.tagRemoved$.unsubscribe(r)}addComponent(t,e){var i;const s=(i=this._componentToQueriesIndex.get(e.constructor))!==null&&i!==void 0?i:[];for(const r of s)r.checkAndAdd(t)}removeComponent(t,e){var i;const s=(i=this._componentToQueriesIndex.get(e.constructor))!==null&&i!==void 0?i:[];for(const r of s)r.removeEntity(t)}addTag(t,e){var i;const s=(i=this._tagToQueriesIndex.get(e))!==null&&i!==void 0?i:[];for(const r of s)r.checkAndAdd(t)}removeTag(t,e){var i;const s=(i=this._tagToQueriesIndex.get(e))!==null&&i!==void 0?i:[];for(const r of s)r.removeEntity(t)}}function Ml(n){var t,e;return!!n?.prototype&&!!(!((e=(t=n?.prototype)===null||t===void 0?void 0:t.constructor)===null||e===void 0)&&e.name)}class Ll{constructor(t){this._world=t,this.systems=[],this.initialized=!1}get(t){return this.systems.find(e=>e instanceof t)}addSystem(t){let e;t instanceof Fe?e=t:e=new t(this._world),this.systems.push(e),this.systems.sort((i,s)=>i.constructor.priority-s.constructor.priority),this.initialized&&e.initialize&&e.initialize(this._world,this._world.scene)}removeSystem(t){ks(t,this.systems)}initialize(){if(!this.initialized){this.initialized=!0;for(const t of this.systems)t.initialize&&t.initialize(this._world,this._world.scene)}}updateSystems(t,e,i){const s=this.systems.filter(r=>r.systemType===t);for(const r of s)r.preupdate&&r.preupdate(e,i);for(const r of s)r.update(i);for(const r of s)r.postupdate&&r.postupdate(e,i)}clear(){for(let t=this.systems.length-1;t>=0;t--)this.removeSystem(this.systems[t])}}class Ul{constructor(t){this.scene=t,this._logger=lt.getInstance(),this.queryManager=new Rl(this),this.entityManager=new Fl(this),this.systemManager=new Ll(this)}query(t){return this.queryManager.createQuery(t)}queryTags(t){return this.queryManager.createTagQuery(t)}update(t,e){t===Te.Update&&this.entityManager.updateEntities(this.scene,e),this.systemManager.updateSystems(t,this.scene,e),this.entityManager.findEntitiesForRemoval(),this.entityManager.processComponentRemovals(),this.entityManager.processEntityRemovals()}add(t){if(t instanceof _e){this.entityManager.addEntity(t);return}if(t instanceof Fe||Ml(t)){this.systemManager.addSystem(t);return}this._logger.warn(`Could not add entity/system ${t.constructor.name} to Excalibur!

If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.

Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`)}get(t){return this.systemManager.get(t)}remove(t,e=!0){if(t instanceof _e){this.entityManager.removeEntity(t,e);return}if(t instanceof Fe){this.systemManager.removeSystem(t);return}this._logger.warn(`Could not remove entity/system ${t.constructor.name} to Excalibur!

If this looks like an Excalibur type, this can be caused by 2 versions of excalibur being included on the page.

Check your bundler settings to make sure this is not the case! Excalibur has ESM & UMD bundles be sure one 1 is loaded.`)}get entities(){return this.entityManager.entities}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}class kn extends Fe{constructor(t,e){super(),this.world=t,this.physics=e,this.systemType=Te.Update,this._physicsConfigDirty=!1,e.$configUpdate.subscribe(()=>this._physicsConfigDirty=!0),this.query=this.world.query([tt,Dt])}update(t){let e,i;const s=this.query.entities,r=this.physics.config.substep;for(let o=0;o<s.length;o++){e=s[o].get(tt),i=s[o].get(Dt);const a=s[o].get(Bt);if(this._physicsConfigDirty&&a&&a.updatePhysicsConfig(this.physics.config.bodies),a?.isSleeping)continue;const h=i.acc.clone();a?.collisionType===gt.Active&&a?.useGravity&&h.addEqual(this.physics.config.gravity),s[o].parent||this.captureOldTransformWithChildren(s[o]),me.integrate(e,i,h,t/r)}this._physicsConfigDirty=!1}captureOldTransformWithChildren(t){var e;(e=t.get(Bt))===null||e===void 0||e.captureOldTransform();for(let i=0;i<t.children.length;i++)this.captureOldTransformWithChildren(t.children[i])}}kn.priority=ci.Higher;class wo{constructor(t){this.config=t,this.directionMap=new Map,this.distanceMap=new Map}solve(t){this.preSolve(t),t=t.filter(i=>!i.isCanceled());let e;switch(this.config.contactSolveBias){case Ii.HorizontalFirst:{e=Ia;break}case Ii.VerticalFirst:{e=ba;break}default:e=Ea}t.sort((i,s)=>{const r=this.directionMap.get(i.id),o=this.directionMap.get(s.id),a=this.distanceMap.get(i.id),h=this.distanceMap.get(s.id);return e[r]-e[o]||a-h});for(const i of t)this.solvePosition(i),this.solveVelocity(i);return this.postSolve(t),t}preSolve(t){for(let i=0;i<t.length;i++){const s=t[i];if(Math.abs(s.mtv.x)<1e-4&&Math.abs(s.mtv.y)<1e-4){s.cancel();continue}const r=Ft.fromDirection(s.mtv),o=s.mtv.negate(),a=Math.abs(s.info.separation);this.distanceMap.set(s.id,a),this.directionMap.set(s.id,r===Ft.Left||r===Ft.Right?"horizontal":"vertical"),s.colliderA.events.emit("precollision",new ss(s.colliderA,s.colliderB,r,o,s)),s.colliderB.events.emit("precollision",new ss(s.colliderB,s.colliderA,Ft.getOpposite(r),o.negate(),s))}}postSolve(t){var e,i;for(let s=0;s<t.length;s++){const r=t[s];if(r.isCanceled())continue;const o=r.colliderA,a=r.colliderB,h=(e=o.owner)===null||e===void 0?void 0:e.get(Bt),l=(i=a.owner)===null||i===void 0?void 0:i.get(Bt);if(h&&l&&(h.collisionType===gt.Passive||l.collisionType===gt.Passive))continue;const c=Ft.fromDirection(r.mtv),d=r.mtv.negate();r.colliderA.events.emit("postcollision",new rs(r.colliderA,r.colliderB,c,d,r)),r.colliderB.events.emit("postcollision",new rs(r.colliderB,r.colliderA,Ft.getOpposite(c),d.negate(),r))}}solvePosition(t){var e,i;if(!t.colliderA.bounds.overlaps(t.colliderB.bounds,1e-4)){t.cancel();return}if(Math.abs(t.mtv.x)<1e-4&&Math.abs(t.mtv.y)<1e-4){t.cancel();return}let r=t.mtv;const o=t.colliderA,a=t.colliderB,h=(e=o.owner)===null||e===void 0?void 0:e.get(Bt),l=(i=a.owner)===null||i===void 0?void 0:i.get(Bt);if(h&&l){if(h.collisionType===gt.Passive||l.collisionType===gt.Passive)return;h.collisionType===gt.Active&&l.collisionType===gt.Active&&(r=r.scale(.5)),h.collisionType===gt.Active&&(h.globalPos.x-=r.x,h.globalPos.y-=r.y,o.update(h.transform.get())),l.collisionType===gt.Active&&(l.globalPos.x+=r.x,l.globalPos.y+=r.y,a.update(l.transform.get()))}}solveVelocity(t){var e,i;if(t.isCanceled())return;const s=t.colliderA,r=t.colliderB,o=(e=s.owner)===null||e===void 0?void 0:e.get(Bt),a=(i=r.owner)===null||i===void 0?void 0:i.get(Bt);if(o&&a){if(o.collisionType===gt.Passive||a.collisionType===gt.Passive)return;const h=t.normal,l=h.negate();if(o.collisionType===gt.Active&&o.vel.normalize().dot(l)<0){const c=h.scale(h.dot(o.vel.negate()));o.vel=o.vel.add(c)}if(a.collisionType===gt.Active&&a.vel.normalize().dot(h)<0){const c=l.scale(l.dot(a.vel.negate()));a.vel=a.vel.add(c)}}}}class Gl{constructor(t,e,i){this.point=t,this.local=e,this.contact=i,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.aToContact=new E(0,0),this.bToContact=new E(0,0),this.originalVelocityAndRestitution=0,this.update()}update(){const t=this.contact.bodyA,e=this.contact.colliderA,i=this.contact.bodyB,s=this.contact.colliderB;if(t&&i){const r=this.contact.normal,o=this.contact.tangent;this.aToContact=this.point.sub(e.center),this.bToContact=this.point.sub(s.center);const a=this.aToContact.cross(r),h=this.bToContact.cross(r);this.normalMass=t.inverseMass+i.inverseMass+t.inverseInertia*a*a+i.inverseInertia*h*h;const l=this.aToContact.cross(o),c=this.bToContact.cross(o);this.tangentMass=t.inverseMass+i.inverseMass+t.inverseInertia*l*l+i.inverseInertia*c*c}return this}getRelativeVelocity(){const t=this.contact.bodyA,e=this.contact.bodyB;if(t&&e){const i=t.vel.add(E.cross(t.angularVelocity,this.aToContact));return e.vel.add(E.cross(e.angularVelocity,this.bToContact)).sub(i)}return E.Zero}}class yo{constructor(t){this.config=t,this.directionMap=new Map,this.distanceMap=new Map,this.lastFrameContacts=new Map,this.idToContactConstraint=new Map}getContactConstraints(t){var e;return(e=this.idToContactConstraint.get(t))!==null&&e!==void 0?e:[]}solve(t){this.preSolve(t),t=t.filter(i=>!i.isCanceled());let e;switch(this.config.contactSolveBias){case Ii.HorizontalFirst:{e=Ia;break}case Ii.VerticalFirst:{e=ba;break}default:e=Ea}return t.sort((i,s)=>{const r=this.directionMap.get(i.id),o=this.directionMap.get(s.id),a=this.distanceMap.get(i.id),h=this.distanceMap.get(s.id);return e[r]-e[o]||a-h}),this.solveVelocity(t),this.solvePosition(t),this.postSolve(t),t}preSolve(t){var e,i,s,r;for(let h=0;h<t.length;h++){const l=t[h];if(Math.abs(l.mtv.x)<1e-4&&Math.abs(l.mtv.y)<1e-4){l.cancel();continue}const c=Ft.fromDirection(l.mtv),d=Math.abs(((e=l?.info)===null||e===void 0?void 0:e.separation)||0);this.distanceMap.set(l.id,d),this.directionMap.set(l.id,c===Ft.Left||c===Ft.Right?"horizontal":"vertical"),l.colliderA.events.emit("precollision",new ss(l.colliderA,l.colliderB,c,l.mtv,l)),l.colliderA.events.emit("beforecollisionresolve",new ln(l.colliderA,l.colliderB,c,l.mtv,l)),l.colliderB.events.emit("precollision",new ss(l.colliderB,l.colliderA,Ft.getOpposite(c),l.mtv.negate(),l)),l.colliderB.events.emit("beforecollisionresolve",new ln(l.colliderB,l.colliderA,Ft.getOpposite(c),l.mtv.negate(),l)),l.matchAwake()}const a=Array.from(this.idToContactConstraint.keys());for(let h=0;h<t.length;h++){const l=t[h],c=a.indexOf(l.id);c>-1&&a.splice(c,1);const d=(i=this.idToContactConstraint.get(l.id))!==null&&i!==void 0?i:[];let A=0;const u=l.bodyA,p=l.colliderA,v=l.bodyB,C=l.colliderB;if(u&&v)for(let y=0;y<l.points.length;y++){const b=l.points[y],P=l.normal,I=l.tangent,Q=b.sub(p.center),O=b.sub(C.center),B=Q.cross(P),j=O.cross(P),$=u.inverseMass+v.inverseMass+u.inverseInertia*B*B+v.inverseInertia*j*j,st=Q.cross(I),Z=O.cross(I),S=u.inverseMass+v.inverseMass+u.inverseInertia*st*st+v.inverseInertia*Z*Z;d[A]&&((r=(s=d[A])===null||s===void 0?void 0:s.point)===null||r===void 0?void 0:r.squareDistance(b))<4?(d[A].point=b,d[A].local=l.localPoints[A]):d[A]=new Gl(b,l.localPoints[A],l),d[A].aToContact=Q,d[A].bToContact=O,d[A].normalMass=1/$,d[A].tangentMass=1/S;const z=u.bounciness>v.bounciness?u.bounciness:v.bounciness,f=l.normal.dot(d[A].getRelativeVelocity());d[A].originalVelocityAndRestitution=0,f<-.1&&(d[A].originalVelocityAndRestitution=-z*f),A++}this.idToContactConstraint.set(l.id,d)}for(const h of a)this.idToContactConstraint.delete(h);if(this.config.warmStart)this.warmStart(t);else for(let h=0;h<t.length;h++){const l=t[h],c=this.getContactConstraints(l.id);for(const d of c)d.normalImpulse=0,d.tangentImpulse=0}}postSolve(t){for(let e=0;e<t.length;e++){const i=t[e],s=i.bodyA,r=i.bodyB;if(s&&r){if(s.collisionType===gt.Passive||r.collisionType===gt.Passive)continue;s.updateMotion(),r.updateMotion()}const o=Ft.fromDirection(i.mtv);i.colliderA.events.emit("postcollision",new rs(i.colliderA,i.colliderB,o,i.mtv,i)),i.colliderA.events.emit("aftercollisionresolve",new cn(i.colliderA,i.colliderB,o,i.mtv,i)),i.colliderB.events.emit("postcollision",new rs(i.colliderB,i.colliderA,Ft.getOpposite(o),i.mtv.negate(),i)),i.colliderB.events.emit("aftercollisionresolve",new cn(i.colliderB,i.colliderA,Ft.getOpposite(o),i.mtv.negate(),i))}this.lastFrameContacts.clear();for(let e=0;e<t.length;e++){const i=t[e];this.lastFrameContacts.set(i.id,i)}}warmStart(t){var e;for(let i=0;i<t.length;i++){const s=t[i],r=s.bodyA,o=s.bodyB;if(r&&o){const a=(e=this.idToContactConstraint.get(s.id))!==null&&e!==void 0?e:[];for(const h of a)if(this.config.warmStart){const l=s.normal.scale(h.normalImpulse),c=s.tangent.scale(h.tangentImpulse),d=l.add(c);r.applyImpulse(h.point,d.negate()),o.applyImpulse(h.point,d)}else h.normalImpulse=0,h.tangentImpulse=0}}}solvePosition(t){var e;for(let i=0;i<this.config.positionIterations;i++)for(let s=0;s<t.length;s++){const r=t[s],o=r.bodyA,a=r.bodyB;if(o&&a){if(o.collisionType===gt.Passive||a.collisionType===gt.Passive)continue;const h=(e=this.idToContactConstraint.get(r.id))!==null&&e!==void 0?e:[];for(const l of h){const c=r.normal,d=je.FindContactSeparation(r,l.local),A=this.config.steeringFactor,u=-5,p=this.config.slop,v=It(A*(d+p),u,0),C=c.scale(-v*l.normalMass);if(o.collisionType===gt.Active){const y=C.negate().scale(o.inverseMass);o.limitDegreeOfFreedom.includes(be.X)&&(y.x=0),o.limitDegreeOfFreedom.includes(be.Y)&&(y.y=0),o.globalPos=o.globalPos.add(y),o.limitDegreeOfFreedom.includes(be.Rotation)||(o.rotation-=l.aToContact.cross(C)*o.inverseInertia)}if(a.collisionType===gt.Active){const y=C.scale(a.inverseMass);a.limitDegreeOfFreedom.includes(be.X)&&(y.x=0),a.limitDegreeOfFreedom.includes(be.Y)&&(y.y=0),a.globalPos=a.globalPos.add(y),a.limitDegreeOfFreedom.includes(be.Rotation)||(a.rotation+=l.bToContact.cross(C)*a.inverseInertia)}}}}}solveVelocity(t){var e;for(let i=0;i<this.config.velocityIterations;i++)for(let s=0;s<t.length;s++){const r=t[s],o=r.bodyA,a=r.bodyB;if(o&&a){if(o.collisionType===gt.Passive||a.collisionType===gt.Passive)continue;const h=Math.min(o.friction,a.friction),l=(e=this.idToContactConstraint.get(r.id))!==null&&e!==void 0?e:[];for(const c of l){let u=-c.getRelativeVelocity().dot(r.tangent)*c.tangentMass;const p=h*c.normalImpulse,v=It(c.tangentImpulse+u,-p,p);u=v-c.tangentImpulse,c.tangentImpulse=v;const C=r.tangent.scale(u);o.applyImpulse(c.point,C.negate()),a.applyImpulse(c.point,C)}for(const c of l){const A=c.getRelativeVelocity().dot(r.normal);let u=-c.normalMass*(A-c.originalVelocityAndRestitution);const p=Math.max(c.normalImpulse+u,0);u=p-c.normalImpulse,c.normalImpulse=p;const v=r.normal.scale(u);o.applyImpulse(c.point,v.negate()),a.applyImpulse(c.point,v)}}}}}class Fn extends Fe{get _processor(){return this._physics.collisionProcessor}constructor(t,e){super(),this._physics=e,this.systemType=Te.Update,this._configDirty=!1,this._lastFrameContacts=new Map,this._currentFrameContacts=new Map,this._arcadeSolver=new wo(e.config.arcade),this._realisticSolver=new yo(e.config.realistic),this._physics.$configUpdate.subscribe(()=>this._configDirty=!0),this._trackCollider=i=>this._processor.track(i),this._untrackCollider=i=>this._processor.untrack(i),this.query=t.query([tt,Dt,ee]),this.query.entityAdded$.subscribe(i=>{const s=i.get(ee);s.$colliderAdded.subscribe(this._trackCollider),s.$colliderRemoved.subscribe(this._untrackCollider);const r=s.get();r&&this._processor.track(r)}),this.query.entityRemoved$.subscribe(i=>{const s=i.get(ee),r=s.get();s&&r&&this._processor.untrack(r)}),this._motionSystem=t.get(kn)}initialize(t,e){this._engine=e.engine}update(t){var e,i,s,r;if(!this._physics.config.enabled)return;let o=[];for(let d=0;d<this.query.entities.length;d++){const u=this.query.entities[d].get(ee),p=u?.get();if(u&&(!((e=u.owner)===null||e===void 0)&&e.isActive)&&p)if(u.update(),p instanceof he){const v=p.getColliders();p.compositeStrategy||(p.compositeStrategy=this._physics.config.colliders.compositeStrategy),o=o.concat(v)}else o.push(p)}this._processor.update(o,t);let a=this._processor.broadphase(o,t);this._currentFrameContacts.clear();let h=[];const l=this.getSolver(),c=this._physics.config.substep;for(let d=0;d<c;d++)if(d>0&&this._motionSystem.update(t),h.length&&(a=h.map(A=>new we(A.colliderA,A.colliderB))),a.length){h=this._processor.narrowphase(a,(r=(s=(i=this._engine)===null||i===void 0?void 0:i.debug)===null||s===void 0?void 0:s.stats)===null||r===void 0?void 0:r.currFrame),h=l.solve(h);for(const A of h){if(A.isCanceled())continue;const u=A.id.indexOf("|");if(u>0){const p=A.id.substring(u+1);this._currentFrameContacts.set(p,A)}else this._currentFrameContacts.set(A.id,A)}}this.runContactStartEnd(),this._lastFrameContacts.clear(),this._lastFrameContacts=new Map(this._currentFrameContacts);for(const d of this.query.entities){const A=d.get(ee);A&&A.processColliderRemoval()}}postupdate(){Kt.SeparationPool.done()}getSolver(){return this._configDirty&&(this._configDirty=!1,this._arcadeSolver=new wo(this._physics.config.arcade),this._realisticSolver=new yo(this._physics.config.realistic)),this._physics.config.solver===ir.Realistic?this._realisticSolver:this._arcadeSolver}debug(t){this._processor.debug(t,0)}runContactStartEnd(){for(const[t,e]of this._currentFrameContacts)if(!this._lastFrameContacts.has(t)){const i=e.colliderA,s=e.colliderB,r=Ft.fromDirection(e.mtv),o=Ft.getOpposite(r);i.events.emit("collisionstart",new Ks(i,s,r,e)),i.events.emit("contactstart",new an(i,s,r,e)),s.events.emit("collisionstart",new Ks(s,i,o,e)),s.events.emit("contactstart",new an(s,i,o,e))}for(const[t,e]of this._lastFrameContacts)if(!this._currentFrameContacts.has(t)){const i=e.colliderA,s=e.colliderB,r=Ft.fromDirection(e.mtv),o=Ft.getOpposite(r);i.events.emit("collisionend",new $s(i,s,r,e)),i.events.emit("contactend",new hn(i,s,r,e)),s.events.emit("collisionend",new $s(s,i,o,e)),s.events.emit("contactend",new hn(s,i,o,e))}}}Fn.priority=ci.Higher;function ru(n,t,e,i){if(n.parent!==t.parent){const c=n.clone(),d=n.globalPos.clone(),A=n.globalScale.clone(),u=n.globalRotation;c.parent=t.parent,c.globalPos=d,c.globalScale=A,c.globalRotation=u,n=c}let s=t.pos,r=t.scale,o=t.rotation;s=t.pos.scale(e).add(n.pos.scale(1-e)),r=t.scale.scale(e).add(n.scale.scale(1-e));const a=(1-e)*Math.cos(n.rotation)+e*Math.cos(t.rotation),h=(1-e)*Math.sin(n.rotation)+e*Math.sin(t.rotation);o=Math.atan2(h,a);const l=i??new xi;return l.setTransform(s,o,r),l}class Qa extends Fe{get sortedTransforms(){return this._sortedTransforms}constructor(t){super(),this.world=t,this.systemType=Te.Draw,this._token=0,this._sortedTransforms=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this._targetInterpolationTransform=new xi,this.query=this.world.query([tt,Wt]),this.query.entityAdded$.subscribe(e=>{const i=e.get(tt);this._sortedTransforms.push(i),i.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(e=>{const i=e.get(tt);i.zIndexChanged$.unsubscribe(this._zIndexUpdate);const s=this._sortedTransforms.indexOf(i);s>-1&&this._sortedTransforms.splice(s,1)})}initialize(t,e){this._camera=e.camera,this._engine=e.engine}preupdate(){this._graphicsContext=this._engine.graphicsContext,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>t.globalZ-e.globalZ),this._zHasChanged=!1)}update(t){this._token++;let e;kt.checkAndClearCache(),this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext);for(let i=0;i<this._sortedTransforms.length;i++){const s=this._sortedTransforms[i],r=s.owner;if(r.hasTag("ex.offscreen")||(e=r.get(Wt),!e.isVisible))continue;e.onPreTransformDraw&&e.onPreTransformDraw(this._graphicsContext,t),r.events.emit("pretransformdraw",new $o(this._graphicsContext,t,r)),s.coordPlane===Ae.Screen&&this._graphicsContext.restore(),this._graphicsContext.save(),s.coordPlane===Ae.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),e.update(t,this._token);const o=r.get(Pn);if(o){const a=E.One.sub(o.parallaxFactor),h=this._camera.drawPos.scale(a);this._graphicsContext.translate(h.x,h.y)}this._applyTransform(r),e.material&&(this._graphicsContext.material=e.material),e.onPreDraw&&e.onPreDraw(this._graphicsContext,t),r.events.emit("predraw",new Ms(this._graphicsContext,t,r)),this._applyOpacity(r),this._drawGraphicsComponent(e,s),e.onPostDraw&&e.onPostDraw(this._graphicsContext,t),r.events.emit("postdraw",new Ls(this._graphicsContext,t,r)),this._graphicsContext.restore(),s.coordPlane===Ae.Screen&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext)),e.onPostTransformDraw&&e.onPostTransformDraw(this._graphicsContext,t),r.events.emit("posttransformdraw",new ta(this._graphicsContext,t,r))}this._graphicsContext.restore()}_drawGraphicsComponent(t,e){var i,s;if(t.isVisible){const r=t.flipHorizontal,o=t.flipVertical,a=t.current,h=(i=t.currentOptions)!==null&&i!==void 0?i:{};if(a){let l=t.anchor,c=t.offset,d=1,A=1;h?.anchor&&(l=h.anchor),h?.offset&&(c=h.offset);const u=e.globalScale;d*=a.scale.x*u.x,A*=a.scale.y*u.y;const p=-a.width*l.x+c.x*d,v=-a.height*l.y+c.y*A,C=a.flipHorizontal,y=a.flipVertical;if((r||o)&&(a.flipHorizontal=r?!C:C,a.flipVertical=o?!y:y),a?.draw(this._graphicsContext,p,v),(r||o)&&(a.flipHorizontal=C,a.flipVertical=y),!((s=this._engine)===null||s===void 0)&&s.isDebug&&this._engine.debug.graphics.showBounds){const b=T(p,v);if(a instanceof bs)for(const P of a.members){let I,Q=E.Zero;P instanceof qt?I=P:(I=P.graphic,Q=P.offset),a.useAnchor?I?.localBounds.translate(b.add(Q)).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor):I?.localBounds.translate(Q).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}else a?.localBounds.translate(b).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}}}}_applyTransform(t){const e=t.getAncestors();for(let i=0;i<e.length;i++){const s=e[i],r=s?.get(tt),o=s?.get(Bt);if(r){let a=r.get();if(o&&this._engine.fixedUpdateTimestep&&o.__oldTransformCaptured&&o.enableFixedUpdateInterpolate){const h=this._engine.currentFrameLagMs/this._engine.fixedUpdateTimestep;a=ru(o.oldTransform,r.get(),h,this._targetInterpolationTransform)}this._graphicsContext.z=r.globalZ,this._graphicsContext.translate(a.pos.x,a.pos.y),this._graphicsContext.scale(a.scale.x,a.scale.y),this._graphicsContext.rotate(a.rotation)}}}_applyOpacity(t){var e;const i=t.getAncestors();for(let s=0;s<i.length;s++){const r=i[s],o=r?.get(Wt);this._graphicsContext.opacity*=(e=o?.opacity)!==null&&e!==void 0?e:1}}}Qa.priority=ci.Average;class Pa extends Fe{constructor(t){super(),this.world=t,this.systemType=Te.Draw,this.query=this.world.query([tt])}initialize(t,e){this._graphicsContext=e.engine.graphicsContext,this._camera=e.camera,this._engine=e.engine,this._collisionSystem=t.systemManager.get(Fn)}update(){var t;if(!this._engine.isDebug)return;const e=this._engine.debug.filter;let i,s;const r=this._engine.debug.entity;let o;const a=this._engine.debug.transform;let h;const l=this._engine.debug.motion;let c;const d=this._engine.debug.collider,A=this._engine.debug.physics;let u;const p=this._engine.debug.graphics;let v,C;const y=this._engine.debug.body,b=this._engine.debug.camera;for(let P=0;P<this.query.entities.length;P++){const I=this.query.entities[P];if(I.hasTag("offscreen")||I instanceof Bn||e.useFilter&&(!(e.ids.length===0||e.ids.includes(I.id))||!(e.nameQuery===""||I.name.includes(e.nameQuery))))continue;let Q=E.Zero;const O=T(0,16);if(i=I.id,s=I.name,o=I.get(tt),this._pushCameraTransform(o),this._graphicsContext.save(),o.coordPlane===Ae.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=a.debugZIndex,this._applyTransform(I),o&&((a.showAll||a.showPosition)&&this._graphicsContext.debug.drawPoint(E.Zero,{size:4,color:a.positionColor}),(a.showAll||a.showPositionLabel)&&(this._graphicsContext.debug.drawText(`pos${o.pos.toString(2)}`,Q),Q=Q.add(O)),(a.showAll||a.showZIndex)&&(this._graphicsContext.debug.drawText(`z(${o.z.toFixed(1)})`,Q),Q=Q.add(O)),(r.showAll||r.showId)&&(this._graphicsContext.debug.drawText(`id(${i}) ${I.parent?"child of id("+((t=I.parent)===null||t===void 0?void 0:t.id)+")":""}`,Q),Q=Q.add(O)),(r.showAll||r.showName)&&(this._graphicsContext.debug.drawText(`name(${s})`,Q),Q=Q.add(O)),(a.showAll||a.showRotation)&&(this._graphicsContext.drawLine(E.Zero,E.fromAngle(o.rotation).scale(50).add(E.Zero),a.rotationColor,2),this._graphicsContext.debug.drawText(`rot deg(${Th(o.rotation).toFixed(2)})`,Q),Q=Q.add(O)),(a.showAll||a.showScale)&&this._graphicsContext.drawLine(E.Zero,o.scale.add(E.Zero),a.scaleColor,2)),u=I.get(Wt),u&&(p.showAll||p.showBounds)&&u.localBounds.draw(this._graphicsContext,p.boundsColor),v=I.get(Dn),v&&(v.useTransform||this._graphicsContext.restore(),v.draw(this._graphicsContext,this._engine.debug),v.useTransform||(this._graphicsContext.save(),this._applyTransform(I))),C=I.get(Bt),C&&((y.showAll||y.showCollisionGroup)&&(this._graphicsContext.debug.drawText(`collision group(${C.group.name})`,Q),Q=Q.add(O)),(y.showAll||y.showCollisionType)&&(this._graphicsContext.debug.drawText(`collision type(${C.collisionType})`,Q),Q=Q.add(O)),(y.showAll||y.showMass)&&(this._graphicsContext.debug.drawText(`mass(${C.mass})`,Q),Q=Q.add(O)),(y.showAll||y.showMotion)&&(this._graphicsContext.debug.drawText(`motion(${C.sleepMotion})`,Q),Q=Q.add(O)),(y.showAll||y.showSleeping)&&(this._graphicsContext.debug.drawText(`sleeping(${C.canSleep?C.isSleeping:"cant sleep"})`,Q),Q=Q.add(O))),this._graphicsContext.restore(),this._graphicsContext.save(),o.coordPlane===Ae.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=a.debugZIndex,h=I.get(Dt),h&&((l.showAll||l.showVelocity)&&(this._graphicsContext.debug.drawText(`vel${h.vel.toString(2)}`,Q.add(o.globalPos)),this._graphicsContext.drawLine(o.globalPos,o.globalPos.add(h.vel),l.velocityColor,2),Q=Q.add(O)),(l.showAll||l.showAcceleration)&&this._graphicsContext.drawLine(o.globalPos,o.globalPos.add(h.acc),l.accelerationColor,2)),c=I.get(ee),c){const B=c.get();if((d.showAll||d.showGeometry)&&B&&B.debug(this._graphicsContext,d.geometryColor,{lineWidth:d.geometryLineWidth,pointSize:d.geometryPointSize}),d.showAll||d.showBounds){if(B instanceof he){const j=B.getColliders();for(const $ of j){const st=$.bounds,Z=T(st.left,st.top);this._graphicsContext.debug.drawRect(Z.x,Z.y,st.width,st.height,{color:d.boundsColor}),(d.showAll||d.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${$.owner.id})`,Z)}c.bounds.draw(this._graphicsContext,d.boundsColor)}else if(B){const j=c.bounds,$=T(j.left,j.top);this._graphicsContext.debug.drawRect($.x,$.y,j.width,j.height,{color:d.boundsColor}),(d.showAll||d.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${c.owner.id})`,$)}}}this._graphicsContext.restore(),this._popCameraTransform(o)}if(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(A.showAll||A.showBroadphaseSpacePartitionDebug)&&this._collisionSystem.debug(this._graphicsContext),A.showAll||A.showCollisionContacts||A.showCollisionNormals)for(const[P,I]of this._engine.debug.stats.currFrame.physics.contacts){if(A.showAll||A.showCollisionContacts)for(const Q of I.points)this._graphicsContext.debug.drawPoint(Q,{size:A.contactSize,color:A.collisionContactColor});if(A.showAll||A.showCollisionNormals)for(const Q of I.points)this._graphicsContext.debug.drawLine(Q,I.normal.scale(30).add(Q),{color:A.collisionNormalColor})}this._graphicsContext.restore(),b&&(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(b.showAll||b.showFocus)&&this._graphicsContext.drawCircle(this._camera.pos,4,b.focusColor),(b.showAll||b.showZoom)&&this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`,this._camera.pos),this._graphicsContext.restore()),this._graphicsContext.flush()}postupdate(t,e){this._engine.isDebug&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext),ae.flush(this._graphicsContext),this._graphicsContext.restore())}_applyTransform(t){const e=t.getAncestors();for(const i of e){const s=i?.get(tt);s&&(this._graphicsContext.translate(s.pos.x,s.pos.y),this._graphicsContext.scale(s.scale.x,s.scale.y),this._graphicsContext.rotate(s.rotation))}}_pushCameraTransform(t){t.coordPlane===Ae.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(t){t.coordPlane===Ae.World&&this._graphicsContext.restore()}}Pa.priority=ci.Lowest;class Da{constructor(t,e){this.object=t,this.id=-1,this.cells=[],this.hasZeroBounds=!1,this.gridSize=e,this.bounds=t.bounds,this.hasZeroBounds=this.bounds.hasZeroDimensions(),this.leftX=Math.floor(this.bounds.left/this.gridSize),this.rightX=Math.floor(this.bounds.right/this.gridSize),this.bottomY=Math.floor(this.bounds.bottom/this.gridSize),this.topY=Math.floor(this.bounds.top/this.gridSize)}hasChanged(){const t=this.object.bounds,e=Math.floor(t.left/this.gridSize),i=Math.floor(t.right/this.gridSize),s=Math.floor(t.bottom/this.gridSize),r=Math.floor(t.top/this.gridSize);return this.leftX!==e||this.rightX!==i||this.bottomY!==s||this.topY!==r}clear(){for(const t of this.cells){const e=t.proxies.indexOf(this);e>-1&&t.proxies.splice(e,1)}}updateBounds(){this.bounds=this.object.bounds}update(){this.bounds=this.object.bounds,this.leftX=Math.floor(this.bounds.left/this.gridSize),this.rightX=Math.floor(this.bounds.right/this.gridSize),this.bottomY=Math.floor(this.bounds.bottom/this.gridSize),this.topY=Math.floor(this.bounds.top/this.gridSize),this.hasZeroBounds=this.object.bounds.hasZeroDimensions()}}class ei{constructor(){this.proxies=[]}configure(t,e){this.x=t,this.y=e,this.key=ei.calculateHashKey(t,e)}static calculateHashKey(t,e){return`${t}+${e}`}}class ka{constructor(t){this.bounds=new ht,this._hashGridCellPool=new Qr(()=>new ei,e=>(e.configure(0,0),e.proxies.length=0,e),1e3),this.gridSize=t.size,this.sparseHashGrid=new Map,this.objectToProxy=new Map,t.proxyFactory?this._buildProxy=e=>t.proxyFactory(e,this.gridSize):this._buildProxy=e=>new Da(e,this.gridSize)}query(t){const e=new Set;if(t instanceof ht){const i=t,s=Math.floor(i.left/this.gridSize),r=Math.floor(i.right/this.gridSize),o=Math.floor(i.bottom/this.gridSize),a=Math.floor(i.top/this.gridSize);for(let h=s;h<=r;h++)for(let l=a;l<=o;l++){const c=ei.calculateHashKey(h,l),d=this.sparseHashGrid.get(c);if(d)for(let A=0;A<d.proxies.length;A++)d.proxies[A].updateBounds(),d.proxies[A].bounds.intersect(i)&&e.add(d.proxies[A].object)}}else{const i=t,s=ei.calculateHashKey(Math.floor(i.x/this.gridSize),Math.floor(i.y/this.gridSize)),r=this.sparseHashGrid.get(s);if(r)for(let o=0;o<r.proxies.length;o++)r.proxies[o].updateBounds(),r.proxies[o].bounds.contains(i)&&e.add(r.proxies[o].object)}return Array.from(e)}get(t,e){const i=ei.calculateHashKey(t,e);return this.sparseHashGrid.get(i)}_insert(t,e,i){const s=ei.calculateHashKey(t,e);let r=this.sparseHashGrid.get(s);r||(r=this._hashGridCellPool.rent(),r.configure(t,e),this.sparseHashGrid.set(r.key,r)),r.proxies.push(i),i.cells.push(r),this.bounds.combine(i.bounds,this.bounds)}_remove(t,e,i){const s=ei.calculateHashKey(t,e),r=this.sparseHashGrid.get(s);if(r){const o=r.proxies.indexOf(i);o>-1&&r.proxies.splice(o,1);const a=i.cells.indexOf(r);a>-1&&i.cells.splice(a,1),r.proxies.length===0&&(this._hashGridCellPool.return(r),this.sparseHashGrid.delete(s))}}track(t){const e=this._buildProxy(t);this.objectToProxy.set(t,e);for(let i=e.leftX;i<=e.rightX;i++)for(let s=e.topY;s<=e.bottomY;s++)this._insert(i,s,e)}untrack(t){const e=this.objectToProxy.get(t);e&&(e.clear(),this.objectToProxy.delete(t))}update(t){let e=0;for(const i of t){const s=this.objectToProxy.get(i);if(s&&s.hasChanged()){for(let r=s.leftX;r<=s.rightX;r++)for(let o=s.topY;o<=s.bottomY;o++)this._remove(r,o,s);s.update();for(let r=s.leftX;r<=s.rightX;r++)for(let o=s.topY;o<=s.bottomY;o++)this._insert(r,o,s);e++}}return e}debug(t,e){const i=q.Transparent,s=q.White;for(const r of this.sparseHashGrid.values())t.drawRectangle(T(r.x*this.gridSize,r.y*this.gridSize),this.gridSize,this.gridSize,i,s,2)}}class Rn extends Fe{constructor(t){super(),this.world=t,this.systemType=Te.Update,this._graphicsHashGrid=new ka({size:100}),this._graphics=[],this._entityToPointer=new Map,this._pointerEventDispatcher=new Ta,this.overrideUseColliderShape=!1,this.overrideUseGraphicsBounds=!1,this._sortedTransforms=[],this._sortedEntities=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this.query=this.world.query([tt,Ri]),this.query.entityAdded$.subscribe(e=>{const i=e.get(tt),s=e.get(Ri);this._pointerEventDispatcher.addObject(e,o=>s&&s.localBounds?s.localBounds.transform(i.get().matrix).contains(i.coordPlane===Ae.World?o.worldPos:o.screenPos):!1,()=>e.isActive),this._entityToPointer.set(e,s);const r=e.get(Wt);r&&(this._graphics.push(r),this._graphicsHashGrid.track(r)),this._sortedTransforms.push(i),this._sortedEntities.push(i.owner),i.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(e=>{this._pointerEventDispatcher.removeObject(e);const i=e.get(tt);this._entityToPointer.delete(e);const s=e.get(Wt);if(s){const o=this._graphics.indexOf(s);o>-1&&this._graphics.splice(o,1),this._graphicsHashGrid.untrack(s)}i.zIndexChanged$.unsubscribe(this._zIndexUpdate);const r=this._sortedTransforms.indexOf(i);r>-1&&(this._sortedTransforms.splice(r,1),this._sortedEntities.splice(r,1))})}initialize(t,e){this._engine=e.engine,this._scene=e}preupdate(){this._scene.camera.hasChanged()&&this._scene.camera.updateTransform(this._scene.camera.pos),this._receivers=[this._engine.input.pointers,this._scene.input.pointers],this._engineReceiver=this._engine.input.pointers,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>e.z-t.z),this._sortedEntities=this._sortedTransforms.map(t=>t.owner),this._zHasChanged=!1)}update(){this._graphicsHashGrid.update(this._graphics);for(const[t,e]of this._engineReceiver.currentFramePointerCoords.entries()){const i=this._scene.physics.query(e.worldPos);for(let r=0;r<i.length;r++){const o=i[r],a=this._entityToPointer.get(o.owner);a&&(a.useColliderShape||this.overrideUseColliderShape)&&this._pointerEventDispatcher.addPointerToObject(o.owner,t)}const s=this._graphicsHashGrid.query(e.worldPos);for(let r=0;r<s.length;r++){const o=s[r],a=this._entityToPointer.get(o.owner);a&&(a.useGraphicsBounds||this.overrideUseGraphicsBounds)&&this._pointerEventDispatcher.addPointerToObject(o.owner,t)}}this._pointerEventDispatcher.processPointerToObject(this._engineReceiver,this._sortedEntities),this._pointerEventDispatcher.dispatchEvents(this._engineReceiver,this._sortedEntities),this._receivers.forEach(t=>t.update()),this._pointerEventDispatcher.clear(),this._receivers.forEach(t=>t.clear())}}Rn.priority=ci.Higher;class Fa extends Fe{constructor(t){super(),this.world=t,this.systemType=Te.Update,this._actions=[],this.query=this.world.query([ms]),this.query.entityAdded$.subscribe(e=>this._actions.push(e.get(ms))),this.query.entityRemoved$.subscribe(e=>{const i=e.get(ms),s=this._actions.indexOf(i);s>-1&&this._actions.splice(s,1)})}update(t){for(let e=0;e<this._actions.length;e++)this._actions[e].update(t)}}Fa.priority=ci.Higher;class nr extends Ue{constructor(t){super(),this.elevation=0,this.columns=t.columns,this.rows=t.rows,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight}}class Ra extends Fe{constructor(t){super(),this.world=t,this.systemType=Te.Update,this.query=this.world.query([tt,nr])}update(){let t,e;for(let i=0;i<this.query.entities.length;i++){const s=this.query.entities[i];t=s.get(tt),e=s.get(nr);const o=Math.max(e.columns*e.tileWidth,e.rows*e.tileHeight)*e.elevation+t.pos.y;t.z=o}}}Ra.priority=ci.Lower;class Ma extends Fe{constructor(t){super(),this.world=t,this.systemType=Te.Draw,this.query=this.world.query([tt,Wt])}initialize(t,e){this._camera=e.camera,this._screen=e.engine.screen}update(){this._worldBounds=this._screen.getWorldBounds();let t,e,i;for(let s=0;s<this.query.entities.length;s++){const r=this.query.entities[s];e=r.get(Wt),t=r.get(tt),i=r.get(Pn);let o;if(i){const h=E.One.sub(i.parallaxFactor);o=this._camera.pos.scale(h)}const a=this._isOffscreen(t,e,o);a&&!r.hasTag("ex.offscreen")&&(r.events.emit("exitviewport",new Aa(r)),r.addTag("ex.offscreen")),!a&&r.hasTag("ex.offscreen")&&(r.events.emit("enterviewport",new ga(r)),r.removeTag("ex.offscreen"))}}_isOffscreen(t,e,i){if(e.forceOnScreen)return!1;if(t.coordPlane===Ae.World){let s=e.localBounds;i&&(s=s.translate(i));const r=s.transform(t.get().matrix);return!this._worldBounds.overlaps(r)}else return!1}}Ma.priority=ci.Higher;class Nl extends Da{constructor(t,e){var i,s;super(t,e),this.collider=t,this.id=-1,this.hasZeroBounds=!1,this.cells=[],this.gridSize=e;const r=t.bounds;this.hasZeroBounds=r.hasZeroDimensions(),this.leftX=Math.floor(r.left/this.gridSize),this.rightX=Math.floor(r.right/this.gridSize),this.bottomY=Math.floor(r.bottom/this.gridSize),this.topY=Math.floor(r.top/this.gridSize),this.owner=t.owner,this.body=(i=this.owner)===null||i===void 0?void 0:i.get(Bt),this.collisionType=(s=this.body.collisionType)!==null&&s!==void 0?s:gt.PreventCollision}update(){var t,e;super.update(),this.body=(t=this.owner)===null||t===void 0?void 0:t.get(Bt),this.collisionType=(e=this.body.collisionType)!==null&&e!==void 0?e:gt.PreventCollision,this.hasZeroBounds=this.collider.localBounds.hasZeroDimensions()}}class Co{constructor(t){this._pairs=new Set,this._nonPairs=new Set,this._pairPool=new In(()=>new we({id:ts("collider",0)},{id:ts("collider",0)}),e=>(e.colliderA=null,e.colliderB=null,e),200),this.gridSize=t.size,this.hashGrid=new ka({size:this.gridSize,proxyFactory:(e,i)=>new Nl(e,i)}),this._pairPool.disableWarnings=!0}getColliders(){return Array.from(this.hashGrid.objectToProxy.keys())}query(t){return this.hashGrid.query(t)}rayCast(t,e){var i,s,r;const o=[],a=(i=e?.maxDistance)!==null&&i!==void 0?i:1/0,h=e?.collisionGroup,l=h?h.category:(s=e?.collisionMask)!==null&&s!==void 0?s:bi.All.category,c=(r=e?.searchAllColliders)!==null&&r!==void 0?r:!1,d=t.dir.normalize(),A=d.y/d.x,u=d.x/d.y,p=Math.sqrt(1+A*A)*this.gridSize,v=Math.sqrt(1+u*u)*this.gridSize,C=t.pos.x/this.gridSize,y=t.pos.y/this.gridSize,b=T(1,1);let P=~~C,I=~~y,Q=0,O=0;d.x<0?(b.x=-1,Q=(C-P)*p):(b.x=1,Q=(P+1-C)*p),d.y<0?(b.y=-1,O=(y-I)*v):(b.y=1,O=(I+1-y)*v);const B=new Set;let j=!1,$=9999;for(;!j&&$>0&&($--,!!this.hashGrid.bounds.contains(T(P*this.gridSize,I*this.gridSize)));){const st=ei.calculateHashKey(P,I),Z=this.hashGrid.sparseHashGrid.get(st);if(Z){const S=[];for(let z=0;z<Z.proxies.length;z++){const f=Z.proxies[z];if(!B.has(f.collider.id.value)){if(B.add(f.collider.id.value),e?.ignoreCollisionGroupAll&&f.body.group===bi.All)continue;const X=(l&f.body.group.category)!==0;if(f.body.group&&!X)continue;const ct=f.collider.rayCast(t,a);ct&&S.push(ct)}}S.sort((z,f)=>z.distance-f.distance);for(let z=0;z<S.length;z++){const f=S[z];if(e?.filter){if(e.filter(f)&&(o.push(f),!c)){j=!0;break}}else if(o.push(f),!c){j=!0;break}}}Q<O?(P+=b.x,Q+=p):(I+=b.y,O+=v)}return o.sort((st,Z)=>st.distance-Z.distance),!c&&o.length?[o[0]]:o}track(t){let e=[t];if(t instanceof he){const i=t.getColliders();for(const s of i)s.owner=t.owner;e=i}for(const i of e)this.hashGrid.track(i)}untrack(t){let e=[t];t instanceof he&&(e=t.getColliders());for(const i of e)this.hashGrid.untrack(i)}_canCollide(t,e){return!(t.collider.id===e.collider.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.hasZeroBounds||e.hasZeroBounds||!t.body.group.canCollide(e.body.group)||t.collisionType===gt.Fixed&&e.collisionType===gt.Fixed||t.collisionType===gt.PreventCollision||e.collisionType===gt.PreventCollision||!t.owner.isActive||!e.owner.isActive)}broadphase(t,e){const i=[];this._pairs.clear(),this._nonPairs.clear();let s=0;for(const r of this.hashGrid.objectToProxy.values())if(r.id=s++,!(!r.owner.isActive||r.collisionType===gt.PreventCollision))for(let o=0;o<r.cells.length;o++){const a=r.cells[o];for(let h=0;h<a.proxies.length;h++){const l=a.proxies[h];if(l.id===r.id)continue;const c=we.calculatePairHash(r.collider.id,l.collider.id);if(!this._nonPairs.has(c))if(!this._pairs.has(c)&&this._canCollide(r,l)&&r.object.bounds.overlaps(l.object.bounds)){const d=this._pairPool.get();d.colliderA=r.collider,d.colliderB=l.collider,d.id=c,this._pairs.add(c),i.push(d)}else this._nonPairs.add(c)}}return i}narrowphase(t,e){const i=[];for(let s=0;s<t.length;s++){const r=t[s].collide();for(let o=0;o<r.length;o++){const a=r[o];i.push(a),e&&e.physics.contacts.set(a.id,a)}}return this._pairPool.done(),e&&(e.physics.collisions+=i.length),i}update(t,e){return this.hashGrid.update(t)}debug(t,e){this.hashGrid.debug(t,e)}}class zl{get config(){return Kc(this._config,t=>{this.$configUpdate.notifyAll(t)})}set config(t){this._config=t,this.$configUpdate.notifyAll(t)}get collisionProcessor(){if(this._configDirty){this._configDirty=!1;const t=this._collisionProcessor.getColliders();this._config.spatialPartition===Is.SparseHashGrid?this._collisionProcessor=new Co(this._config.sparseHashGrid):this._collisionProcessor=new un(this._config);for(const e of t)this._collisionProcessor.track(e)}return this._collisionProcessor}constructor(t){this.$configUpdate=new ve,this._configDirty=!1,this.config=t,this.$configUpdate.subscribe(e=>{this._configDirty=!0,Bt.updateDefaultPhysicsConfig(e.bodies)}),this._config.spatialPartition===Is.SparseHashGrid?this._collisionProcessor=new Co(this._config.sparseHashGrid):this._collisionProcessor=new un(this._config)}rayCast(t,e){return this.collisionProcessor.rayCast(t,e)}query(t){return this._collisionProcessor.query(t)}}class Mn{constructor(){this.events=new Nt,this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null,this._enabled=!0}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}toggleEnabled(t){this._enabled=t}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;const e=t.axes.filter(s=>typeof s!==void 0).length,i=t.buttons.filter(s=>typeof s!==void 0).length;return e>=this._minimumConfiguration.axis&&i>=this._minimumConfiguration.buttons&&t.connected}emit(t,e){this.events.emit(t,e)}on(t,e){return this._enableAndUpdate(),this.events.on(t,e)}once(t,e){return this._enableAndUpdate(),this.events.once(t,e)}off(t,e){this._enableAndUpdate(),this.events.off(t,e)}update(){var t,e;if(!this.enabled||!this.supported||!this._enabled)return;this.init();const i=this._navigator.getGamepads();for(let s=0;s<i.length;s++){if(i[s]){const o=this.at(s);!this.at(s).connected&&this._isGamepadValid(i[s])&&(o.events.pipe(this.events),this.events.emit("connect",new na(s,this.at(s)))),this.at(s).connected=!0}else{const o=this.at(s);o.connected&&(this.events.emit("disconnect",new oa(s,o)),o.events.unpipe(this.events)),o.connected=!1;continue}if(this.at(s).update(),i[s].timestamp&&i[s].timestamp===this._gamePadTimeStamps[s])continue;this._gamePadTimeStamps[s]=i[s].timestamp,this.at(s).navigatorGamepad=i[s];const r=i[s];if(r){for(let o=0;o<r.buttons.length;o++){const a=r.buttons[o],h=a?.value;h!==((t=this._oldPads[s])===null||t===void 0?void 0:t.getButton(o))&&(a?.pressed?(this.at(s).updateButton(o,h),this.at(s).events.emit("button",new aa(o in or?o:or.Unknown,o,h,this.at(s)))):this.at(s).updateButton(o,0))}for(let o=0;o<r.axes.length;o++){const a=r.axes[o];a!==((e=this._oldPads[s])===null||e===void 0?void 0:e.getAxes(o))&&(this.at(s).updateAxes(o,a),this.at(s).events.emit("axis",new ha(o,a,this.at(s))))}}this._oldPads[s]=this._clonePad(i[s])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let e=this._pads.length-1,i=t;e<i;e++)this._pads.push(new Zr),this._oldPads.push(new Zr);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();const t=[];for(let e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t}count(){return this._pads.filter(t=>t.connected).length}_clonePads(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(this._clonePad(t[i]));return e}_clonePad(t){let e,i;const s=new Zr;if(!t)return s;for(e=0,i=t.buttons.length;e<i;e++)t.buttons[e]&&s.updateButton(e,t.buttons[e].value);for(e=0,i=t.axes.length;e<i;e++)s.updateAxes(e,t.axes[e]);return s}}Mn.MinAxisMoveThreshold=.05;class Zr{constructor(){this.events=new Nt,this.connected=!1,this._axes=new Array(4),this._buttons=new Array(16),this._buttonsUp=new Array(16),this._buttonsDown=new Array(16);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}update(){this._buttonsDown=new Array(16),this._buttonsUp=new Array(16)}isButtonPressed(t,e=1){return this._buttons[t]>=e}isButtonHeld(t,e=1){return this._buttons[t]>=e}wasButtonPressed(t,e=1){return this._buttonsDown[t]>=e}wasButtonReleased(t){return!!this._buttonsUp[t]}getButton(t){return this._buttons[t]}getAxes(t){const e=this._axes[t];return Math.abs(e)<Mn.MinAxisMoveThreshold?0:e}updateButton(t,e){e===0&&this._buttons[t]?this._buttonsUp[t]=1:this._buttonsDown[t]=e,this._buttons[t]=e}updateAxes(t,e){this._axes[t]=e}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}var or;(function(n){n[n.Unknown=-1]="Unknown",n[n.Face1=0]="Face1",n[n.Face2=1]="Face2",n[n.Face3=2]="Face3",n[n.Face4=3]="Face4",n[n.LeftBumper=4]="LeftBumper",n[n.RightBumper=5]="RightBumper",n[n.LeftTrigger=6]="LeftTrigger",n[n.RightTrigger=7]="RightTrigger",n[n.Select=8]="Select",n[n.Start=9]="Start",n[n.LeftStick=10]="LeftStick",n[n.RightStick=11]="RightStick",n[n.DpadUp=12]="DpadUp",n[n.DpadDown=13]="DpadDown",n[n.DpadLeft=14]="DpadLeft",n[n.DpadRight=15]="DpadRight",n[n.CenterButton=16]="CenterButton",n[n.MiscButton1=17]="MiscButton1"})(or||(or={}));var xo;(function(n){n[n.LeftStickX=0]="LeftStickX",n[n.LeftStickY=1]="LeftStickY",n[n.RightStickX=2]="RightStickX",n[n.RightStickY=3]="RightStickY"})(xo||(xo={}));class Ol{constructor(t){this.inputs=t,this._handlers=new Map}execute(){for(const[t,e]of this._handlers.entries()){const i=t(this.inputs);i&&e(i)}}on(t,e){this._handlers.set(t,e)}}function Hl(){try{const n=()=>{};window.top.addEventListener("blur",n),window.top.removeEventListener("blur",n)}catch{return!0}return!1}var ar;(function(n){n.Backquote="Backquote",n.Backslash="Backslash",n.BracketLeft="BracketLeft",n.BracketRight="BracketRight",n.Comma="Comma",n.Key0="Digit0",n.Key1="Digit1",n.Key2="Digit2",n.Key3="Digit3",n.Key4="Digit4",n.Key5="Digit5",n.Key6="Digit6",n.Key7="Digit7",n.Key8="Digit8",n.Key9="Digit9",n.Digit0="Digit0",n.Digit1="Digit1",n.Digit2="Digit2",n.Digit3="Digit3",n.Digit4="Digit4",n.Digit5="Digit5",n.Digit6="Digit6",n.Digit7="Digit7",n.Digit8="Digit8",n.Digit9="Digit9",n.Equal="Equal",n.IntlBackslash="IntlBackslash",n.IntlRo="IntlRo",n.IntlYen="IntlYen",n.A="KeyA",n.B="KeyB",n.C="KeyC",n.D="KeyD",n.E="KeyE",n.F="KeyF",n.G="KeyG",n.H="KeyH",n.I="KeyI",n.J="KeyJ",n.K="KeyK",n.L="KeyL",n.M="KeyM",n.N="KeyN",n.O="KeyO",n.P="KeyP",n.Q="KeyQ",n.R="KeyR",n.S="KeyS",n.T="KeyT",n.U="KeyU",n.V="KeyV",n.W="KeyW",n.X="KeyX",n.Y="KeyY",n.Z="KeyZ",n.KeyA="KeyA",n.KeyB="KeyB",n.KeyC="KeyC",n.KeyD="KeyD",n.KeyE="KeyE",n.KeyF="KeyF",n.KeyG="KeyG",n.KeyH="KeyH",n.KeyI="KeyI",n.KeyJ="KeyJ",n.KeyK="KeyK",n.KeyL="KeyL",n.KeyM="KeyM",n.KeyN="KeyN",n.KeyO="KeyO",n.KeyP="KeyP",n.KeyQ="KeyQ",n.KeyR="KeyR",n.KeyS="KeyS",n.KeyT="KeyT",n.KeyU="KeyU",n.KeyV="KeyV",n.KeyW="KeyW",n.KeyX="KeyX",n.KeyY="KeyY",n.KeyZ="KeyZ",n.Minus="Minus",n.Period="Period",n.Quote="Quote",n.Semicolon="Semicolon",n.Slash="Slash",n.AltLeft="AltLeft",n.AltRight="AltRight",n.Alt="Alt",n.AltGraph="AltGraph",n.Backspace="Backspace",n.CapsLock="CapsLock",n.ContextMenu="ContextMenu",n.ControlLeft="ControlLeft",n.ControlRight="ControlRight",n.Enter="Enter",n.MetaLeft="MetaLeft",n.MetaRight="MetaRight",n.ShiftLeft="ShiftLeft",n.ShiftRight="ShiftRight",n.Space="Space",n.Tab="Tab",n.Convert="Convert",n.KanaMode="KanaMode",n.NonConvert="NonConvert",n.Delete="Delete",n.End="End",n.Help="Help",n.Home="Home",n.Insert="Insert",n.PageDown="PageDown",n.PageUp="PageUp",n.Up="ArrowUp",n.Down="ArrowDown",n.Left="ArrowLeft",n.Right="ArrowRight",n.ArrowUp="ArrowUp",n.ArrowDown="ArrowDown",n.ArrowLeft="ArrowLeft",n.ArrowRight="ArrowRight",n.NumLock="NumLock",n.Numpad0="Numpad0",n.Numpad1="Numpad1",n.Numpad2="Numpad2",n.Numpad3="Numpad3",n.Numpad4="Numpad4",n.Numpad5="Numpad5",n.Numpad6="Numpad6",n.Numpad7="Numpad7",n.Numpad8="Numpad8",n.Numpad9="Numpad9",n.Num0="Numpad0",n.Num1="Numpad1",n.Num2="Numpad2",n.Num3="Numpad3",n.Num4="Numpad4",n.Num5="Numpad5",n.Num6="Numpad6",n.Num7="Numpad7",n.Num8="Numpad8",n.Num9="Numpad9",n.NumAdd="NumpadAdd",n.NumpadAdd="NumpadAdd",n.NumDecimal="NumpadDecimal",n.NumpadDecimal="NumpadDecimal",n.NumDivide="NumpadDivide",n.NumpadDivide="NumpadDivide",n.NumEnter="NumpadEnter",n.NumpadEnter="NumpadEnter",n.NumMultiply="NumpadMultiply",n.NumpadMultiply="NumpadMultiply",n.NumSubtract="NumpadSubtract",n.NumpadSubtract="NumpadSubtract",n.Esc="Escape",n.Escape="Escape",n.F1="F1",n.F2="F2",n.F3="F3",n.F4="F4",n.F5="F5",n.F6="F6",n.F7="F7",n.F8="F8",n.F9="F9",n.F10="F10",n.F11="F11",n.F12="F12",n.F13="F13",n.F14="F14",n.F15="F15",n.F16="F16",n.F17="F17",n.F18="F18",n.F19="F19",n.F20="F20",n.PrintScreen="PrintScreen",n.ScrollLock="ScrollLock",n.Pause="Pause",n.Unidentified="Unidentified"})(ar||(ar={}));class qs extends bt{constructor(t,e,i){super(),this.key=t,this.value=e,this.originalEvent=i}}class ql{constructor(){this.events=new Nt,this._enabled=!0,this._keys=[],this._keysUp=[],this._keysDown=[],this._releaseAllKeys=t=>{for(const e of this._keys){const i=new qs(e,t.key,t);this.events.emit("up",i),this.events.emit("release",i)}this._keysUp=Array.from(new Set(this._keys.concat(this._keysUp))),this._keys.length=0},this._handleKeyDown=t=>{if(!this._enabled)return;!t.metaKey&&(this._keys.includes(ar.MetaLeft)||this._keys.includes(ar.MetaRight))&&this._releaseAllKeys(t);const e=t.code;if(this._keys.indexOf(e)===-1){this._keys.push(e),this._keysDown.push(e);const i=new qs(e,t.key,t);this.events.emit("down",i),this.events.emit("press",i)}},this._handleKeyUp=t=>{if(!this._enabled)return;const e=t.code,i=this._keys.indexOf(e);this._keys.splice(i,1),this._keysUp.push(e);const s=new qs(e,t.key,t);this.events.emit("up",s),this.events.emit("release",s),t.key==="Meta"&&this._releaseAllKeys(t)}}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}init(t){let{global:e}=t;const{grabWindowFocus:i}=t;e||(Hl()?(e=window,i&&window.focus(),lt.getInstance().warn("Excalibur might be in a cross-origin iframe, in order to receive keyboard events it must be in focus")):e=window.top),e.addEventListener("blur",()=>{this._keys.length=0}),e.addEventListener("keyup",this._handleKeyUp),e.addEventListener("keydown",this._handleKeyDown)}toggleEnabled(t){this._enabled=t}clear(){this._keysDown.length=0,this._keysUp.length=0,this._keys.length=0}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.events.emit("hold",new qs(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._enabled?this._keysDown.indexOf(t)>-1:!1}isHeld(t){return this._enabled?this._keys.indexOf(t)>-1:!1}wasReleased(t){return this._enabled?this._keysUp.indexOf(t)>-1:!1}triggerEvent(t,e,i){t==="down"&&this._handleKeyDown(new KeyboardEvent("keydown",{code:e,key:i??null})),t==="up"&&this._handleKeyUp(new KeyboardEvent("keyup",{code:e,key:i??null}))}}class Es{static fromPagePosition(t,e,i){let s,r,o,a;arguments.length===3?(s=t,r=e,o=new E(s,r),a=i):(o=t,s=o.x,r=o.y,a=e);const h=a.screen.pageToScreenCoordinates(o),l=a.screen.screenToWorldCoordinates(h);return new Es(l,o,h)}constructor(t,e,i){this.worldPos=t,this.pagePos=e,this.screenPos=i}}class Ws{cancel(){this.active=!1}get pagePos(){return this.coordinates.pagePos}get screenPos(){return this.coordinates.screenPos}get worldPos(){return this.coordinates.worldPos}constructor(t,e,i,s,r,o){this.type=t,this.pointerId=e,this.button=i,this.pointerType=s,this.coordinates=r,this.nativeEvent=o,this.active=!0}}class Wl{cancel(){this.active=!1}constructor(t,e,i,s,r,o,a,h,l,c,d,A){this.x=t,this.y=e,this.pageX=i,this.pageY=s,this.screenX=r,this.screenY=o,this.index=a,this.deltaX=h,this.deltaY=l,this.deltaZ=c,this.deltaMode=d,this.ev=A,this.active=!0}}class bo{constructor(){this.events=new Nt,this.lastPagePos=E.Zero,this.lastScreenPos=E.Zero,this.lastWorldPos=E.Zero,this._onPointerMove=t=>{this.lastPagePos=new E(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new E(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new E(t.worldPos.x,t.worldPos.y)},this._onPointerDown=t=>{this.lastPagePos=new E(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new E(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new E(t.worldPos.x,t.worldPos.y)},this.on("move",this._onPointerMove),this.on("down",this._onPointerDown)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_updateWorldPosition(t){const e=Es.fromPagePosition(this.lastPagePos,t);this.lastScreenPos=e.screenPos,this.lastWorldPos=e.worldPos}}var vs;(function(n){n.Pixel="Pixel",n.Line="Line",n.Page="Page"})(vs||(vs={}));var Ti;(function(n){n[n.NoButton=-1]="NoButton",n[n.Left=0]="Left",n[n.Middle=1]="Middle",n[n.Right=2]="Right",n[n.Unknown=3]="Unknown"})(Ti||(Ti={}));var Ai;(function(n){n.Left="Left",n.Middle="Middle",n.Right="Right",n.Unknown="Unknown",n.NoButton="NoButton"})(Ai||(Ai={}));var gi;(function(n){n.Touch="Touch",n.Mouse="Mouse",n.Pen="Pen",n.Unknown="Unknown"})(gi||(gi={}));function nu(n){return globalThis.TouchEvent&&n instanceof globalThis.TouchEvent}function ou(n){return globalThis.PointerEvent&&n instanceof globalThis.PointerEvent}class Ln{constructor(t,e){this.target=t,this.engine=e,this.events=new Nt,this.primary=new bo,this._activeNativePointerIdsToNormalized=new Map,this.lastFramePointerCoords=new Map,this.currentFramePointerCoords=new Map,this.currentFramePointerDown=new Map,this.lastFramePointerDown=new Map,this.currentFrameDown=[],this.currentFrameUp=[],this.currentFrameMove=[],this.currentFrameCancel=[],this.currentFrameWheel=[],this._enabled=!0,this._pointers=[this.primary],this._boundHandle=this._handle.bind(this),this._boundWheel=this._handleWheel.bind(this)}toggleEnabled(t){this._enabled=t}recreate(t,e){const i=new Ln(t,e);return i.primary=this.primary,i._pointers=this._pointers,i}at(t){if(t>=this._pointers.length)for(let e=this._pointers.length-1,i=t;e<i;e++)this._pointers.push(new bo);return this._pointers[t]}count(){return this._pointers.length}isDown(t){var e;return this._enabled&&(e=this.currentFramePointerDown.get(t))!==null&&e!==void 0?e:!1}wasDown(t){var e;return this._enabled&&(e=this.lastFramePointerDown.get(t))!==null&&e!==void 0?e:!1}isDragging(t){return this._enabled?this.isDown(t):!1}isDragStart(t){return this._enabled?this.isDown(t)&&!this.wasDown(t):!1}isDragEnd(t){return this._enabled?!this.isDown(t)&&this.wasDown(t):!1}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}update(){this.lastFramePointerDown=new Map(this.currentFramePointerDown),this.lastFramePointerCoords=new Map(this.currentFramePointerCoords);for(const t of this.currentFrameDown){if(!t.active)continue;this.emit("down",t),this.at(t.pointerId).emit("down",t),this.primary.emit("pointerdown",t)}for(const t of this.currentFrameUp){if(!t.active)continue;this.emit("up",t),this.at(t.pointerId).emit("up",t)}for(const t of this.currentFrameMove){if(!t.active)continue;this.emit("move",t),this.at(t.pointerId).emit("move",t)}for(const t of this.currentFrameCancel){if(!t.active)continue;this.emit("cancel",t),this.at(t.pointerId).emit("cancel",t)}for(const t of this.currentFrameWheel)t.active&&(this.emit("pointerwheel",t),this.emit("wheel",t),this.primary.emit("pointerwheel",t),this.primary.emit("wheel",t));if(this.engine.currentScene.camera.hasChanged())for(const t of this._pointers)t._updateWorldPosition(this.engine)}clear(){for(const t of this.currentFrameUp){this.currentFramePointerCoords.delete(t.pointerId);const e=this._activeNativePointerIdsToNormalized.entries();for(const[i,s]of e)s===t.pointerId&&this._activeNativePointerIdsToNormalized.delete(i)}this.currentFrameDown.length=0,this.currentFrameUp.length=0,this.currentFrameMove.length=0,this.currentFrameCancel.length=0,this.currentFrameWheel.length=0}init(t){var e;if(this.engine.isDisposed())return;this.target===this.engine.canvas?this.engine.canvas.style.touchAction="none":document.body.style.touchAction="none",window.PointerEvent?(this.target.addEventListener("pointerdown",this._boundHandle),this.target.addEventListener("pointerup",this._boundHandle),this.target.addEventListener("pointermove",this._boundHandle),this.target.addEventListener("pointercancel",this._boundHandle)):(this.target.addEventListener("touchstart",this._boundHandle),this.target.addEventListener("touchend",this._boundHandle),this.target.addEventListener("touchmove",this._boundHandle),this.target.addEventListener("touchcancel",this._boundHandle),this.target.addEventListener("mousedown",this._boundHandle),this.target.addEventListener("mouseup",this._boundHandle),this.target.addEventListener("mousemove",this._boundHandle));const i={passive:!(this.engine.pageScrollPreventionMode===Pi.All||this.engine.pageScrollPreventionMode===Pi.Canvas)};if("onwheel"in document.createElement("div")?this.target.addEventListener("wheel",this._boundWheel,i):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel,i):this.target.addEventListener("MozMousePixelScroll",this._boundWheel,i),((e=t?.grabWindowFocus)!==null&&e!==void 0?e:!0)&&Hl()){const r=()=>{window.focus()};window.PointerEvent?this.target.addEventListener("pointerdown",r):(this.target.addEventListener("touchstart",r),this.target.addEventListener("mousedown",r))}}detach(){window.PointerEvent?(this.target.removeEventListener("pointerdown",this._boundHandle),this.target.removeEventListener("pointerup",this._boundHandle),this.target.removeEventListener("pointermove",this._boundHandle),this.target.removeEventListener("pointercancel",this._boundHandle)):(this.target.removeEventListener("touchstart",this._boundHandle),this.target.removeEventListener("touchend",this._boundHandle),this.target.removeEventListener("touchmove",this._boundHandle),this.target.removeEventListener("touchcancel",this._boundHandle),this.target.removeEventListener("mousedown",this._boundHandle),this.target.removeEventListener("mouseup",this._boundHandle),this.target.removeEventListener("mousemove",this._boundHandle)),"onwheel"in document.createElement("div")?this.target.removeEventListener("wheel",this._boundWheel):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel):this.target.addEventListener("MozMousePixelScroll",this._boundWheel)}_normalizePointerId(t){this._activeNativePointerIdsToNormalized.set(t,-1);const i=Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((s,r)=>s-r).findIndex(s=>s===t);return this._activeNativePointerIdsToNormalized.set(t,i),i}_handle(t){if(!this._enabled)return;t.preventDefault();const e=new Map;let i,s;if(nu(t)){i=Ai.Unknown,s=gi.Touch;for(let r=0;r<t.changedTouches.length;r++){const o=t.changedTouches[r],a=Es.fromPagePosition(o.pageX,o.pageY,this.engine),h=r+1,l=this._normalizePointerId(h);this.currentFramePointerCoords.set(l,a),e.set(l,a)}}else{i=this._nativeButtonToPointerButton(t.button),s=gi.Mouse;const r=Es.fromPagePosition(t.pageX,t.pageY,this.engine);let o=1;ou(t)&&(o=t.pointerId,s=this._stringToPointerType(t.pointerType));const a=this._normalizePointerId(o);this.currentFramePointerCoords.set(a,r),e.set(a,r)}for(const[r,o]of e.entries())switch(t.type){case"mousedown":case"pointerdown":case"touchstart":this.currentFrameDown.push(new Ws("down",r,i,s,o,t)),this.currentFramePointerDown.set(r,!0);break;case"mouseup":case"pointerup":case"touchend":this.currentFrameUp.push(new Ws("up",r,i,s,o,t)),this.currentFramePointerDown.set(r,!1);break;case"mousemove":case"pointermove":case"touchmove":this.currentFrameMove.push(new Ws("move",r,i,s,o,t));break;case"touchcancel":case"pointercancel":this.currentFrameCancel.push(new Ws("cancel",r,i,s,o,t));break}}_handleWheel(t){if(!this._enabled)return;(this.engine.pageScrollPreventionMode===Pi.All||this.engine.pageScrollPreventionMode===Pi.Canvas&&t.target===this.engine.canvas)&&t.preventDefault();const e=this.engine.screen.pageToScreenCoordinates(T(t.pageX,t.pageY)),i=this.engine.screen.screenToWorldCoordinates(e),s=-1/40,r=t.deltaX||t.wheelDeltaX*s||0,o=t.deltaY||t.wheelDeltaY*s||t.wheelDelta*s||t.detail||0,a=t.deltaZ||0;let h=vs.Pixel;t.deltaMode&&(t.deltaMode===1?h=vs.Line:t.deltaMode===2&&(h=vs.Page));const l=new Wl(i.x,i.y,t.pageX,t.pageY,e.x,e.y,0,r,o,a,h,t);this.currentFrameWheel.push(l)}triggerEvent(t,e){const i=this.engine.screen.worldToPageCoordinates(e);window.PointerEvent?this._handle(new window.PointerEvent("pointer"+t,{pointerId:0,clientX:i.x,clientY:i.y})):this._handle(new window.MouseEvent("mouse"+t,{clientX:i.x,clientY:i.y}));const s=this.engine.currentScene.world.get(Rn);s.preupdate(this.engine.currentScene,1),s.update(1)}_nativeButtonToPointerButton(t){switch(t){case Ti.NoButton:return Ai.NoButton;case Ti.Left:return Ai.Left;case Ti.Middle:return Ai.Middle;case Ti.Right:return Ai.Right;case Ti.Unknown:return Ai.Unknown;default:return Dh(t)}}_stringToPointerType(t){switch(t){case"touch":return gi.Touch;case"mouse":return gi.Mouse;case"pen":return gi.Pen;default:return gi.Unknown}}}class La{constructor(t){this._enabled=!0;const{pointerTarget:e,grabWindowFocus:i,engine:s}=t;this.keyboard=new ql,this.pointers=new Ln(e,s),this.gamepads=new Mn,this.keyboard.init({grabWindowFocus:i}),this.pointers.init({grabWindowFocus:i}),this.gamepads.init(),this.inputMapper=new Ol({keyboard:this.keyboard,pointers:this.pointers,gamepads:this.gamepads})}get enabled(){return this._enabled}toggleEnabled(t){this._enabled=t,this.keyboard.toggleEnabled(this._enabled),this.pointers.toggleEnabled(this._enabled),this.gamepads.toggleEnabled(this._enabled)}update(){this._enabled&&(this.inputMapper.execute(),this.keyboard.update(),this.gamepads.update())}clear(){this.keyboard.clear(),this.pointers.clear()}}class au{}const hu={Initialize:"initialize",Activate:"activate",Deactivate:"deactivate",PreUpdate:"preupdate",PostUpdate:"postupdate",PreDraw:"predraw",PostDraw:"postdraw",PreDebugDraw:"predebugdraw",PostDebugDraw:"postdebugdraw",PreLoad:"preload"};function $e(n){var t,e;return!!n?.prototype&&!!(!((e=(t=n?.prototype)===null||t===void 0?void 0:t.constructor)===null||e===void 0)&&e.name)}class Qe{get actors(){return this.world.entityManager.entities.filter(t=>t instanceof ye)}get entities(){return this.world.entityManager.entities}get triggers(){return this.world.entityManager.entities.filter(t=>t instanceof kl)}get tileMaps(){return this.world.entityManager.entities.filter(t=>t instanceof bl)}get timers(){return this._timers}constructor(){this._logger=lt.getInstance(),this.events=new Nt,this.camera=new Dl,this.world=new Ul(this),this.physics=new zl(yi()),this._isInitialized=!1,this._timers=[],this._cancelQueue=[],this.world.add(Fa),this.world.add(new kn(this.world,this.physics)),this.world.add(new Fn(this.world,this.physics)),this.world.add(Rn),this.world.add(Ra),this.world.add(Ma),this.world.add(Qa),this.world.add(Pa)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}onPreLoad(t){}onTransition(t){}onInitialize(t){}onActivate(t){}onDeactivate(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreDraw(t,e){}onPostDraw(t,e){}_initializeChildren(){for(const t of this.entities)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}async _initialize(t){var e;if(!this.isInitialized){try{this.engine=t,this.physics.config=this.engine.physics,this.input=new La({pointerTarget:t.pointerScope===es.Canvas?t.canvas:document,grabWindowFocus:t.grabWindowFocus,engine:t}),this.camera._initialize(t),this.world.systemManager.initialize(),await this.onInitialize(t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.events.emit("initialize",new Us(t,this))}catch(i){throw this._logger.error(`Error during scene initialization for scene ${(e=t.director)===null||e===void 0?void 0:e.getSceneName(this)}!`),i}this._isInitialized=!0}}async _activate(t){var e,i;try{this._logger.debug("Scene.onActivate",this),this.input.toggleEnabled(!0),await this.onActivate(t)}catch(s){throw this._logger.error(`Error during scene activation for scene ${(i=(e=this.engine)===null||e===void 0?void 0:e.director)===null||i===void 0?void 0:i.getSceneName(this)}!`),s}}async _deactivate(t){this._logger.debug("Scene.onDeactivate",this),this.input.toggleEnabled(!1),await this.onDeactivate(t)}_preupdate(t,e){this.emit("preupdate",new Ni(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new zi(t,e,this)),this.onPostUpdate(t,e)}_predraw(t,e){this.emit("predraw",new Ms(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new Ls(t,e,this)),this.onPostDraw(t,e)}update(t,e){var i;if(!this.isInitialized){this._logger.warnOnce(`Scene update called before initialize for scene ${(i=t.director)===null||i===void 0?void 0:i.getSceneName(this)}!`);return}this._preupdate(t,e);let s,r;for(s=0,r=this._cancelQueue.length;s<r;s++)this.removeTimer(this._cancelQueue[s]);this._cancelQueue.length=0;for(const o of this._timers)o.update(e);this.world.update(Te.Update,e),this.camera&&this.camera.update(t,e),this._collectActorStats(t),this._postupdate(t,e),this.input.update()}draw(t,e){var i;if(!this.isInitialized){this._logger.warnOnce("Scene draw called before initialize!");return}this._predraw(t,e),this.world.update(Te.Draw,e),!((i=this.engine)===null||i===void 0)&&i.isDebug&&this.debugDraw(t),this._postdraw(t,e)}debugDraw(t){this.emit("predebugdraw",new ea(t,this)),this.emit("postdebugdraw",new ia(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){if(this.emit("entityadded",{target:t}),t instanceof Ji){Ph(this._timers,t)||this.addTimer(t);return}this.world.add(t),t.scene=this}transfer(t){let e;t instanceof _e&&t.scene&&t.scene!==this&&(e=t.scene,t.scene.world.remove(t,!1)),t instanceof Ji&&t.scene&&(e=t.scene,t.scene.removeTimer(t)),e?.emit("entityremoved",{target:t}),this.add(t)}remove(t){this.emit("entityremoved",{target:t}),t instanceof _e&&(t.isActive&&t.kill(),this.world.remove(t)),t instanceof Ji&&this.removeTimer(t)}clear(t=!0){for(let e=this.entities.length-1;e>=0;e--)this.world.remove(this.entities[e],t);for(let e=this.timers.length-1;e>=0;e--)this.removeTimer(this.timers[e])}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){const e=this._timers.indexOf(t);return e!==-1&&this._timers.splice(e,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return this.engine?this.engine.currentScene===this:!1}_collectActorStats(t){const e=this.actors;for(let i=0;i<e.length;i++){const s=e[i];s instanceof Sa&&t.stats.currFrame.actors.ui++,t.stats.currFrame.actors.alive++;for(let r=0;r<s.children.length;r++){const o=s.children[r];xl(o)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}}var Ki;(function(n){n.Protanope="Protanope",n.Deuteranope="Deuteranope",n.Tritanope="Tritanope"})(Ki||(Ki={}));const lu=`#version 300 es\r
precision mediump float;\r
// our texture\r
uniform sampler2D u_image;\r
// the texCoords passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// color blind type\r
uniform int u_type;\r
\r
// simulation?\r
uniform bool u_simulate;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  vec4 o =  texture(u_image, v_texcoord);\r
  // RGB to LMS matrix conversion\r
  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\r
  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\r
  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\r
  // Simulate color blindness\r
  float l;\r
  float m;\r
  float s;\r
  //MODE CODE//\r
  if (u_type == 0) {\r
    // Protanope\r
    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;;\r
  } else if (u_type == 1) {\r
    // Deuteranope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;\r
  } else if (u_type == 2) {\r
    // Tritanope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\r
  }\r
\r
  // LMS to RGB matrix conversion\r
  vec4 error; // simulate the colors\r
  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\r
  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\r
  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\r
  error.a = 1.0;\r
  vec4 diff = o - error;\r
  vec4 correction; // correct the colors\r
  correction.r = 0.0;\r
  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\r
  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\r
  correction = o + correction;\r
  correction.a = o.a;\r
  //SIMULATE//\r
\r
  // sim \r
  if (u_simulate) {\r
    fragColor = error.rgba;\r
  } else {\r
    fragColor = correction.rgba;\r
  }\r
}`;class jl{constructor(t,e){this._shader=new Ie({gl:t,vertexSource:`#version 300 es
      in vec2 a_position;
      in vec2 a_uv;
      out vec2 v_texcoord;
      out vec2 v_uv;

      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        // Pass the texcoord to the fragment shader.
        v_texcoord = a_uv;
        v_uv = a_uv;
      }`,fragmentSource:e}),this._shader.compile(),this._buffer=new hi({gl:t,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Ei({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2]]}),this._buffer.upload()}getShader(){return this._shader}getLayout(){return this._layout}}class Yl{constructor(t,e=!1){this._colorBlindnessMode=t,this._simulate=!1,this._simulate=e}initialize(t){this._shader=new jl(t,lu),this.simulate=this._simulate,this.colorBlindnessMode=this._colorBlindnessMode}getShader(){return this._shader.getShader()}getLayout(){return this._shader.getLayout()}set colorBlindnessMode(t){if(this._colorBlindnessMode=t,this._shader){const e=this._shader.getShader();e.use(),this._colorBlindnessMode===Ki.Protanope?e.setUniformInt("u_type",0):this._colorBlindnessMode===Ki.Deuteranope?e.setUniformInt("u_type",1):this._colorBlindnessMode===Ki.Tritanope&&e.setUniformInt("u_type",2)}}get colorBlindnessMode(){return this._colorBlindnessMode}set simulate(t){if(this._simulate=t,this._shader){const e=this._shader.getShader();e.use(),e.setUniformBoolean("u_simulate",t)}}get simulate(){return this._simulate}}class Vl{constructor(t){this._engine=t,this._colorBlindPostProcessor=new Yl(Ki.Protanope)}correct(t){this._engine.graphicsContext instanceof wi&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!1,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}simulate(t){this._engine.graphicsContext instanceof wi&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!0,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}clear(){this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor)}}class Zl{constructor(t){this.stats={currFrame:new hr,prevFrame:new hr},this.filter={useFilter:!1,nameQuery:"",ids:[]},this.entity={showAll:!1,showId:!1,showName:!1},this.transform={showAll:!1,debugZIndex:1e7,showPosition:!1,showPositionLabel:!1,positionColor:q.Yellow,showZIndex:!1,showScale:!1,scaleColor:q.Green,showRotation:!1,rotationColor:q.Blue},this.graphics={showAll:!1,showBounds:!1,boundsColor:q.Yellow},this.collider={showAll:!1,showBounds:!1,boundsColor:q.Blue,showOwner:!1,showGeometry:!0,geometryColor:q.Green,geometryLineWidth:1,geometryPointSize:.5},this.physics={showAll:!1,showBroadphaseSpacePartitionDebug:!1,showCollisionNormals:!1,collisionNormalColor:q.Cyan,showCollisionContacts:!0,contactSize:2,collisionContactColor:q.Red},this.motion={showAll:!1,showVelocity:!1,velocityColor:q.Yellow,showAcceleration:!1,accelerationColor:q.Red},this.body={showAll:!1,showCollisionGroup:!1,showCollisionType:!1,showSleeping:!1,showMotion:!1,showMass:!1},this.camera={showAll:!1,showFocus:!1,focusColor:q.Red,showZoom:!1},this.tilemap={showAll:!1,showGrid:!1,gridColor:q.Red,gridWidth:.5,showSolidBounds:!1,solidBoundsColor:q.fromHex("#8080807F"),showColliderGeometry:!0},this.isometric={showAll:!1,showPosition:!1,positionColor:q.Yellow,positionSize:1,showGrid:!1,gridColor:q.Red,gridWidth:1,showColliderGeometry:!0},this._engine=t,this.colorBlindMode=new Vl(this._engine)}useTestClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const i=t.toTestClock();return e&&i.start(),this._engine.clock=i,i}useStandardClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const i=t.toStandardClock();return e&&i.start(),this._engine.clock=i,i}}class hr{constructor(){this._id=0,this._elapsedMs=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new Un,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(t){t?(this.id=t.id,this.elapsedMs=t.elapsedMs,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics),this.graphics.drawCalls=t.graphics.drawCalls,this.graphics.drawnImages=t.graphics.drawnImages):(this.id=this.elapsedMs=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){const t=new hr;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get elapsedMs(){return this._elapsedMs}set elapsedMs(t){this._elapsedMs=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class Un{constructor(){this._pairs=0,this._collisions=0,this._contacts=new Map,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.contacts=t.contacts,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.contacts.clear())}clone(){const t=new Un;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get contacts(){return this._contacts}set contacts(t){this._contacts=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}class Io{on(t,e){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(e),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,e){e||(e=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,e),this._nativeHandlers[t]=null}_decorate(t){return e=>{this._paused||t(e)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const t in this._nativeHandlers)this.off(t)}constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}}class Xl{constructor(t,e){this._windowGlobal=t,this._documentGlobal=e,this._windowComponent=new Io(this._windowGlobal),this._documentComponent=new Io(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}const Jl={pixelArtSampler:!1,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:ie.Blended,canvasImageRendering:"auto"},Kl={pixelArtSampler:!0,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:ie.Blended,canvasImageRendering:"auto"};class $l{constructor(t){var e;this._samplePeriod=100,this._currentFrameTime=0,this._frames=0,this._previousSampleTime=0,this._beginFrameTime=0,this._fps=t.initialFps,this._samplePeriod=(e=t.samplePeriod)!==null&&e!==void 0?e:this._samplePeriod,this._currentFrameTime=1e3/t.initialFps,this._nowFn=t.nowFn,this._previousSampleTime=this._nowFn()}start(){this._beginFrameTime=this._nowFn()}end(){this._frames++;const t=this._nowFn();this._currentFrameTime=t-this._beginFrameTime,t>=this._previousSampleTime+this._samplePeriod&&(this._fps=this._frames*1e3/(t-this._previousSampleTime),this._previousSampleTime=t,this._frames=0)}get fps(){return this._fps}get instant(){return 1e3/this._currentFrameTime}}class Ua{constructor(t){var e,i,s;this._onFatalException=()=>{},this._maxFps=1/0,this._lastTime=0,this._elapsed=1,this._scheduledCbs=[],this._totalElapsed=0,this._options=t,this.tick=t.tick,this._lastTime=(e=this.now())!==null&&e!==void 0?e:0,this._maxFps=(i=t.maxFps)!==null&&i!==void 0?i:this._maxFps,this._onFatalException=(s=t.onFatalException)!==null&&s!==void 0?s:this._onFatalException,this.fpsSampler=new $l({initialFps:60,nowFn:()=>this.now()})}elapsed(){return this._elapsed}now(){return performance.now()}toTestClock(){return new tc({...this._options,defaultUpdateMs:16.6})}toStandardClock(){return new Ga({...this._options})}setFatalExceptionHandler(t){this._onFatalException=t}schedule(t,e=0,i="preframe"){const s=this._totalElapsed+e;this._scheduledCbs.push([t,s,i])}__runScheduledCbs(t="preframe"){for(let e=this._scheduledCbs.length-1;e>-1;e--)t===this._scheduledCbs[e][2]&&this._scheduledCbs[e][1]<=this._totalElapsed&&(this._scheduledCbs[e][0](this._elapsed),this._scheduledCbs.splice(e,1))}update(t){try{this.fpsSampler.start();const e=this.now();let i=e-this._lastTime||1;const s=1e3/this._maxFps;if(i>=s){let r=0;s!==0&&(r=i%s,i=i-r),i>200&&(i=1),this._elapsed=t||i,this._totalElapsed+=this._elapsed,this.__runScheduledCbs("preframe"),this.tick(t||i),this.__runScheduledCbs("postframe"),s!==0?this._lastTime=e-r:this._lastTime=e,this.fpsSampler.end()}}catch(e){this._onFatalException(e),this.stop()}}}class Ga extends Ua{constructor(t){super(t),this._running=!1}isRunning(){return this._running}start(){if(this._running)return;this._running=!0;const t=()=>{if(this._running)try{this._requestId=window.requestAnimationFrame(t),this.update()}catch(e){throw window.cancelAnimationFrame(this._requestId),e}};t()}stop(){window.cancelAnimationFrame(this._requestId),this._running=!1}}class tc extends Ua{constructor(t){super({...t}),this._logger=lt.getInstance(),this._running=!1,this._currentTime=0,this._updateMs=t.defaultUpdateMs}now(){var t;return(t=this._currentTime)!==null&&t!==void 0?t:0}isRunning(){return this._running}start(){this._running=!0}stop(){this._running=!1}step(t){const e=t??this._updateMs;this._running?(this.update(e),this._currentTime+=e):this._logger.warn("The clock is not running, no step will be performed")}run(t,e){for(let i=0;i<t;i++)this.step(e??this._updateMs)}}var cu=le(296);class ec{constructor(){this._toasterCss=cu.A.toString(),this._isInitialized=!1}_initialize(){this._isInitialized||(this._container=document.createElement("div"),this._container.id="ex-toast-container",document.body.appendChild(this._container),this._isInitialized=!0,this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._toasterCss,document.head.appendChild(this._styleBlock))}dispose(){this._container.parentElement.removeChild(this._container),this._styleBlock.parentElement.removeChild(this._styleBlock),this._isInitialized=!1}_createFragment(t){const e=document.createElement("span");return e.innerText=t,e}toast(t,e,i){this._initialize();const s=document.createElement("div");s.className="ex-toast-message";const r=t.split("[LINK]").map(c=>this._createFragment(c));if(e){const c=document.createElement("a");c.href=e,i?c.innerText=i:c.innerText=e,r.splice(1,0,c)}const o=document.createElement("div");r.forEach(c=>{o.appendChild(c)}),s.appendChild(o);const a=document.createElement("button");a.innerText="x",a.addEventListener("click",()=>{this._container.removeChild(s)}),s.appendChild(a);const h=c=>{if(c.key==="Escape")try{this._container.removeChild(s)}catch{}document.removeEventListener("keydown",h)};document.addEventListener("keydown",h);const l=this._container.firstChild;this._container.insertBefore(s,l)}}const du={NavigationStart:"navigationstart",Navigation:"navigation",NavigationEnd:"navigationend"};class ic{get isTransitioning(){return this._isTransitioning}constructor(t,e){this._engine=t,this.events=new Nt,this._logger=lt.getInstance(),this._initialized=!1,this.scenes={},this._sceneToInstance=new Map,this._sceneToLoader=new Map,this._sceneToTransition=new Map,this._loadedScenes=new Set,this._isTransitioning=!1,this.rootScene=this.currentScene=new Qe,this.add("root",this.rootScene),this.currentScene=this.rootScene,this.currentSceneName="root";for(const i in e){const s=e[i];this.add(i,s),i==="root"&&(this.rootScene=this.getSceneInstance("root"),this.currentScene=this.rootScene)}}async onInitialize(){if(!this._initialized)if(this._initialized=!0,this._deferredGoto){const t=this._deferredGoto;this._deferredGoto=void 0;const e=this._deferredTransition;this._deferredTransition=void 0;const i=this.getSceneInstance(t);i&&e&&e._addToTargetScene(this._engine,i),await this.swapScene(t),i&&e&&await this.playTransition(e,i)}else await this.swapScene("root")}get isInitialized(){return this._initialized}configureStart(t,e){const i=e?.loader;i instanceof er?this.mainLoader=i:go(i)?this.mainLoader=new i:this.mainLoader=new ns;let s;if(e?.inTransition){const{inTransition:r}=e;s=r}if(this.startScene=t,s){const r=this.getSceneInstance(this.startScene);r&&(s._addToTargetScene(this._engine,r),this.swapScene(this.startScene).then(()=>this.playTransition(s,r)))}else this.swapScene(this.startScene);this.currentSceneName=this.startScene}_getLoader(t){return this._sceneToLoader.get(t)}_getInTransition(t){var e;const i=this.scenes[t];if(!(i instanceof Qe||$e(i)))return(e=i?.transitions)===null||e===void 0?void 0:e.in}_getOutTransition(t){var e;const i=this.scenes[t];if(!(i instanceof Qe||$e(i)))return(e=i?.transitions)===null||e===void 0?void 0:e.out}getDeferredScene(){const t=this.getSceneDefinition(this._deferredGoto);return this._deferredGoto&&t?t:null}getSceneDefinition(t){const e=this.scenes[t];if(e instanceof Qe||$e(e))return e;if(e)return e.scene}getSceneName(t){for(const[e,i]of Object.entries(this.scenes))if(i instanceof Qe){if(t===i)return e}else if(!$e(i)&&t===i.scene)return e;for(const[e,i]of Object.entries(this.scenes))if($e(i)){if(t.constructor===i)return e}else if(!(i instanceof Qe)&&t.constructor===i.scene)return e;return null}assertAdded(t){return this}assertRemoved(t){return this}add(t,e){if(!(e instanceof Qe)&&!$e(e)){const{loader:i,transitions:s}=e,{in:r,out:o}=s??{};this._sceneToTransition.set(t,{in:r,out:o}),go(i)?this._sceneToLoader.set(t,new i):i&&this._sceneToLoader.set(t,i)}return this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e,this.assertAdded(t)}remove(t){if(t instanceof Qe||$e(t)){const e=t;for(const i in this.scenes)if(this.scenes.hasOwnProperty(i)){const s=this.scenes[i];let r;if(s instanceof Qe||$e(s)?r=s:r=s.scene,r===e){if(i===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${i}`);this._sceneToInstance.delete(i),this._sceneToTransition.delete(i),this._sceneToLoader.delete(i),delete this.scenes[i]}}}if(typeof t=="string"){if(t===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${t}`);this._sceneToInstance.delete(t),this._sceneToTransition.delete(t),this._sceneToLoader.delete(t),delete this.scenes[t]}}async goToScene(t,e){var i,s,r,o,a,h;const l=this.getSceneInstance(t);if(!l){this._logger.warn(`Scene ${t} does not exist! Check the name, are you sure you added it?`);return}const c=this.currentScene,d=this.currentSceneName,A=(s=(i=this._engine.input)===null||i===void 0?void 0:i.enabled)!==null&&s!==void 0?s:!0;this._isTransitioning=!0;const u=(r=this.getSceneInstance(d))===null||r===void 0?void 0:r.onTransition("out"),p=l?.onTransition("in");e={sourceOut:(o=this._getOutTransition(this.currentSceneName))!==null&&o!==void 0?o:u,destinationIn:(a=this._getInTransition(t))!==null&&a!==void 0?a:p,...e};const{sourceOut:v,destinationIn:C,sceneActivationData:y}=e,b=v??this._getOutTransition(this.currentSceneName),P=C??this._getInTransition(t),I=b?.hideLoader||P?.hideLoader;I&&this.maybeLoadScene(t,I),this._emitEvent("navigationstart",d,t),b&&await this.playTransition(b,c),await this.maybeLoadScene(t,I),P&&await P.onPreviousSceneDeactivate(this.currentScene),P&&P._addToTargetScene(this._engine,l),await this.swapScene(t,y),this._emitEvent("navigation",d,t),P&&await this.playTransition(P,l),this._emitEvent("navigationend",d,t),(h=this._engine.input)===null||h===void 0||h.toggleEnabled(A),this._isTransitioning=!1}getSceneInstance(t){const e=this.getSceneDefinition(t);if(!e)return;if(this._sceneToInstance.has(t))return this._sceneToInstance.get(t);if(e instanceof Qe)return this._sceneToInstance.set(t,e),e;const i=new e;return this._sceneToInstance.set(t,i),i}async maybeLoadScene(t,e=!1){var i;const s=(i=this._getLoader(t))!==null&&i!==void 0?i:new er,r=this.getSceneDefinition(t),o=this.getSceneInstance(t);r&&o&&!this._loadedScenes.has(o)&&(o.onPreLoad(s),o.events.emit("preload",{loader:s}),e?this._engine.load(s,e):await this._engine.load(s),this._loadedScenes.add(o))}async playTransition(t,e){var i,s,r,o,a,h,l;if(!this.isInitialized){this._deferredTransition=t;return}if(t){this.currentTransition=t;const c=(s=(i=e.input)===null||i===void 0?void 0:i.enabled)!==null&&s!==void 0?s:!0;(r=e.input)===null||r===void 0||r.toggleEnabled(!t.blockInput),(o=this._engine.input)===null||o===void 0||o.toggleEnabled(!t.blockInput),this.currentTransition._addToTargetScene(this._engine,e),await this.currentTransition._play(),(a=e.input)===null||a===void 0||a.toggleEnabled(c)}(h=this.currentTransition)===null||h===void 0||h.kill(),(l=this.currentTransition)===null||l===void 0||l.reset(),this.currentTransition=void 0}async swapScene(t,e){const i=this._engine;if(!this.isInitialized){this._deferredGoto=t;return}const s=this.getSceneInstance(t);if(s){const r=this.currentScene,o=s;if(this._logger.debug("Going to scene:",t),this.currentScene.isInitialized){const l={engine:i,previousScene:r,nextScene:o};await this.currentScene._deactivate(l),this.currentScene.events.emit("deactivate",new ua(l,this.currentScene)),this.currentScene.input.clear()}const a=this._sceneToLoader.get(t);await a?.areResourcesLoaded(),this.currentScene=o,this.currentSceneName=t,i.screen.setCurrentCamera(o.camera),await this.currentScene._initialize(i);const h={engine:i,previousScene:r,nextScene:o,data:e};await this.currentScene._activate(h),this.currentScene.events.emit("activate",new da(h,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")}_emitEvent(t,e,i){const s=this.getSceneDefinition(e),r=this.getSceneDefinition(i);this.events.emit(t,{sourceScene:s,sourceName:e,destinationScene:r,destinationName:i})}}function sc(){const n={scope:(t,e)=>{const i=n.value;n.value=t;try{return e()}catch(s){throw s}finally{n.value=i}},value:void 0};return n}function rc(n){return n.value}const Eo={textureCollectInterval:6e4};class nc{constructor(t){this.options=t,this._running=!1,this._collectionMap=new Map,this._collectors=new Map,this.collectStaleResources=e=>{if(this._running){for(const[i,[s,r]]of this._collectors.entries()){const o=this.options.getTimestamp();for(const[a,[h,l]]of this._collectionMap.entries()){if(i!==h||l+r>=o)continue;s(a)&&this._collectionMap.delete(a)}}this._collectHandle=requestIdleCallback(this.collectStaleResources)}}}registerCollector(t,e,i){this._collectors.set(t,[i,e])}addCollectableResource(t,e){this._collectionMap.set(e,[t,this.options.getTimestamp()])}touch(t){const e=this._collectionMap.get(t);e&&this._collectionMap.set(t,[e[0],this.options.getTimestamp()])}forceCollectAll(){for(const[t,[e]]of this._collectors.entries())for(const[i]of this._collectionMap.entries())e(i)&&this._collectionMap.delete(i)}start(){this._running=!0,this.collectStaleResources()}stop(){this._running=!1,cancelIdleCallback(this._collectHandle)}}Bh();const uu={FallbackGraphicsContext:"fallbackgraphicscontext",Initialize:"initialize",Visible:"visible",Hidden:"hidden",Start:"start",Stop:"stop",PreUpdate:"preupdate",PostUpdate:"postupdate",PreFrame:"preframe",PostFrame:"postframe",PreDraw:"predraw",PostDraw:"postdraw"};var Pi;(function(n){n[n.None=0]="None",n[n.Canvas=1]="Canvas",n[n.All=2]="All"})(Pi||(Pi={}));class xe{static useEngine(){const t=rc(xe.Context);if(!t)throw new Error("Cannot inject engine with `useEngine()`, `useEngine()` was called outside of Engine lifecycle scope.");return t}get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get currentScene(){return this.director.currentScene}get currentSceneName(){return this.director.currentSceneName}get rootScene(){return this.director.rootScene}get scenes(){return this.director.scenes}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}get snapToPixel(){return this.graphicsContext.snapToPixel}set snapToPixel(t){this.graphicsContext.snapToPixel=t}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}constructor(t){var e,i,s,r,o,a,h,l,c;this.scope=I=>xe.Context.scope(this,I),this.version=Bo,this.events=new Nt,this.maxFps=Number.POSITIVE_INFINITY,this._inputEnabled=!0,this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.enableCanvasTransparency=!0,this.onFatalException=I=>{lt.getInstance().fatal(I,I.stack)},this._toaster=new ec,this._timescale=1,this._isInitialized=!1,this._originalOptions={},this._handleWebGLContextLost=I=>{var Q;I.preventDefault(),this.clock.stop(),this._logger.fatalOnce("WebGL Graphics Lost",I);const O=document.createElement("div");O.id="ex-webgl-graphics-context-lost",O.style.position="absolute",O.style.zIndex="99",O.style.left="50%",O.style.top="50%",O.style.display="flex",O.style.flexDirection="column",O.style.transform="translate(-50%, -50%)",O.style.backgroundColor="white",O.style.padding="10px",O.style.borderStyle="solid 1px";const B=document.createElement("div");if(B.innerHTML=`
      <h1>There was an issue rendering, please refresh the page.</h1>
      <div>
        <p>WebGL Graphics Context Lost</p>

        <button id="ex-webgl-graphics-reload">Refresh Page</button>

        <p>There are a few reasons this might happen:</p>
        <ul>
          <li>Two or more pages are placing a high demand on the GPU</li>
          <li>Another page or operation has stalled the GPU and the browser has decided to reset the GPU</li>
          <li>The computer has multiple GPUs and the user has switched between them</li>
          <li>Graphics driver has crashed or restarted</li>
          <li>Graphics driver was updated</li>
        </ul>
      </div>
    `,O.appendChild(B),!((Q=this.canvas)===null||Q===void 0)&&Q.parentElement){this.canvas.parentElement.appendChild(O);const j=B.querySelector("#ex-webgl-graphics-reload");j?.addEventListener("click",()=>location.reload())}},this._performanceThresholdTriggered=!1,this._fpsSamples=[],this._disposed=!1,this._isLoading=!1,this._hideLoader=!1,this._isReadyFuture=new ke,this.currentFrameElapsedMs=0,this.currentFrameLagMs=0,this._lagMs=0,this._screenShotRequests=[],t={...xe._DEFAULT_ENGINE_OPTIONS,...t},this._originalOptions=t,de.freeze(),this.browser=new Xl(window,document);const d=new jh;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=d.test())){const I=document.createElement("div");if(I.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(I),d.failedTests.forEach(function(Q){const O=document.createElement("div");O.innerText="Browser feature missing "+Q,document.body.appendChild(O)}),t.canvasElementId){const Q=document.getElementById(t.canvasElementId);Q&&Q.parentElement.removeChild(Q)}return}else this._compatible=!0;if(console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${Bo})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log(`
      /| ________________
O|===|* >________________>
      \\|`),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=lt.getInstance(),this._logger.defaultLevel===se.Debug&&d.logBrowserFeatures(),this._logger.debug("Building engine..."),t.garbageCollection===!0?this.garbageCollectorConfig={...Eo}:t.garbageCollection===!1?(this._logger.warn("WebGL Garbage Collection Disabled!!! If you leak any images over time your game will crash when GPU memory is exhausted"),this.garbageCollectorConfig=null):this.garbageCollectorConfig={...Eo,...t.garbageCollection},this._garbageCollector=new nc({getTimestamp:Date.now}),this.canvasElementId=t.canvasElementId,t.canvasElementId){if(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),document.getElementById(t.canvasElementId)===null)throw new Error("Cannot find existing element in the DOM, please ensure element is created prior to engine creation.");this.canvas=document.getElementById(t.canvasElementId)}else t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"));this.canvas&&!t.enableCanvasContextMenu&&this.canvas.addEventListener("contextmenu",I=>{I.preventDefault()});let A=(e=t.displayMode)!==null&&e!==void 0?e:oe.Fixed;t.width&&t.height||t.viewport?(t.displayMode===void 0&&(A=oe.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fit"),A=oe.FitScreen),this.grabWindowFocus=t.grabWindowFocus,this.pointerScope=t.pointerScope,this._originalDisplayMode=A;let u,p,v,C,y,b;typeof t.antialiasing=="object"?{pixelArtSampler:u,nativeContextAntialiasing:v,multiSampleAntialiasing:b,filtering:y,canvasImageRendering:C}={...t.pixelArt?Kl:Jl,...t.antialiasing}:(u=!!t.pixelArt,v=!1,b=t.antialiasing,C=t.antialiasing?"auto":"pixelated",y=t.antialiasing?ie.Blended:ie.Pixel),v&&b&&this._logger.warnOnce("Cannot use antialias setting nativeContextAntialiasing and multiSampleAntialiasing at the same time, they are incompatible settings. If you aren't sure use multiSampleAntialiasing"),t.pixelArt&&(p=.25),(!t.antialiasing||y===ie.Pixel)&&(p=0),p=(s=(i=t.uvPadding)!==null&&i!==void 0?i:p)!==null&&s!==void 0?s:.01;let P=de.isEnabled("use-canvas-context");if(!P)try{this.graphicsContext=new wi({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,pixelArtSampler:u,antialiasing:v,multiSampleAntialiasing:b,uvPadding:p,powerPreference:t.powerPreference,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting,garbageCollector:this.garbageCollectorConfig?{garbageCollector:this._garbageCollector,collectionInterval:this.garbageCollectorConfig.textureCollectInterval}:null,handleContextLost:(r=t.handleContextLost)!==null&&r!==void 0?r:this._handleWebGLContextLost,handleContextRestored:t.handleContextRestored})}catch(I){this._logger.warn(`Excalibur could not load webgl for some reason (${I.message}) and loaded a Canvas 2D fallback. Some features of Excalibur will not work in this mode. 

Read more about this issue at https://excaliburjs.com/docs/performance`),P=!0}P&&(this.graphicsContext=new dn({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:v,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting})),this.screen=new Ao({canvas:this.canvas,context:this.graphicsContext,antialiasing:v,canvasImageRendering:C,browser:this.browser,viewport:(o=t.viewport)!==null&&o!==void 0?o:t.width&&t.height?{width:t.width,height:t.height}:uo.SVGA,resolution:t.resolution,displayMode:A,pixelRatio:t.suppressHiDPIScaling?1:(a=t.pixelRatio)!==null&&a!==void 0?a:null}),zt.filtering=y,t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.maxFps=(h=t.maxFps)!==null&&h!==void 0?h:this.maxFps,this.fixedUpdateTimestep=(l=t.fixedUpdateTimestep)!==null&&l!==void 0?l:this.fixedUpdateTimestep,this.fixedUpdateFps=(c=t.fixedUpdateFps)!==null&&c!==void 0?c:this.fixedUpdateFps,this.fixedUpdateTimestep=this.fixedUpdateTimestep||1e3/this.fixedUpdateFps,this.clock=new Ga({maxFps:this.maxFps,tick:this._mainloop.bind(this),onFatalException:I=>this.onFatalException(I)}),this.enableCanvasTransparency=t.enableCanvasTransparency,typeof t.physics=="boolean"?this.physics={...yi(),enabled:t.physics}:(this.physics={...yi()},$r(this.physics,t.physics)),this.debug=new Zl(this),this.director=new ic(this,t.scenes),this._initialize(t),window.___EXCALIBUR_DEVTOOL=this,xe.InstanceCount++}_monitorPerformanceThresholdAndTriggerFallback(){const{allow:t}=this._originalOptions.configurePerformanceCanvas2DFallback;let{threshold:e,showPlayerMessage:i}=this._originalOptions.configurePerformanceCanvas2DFallback;if(e===void 0&&(e=xe._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold),i===void 0&&(i=xe._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage),!de.isEnabled("use-canvas-context")&&t&&this.ready&&!this._performanceThresholdTriggered){this._fpsSamples.length===e.numberOfFrames&&this._fpsSamples.splice(0,1),this._fpsSamples.push(this.clock.fpsSampler.fps);let s=0;for(let o=0;o<this._fpsSamples.length;o++)s+=this._fpsSamples[o];const r=s/this._fpsSamples.length;this._fpsSamples.length===e.numberOfFrames&&r<=e.fps&&(this._performanceThresholdTriggered=!0,this._logger.warn(`Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.
this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.

If in Chrome:
  * Visit Settings > Advanced > System, and ensure "Use Hardware Acceleration" is checked.
  * Visit chrome://flags/#ignore-gpu-blocklist and ensure "Override software rendering list" is "enabled"
If in Firefox, visit about:config
  * Ensure webgl.disabled = false
  * Ensure webgl.force-enabled = true
  * Ensure layers.acceleration.force-enabled = true

Read more about this issue at https://excaliburjs.com/docs/performance`),i&&this._toaster.toast("Excalibur is encountering performance issues. It's possible that your browser doesn't have hardware acceleration enabled. Visit [LINK] for more information and potential solutions.","https://excaliburjs.com/docs/performance"),this.useCanvas2DFallback(),this.emit("fallbackgraphicscontext",this.graphicsContext))}}useCanvas2DFallback(){var t,e,i;const s=this.canvas.cloneNode(!1);this.canvas.parentNode.replaceChild(s,this.canvas),this.canvas=s;const r={...this._originalOptions,antialiasing:this.screen.antialiasing},o=this._originalDisplayMode;this.graphicsContext=new dn({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:r.antialiasing,backgroundColor:r.backgroundColor,snapToPixel:r.snapToPixel,useDrawSorting:r.useDrawSorting}),this.screen&&this.screen.dispose(),this.screen=new Ao({canvas:this.canvas,context:this.graphicsContext,antialiasing:(t=r.antialiasing)!==null&&t!==void 0?t:!0,browser:this.browser,viewport:(e=r.viewport)!==null&&e!==void 0?e:r.width&&r.height?{width:r.width,height:r.height}:uo.SVGA,resolution:r.resolution,displayMode:o,pixelRatio:r.suppressHiDPIScaling?1:(i=r.pixelRatio)!==null&&i!==void 0?i:null}),this.screen.setCurrentCamera(this.currentScene.camera),this.input.pointers.detach();const a=r&&r.pointerScope===es.Document?document:this.canvas;this.input.pointers=this.input.pointers.recreate(a,this),this.input.pointers.init()}dispose(){this._disposed||(this._disposed=!0,this.stop(),this._garbageCollector.forceCollectAll(),this.input.toggleEnabled(!1),this.canvas.parentNode.removeChild(this.canvas),this.canvas=null,this.screen.dispose(),this.graphicsContext.dispose(),this.graphicsContext=null,xe.InstanceCount--)}isDisposed(){return this._disposed}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){if(t<0){lt.getInstance().warnOnce("engine.timescale to a value less than 0 are ignored");return}this._timescale=t}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,e){return this.director.add(t,e),this}removeScene(t){this.director.remove(t)}add(t){if(arguments.length===2){this.director.add(arguments[0],arguments[1]);return}const e=this.director.getDeferredScene();e instanceof Qe?e.add(t):this.currentScene.add(t)}remove(t){t instanceof _e&&this.currentScene.remove(t),(t instanceof Qe||$e(t))&&this.removeScene(t),typeof t=="string"&&this.removeScene(t)}async goToScene(t,e){await this.scope(async()=>{await this.director.goToScene(t,e)})}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){var e,i;this.pageScrollPreventionMode=t.scrollPreventionMode;const s=t&&t.pointerScope===es.Document?document:this.canvas,r=(i=(e=this._originalOptions)===null||e===void 0?void 0:e.grabWindowFocus)!==null&&i!==void 0?i:!0;this.input=new La({pointerTarget:s,grabWindowFocus:r,engine:this}),this.inputMapper=this.input.inputMapper,this.browser.document.on("visibilitychange",()=>{document.visibilityState==="hidden"?(this.events.emit("hidden",new ca(this)),this._logger.debug("Window hidden")):document.visibilityState==="visible"&&(this.events.emit("visible",new la(this)),this._logger.debug("Window visible"))}),!this.canvasElementId&&!t.canvasElement&&document.body.appendChild(this.canvas)}toggleInputEnabled(t){this._inputEnabled=t,this.input.toggleEnabled(this._inputEnabled)}onInitialize(t){}get isInitialized(){return this._isInitialized}async _overrideInitialize(t){this.isInitialized||(await this.director.onInitialize(),await this.onInitialize(t),this.events.emit("initialize",new Us(t,this)),this._isInitialized=!0)}_update(t){var e;if(this._isLoading){(e=this._loader)===null||e===void 0||e.onUpdate(this,t),this.input.update();return}this.clock.__runScheduledCbs("preupdate"),this._preupdate(t),this.currentScene.update(this,t),this.graphicsContext.updatePostProcessors(t),this.clock.__runScheduledCbs("postupdate"),this._postupdate(t),this.input.update()}_preupdate(t){this.emit("preupdate",new Ni(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,e){}_postupdate(t){this.emit("postupdate",new zi(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,e){}_draw(t){var e,i;if(this.graphicsContext.backgroundColor=(e=this.currentScene.backgroundColor)!==null&&e!==void 0?e:this.backgroundColor,this.graphicsContext.beginDrawLifecycle(),this.graphicsContext.clear(),this.clock.__runScheduledCbs("predraw"),this._predraw(this.graphicsContext,t),this._isLoading){this._hideLoader||((i=this._loader)===null||i===void 0||i.canvas.draw(this.graphicsContext,0,0),this.clock.__runScheduledCbs("postdraw"),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle());return}this.currentScene.draw(this.graphicsContext,t),this.clock.__runScheduledCbs("postdraw"),this._postdraw(this.graphicsContext,t),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle(),this._checkForScreenShots()}_predraw(t,e){this.emit("predraw",new Ms(t,e,this)),this.onPreDraw(t,e)}onPreDraw(t,e){}_postdraw(t,e){this.emit("postdraw",new Ls(t,e,this)),this.onPostDraw(t,e)}onPostDraw(t,e){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}get loadingComplete(){return!this._isLoading}get ready(){return this._isReadyFuture.isCompleted}isReady(){return this._isReadyFuture.promise}async start(t,e){await this.scope(async()=>{if(!this._compatible)throw new Error("Excalibur is incompatible with your browser");this._isLoading=!0;let i;return t instanceof er?i=t:typeof t=="string"&&(this.director.configureStart(t,e),i=this.director.mainLoader),this._logger.debug("Starting game clock..."),this.browser.resume(),this.clock.start(),this.garbageCollectorConfig&&this._garbageCollector.start(),this._logger.debug("Game clock started"),await this.load(i??new ns),await this._overrideInitialize(this),this._isReadyFuture.resolve(),this.emit("start",new Jo(this)),this._isReadyFuture.promise})}_mainloop(t){this.scope(()=>{this.emit("preframe",new sa(this,this.stats.prevFrame));const e=t*this.timescale;this.currentFrameElapsedMs=e;const i=this.stats.prevFrame.id+1;this.stats.currFrame.reset(),this.stats.currFrame.id=i,this.stats.currFrame.elapsedMs=e,this.stats.currFrame.fps=this.clock.fpsSampler.fps,Gt.clear();const s=this.clock.now(),r=this.fixedUpdateTimestep;if(this.fixedUpdateTimestep)for(this._lagMs+=e;this._lagMs>=r;)this._update(r),this._lagMs-=r;else this._update(e);const o=this.clock.now();this.currentFrameLagMs=this._lagMs,this._draw(e);const a=this.clock.now();this.stats.currFrame.duration.update=o-s,this.stats.currFrame.duration.draw=a-o,this.stats.currFrame.graphics.drawnImages=Gt.DrawnImagesCount,this.stats.currFrame.graphics.drawCalls=Gt.DrawCallCount,this.emit("postframe",new ra(this,this.stats.currFrame)),this.stats.prevFrame.reset(this.stats.currFrame),this._monitorPerformanceThresholdAndTriggerFallback()})}stop(){this.clock.isRunning()&&(this.emit("stop",new Ko(this)),this.browser.pause(),this.clock.stop(),this._garbageCollector.stop(),this._logger.debug("Game stopped"))}isRunning(){return this.clock.isRunning()}screenshot(t=!1){return new Promise(i=>{this._screenShotRequests.push({preserveHiDPIResolution:t,resolve:i})})}_checkForScreenShots(){for(const t of this._screenShotRequests){const e=t.preserveHiDPIResolution?this.canvas.width:this.screen.resolution.width,i=t.preserveHiDPIResolution?this.canvas.height:this.screen.resolution.height,s=document.createElement("canvas");s.width=e,s.height=i;const r=s.getContext("2d");r.imageSmoothingEnabled=this.screen.antialiasing,r.drawImage(this.canvas,0,0,e,i);const o=new Image,a=s.toDataURL("image/png");o.onload=()=>{t.resolve(o)},o.src=a}this._screenShotRequests.length=0}async load(t,e=!1){await this.scope(async()=>{try{if(t.isLoaded())return;this._loader=t,this._isLoading=!0,this._hideLoader=e,t instanceof ns&&(t.suppressPlayButton=t.suppressPlayButton||this._suppressPlayButton),this._loader.onInitialize(this),await t.load()}catch(i){this._logger.error("Error loading resources, things may not behave properly",i),await Promise.resolve()}finally{this._isLoading=!1,this._hideLoader=!1,this._loader=null}})}}xe.Context=sc();xe.InstanceCount=0;xe._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,useDrawSorting:!0,configurePerformanceCanvas2DFallback:{allow:!1,showPlayerMessage:!1,threshold:{fps:20,numberOfFrames:100}},canvasElementId:"",canvasElement:void 0,enableCanvasContextMenu:!1,snapToPixel:!1,antialiasing:!0,pixelArt:!1,garbageCollection:!0,powerPreference:"high-performance",pointerScope:es.Canvas,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,grabWindowFocus:!0,scrollPreventionMode:Pi.Canvas,backgroundColor:q.fromHex("#2185d0")};class Au extends ye{set maxWidth(t){this._text.maxWidth=t}get maxWidth(){return this._text.maxWidth}get font(){return this._font}set font(t){this._font=t,this._text.font=t}get text(){return this._text.text}set text(t){this._text.text=t}get color(){return this._text.color}set color(t){this._text&&(this._text.color=t)}get opacity(){return this.graphics.opacity}set opacity(t){this.graphics.opacity=t}get spriteFont(){return this._spriteFont}set spriteFont(t){t&&(this._spriteFont=t,this._text.font=this._spriteFont)}constructor(t){super(t),this._font=new is,this._text=new Fr({text:"",font:this._font});const{text:e,pos:i,x:s,y:r,spriteFont:o,font:a,color:h,maxWidth:l}={text:"",...t};this.pos=i??(s&&r?T(s,r):this.pos),this.text=e??this.text,this.font=a??this.font,this.maxWidth=l??this.maxWidth,this.spriteFont=o??this.spriteFont,this._text.color=h??this.color;const c=this.get(Wt);c.anchor=E.Zero,c.use(this._text)}_initialize(t){super._initialize(t)}getTextWidth(){return this._text.width}}var Di;(function(n){n.Circle="circle",n.Rectangle="rectangle"})(Di||(Di={}));class gu extends ye{constructor(t){var e,i;super({width:(e=t.width)!==null&&e!==void 0?e:0,height:(i=t.height)!==null&&i!==void 0?i:0}),this._particlesToEmit=0,this._particlePool=new Qr(()=>new Bn({}),p=>p,500),this.numParticles=0,this.isEmitting=!0,this.deadParticles=[],this.emitRate=1,this.emitterType=Di.Rectangle,this.radius=0,this.particle={life:2e3,transform:Ze.Global,graphic:void 0,opacity:1,angularVelocity:0,focus:void 0,focusAccel:void 0,randomRotation:!1},this._activeParticles=[];const{particle:s,x:r,y:o,z:a,pos:h,isEmitting:l,emitRate:c,emitterType:d,radius:A,random:u}={...t};this.particle={...this.particle,...s},this.pos=h??T(r??0,o??0),this.z=a??0,this.isEmitting=l??this.isEmitting,this.emitRate=c??this.emitRate,this.emitterType=d??this.emitterType,this.radius=A??this.radius,this.body.collisionType=gt.PreventCollision,this.random=u??new Ds}removeParticle(t){this.deadParticles.push(t)}emitParticles(t){var e;if(!(t<=0)){t=t|0;for(let i=0;i<t;i++){const s=this._createParticle();!((e=this===null||this===void 0?void 0:this.scene)===null||e===void 0)&&e.world&&(this.particle.transform===Ze.Global?this.scene.world.add(s):this.addChild(s)),this._activeParticles.push(s)}}}clearParticles(){for(let t=0;t<this._activeParticles.length;t++)this.removeParticle(this._activeParticles[t])}_createParticle(){let t=0,e=0;const i=ti(this.particle.minAngle||0,this.particle.maxAngle||Math.PI*2,this.random),s=ti(this.particle.minSpeed||0,this.particle.maxSpeed||0,this.random),r=this.particle.startSize||ti(this.particle.minSize||5,this.particle.maxSize||5,this.random),o=s*Math.cos(i),a=s*Math.sin(i);if(this.emitterType===Di.Rectangle)t=ti(0,this.width,this.random),e=ti(0,this.height,this.random);else if(this.emitterType===Di.Circle){const l=ti(0,this.radius,this.random);t=l*Math.cos(i),e=l*Math.sin(i)}const h=this._particlePool.rent();return h.configure({life:this.particle.life,opacity:this.particle.opacity,beginColor:this.particle.beginColor,endColor:this.particle.endColor,pos:T(t,e),vel:T(o,a),acc:this.particle.acc,angularVelocity:this.particle.angularVelocity,startSize:this.particle.startSize,endSize:this.particle.endSize,size:r,graphic:this.particle.graphic,fade:this.particle.fade}),h.registerEmitter(this),this.particle.randomRotation&&(h.transform.rotation=ti(0,Math.PI*2,this.random)),this.particle.focus&&(h.focus=this.particle.focus.add(T(this.pos.x,this.pos.y)),h.focusAccel=this.particle.focusAccel),h}update(t,e){var i;super.update(t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit)));for(let s=0;s<this.deadParticles.length;s++){!((i=this===null||this===void 0?void 0:this.scene)===null||i===void 0)&&i.world&&(this.scene.world.remove(this.deadParticles[s],!1),this._particlePool.return(this.deadParticles[s]));const r=this._activeParticles.indexOf(this.deadParticles[s]);r>-1&&this._activeParticles.splice(r,1)}this.deadParticles.length=0}}function pu(n,t){}class gn{constructor(t,e,i){var s;this.emitRate=1,this._initialized=!1,this._vaos=[],this._buffers=[],this._drawIndex=0,this._numInputFloats=7,this._particleIndex=0,this._uploadIndex=0,this._wrappedLife=0,this._wrappedParticles=0,this._particleLife=0,this._clearRequested=!1,this._emitted=[],this.emitter=t,this.particle=i,this._particleData=new Float32Array(this.emitter.maxParticles*this._numInputFloats),this._random=e,this._particleLife=(s=this.particle.life)!==null&&s!==void 0?s:2e3}get isInitialized(){return this._initialized}get maxParticles(){return this.emitter.maxParticles}initialize(t,e){if(this._initialized)return;const i=this.emitter.maxParticles,s=this._numInputFloats,r=this._particleData,o=4,a=t.createBuffer(),h=t.createVertexArray();t.bindVertexArray(h),t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,i*s*o,t.DYNAMIC_DRAW),t.bufferSubData(t.ARRAY_BUFFER,0,r);let l=0;t.vertexAttribPointer(0,2,t.FLOAT,!1,s*o,0),l+=o*2,t.vertexAttribPointer(1,2,t.FLOAT,!1,s*o,l),l+=o*2,t.vertexAttribPointer(2,1,t.FLOAT,!1,s*o,l),l+=o*1,t.vertexAttribPointer(3,1,t.FLOAT,!1,s*o,l),l+=o*1,t.vertexAttribPointer(4,1,t.FLOAT,!1,s*o,l),l+=o*1,t.enableVertexAttribArray(0),t.enableVertexAttribArray(1),t.enableVertexAttribArray(2),t.enableVertexAttribArray(3),t.enableVertexAttribArray(4),this._vaos.push(h),this._buffers.push(a),t.bindVertexArray(null),t.bindBuffer(t.ARRAY_BUFFER,null);const c=t.createBuffer(),d=t.createVertexArray();t.bindVertexArray(d),t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,i*s*o,t.DYNAMIC_DRAW),l=0,t.vertexAttribPointer(0,2,t.FLOAT,!1,s*o,0),l+=o*2,t.vertexAttribPointer(1,2,t.FLOAT,!1,s*o,l),l+=o*2,t.vertexAttribPointer(2,1,t.FLOAT,!1,s*o,l),l+=o*1,t.vertexAttribPointer(3,1,t.FLOAT,!1,s*o,l),l+=o*1,t.vertexAttribPointer(4,1,t.FLOAT,!1,s*o,l),l+=o*1,t.enableVertexAttribArray(0),t.enableVertexAttribArray(1),t.enableVertexAttribArray(2),t.enableVertexAttribArray(3),t.enableVertexAttribArray(4),this._vaos.push(d),this._buffers.push(c),t.bindVertexArray(null),t.bindBuffer(t.ARRAY_BUFFER,null),this._currentVao=this._vaos[this._drawIndex%2],this._currentBuffer=this._buffers[(this._drawIndex+1)%2],this._initialized=!0}clearParticles(){this._particleData.fill(0),this._clearRequested=!0}emitParticles(t){const e=this._particleIndex,i=this.maxParticles*this._numInputFloats,s=t*this._numInputFloats+e;for(let r=e;r<s;r+=this._numInputFloats){const o=this._random.floating(this.particle.minAngle||0,this.particle.maxAngle||re),a=this._random.floating(this.particle.minSpeed||0,this.particle.maxSpeed||0),h=this._random.floating(this.particle.minSpeed||0,this.particle.maxSpeed||0),l=a*Math.cos(o),c=h*Math.sin(o);let d=0,A=0;if(this.emitter.emitterType===Di.Rectangle)d=this._random.floating(-.5,.5)*this.emitter.width,A=this._random.floating(-.5,.5)*this.emitter.height;else{const v=this._random.floating(0,this.emitter.radius);d=v*Math.cos(o),A=v*Math.sin(o)}const u=this.emitter.transform.apply(T(d,A)),p=[this.particle.transform===Ze.Local?d:u.x,this.particle.transform===Ze.Local?A:u.y,l,c,this.particle.randomRotation?ti(0,re,this._random):this.particle.rotation||0,this.particle.angularVelocity||0,this._particleLife];this._particleData.set(p,r%this._particleData.length)}s>=i?(this._wrappedParticles+=(s-i)/this._numInputFloats,this._wrappedLife=this._particleLife):this._wrappedLife>0&&(this._wrappedParticles+=t),this._particleIndex=s%i,this._emitted.push([this._particleLife,e])}_uploadEmitted(t){this._particleIndex!==this._uploadIndex&&(t.bindBuffer(t.ARRAY_BUFFER,this._buffers[(this._drawIndex+1)%2]),this._particleIndex>=this._uploadIndex?t.bufferSubData(t.ARRAY_BUFFER,this._uploadIndex*4,this._particleData,this._uploadIndex,this._particleIndex-this._uploadIndex):(t.bufferSubData(t.ARRAY_BUFFER,this._uploadIndex*4,this._particleData,this._uploadIndex,this._particleData.length-this._uploadIndex),this._wrappedParticles&&t.bufferSubData(t.ARRAY_BUFFER,0,this._particleData,0,this._wrappedParticles*this._numInputFloats),this._wrappedLife=this._particleLife),t.bindBuffer(t.ARRAY_BUFFER,null)),this._uploadIndex=this._particleIndex%(this.maxParticles*this._numInputFloats)}update(t){var e;if(this._particleLife=(e=this.particle.life)!==null&&e!==void 0?e:this._particleLife,this._wrappedLife>0?this._wrappedLife-=t:(this._wrappedLife=0,this._wrappedParticles=0),!!this._emitted.length){for(let i=this._emitted.length-1;i>=0;i--){const s=this._emitted[i];s[0]-=t,s[0]<=0&&this._emitted.splice(i,1)}this._emitted.sort((i,s)=>i[0]-s[0])}}draw(t){if(this._initialized){if(this._clearRequested?(t.bindBuffer(t.ARRAY_BUFFER,this._buffers[(this._drawIndex+1)%2]),t.bufferSubData(t.ARRAY_BUFFER,0,this._particleData),t.bindBuffer(t.ARRAY_BUFFER,null),this._clearRequested=!1):this._uploadEmitted(t),t.bindVertexArray(this._currentVao),t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,0,this._currentBuffer),this._wrappedLife&&this._emitted[0]&&this._emitted[0][1]>0){const e=this._emitted[0][1]/this._numInputFloats;t.bindBufferRange(t.TRANSFORM_FEEDBACK_BUFFER,0,this._currentBuffer,this._emitted[0][1]*4,(this.maxParticles-e)*this._numInputFloats*4),t.beginTransformFeedback(t.POINTS),t.drawArrays(t.POINTS,e,this.maxParticles-e),t.endTransformFeedback(),t.bindBufferRange(t.TRANSFORM_FEEDBACK_BUFFER,0,this._currentBuffer,0,this._emitted[0][1]*4),t.beginTransformFeedback(t.POINTS),t.drawArrays(t.POINTS,0,e),t.endTransformFeedback()}else t.bindBufferRange(t.TRANSFORM_FEEDBACK_BUFFER,0,this._currentBuffer,0,this._particleData.length*4),t.beginTransformFeedback(t.POINTS),t.drawArrays(t.POINTS,0,this.maxParticles),t.endTransformFeedback();t.bindVertexArray(null),t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,0,null),this._currentVao=this._vaos[this._drawIndex%2],this._currentBuffer=this._buffers[(this._drawIndex+1)%2],this._drawIndex=(this._drawIndex+1)%2}}}gn.GPU_MAX_PARTICLES=1e5;class fu extends ye{get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get z(){return this.transform.z}set z(t){this.transform.z=t}constructor(t){super({name:"GpuParticleEmitter",width:t.width,height:t.height}),this.particle={life:2e3,transform:Ze.Global,graphic:void 0,opacity:1,angularVelocity:0,focus:void 0,focusAccel:void 0,randomRotation:!1},this.graphics=new Wt,this.isEmitting=!1,this.emitRate=1,this.emitterType=Di.Rectangle,this.radius=0,this.maxParticles=2e3,this._particlesToEmit=0,this.addComponent(this.graphics,!0),this.graphics.onPostDraw=this.draw.bind(this);const{particle:e,maxParticles:i,x:s,y:r,z:o,pos:a,isEmitting:h,emitRate:l,emitterType:c,radius:d,random:A}={...t};this.maxParticles=It(i??this.maxParticles,0,gn.GPU_MAX_PARTICLES),this.pos=a??T(s??0,r??0),this.z=o??0,this.isEmitting=h??this.isEmitting,this.emitRate=l??this.emitRate,this.emitterType=c??this.emitterType,this.radius=d??this.radius,this.particle={...this.particle,...e},this.random=A??new Ds,this.renderer=new gn(this,this.random,this.particle)}_initialize(t){super._initialize(t);const e=t.graphicsContext;this.renderer.initialize(e.__gl,e)}update(t,e){super.update(t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit))),this.renderer.update(e)}emitParticles(t){t<=0||this.renderer.emitParticles(t|0)}clearParticles(){this.renderer.clearParticles()}draw(t,e){t.draw("ex.particle",this.renderer,e)}}class oc extends _e{getGraphics(){return this._graphics}addGraphic(t,e){this._graphics.push(t),this._gfx.isVisible=this.map.isVisible,this._gfx.opacity=this.map.opacity,e?.offset&&(this._gfx.offset=e.offset),this._gfx.localBounds=this._recalculateBounds()}_recalculateBounds(){let t=this._tileBounds.clone();for(const e of this._graphics){const i=T(this.map.graphicsOffset.x-this.map.tileWidth/2,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:e.height-this.map.tileHeight));t=t.combine(e.localBounds.translate(i))}return t}removeGraphic(t){const e=this._graphics.indexOf(t);e>-1&&this._graphics.splice(e,1),this._gfx.localBounds=this._recalculateBounds()}clearGraphics(){this._graphics.length=0,this._gfx.isVisible=!1,this._gfx.localBounds=this._recalculateBounds()}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}get pos(){return this.map.tileToWorld(T(this.x,this.y))}get center(){return this.pos.add(T(0,this.map.tileHeight/2))}constructor(t,e,i,s){super([new tt,new Wt({offset:i??E.Zero,onPostDraw:(A,u)=>this.draw(A,u)}),new nr(s)]),this.solid=!1,this.events=new Nt,this._tileBounds=new ht,this._graphics=[],this._colliders=[],this.data=new Map,this.x=t,this.y=e,this.map=s,this._transform=this.get(tt),this._isometricEntityComponent=this.get(nr);const r=this.map.tileWidth/2,o=this.map.tileHeight/2,a=(this.x-this.y)*r,h=(this.x+this.y)*o;this._transform.pos=T(a,h),this._isometricEntityComponent.elevation=s.elevation,this._gfx=this.get(Wt),this._gfx.isVisible=!1;const l=this.map.tileWidth,c=this.map.tileHeight,d=T(0,this.map.renderFromTopOfGraphic?c:0);this._gfx.localBounds=this._tileBounds=new ht({left:-l/2,top:-c,right:l/2,bottom:c}).translate(d)}draw(t,e){const i=this.map.tileWidth/2;t.save(),t.translate(-i,0);for(const s of this._graphics)s.draw(t,this.map.graphicsOffset.x,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:s.height-this.map.tileHeight));t.restore()}}class _u extends _e{get visible(){return this.isVisible}set visible(t){this.isVisible=t}constructor(t){super([new tt,new Bt({type:gt.Fixed}),new ee,new Ri,new Dn((c,d)=>this.debug(c,d),!1)],t.name),this.elevation=0,this.isVisible=!0,this.opacity=1,this.renderFromTopOfGraphic=!1,this.graphicsOffset=T(0,0),this._collidersDirty=!1,this._originalOffsets=new WeakMap;const{pos:e,tileWidth:i,tileHeight:s,columns:r,rows:o,renderFromTopOfGraphic:a,graphicsOffset:h,elevation:l}=t;this.transform=this.get(tt),e&&(this.transform.pos=e),this.collider=this.get(ee),this.collider&&this.collider.set(this._composite=new he([])),this.pointer=this.get(Ri),this.renderFromTopOfGraphic=a??this.renderFromTopOfGraphic,this.graphicsOffset=h??this.graphicsOffset,this.elevation=l??this.elevation,this.tileWidth=i,this.tileHeight=s,this.columns=r,this.rows=o,this._pointerEventDispatcher=new Ta,this.tiles=new Array(r*o);for(let c=0;c<o;c++)for(let d=0;d<r;d++){const A=new oc(d,c,this.graphicsOffset,this);this.tiles[d+c*r]=A,this.addChild(A),this._pointerEventDispatcher.addObject(A,u=>this.getTileByPoint(u.worldPos)===A,()=>!0)}this.pointer.localBounds=ht.fromDimension(i*r*this.transform.scale.x,s*o*this.transform.scale.y,T(.5,0))}_processPointerToObject(t){this._pointerEventDispatcher.processPointerToObject(t,this.tiles)}_dispatchPointerEvents(t){this._pointerEventDispatcher.dispatchEvents(t,this.tiles)}update(){this._collidersDirty&&(this.updateColliders(),this._collidersDirty=!1),this._pointerEventDispatcher.clear()}flagCollidersDirty(){this._collidersDirty=!0}_getOrSetColliderOriginalOffset(t){var e;if(this._originalOffsets.has(t))return(e=this._originalOffsets.get(t))!==null&&e!==void 0?e:E.Zero;{const i=t.offset;return this._originalOffsets.set(t,i),i}}updateColliders(){this._composite.clearColliders();const t=this.get(tt).pos;for(const e of this.tiles)if(e.solid)for(const i of e.getColliders()){const s=this._getOrSetColliderOriginalOffset(i);i.offset=this.tileToWorld(T(e.x,e.y)).sub(t).add(s).sub(T(this.tileWidth/2,this.tileHeight)),i.owner=this,this._composite.addCollider(i)}this.collider.update()}worldToTile(t){t=t.sub(this.transform.globalPos);const e=this.tileWidth/2,i=this.tileHeight/2;return T(~~((t.x/e+t.y/i)/2),~~((t.y/i-t.x/e)/2))}tileToWorld(t){const e=this.tileWidth/2,i=this.tileHeight/2,s=(t.x-t.y)*e,r=(t.x+t.y)*i;return T(s,r).add(this.transform.pos)}getTile(t,e){return t<0||e<0||t>=this.columns||e>=this.rows?null:this.tiles[t+e*this.columns]}getTileByPoint(t){const e=this.worldToTile(t);return this.getTile(e.x,e.y)}_getMaxZIndex(){let t=Number.NEGATIVE_INFINITY;for(const e of this.tiles){const i=e.get(tt).z;i>t&&(t=i)}return t}debug(t,e){const{showAll:i,showPosition:s,positionColor:r,positionSize:o,showGrid:a,gridColor:h,gridWidth:l,showColliderGeometry:c}=e.isometric,{geometryColor:d,geometryLineWidth:A,geometryPointSize:u}=e.collider;if(t.save(),t.z=this._getMaxZIndex()+.5,i||a){for(let p=0;p<this.rows+1;p++){const v=this.tileToWorld(T(0,p)),C=this.tileToWorld(T(this.columns,p));t.drawLine(v,C,h,l)}for(let p=0;p<this.columns+1;p++){const v=this.tileToWorld(T(p,0)),C=this.tileToWorld(T(p,this.rows));t.drawLine(v,C,h,l)}}if(i||s)for(const p of this.tiles)t.drawCircle(this.tileToWorld(T(p.x,p.y)),o,r);if(i||c){for(const p of this.tiles)if(p.solid)for(const v of p.getColliders())v.debug(t,d,{lineWidth:A,pointSize:u})}t.restore()}}class Na{constructor(t,e){this.id=Rt(),this._stopped=!1,this._sequenceBuilder=e,this._sequenceContext=new Gr(t),this._actionQueue=this._sequenceContext.getQueue(),this._sequenceBuilder(this._sequenceContext)}update(t){this._actionQueue.update(t)}isComplete(){return this._stopped||this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._stopped=!1,this._actionQueue.reset()}clone(t){return new Na(t,this._sequenceBuilder)}}class mu{constructor(t){this.id=Rt(),this._actions=t}update(t){for(let e=0;e<this._actions.length;e++)this._actions[e].update(t)}isComplete(t){return this._actions.every(e=>e.isComplete(t))}reset(){this._actions.forEach(t=>t.reset())}stop(){this._actions.forEach(t=>t.stop())}}class As{constructor(t,e){this.bounds=t,this.options=e,this._defaultOptions={maxDepth:10,capacity:10,level:0},this.items=[],this._isDivided=!1,this.topLeft=null,this.topRight=null,this.bottomLeft=null,this.bottomRight=null,this.options={...this._defaultOptions,...e},this.halfWidth=t.width/2,this.halfHeight=t.height/2}_split(){this._isDivided=!0;const t={maxDepth:this.options.maxDepth,capacity:this.options.capacity,level:this.options.level+1};this.topLeft=new As(new ht({left:this.bounds.left,top:this.bounds.top,right:this.bounds.left+this.halfWidth,bottom:this.bounds.top+this.halfHeight}),t),this.topRight=new As(new ht({left:this.bounds.left+this.halfWidth,top:this.bounds.top,right:this.bounds.right,bottom:this.bounds.top+this.halfHeight}),t),this.bottomLeft=new As(new ht({left:this.bounds.left,top:this.bounds.top+this.halfHeight,right:this.bounds.left+this.halfWidth,bottom:this.bounds.bottom}),t),this.bottomRight=new As(new ht({left:this.bounds.left+this.halfWidth,top:this.bounds.top+this.halfHeight,right:this.bounds.right,bottom:this.bounds.bottom}),t)}_insertIntoSubNodes(t){var e,i,s,r;!((e=this.topLeft)===null||e===void 0)&&e.bounds.overlaps(t.bounds)&&this.topLeft.insert(t),!((i=this.topRight)===null||i===void 0)&&i.bounds.overlaps(t.bounds)&&this.topRight.insert(t),!((s=this.bottomLeft)===null||s===void 0)&&s.bounds.overlaps(t.bounds)&&this.bottomLeft.insert(t),!((r=this.bottomRight)===null||r===void 0)&&r.bounds.overlaps(t.bounds)&&this.bottomRight.insert(t)}insert(t){if(this._isDivided){this._insertIntoSubNodes(t);return}if(this.items.push(t),this.items.length>this.options.capacity&&this.options.level<this.options.maxDepth){this._isDivided||this._split();for(const e of this.items)this._insertIntoSubNodes(e);this.items.length=0}}remove(t){var e,i,s,r;if(this.bounds.overlaps(t.bounds)){if(!this._isDivided){const o=this.items.indexOf(t);o>-1&&this.items.splice(o,1);return}!((e=this.topLeft)===null||e===void 0)&&e.bounds.overlaps(t.bounds)&&this.topLeft.remove(t),!((i=this.topRight)===null||i===void 0)&&i.bounds.overlaps(t.bounds)&&this.topRight.remove(t),!((s=this.bottomLeft)===null||s===void 0)&&s.bounds.overlaps(t.bounds)&&this.bottomLeft.remove(t),!((r=this.bottomRight)===null||r===void 0)&&r.bounds.overlaps(t.bounds)&&this.bottomRight.remove(t)}}query(t){let e=this.items;return this._isDivided&&(this.topLeft.bounds.overlaps(t)&&(e=e.concat(this.topLeft.query(t))),this.topRight.bounds.overlaps(t)&&(e=e.concat(this.topRight.query(t))),this.bottomLeft.bounds.overlaps(t)&&(e=e.concat(this.bottomLeft.query(t))),this.bottomRight.bounds.overlaps(t)&&(e=e.concat(this.bottomRight.query(t)))),e=e.filter((i,s)=>e.indexOf(i)>=s),e}clear(){this.items=[],this._isDivided=!1,this.topLeft=null,this.topRight=null,this.bottomLeft=null,this.bottomRight=null}getAllItems(){let t=this.items;return this._isDivided&&(t=t.concat(this.topLeft.getAllItems()),t=t.concat(this.topRight.getAllItems()),t=t.concat(this.bottomLeft.getAllItems()),t=t.concat(this.bottomRight.getAllItems())),t=t.filter((e,i)=>t.indexOf(e)>=i),t}getTreeDepth(){return this._isDivided?1+Math.max(this.topLeft.getTreeDepth(),this.topRight.getTreeDepth(),this.bottomLeft.getTreeDepth(),this.bottomRight.getTreeDepth()):0}debug(t){this.bounds.draw(t,q.Yellow),this._isDivided&&(this.topLeft.bounds.draw(t,q.Yellow),this.topRight.bounds.draw(t,q.Yellow),this.bottomLeft.bounds.draw(t,q.Yellow),this.bottomRight.bounds.draw(t,q.Yellow))}}function vu(n){return!!n._initialize}function wu(n){return!!n.onAdd}function yu(n){return!!n.onRemove}function Cu(n){return!!n.onInitialize}function xu(n){return!!n._preupdate}function bu(n){return!!n.onPreUpdate}function Iu(n){return!!n.onPostUpdate}function Eu(n){return!!n.onPostUpdate}function Bu(n){return!!n.onAdd}function Su(n){return!!n.onRemove}function Tu(n){return!!n.onPreDraw}function Qu(n){return!!n.onPostDraw}class Pu{constructor(t,e=!1){this.path=t,this.width=0,this.height=0,this._images=[],this.data=[],this._sprites=[],this._resource=new Pr(t,"arraybuffer",e)}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}async load(){const t=await this._resource.load();this._stream=new ac(t),this._gif=new hc(this._stream);const e=this._gif.images.map(i=>new ii(i.src,!1));return await Promise.all(e.map(i=>i.load())),this.data=this._images=e,this._sprites=this._images.map(i=>i.toSprite()),this.data}isLoaded(){return!!this.data}toSprite(t=0){var e;return(e=this._sprites[t])!==null&&e!==void 0?e:null}toSpriteSheet(){const t=this._sprites;return t.length?new Zi({sprites:t}):null}toAnimation(t){var e;const i=(e=this._gif)===null||e===void 0?void 0:e.images;if(i?.length){const s=i.map((r,o)=>{var a;return{graphic:this._sprites[o],duration:((a=this._gif)===null||a===void 0?void 0:a.frames[o].delayMs)||void 0}});return this._animation=new ze({frames:s,frameDuration:t}),this._animation}return null}get readCheckBytes(){var t,e;return(e=(t=this._gif)===null||t===void 0?void 0:t.checkBytes)!==null&&e!==void 0?e:[]}}const qr=n=>n.reduce(function(t,e){return t*2+e},0),Jn=n=>{const t=[];for(let e=7;e>=0;e--)t.push(!!(n&1<<e));return t};class ac{constructor(t){if(this.len=0,this.position=0,this.readByte=()=>{if(this.position>=this.data.byteLength)throw new Error("Attempted to read past end of stream.");return this.data[this.position++]},this.readBytes=e=>{const i=[];for(let s=0;s<e;s++)i.push(this.readByte());return i},this.read=e=>{let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(this.readByte());return i},this.readUnsigned=()=>{const e=this.readBytes(2);return(e[1]<<8)+e[0]},this.data=new Uint8Array(t),this.len=this.data.byteLength,this.len===0)throw new Error("No data loaded from file")}}const Du=function(n,t){let e=0;const i=function(A){let u=0;for(let p=0;p<A;p++)t.charCodeAt(e>>3)&1<<(e&7)&&(u|=1<<p),e++;return u},s=[],r=1<<n,o=r+1;let a=n+1,h=[];const l=function(){h=[],a=n+1;for(let A=0;A<r;A++)h[A]=[A];h[r]=[],h[o]=null};let c=0,d=0;for(;;){if(d=c,c=i(a),c===r){l();continue}if(c===o)break;if(c<h.length)d!==r&&h.push(h[d].concat(h[c][0]));else{if(c!==h.length)throw new Error("Invalid LZW code.");h.push(h[d].concat(h[d][0]))}s.push.apply(s,h[c]),h.length===1<<a&&a<12&&a++}return s};class hc{constructor(t){this._handler={},this.frames=[],this.images=[],this.globalColorTableBytes=[],this.checkBytes=[],this.parseColorTableBytes=e=>{const i=[];for(let s=0;s<e;s++){const r=this._st.readBytes(3);i.push(r)}return i},this.readSubBlocks=()=>{let e,i;i="";do e=this._st.readByte(),i+=this._st.read(e);while(e!==0);return i},this.parseHeader=()=>{const e={sig:"",ver:"",width:0,height:0,colorResolution:0,globalColorTableSize:0,gctFlag:!1,sortedFlag:!1,globalColorTable:[],backgroundColorIndex:0,pixelAspectRatio:0};if(e.sig=this._st.read(3),e.ver=this._st.read(3),e.sig!=="GIF")throw new Error("Not a GIF file.");e.width=this._st.readUnsigned(),e.height=this._st.readUnsigned(),this._currentFrameCanvas.width=e.width,this._currentFrameCanvas.height=e.height;const i=Jn(this._st.readByte());e.gctFlag=i.shift(),e.colorResolution=qr(i.splice(0,3)),e.sortedFlag=i.shift(),e.globalColorTableSize=qr(i.splice(0,3)),e.backgroundColorIndex=this._st.readByte(),e.pixelAspectRatio=this._st.readByte(),e.gctFlag&&(this.globalColorTableBytes=this.parseColorTableBytes(1<<e.globalColorTableSize+1)),this._handler.hdr&&this._handler.hdr(e)&&this.checkBytes.push(this._handler.hdr)},this.parseExt=e=>{const i=h=>{this.checkBytes.push(this._st.readByte());const l=Jn(this._st.readByte());return h.reserved=l.splice(0,3),h.disposalMethod=qr(l.splice(0,3)),h.userInputFlag=l.shift(),h.transparentColorFlag=l.shift(),h.delayTime=this._st.readUnsigned(),h.transparentColorIndex=this._st.readByte(),h.terminator=this._st.readByte(),this._handler.gce&&this._handler.gce(h)&&this.checkBytes.push(this._handler.gce),h},s=h=>{h.comment=this.readSubBlocks(),this._handler.com&&this._handler.com(h)&&this.checkBytes.push(this._handler.com)},r=h=>{this.checkBytes.push(this._st.readByte()),h.ptHeader=this._st.readBytes(12),h.ptData=this.readSubBlocks(),this._handler.pte&&this._handler.pte(h)&&this.checkBytes.push(this._handler.pte)},o=h=>{const l=d=>{this.checkBytes.push(this._st.readByte()),d.unknown=this._st.readByte(),d.iterations=this._st.readUnsigned(),d.terminator=this._st.readByte(),this._handler.app&&this._handler.app.NETSCAPE&&this._handler.app.NETSCAPE(d)&&this.checkBytes.push(this._handler.app)},c=d=>{d.appData=this.readSubBlocks(),this._handler.app&&this._handler.app[d.identifier]&&this._handler.app[d.identifier](d)&&this.checkBytes.push(this._handler.app[d.identifier])};switch(this.checkBytes.push(this._st.readByte()),h.identifier=this._st.read(8),h.authCode=this._st.read(3),h.identifier){case"NETSCAPE":l(h);break;default:c(h);break}},a=h=>{h.data=this.readSubBlocks(),this._handler.unknown&&this._handler.unknown(h)&&this.checkBytes.push(this._handler.unknown)};switch(e.label=this._st.readByte(),e.label){case 249:e.extType="gce",this._gce=i(e);break;case 254:e.extType="com",s(e);break;case 1:e.extType="pte",r(e);break;case 255:e.extType="app",o(e);break;default:e.extType="unknown",a(e);break}},this.parseImg=e=>{var i;const s=(a,h)=>{const l=new Array(a.length),c=a.length/h,d=(v,C)=>{const y=a.slice(C*h,(C+1)*h);l.splice.apply(l,[v*h,h].concat(y))},A=[0,4,2,1],u=[8,8,4,2];let p=0;for(let v=0;v<4;v++)for(let C=A[v];C<c;C+=u[v])d(C,p),p++;return l};e.leftPos=this._st.readUnsigned(),e.topPos=this._st.readUnsigned(),e.width=this._st.readUnsigned(),e.height=this._st.readUnsigned();const r=Jn(this._st.readByte());e.lctFlag=r.shift(),e.interlaced=r.shift(),e.sorted=r.shift(),e.reserved=r.splice(0,2),e.lctSize=qr(r.splice(0,3)),e.lctFlag&&(e.lctBytes=this.parseColorTableBytes(1<<e.lctSize+1)),e.lzwMinCodeSize=this._st.readByte();const o=this.readSubBlocks();e.pixels=Du(e.lzwMinCodeSize,o),e.interlaced&&(e.pixels=s(e.pixels,e.width)),!((i=this._gce)===null||i===void 0)&&i.delayTime&&(e.delayMs=this._gce.delayTime*10),this.frames.push(e),this.arrayToImage(e,e.lctFlag?e.lctBytes:this.globalColorTableBytes),this._handler.img&&this._handler.img(e)&&this.checkBytes.push(this._handler)},this.parseBlocks=()=>{const e={sentinel:this._st.readByte(),type:""};switch(String.fromCharCode(e.sentinel)){case"!":e.type="ext",this.parseExt(e);break;case",":e.type="img",this.parseImg(e);break;case";":e.type="eof",this._handler.eof&&this._handler.eof(e)&&this.checkBytes.push(this._handler.eof);break;default:throw new Error("Unknown block: 0x"+e.sentinel.toString(16))}e.type!=="eof"&&this.parseBlocks()},this.arrayToImage=(e,i)=>{var s,r,o,a;const h=document.createElement("canvas");h.width=e.width,h.height=e.height;const l=h.getContext("2d"),c=l.getImageData(0,0,h.width,h.height);let d=-1;!((s=this._gce)===null||s===void 0)&&s.transparentColorFlag&&(d=this._gce.transparentColorIndex);for(let u=0;u<e.pixels.length;u++){const p=e.pixels[u],v=i[p];p===d?c.data.set([0,0,0,0],u*4):c.data.set([...v,255],u*4)}if(l.putImageData(c,0,0),((r=this._gce)===null||r===void 0?void 0:r.disposalMethod)===1&&this.images.length)this._currentFrameContext.drawImage(this.images[this.images.length-1],0,0);else if(((o=this._gce)===null||o===void 0?void 0:o.disposalMethod)===2&&(!((a=this._hdr)===null||a===void 0)&&a.gctFlag)){const u=i[this._hdr.backgroundColorIndex];this._currentFrameContext.fillStyle=`rgb(${u[0]}, ${u[1]}, ${u[2]})`,this._currentFrameContext.fillRect(0,0,this._hdr.width,this._hdr.height)}else this._currentFrameContext.clearRect(0,0,this._currentFrameCanvas.width,this._currentFrameCanvas.height);this._currentFrameContext.drawImage(h,e.leftPos,e.topPos,e.width,e.height);const A=new Image;A.src=this._currentFrameCanvas.toDataURL(),this.images.push(A)},this._st=t,this._handler={},this._currentFrameCanvas=document.createElement("canvas"),this._currentFrameContext=this._currentFrameCanvas.getContext("2d"),this.parseHeader(),this.parseBlocks()}}class ku{constructor(t,e,{bustCache:i,...s}={}){this.path=t,this.family=e,this._isLoaded=!1,this._resource=new Pr(t,"blob",i),this._options=s}async load(){if(this.isLoaded())return this.data;try{const t=await this._resource.load(),e=URL.createObjectURL(t);this.data||(this.data=new FontFace(this.family,`url(${e})`),document.fonts.add(this.data)),await this.data.load(),this._isLoaded=!0}catch(t){throw`Error loading FontSource from path '${this.path}' with error [${t.message}]`}return this.data}isLoaded(){return this._isLoaded}toFont(t){return new is({family:this.family,...this._options,...t})}}const lh=sc(),Fu=/^\s*(?:function)?\*/;function ch(n){return typeof n!="function"?!1:Fu.test(Function.prototype.toString.call(n))?!0:Object.getPrototypeOf?Object.getPrototypeOf(n)===Object.getPrototypeOf(new Function("return function * () {}")()):!1}function lc(...n){var t;const e=lt.getInstance();let i,s,r,o;ch(n[0])&&(s=globalThis,i=n[0],r=n[1]),ch(n[1])&&(s=n[0],i=n[1],r=n[2]),n[1]instanceof xe&&(s=n[0],o=n[1],i=n[2],r=n[3]),n[0]instanceof xe&&(s=globalThis,o=n[0],i=n[1],r=n[2]);const a=rc(lh),h=r?.timing,l=a?!1:(t=r?.autostart)!==null&&t!==void 0?t:!0;let c;try{c=o??xe.useEngine()}catch{throw Error(`Cannot run coroutine without engine parameter outside of an excalibur lifecycle method.
Pass an engine parameter to ex.coroutine(engine, function * {...})`)}let d=!1,A=!1,u=!1;const p=i.bind(s),v=p();let C;const y=new Promise((P,I)=>{C=Q=>{try{if(u){A=!0,P();return}const{done:O,value:B}=lh.scope(!0,()=>v.next(Q));if(O||u){A=!0,P();return}B instanceof Promise?B.then(()=>{c.clock.schedule(C,0,h)}):B===void 0||B===void 0?c.clock.schedule(C,0,h):c.clock.schedule(C,B||0,h)}catch(O){I(O);return}},l&&(d=!0,C(c.clock.elapsed()))}),b={isRunning:()=>d&&!u&&!A,isComplete:()=>A,cancel:()=>{u=!0},start:()=>(d?e.warn(`.start() was called on a coroutine that was already started, this is probably a bug:
`,Function.prototype.toString.call(p)):(d=!0,C(c.clock.elapsed())),b),generator:v,done:y,then:y.then.bind(y),[Symbol.iterator]:()=>v};return b}class Gn extends _e{get progress(){return this._currentProgress}get complete(){return this.direction==="out"?this.progress>=1:this.progress<=0}constructor(t){var e,i,s,r;super(),this._logger=lt.getInstance(),this.transform=new tt,this.graphics=new Wt,this._completeFuture=new ke,this.started=!1,this._currentDistance=0,this._currentProgress=0,this.done=this._completeFuture.promise,this.name=`Transition#${this.id}`,this.duration=t.duration,this.easing=(e=t.easing)!==null&&e!==void 0?e:Mt.Linear,this.direction=(i=t.direction)!==null&&i!==void 0?i:"out",this.hideLoader=(s=t.hideLoader)!==null&&s!==void 0?s:!1,this.blockInput=(r=t.blockInput)!==null&&r!==void 0?r:!1,this.transform.coordPlane=Ae.Screen,this.transform.pos=E.Zero,this.transform.z=1/0,this.graphics.anchor=E.Zero,this.addComponent(this.transform),this.addComponent(this.graphics),this.direction==="out"?this._currentProgress=0:this._currentProgress=1}updateTransition(t,e){this.complete||(this._currentDistance+=It(e/this.duration,0,1),this._currentDistance>=1&&(this._currentDistance=1),this.direction==="out"?this._currentProgress=It(this.easing(this._currentDistance,0,1,1),0,1):this._currentProgress=It(this.easing(this._currentDistance,1,0,1),0,1))}async onPreviousSceneDeactivate(t){}onStart(t){}onUpdate(t){}onEnd(t){}onReset(){}reset(){this.started=!1,this._completeFuture=new ke,this.done=this._completeFuture.promise,this._currentDistance=0,this.direction==="out"?this._currentProgress=0:this._currentProgress=1,this.onReset()}_addToTargetScene(t,e){const i=e;if(this.started&&this._logger.warn(`Attempted to add a transition ${this.name} that is already playing.`),i.world.entityManager.getById(this.id))return this._co;this._engine=t,i.add(this);const s=this;return this._co=lc(t,function*(){for(;!s.complete;){const r=yield;s.updateTransition(s._engine,r),s._execute()}},{autostart:!1}),this._co}async _play(){this.started&&(this.reset(),this._logger.warn(`Attempted to play a transition ${this.name} that is already playing, reset transition.`)),(!this._engine||!this._co)&&(this.reset(),this._logger.warn(`Attempted to play a transition ${this.name} that hasn't been added`)),this._co&&await this._co.start()}_execute(){this.isInitialized&&(this.started||(this.started=!0,this.onStart(this.progress)),this.onUpdate(this.progress),this.complete&&!this._completeFuture.isCompleted&&(this.onEnd(this.progress),this._completeFuture.resolve()))}}class Ru extends Gn{constructor(t){var e,i;super({...t,duration:(e=t.duration)!==null&&e!==void 0?e:2e3}),this.name=`FadeInOut#${this.id}`,this.color=(i=t.color)!==null&&i!==void 0?i:q.Black}onInitialize(t){this.transform.pos=t.screen.unsafeArea.topLeft,this.screenCover=new Mr({width:t.screen.resolution.width,height:t.screen.resolution.height,color:this.color}),this.graphics.add(this.screenCover),this.graphics.opacity=this.progress}onReset(){this.graphics.opacity=this.progress}onStart(t){this.graphics.opacity=t}onEnd(t){this.graphics.opacity=t}onUpdate(t){this.graphics.opacity=t}}class Mu extends Gn{constructor(t){super({direction:"in",...t}),this.name=`CrossFade#${this.id}`}async onPreviousSceneDeactivate(t){this.image=await t.engine.screenshot(!0),await this.image.decode()}onInitialize(t){this.engine=t,this.transform.pos=t.screen.unsafeArea.topLeft,this.screenCover=ii.fromHtmlImageElement(this.image).toSprite(),this.graphics.add(this.screenCover),this.transform.scale=T(1/t.screen.pixelRatio,1/t.screen.pixelRatio),this.graphics.opacity=this.progress}onStart(t){this.graphics.opacity=this.progress}onReset(){this.graphics.opacity=this.progress}onEnd(t){this.graphics.opacity=t}onUpdate(t){this.graphics.opacity=t}}class Lu extends Gn{constructor(t){var e;super({direction:"in",...t}),this._easing=Mt.Linear,this.name=`Slide#${this.id}`,this.slideDirection=t.slideDirection,this.transform.coordPlane=Ae.World,this.graphics.forceOnScreen=!0,this._easing=(e=t.easingFunction)!==null&&e!==void 0?e:this._easing,this._vectorEasing=Mt.CreateVectorEasingFunction(this._easing)}async onPreviousSceneDeactivate(t){this._image=await t.engine.screenshot(!0),await this._image.decode(),this._screenCover=ii.fromHtmlImageElement(this._image).toSprite()}onInitialize(t){switch(this._engine=t,this.slideDirection){case"up":{this._directionOffset=T(0,-t.screen.resolution.height);break}case"down":{this._directionOffset=T(0,t.screen.resolution.height);break}case"left":{this._directionOffset=T(-t.screen.resolution.width,0);break}case"right":{this._directionOffset=T(t.screen.resolution.width,0);break}}this._camera=this._engine.currentScene.camera,this._destinationCameraPosition=this._camera.pos.clone(),this._camera.pos=this._camera.pos.add(this._directionOffset),this.transform.pos=this.transform.pos.add(this._directionOffset),this._startCameraPosition=this._camera.pos.clone(),this.graphics.use(this._screenCover),this.transform.scale=T(1/t.screen.pixelRatio,1/t.screen.pixelRatio)}onUpdate(t){this._camera.pos=this._vectorEasing(t,this._destinationCameraPosition,this._startCameraPosition,1)}}class za extends qt{constructor(t){super(),this.color=q.Black,this.thickness=1;const{start:e,end:i,color:s,thickness:r}=t;this.start=e,this.end=i,this.color=s??this.color,this.thickness=r??this.thickness,this._localBounds=this._calculateBounds();const{width:o,height:a}=this._localBounds;this.width=o,this.height=a}get localBounds(){return this._localBounds}_calculateBounds(){const t=this.end.sub(this.start).normal(),e=this.thickness/2,i=[this.start.add(t.scale(e)),this.end.add(t.scale(e)),this.end.add(t.scale(-e)),this.start.add(t.scale(-e))];return ht.fromPoints(i)}_drawImage(t,e,i){t.drawLine(this.start,this.end,this.color,this.thickness)}clone(){return new za({start:this.start,end:this.end,color:this.color,thickness:this.thickness})}}class Oa extends Rs{get points(){return this._points}set points(t){this._points=t;const e=this.minPoint;this.width=this._points.reduce((i,s)=>Math.max(s.x,i),0)-e.x,this.height=this._points.reduce((i,s)=>Math.max(s.y,i),0)-e.y,this.flagDirty()}get minPoint(){const t=this._points.reduce((i,s)=>Math.min(s.x,i),1/0),e=this._points.reduce((i,s)=>Math.min(s.y,i),1/0);return T(t,e)}constructor(t){super(t),this._points=[],this.points=t.points,this.filtering=ie.Blended,this.rasterize()}clone(){return new Oa({points:this.points.map(t=>t.clone()),...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){if(this.points&&this.points.length){t.beginPath();const e=this.minPoint.negate(),i=this.points[0].add(e);t.moveTo(i.x,i.y),this.points.forEach(s=>{t.lineTo(s.x+e.x,s.y+e.y)}),t.lineTo(i.x,i.y),t.closePath(),this.color&&t.fill(),this.strokeColor&&t.stroke()}}}var pi;(function(n){n.Stretch="stretch",n.Tile="tile",n.TileFit="tile-fit"})(pi||(pi={}));class Ha extends qt{constructor(t){super(t),this._logger=lt.getInstance(),this._config=t,this._imgSource=t.source,this._canvasA=document.createElement("canvas"),this._canvasB=document.createElement("canvas"),this._canvasC=document.createElement("canvas"),this._canvasD=document.createElement("canvas"),this._canvasE=document.createElement("canvas"),this._canvasF=document.createElement("canvas"),this._canvasG=document.createElement("canvas"),this._canvasH=document.createElement("canvas"),this._canvasI=document.createElement("canvas"),this._initialize(),this._imgSource.ready.then(()=>{this._initialize()})}setTargetWidth(t,e=!1){this._config.width=t,e&&this._initialize()}setTargetHeight(t,e=!1){this._config.height=t,e&&this._initialize()}setMargins(t,e,i,s,r=!1){this._config.sourceConfig.leftMargin=t,this._config.sourceConfig.topMargin=e,this._config.sourceConfig.rightMargin=i,this._config.sourceConfig.bottomMargin=s,r&&this._initialize()}setStretch(t,e,i=!1){t==="horizontal"?this._config.destinationConfig.horizontalStretch=e:t==="vertical"?this._config.destinationConfig.verticalStretch=e:(this._config.destinationConfig.horizontalStretch=e,this._config.destinationConfig.verticalStretch=e),i&&this._initialize()}getConfig(){return this._config}_drawTile(t,e,i,s,r,o,a){const h=o||0,l=a||0;let c,d,A,u;const p=this._getNumberOfTiles(e.width,i.x,s),v=this._getNumberOfTiles(e.height,i.y,r);for(let C=0;C<p;C++)for(let y=0;y<v;y++){let{tempSize:b,tempPosition:P}=this._calculateParams(C,p,e.width,i.x,this._config.destinationConfig.horizontalStretch);c=b,d=P,{tempSize:b,tempPosition:P}=this._calculateParams(y,v,e.height,i.y,this._config.destinationConfig.verticalStretch),A=b,u=P,t.drawImage(e,0,0,e.width,e.height,h+d,l+u,c,A)}}_drawImage(t,e,i){this._imgSource.isLoaded()?(this._drawTile(t,this._canvasA,new E(this._config.sourceConfig.leftMargin,this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch),this._drawTile(t,this._canvasB,new E(this._config.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.sourceConfig.leftMargin,0),this._drawTile(t,this._canvasC,new E(this._config.sourceConfig.rightMargin,this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.width-this._config.sourceConfig.rightMargin,0),this._drawTile(t,this._canvasD,new E(this._config.sourceConfig.leftMargin,this._config.height-this._config.sourceConfig.bottomMargin-this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,0,this._config.sourceConfig.topMargin),this._config.destinationConfig.drawCenter&&this._drawTile(t,this._canvasE,new E(this._config.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._config.height-this._config.sourceConfig.bottomMargin-this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.sourceConfig.leftMargin,this._config.sourceConfig.topMargin),this._drawTile(t,this._canvasF,new E(this._config.sourceConfig.rightMargin,this._config.height-this._config.sourceConfig.bottomMargin-this._config.sourceConfig.topMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.width-this._config.sourceConfig.rightMargin,this._config.sourceConfig.topMargin),this._drawTile(t,this._canvasG,new E(this._config.sourceConfig.leftMargin,this._config.sourceConfig.bottomMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,0,this._config.height-this._config.sourceConfig.bottomMargin),this._drawTile(t,this._canvasH,new E(this._config.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._config.sourceConfig.bottomMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.sourceConfig.leftMargin,this._config.height-this._config.sourceConfig.bottomMargin),this._drawTile(t,this._canvasI,new E(this._config.sourceConfig.rightMargin,this._config.sourceConfig.bottomMargin),this._config.destinationConfig.horizontalStretch,this._config.destinationConfig.verticalStretch,this._config.width-this._config.sourceConfig.rightMargin,this._config.height-this._config.sourceConfig.bottomMargin)):this._logger.warnOnce(`NineSlice ImageSource ${this._imgSource.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`)}_initialize(){this._sourceSprite=this._imgSource.image,this._canvasA.width=this._config.sourceConfig.leftMargin,this._canvasA.height=this._config.sourceConfig.topMargin;const t=this._canvasA.getContext("2d");t?.drawImage(this._sourceSprite,0,0,this._canvasA.width,this._canvasA.height,0,0,this._canvasA.width,this._canvasA.height),this._canvasB.width=this._config.sourceConfig.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._canvasB.height=this._config.sourceConfig.topMargin;const e=this._canvasB.getContext("2d");e?.drawImage(this._sourceSprite,this._config.sourceConfig.leftMargin,0,this._canvasB.width,this._canvasB.height,0,0,this._canvasB.width,this._canvasB.height),this._canvasC.width=this._config.sourceConfig.rightMargin,this._canvasC.height=this._config.sourceConfig.topMargin;const i=this._canvasC.getContext("2d");i?.drawImage(this._sourceSprite,this._sourceSprite.width-this._config.sourceConfig.rightMargin,0,this._canvasC.width,this._canvasC.height,0,0,this._canvasC.width,this._canvasC.height),this._canvasD.width=this._config.sourceConfig.leftMargin,this._canvasD.height=this._config.sourceConfig.height-this._config.sourceConfig.topMargin-this._config.sourceConfig.bottomMargin;const s=this._canvasD.getContext("2d");s?.drawImage(this._sourceSprite,0,this._config.sourceConfig.topMargin,this._canvasD.width,this._canvasD.height,0,0,this._canvasD.width,this._canvasD.height),this._canvasE.width=this._config.sourceConfig.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._canvasE.height=this._config.sourceConfig.height-this._config.sourceConfig.topMargin-this._config.sourceConfig.bottomMargin;const r=this._canvasE.getContext("2d");r?.drawImage(this._sourceSprite,this._config.sourceConfig.leftMargin,this._config.sourceConfig.topMargin,this._canvasE.width,this._canvasE.height,0,0,this._canvasE.width,this._canvasE.height),this._canvasF.width=this._config.sourceConfig.rightMargin,this._canvasF.height=this._config.sourceConfig.height-this._config.sourceConfig.topMargin-this._config.sourceConfig.bottomMargin;const o=this._canvasF.getContext("2d");o?.drawImage(this._sourceSprite,this._config.sourceConfig.width-this._config.sourceConfig.rightMargin,this._config.sourceConfig.topMargin,this._canvasF.width,this._canvasF.height,0,0,this._canvasF.width,this._canvasF.height),this._canvasG.width=this._config.sourceConfig.leftMargin,this._canvasG.height=this._config.sourceConfig.bottomMargin;const a=this._canvasG.getContext("2d");a?.drawImage(this._sourceSprite,0,this._config.sourceConfig.height-this._config.sourceConfig.bottomMargin,this._canvasG.width,this._canvasG.height,0,0,this._canvasG.width,this._canvasG.height),this._canvasH.width=this._config.sourceConfig.width-this._config.sourceConfig.leftMargin-this._config.sourceConfig.rightMargin,this._canvasH.height=this._config.sourceConfig.bottomMargin;const h=this._canvasH.getContext("2d");h?.drawImage(this._sourceSprite,this._config.sourceConfig.leftMargin,this._config.sourceConfig.height-this._config.sourceConfig.bottomMargin,this._canvasH.width,this._canvasH.height,0,0,this._canvasH.width,this._canvasH.height),this._canvasI.width=this._config.sourceConfig.rightMargin,this._canvasI.height=this._config.sourceConfig.bottomMargin;const l=this._canvasI.getContext("2d");l?.drawImage(this._sourceSprite,this._sourceSprite.width-this._config.sourceConfig.rightMargin,this._config.sourceConfig.height-this._config.sourceConfig.bottomMargin,this._canvasI.width,this._canvasI.height,0,0,this._canvasI.width,this._canvasI.height)}clone(){return new Ha(this._config)}_getNumberOfTiles(t,e,i){switch(i){case pi.Stretch:return 1;case pi.Tile:return Math.ceil(e/t);case pi.TileFit:return Math.ceil(e/t)}}_calculateParams(t,e,i,s,r){switch(r){case pi.Stretch:return{tempPosition:0,tempSize:s};case pi.Tile:return t===e-1?{tempPosition:t*i,tempSize:i-(e*i-s)}:{tempPosition:t*i,tempSize:i};case pi.TileFit:const o=s/e;return{tempPosition:t*o,tempSize:o}}}}class qa extends ze{constructor(t){super({...t,frames:t.animation.frames.slice(),strategy:t.animation.strategy,frameDuration:t.animation.frameDuration,speed:t.animation.speed,reverse:t.animation.isReversed}),this._ready=new ke,this.ready=this._ready.promise,this._tiledWidth=0,this._tiledHeight=0,this._sourceView={},this._sourceView={...t.sourceView},this._tiledWidth=t.width,this._tiledHeight=t.height;const e=[];for(let i=0;i<this.frames.length;i++){const s=this.frames[i].graphic;if(s&&s instanceof We){const r=new Dr({image:s.image,width:t.width,height:t.height,sourceView:{...s.sourceView},wrapping:t.wrapping,filtering:t.filtering});this.frames[i].graphic=r,r.ready.then(()=>{r.sourceView={...r.sourceView,...this._sourceView}}),e.push(r.ready)}}Promise.all(e).then(()=>this._ready.resolve())}static fromAnimation(t,e){return new qa({width:t.width,height:t.height,...e,animation:t})}_updateSourceView(){for(let t=0;t<this.frames.length;t++){const e=this.frames[t].graphic;e&&e instanceof We&&(e.sourceView={...e.sourceView,...this._sourceView})}}get sourceView(){return Oe(this._sourceView,()=>this._updateSourceView())}set sourceView(t){this._sourceView=Oe(t,()=>this._updateSourceView()),this._updateSourceView()}_updateWidthHeight(){for(let t=0;t<this.frames.length;t++){const e=this.frames[t].graphic;e&&e instanceof We&&(e.sourceView.height=this._tiledHeight||e.height,e.destSize.height=this._tiledHeight||e.height,e.sourceView.width=this._tiledWidth||e.width,e.destSize.width=this._tiledWidth||e.width)}}get width(){return this._tiledWidth}get height(){return this._tiledHeight}set width(t){this._tiledWidth=t,this._updateWidthHeight()}set height(t){this._tiledHeight=t,this._updateWidthHeight()}}const cc=5,Bs={},Uu=()=>{for(const n in Bs)Bs[n]=0},Wr=(n,t)=>{const e=de.isEnabled("suppress-obsolete-message");Bs[n]<cc&&!e&&(lt.getInstance().warn(n),console.trace&&t.showStackTrace&&console.trace()),Bs[n]++};function Gu(n){return n={message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrace:!1,...n},function(t,e,i){if(i&&!(typeof i.value=="function"||typeof i.get=="function"||typeof i.set=="function"))throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");const r=`${`${t.name||""}${t.name&&e?".":""}${e||""}`} is marked obsolete: ${n.message}`+(n.alternateMethod?` Use ${n.alternateMethod} instead`:"");Bs[r]||(Bs[r]=0);const o=i?{...i}:t;if(!i){class a extends o{constructor(...l){Wr(r,n),super(...l)}}return a}return i&&i.value?(o.value=function(){return Wr(r,n),i.value.apply(this,arguments)},o):(i&&i.get&&(o.get=function(){return Wr(r,n),i.get.apply(this,arguments)}),i&&i.set&&(o.set=function(){return Wr(r,n),i.set.apply(this,arguments)}),o)}}class Nu{constructor(){this._queue=[]}get length(){return this._queue.length}enqueue(){const t=new ke;return this._queue.push(t),t.promise}dequeue(t){this._queue.shift().resolve(t)}}class zu{constructor(t){this._count=t,this._waitQueue=new Nu}get count(){return this._count}get waiting(){return this._waitQueue.length}async enter(){return this._count!==0?(this._count--,Promise.resolve()):this._waitQueue.enqueue()}exit(t=1){if(t!==0){for(;t!==0&&this._waitQueue.length!==0;)this._waitQueue.dequeue(null),t--;this._count+=t}}}const Bo="0.30.3";Bh();_.eKr;_.yVm;_.a7j;_.U_w;_.JF2;_.htg;_.HXL;_.mcg;var _t=_.Agj;_.J3_;_.Wgv;_.u6S;var Ou=_.x7M,Hu=_.X55;_.m3M;_.aE5;var qu=_.YJU;_.eZi;_.GNv;_.Y56;_._0v;var Wu=_.vhs;_.vrQ;_.Z8b;var ju=_.Yfw,Yu=_.IcQ;_.kgJ;_.GTT;_.ypY;_.i7d;_.fQ3;_.HlI;_.jlt;_.VQc;_.zD7;_.AUF;_.JoF;_.MlA;_.PZh;_.qA;_.CrD;_.dQK;_.D3r;_.Qpo;_.D9n;_.b6v;_.mvh;var cs=_.Bpo,Le=_.Q1f;_.IKv;_.fcV;_.Glf;var Vu=_.uAl;_.ElT;_.Z8r;_.QSL;_.sPV;_.nAn;_.zCU;_.QrV;_.fF9;_.Jqv;_.d_u;_.xI8;_.yar;_.SP7;_.oRy;_.f5X;_.V1c;_.Mlx;_.ZiM;_.ZCo;_.J5p;_.mL_;_.Guw;_.N5j;_.pgY;_.OP3;_.rl5;_.eod;var Zu=_.q5Z;_.YUC;_.saR;_.hvr;_.Qol;_.Wf4;_.JCs;_.gJV;_.fWD;_.Va_;var Xu=_.N$8;_._jQ;_.rxj;_.rhv;_.wCu;_.HAp;_.Zy1;_.bkB;_.wfL;_.sVA;_.$Gs;_.CJ0;_.NWh;_.tWi;_.xAj;_.zWh;_.i_4;_.iIx;_.Hxo;_.c9e;var ws=_.KQV;_.weH;_.jXp;_.zzY;var dc=_.yRQ;_.MtE;_.rPj;_.KLc;_.Fir;_.V5f;_.Xj7;_.Wud;_.FVg;_.g5Y;_.YQB;_.KPb;_.nHK;_.Jrb;_.TX_;_.Olt;_.r3n;_.Fvk;_.gpR;_.vYh;var Ju=_.hnk;_.D2R;_.n1o;_.h9O;_.X5j;_.p3P;_.RLG;_.fBU;_.Adb;var dt=_.bEs;_.wCy;_.CbD;_.x_C;_.pGf;_.ibQ;var Ku=_.shR;_.Yjk;var $u=_._u1;_.OBI;_.klh;_.s3S;var Pe=_.D$R;_.xth;var Vs=_.JU7;_.h9x;_.N1A;_.e_k;var tA=_.aHM;_.tlv;_.Vi9;_.ieR;_.$bb;var eA=_.VyI;_.imn;_.uqu;_.QnL;_.vnc;_.wk_;_.GH0;_._1r;_.l0X;_.bT;_.HHX;_.jtW;_.tjk;_.rWe;_.j9l;_.l0$;_.sGJ;_.NVp;_.cPK;_.XoL;_.RmF;var iA=_.DXI;_.tCD;_.J3D;_.vCJ;_.e6k;_.f9l;_.v9m;_.yRJ;_.EU6;_.m3O;_.Ryz;_.OxP;_.LEs;_.Ec;_.Pi5;_.gmH;_.tS;_.XxX;_.bCz;_.nYS;_.yiT;_.NHl;_.mO8;_.PXI;_.bn5;_.Ywr;_.cMd;_.Bs6;_.G0k;_.pyn;_.QeM;_.aPX;_.ITP;_.BY0;_.MFw;_.sBn;_.S3L;_.XKQ;_.ESI;_.uxz;_.o8N;_.u_r;_.RlV;_.gVA;var dh=_.M_G;_.BpG;_.GRB;_.kM6;_.dO8;_.jgM;_.FWq;_.s3j;_.hlw;_.L0q;_.B7e;_.PGN;_.H_X;_.S_d;_._Tq;_.U7E;_.IOH;var uc=_.Z58;_.yh2;_.ff$;_.cWi;var Wa=_.NBt;_.oNz;_.QlU;_.Xey;_.jft;_._r8;_.bTC;_.Mtr;var sA=_.ypk;_.mnM;_.q7S;var rA=_.bAZ,Os=_.ABN;_.VK6;_.Hj2;_.Df8;_.oOx;_.kxk;_.DT1;var nA=_.FLG;_.qN_;_.Z37;_.FtL;_.Z6X;_.iQT;_.ziO;_.OEF;_.uuE;_.tiv;_.T$Y;var oA=_.EYj,aA=_.nOB;_.Tap;_.FAs;var hA=_.B_P;_.aA5;_.J3s;_.Y0Q;_.M4G;_.l$l;_.dLy;var lA=_.WZP;_.eB6;_.nFK;_.l9z;_.YOF;_.yhB;_.J0N;var L=_.Miz;_.Bj4;_.Rcs;_.vJ4;_.TqC;_.nM0;_.X1u;_.SpZ;_.DX8;_.Yx$;_.HK4;_.yt5;_.vAR;_.SE$;_.qE8;_.Pz7;_.sX_;_.JuI;_.pxT;_.Nl$;_.zDr;_.OwT;_.P$G;_.mHV;_.kEA;_.Fx_;_.WFC;_.vKu;_.aDq;_.jIg;_.UH3;_.AJO;_.U4;_.xAc;_._3Y;_.K6X;_.C1Y;_.Aw1;_.tm8;_.LBV;_.A8$;_.F5e;_.ran;_.c8L;_.o6M;_.hsx;_.l9E;_.aSf;_.CcK;_.nU8;_.td6;_.Zex;_.bkJ;_.mXP;_.vt$;_.hCA;_.pjR;_.U43;_.pSZ;_.y17;_.Ew7;_.hG1;_.jVr;_._SZ;_.xWn;var cA=_.ehJ,dA=_.t6s;_.Eyn;const uA={},AA=Object.freeze(Object.defineProperty({__proto__:null,default:uA},Symbol.toStringTag,{value:"Module"}));var gA={668:(n,t,e)=>{var i={};(0,e(805).assign)(i,e(303),e(83),e(681)),n.exports=i},303:(n,t,e)=>{var i=e(792),s=e(805),r=e(996),o=e(674),a=e(442),h=Object.prototype.toString,l=0,c=-1,d=0,A=8;function u(v){if(!(this instanceof u))return new u(v);this.options=s.assign({level:c,method:A,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},v||{});var C=this.options;C.raw&&C.windowBits>0?C.windowBits=-C.windowBits:C.gzip&&C.windowBits>0&&C.windowBits<16&&(C.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var y=i.deflateInit2(this.strm,C.level,C.method,C.windowBits,C.memLevel,C.strategy);if(y!==l)throw new Error(o[y]);if(C.header&&i.deflateSetHeader(this.strm,C.header),C.dictionary){var b;if(b=typeof C.dictionary=="string"?r.string2buf(C.dictionary):h.call(C.dictionary)==="[object ArrayBuffer]"?new Uint8Array(C.dictionary):C.dictionary,(y=i.deflateSetDictionary(this.strm,b))!==l)throw new Error(o[y]);this._dict_set=!0}}function p(v,C){var y=new u(C);if(y.push(v,!0),y.err)throw y.msg||o[y.err];return y.result}u.prototype.push=function(v,C){var y,b,P=this.strm,I=this.options.chunkSize;if(this.ended)return!1;b=C===~~C?C:C===!0?4:0,typeof v=="string"?P.input=r.string2buf(v):h.call(v)==="[object ArrayBuffer]"?P.input=new Uint8Array(v):P.input=v,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new s.Buf8(I),P.next_out=0,P.avail_out=I),(y=i.deflate(P,b))!==1&&y!==l)return this.onEnd(y),this.ended=!0,!1;P.avail_out!==0&&(P.avail_in!==0||b!==4&&b!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(s.shrinkBuf(P.output,P.next_out))):this.onData(s.shrinkBuf(P.output,P.next_out)))}while((P.avail_in>0||P.avail_out===0)&&y!==1);return b===4?(y=i.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===l):b!==2||(this.onEnd(l),P.avail_out=0,!0)},u.prototype.onData=function(v){this.chunks.push(v)},u.prototype.onEnd=function(v){v===l&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},t.Deflate=u,t.deflate=p,t.deflateRaw=function(v,C){return(C=C||{}).raw=!0,p(v,C)},t.gzip=function(v,C){return(C=C||{}).gzip=!0,p(v,C)}},83:(n,t,e)=>{var i=e(447),s=e(805),r=e(996),o=e(681),a=e(674),h=e(442),l=e(414),c=Object.prototype.toString;function d(u){if(!(this instanceof d))return new d(u);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},u||{});var p=this.options;p.raw&&p.windowBits>=0&&p.windowBits<16&&(p.windowBits=-p.windowBits,p.windowBits===0&&(p.windowBits=-15)),!(p.windowBits>=0&&p.windowBits<16)||u&&u.windowBits||(p.windowBits+=32),p.windowBits>15&&p.windowBits<48&&(15&p.windowBits)==0&&(p.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var v=i.inflateInit2(this.strm,p.windowBits);if(v!==o.Z_OK)throw new Error(a[v]);if(this.header=new l,i.inflateGetHeader(this.strm,this.header),p.dictionary&&(typeof p.dictionary=="string"?p.dictionary=r.string2buf(p.dictionary):c.call(p.dictionary)==="[object ArrayBuffer]"&&(p.dictionary=new Uint8Array(p.dictionary)),p.raw&&(v=i.inflateSetDictionary(this.strm,p.dictionary))!==o.Z_OK))throw new Error(a[v])}function A(u,p){var v=new d(p);if(v.push(u,!0),v.err)throw v.msg||a[v.err];return v.result}d.prototype.push=function(u,p){var v,C,y,b,P,I=this.strm,Q=this.options.chunkSize,O=this.options.dictionary,B=!1;if(this.ended)return!1;C=p===~~p?p:p===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof u=="string"?I.input=r.binstring2buf(u):c.call(u)==="[object ArrayBuffer]"?I.input=new Uint8Array(u):I.input=u,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new s.Buf8(Q),I.next_out=0,I.avail_out=Q),(v=i.inflate(I,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&O&&(v=i.inflateSetDictionary(this.strm,O)),v===o.Z_BUF_ERROR&&B===!0&&(v=o.Z_OK,B=!1),v!==o.Z_STREAM_END&&v!==o.Z_OK)return this.onEnd(v),this.ended=!0,!1;I.next_out&&(I.avail_out!==0&&v!==o.Z_STREAM_END&&(I.avail_in!==0||C!==o.Z_FINISH&&C!==o.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=r.utf8border(I.output,I.next_out),b=I.next_out-y,P=r.buf2string(I.output,y),I.next_out=b,I.avail_out=Q-b,b&&s.arraySet(I.output,I.output,y,b,0),this.onData(P)):this.onData(s.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(B=!0)}while((I.avail_in>0||I.avail_out===0)&&v!==o.Z_STREAM_END);return v===o.Z_STREAM_END&&(C=o.Z_FINISH),C===o.Z_FINISH?(v=i.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===o.Z_OK):C!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),I.avail_out=0,!0)},d.prototype.onData=function(u){this.chunks.push(u)},d.prototype.onEnd=function(u){u===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.msg=this.strm.msg},t.Inflate=d,t.inflate=A,t.inflateRaw=function(u,p){return(p=p||{}).raw=!0,A(u,p)},t.ungzip=A},805:(n,t)=>{var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function i(o,a){return Object.prototype.hasOwnProperty.call(o,a)}t.assign=function(o){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var h=a.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var l in h)i(h,l)&&(o[l]=h[l])}}return o},t.shrinkBuf=function(o,a){return o.length===a?o:o.subarray?o.subarray(0,a):(o.length=a,o)};var s={arraySet:function(o,a,h,l,c){if(a.subarray&&o.subarray)o.set(a.subarray(h,h+l),c);else for(var d=0;d<l;d++)o[c+d]=a[h+d]},flattenChunks:function(o){var a,h,l,c,d,A;for(l=0,a=0,h=o.length;a<h;a++)l+=o[a].length;for(A=new Uint8Array(l),c=0,a=0,h=o.length;a<h;a++)d=o[a],A.set(d,c),c+=d.length;return A}},r={arraySet:function(o,a,h,l,c){for(var d=0;d<l;d++)o[c+d]=a[h+d]},flattenChunks:function(o){return[].concat.apply([],o)}};t.setTyped=function(o){o?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,s)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,r))},t.setTyped(e)},996:(n,t,e)=>{var i=e(805),s=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var o=new i.Buf8(256),a=0;a<256;a++)o[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function h(l,c){if(c<65534&&(l.subarray&&r||!l.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(l,c));for(var d="",A=0;A<c;A++)d+=String.fromCharCode(l[A]);return d}o[254]=o[254]=1,t.string2buf=function(l){var c,d,A,u,p,v=l.length,C=0;for(u=0;u<v;u++)(64512&(d=l.charCodeAt(u)))==55296&&u+1<v&&(64512&(A=l.charCodeAt(u+1)))==56320&&(d=65536+(d-55296<<10)+(A-56320),u++),C+=d<128?1:d<2048?2:d<65536?3:4;for(c=new i.Buf8(C),p=0,u=0;p<C;u++)(64512&(d=l.charCodeAt(u)))==55296&&u+1<v&&(64512&(A=l.charCodeAt(u+1)))==56320&&(d=65536+(d-55296<<10)+(A-56320),u++),d<128?c[p++]=d:d<2048?(c[p++]=192|d>>>6,c[p++]=128|63&d):d<65536?(c[p++]=224|d>>>12,c[p++]=128|d>>>6&63,c[p++]=128|63&d):(c[p++]=240|d>>>18,c[p++]=128|d>>>12&63,c[p++]=128|d>>>6&63,c[p++]=128|63&d);return c},t.buf2binstring=function(l){return h(l,l.length)},t.binstring2buf=function(l){for(var c=new i.Buf8(l.length),d=0,A=c.length;d<A;d++)c[d]=l.charCodeAt(d);return c},t.buf2string=function(l,c){var d,A,u,p,v=c||l.length,C=new Array(2*v);for(A=0,d=0;d<v;)if((u=l[d++])<128)C[A++]=u;else if((p=o[u])>4)C[A++]=65533,d+=p-1;else{for(u&=p===2?31:p===3?15:7;p>1&&d<v;)u=u<<6|63&l[d++],p--;p>1?C[A++]=65533:u<65536?C[A++]=u:(u-=65536,C[A++]=55296|u>>10&1023,C[A++]=56320|1023&u)}return h(C,A)},t.utf8border=function(l,c){var d;for((c=c||l.length)>l.length&&(c=l.length),d=c-1;d>=0&&(192&l[d])==128;)d--;return d<0||d===0?c:d+o[l[d]]>c?d:c}},269:n=>{n.exports=function(t,e,i,s){for(var r=65535&t|0,o=t>>>16&65535|0,a=0;i!==0;){i-=a=i>2e3?2e3:i;do o=o+(r=r+e[s++]|0)|0;while(--a);r%=65521,o%=65521}return r|o<<16|0}},681:n=>{n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},823:n=>{var t=function(){for(var e,i=[],s=0;s<256;s++){e=s;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;i[s]=e}return i}();n.exports=function(e,i,s,r){var o=t,a=r+s;e^=-1;for(var h=r;h<a;h++)e=e>>>8^o[255&(e^i[h])];return-1^e}},792:(n,t,e)=>{var i,s=e(805),r=e(665),o=e(269),a=e(823),h=e(674),l=0,c=4,d=0,A=-2,u=-1,p=4,v=2,C=8,y=9,b=286,P=30,I=19,Q=2*b+1,O=15,B=3,j=258,$=j+B+1,st=42,Z=103,S=113,z=666,f=1,X=2,ct=3,D=4;function wt(g,U){return g.msg=h[U],U}function K(g){return(g<<1)-(g>4?9:0)}function pt(g){for(var U=g.length;--U>=0;)g[U]=0}function M(g){var U=g.state,w=U.pending;w>g.avail_out&&(w=g.avail_out),w!==0&&(s.arraySet(g.output,U.pending_buf,U.pending_out,w,g.next_out),g.next_out+=w,U.pending_out+=w,g.total_out+=w,g.avail_out-=w,U.pending-=w,U.pending===0&&(U.pending_out=0))}function F(g,U){r._tr_flush_block(g,g.block_start>=0?g.block_start:-1,g.strstart-g.block_start,U),g.block_start=g.strstart,M(g.strm)}function nt(g,U){g.pending_buf[g.pending++]=U}function Ct(g,U){g.pending_buf[g.pending++]=U>>>8&255,g.pending_buf[g.pending++]=255&U}function rt(g,U){var w,m,N=g.max_chain_length,H=g.strstart,G=g.prev_length,Y=g.nice_match,W=g.strstart>g.w_size-$?g.strstart-(g.w_size-$):0,V=g.window,ot=g.w_mask,At=g.prev,Et=g.strstart+j,ne=V[H+G-1],Xt=V[H+G];g.prev_length>=g.good_match&&(N>>=2),Y>g.lookahead&&(Y=g.lookahead);do if(V[(w=U)+G]===Xt&&V[w+G-1]===ne&&V[w]===V[H]&&V[++w]===V[H+1]){H+=2,w++;do;while(V[++H]===V[++w]&&V[++H]===V[++w]&&V[++H]===V[++w]&&V[++H]===V[++w]&&V[++H]===V[++w]&&V[++H]===V[++w]&&V[++H]===V[++w]&&V[++H]===V[++w]&&H<Et);if(m=j-(Et-H),H=Et-j,m>G){if(g.match_start=U,G=m,m>=Y)break;ne=V[H+G-1],Xt=V[H+G]}}while((U=At[U&ot])>W&&--N!=0);return G<=g.lookahead?G:g.lookahead}function Vt(g){var U,w,m,N,H,G,Y,W,V,ot,At=g.w_size;do{if(N=g.window_size-g.lookahead-g.strstart,g.strstart>=At+(At-$)){s.arraySet(g.window,g.window,At,At,0),g.match_start-=At,g.strstart-=At,g.block_start-=At,U=w=g.hash_size;do m=g.head[--U],g.head[U]=m>=At?m-At:0;while(--w);U=w=At;do m=g.prev[--U],g.prev[U]=m>=At?m-At:0;while(--w);N+=At}if(g.strm.avail_in===0)break;if(G=g.strm,Y=g.window,W=g.strstart+g.lookahead,V=N,ot=void 0,(ot=G.avail_in)>V&&(ot=V),w=ot===0?0:(G.avail_in-=ot,s.arraySet(Y,G.input,G.next_in,ot,W),G.state.wrap===1?G.adler=o(G.adler,Y,ot,W):G.state.wrap===2&&(G.adler=a(G.adler,Y,ot,W)),G.next_in+=ot,G.total_in+=ot,ot),g.lookahead+=w,g.lookahead+g.insert>=B)for(H=g.strstart-g.insert,g.ins_h=g.window[H],g.ins_h=(g.ins_h<<g.hash_shift^g.window[H+1])&g.hash_mask;g.insert&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[H+B-1])&g.hash_mask,g.prev[H&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=H,H++,g.insert--,!(g.lookahead+g.insert<B)););}while(g.lookahead<$&&g.strm.avail_in!==0)}function Re(g,U){for(var w,m;;){if(g.lookahead<$){if(Vt(g),g.lookahead<$&&U===l)return f;if(g.lookahead===0)break}if(w=0,g.lookahead>=B&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+B-1])&g.hash_mask,w=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),w!==0&&g.strstart-w<=g.w_size-$&&(g.match_length=rt(g,w)),g.match_length>=B)if(m=r._tr_tally(g,g.strstart-g.match_start,g.match_length-B),g.lookahead-=g.match_length,g.match_length<=g.max_lazy_match&&g.lookahead>=B){g.match_length--;do g.strstart++,g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+B-1])&g.hash_mask,w=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart;while(--g.match_length!=0);g.strstart++}else g.strstart+=g.match_length,g.match_length=0,g.ins_h=g.window[g.strstart],g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+1])&g.hash_mask;else m=r._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++;if(m&&(F(g,!1),g.strm.avail_out===0))return f}return g.insert=g.strstart<B-1?g.strstart:B-1,U===c?(F(g,!0),g.strm.avail_out===0?ct:D):g.last_lit&&(F(g,!1),g.strm.avail_out===0)?f:X}function St(g,U){for(var w,m,N;;){if(g.lookahead<$){if(Vt(g),g.lookahead<$&&U===l)return f;if(g.lookahead===0)break}if(w=0,g.lookahead>=B&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+B-1])&g.hash_mask,w=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),g.prev_length=g.match_length,g.prev_match=g.match_start,g.match_length=B-1,w!==0&&g.prev_length<g.max_lazy_match&&g.strstart-w<=g.w_size-$&&(g.match_length=rt(g,w),g.match_length<=5&&(g.strategy===1||g.match_length===B&&g.strstart-g.match_start>4096)&&(g.match_length=B-1)),g.prev_length>=B&&g.match_length<=g.prev_length){N=g.strstart+g.lookahead-B,m=r._tr_tally(g,g.strstart-1-g.prev_match,g.prev_length-B),g.lookahead-=g.prev_length-1,g.prev_length-=2;do++g.strstart<=N&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+B-1])&g.hash_mask,w=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart);while(--g.prev_length!=0);if(g.match_available=0,g.match_length=B-1,g.strstart++,m&&(F(g,!1),g.strm.avail_out===0))return f}else if(g.match_available){if((m=r._tr_tally(g,0,g.window[g.strstart-1]))&&F(g,!1),g.strstart++,g.lookahead--,g.strm.avail_out===0)return f}else g.match_available=1,g.strstart++,g.lookahead--}return g.match_available&&(m=r._tr_tally(g,0,g.window[g.strstart-1]),g.match_available=0),g.insert=g.strstart<B-1?g.strstart:B-1,U===c?(F(g,!0),g.strm.avail_out===0?ct:D):g.last_lit&&(F(g,!1),g.strm.avail_out===0)?f:X}function Qt(g,U,w,m,N){this.good_length=g,this.max_lazy=U,this.nice_length=w,this.max_chain=m,this.func=N}function ce(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=C,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*Q),this.dyn_dtree=new s.Buf16(2*(2*P+1)),this.bl_tree=new s.Buf16(2*(2*I+1)),pt(this.dyn_ltree),pt(this.dyn_dtree),pt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(O+1),this.heap=new s.Buf16(2*b+1),pt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*b+1),pt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Zt(g){var U;return g&&g.state?(g.total_in=g.total_out=0,g.data_type=v,(U=g.state).pending=0,U.pending_out=0,U.wrap<0&&(U.wrap=-U.wrap),U.status=U.wrap?st:S,g.adler=U.wrap===2?0:1,U.last_flush=l,r._tr_init(U),d):wt(g,A)}function Xe(g){var U,w=Zt(g);return w===d&&((U=g.state).window_size=2*U.w_size,pt(U.head),U.max_lazy_match=i[U.level].max_lazy,U.good_match=i[U.level].good_length,U.nice_match=i[U.level].nice_length,U.max_chain_length=i[U.level].max_chain,U.strstart=0,U.block_start=0,U.lookahead=0,U.insert=0,U.match_length=U.prev_length=B-1,U.match_available=0,U.ins_h=0),w}function Je(g,U,w,m,N,H){if(!g)return A;var G=1;if(U===u&&(U=6),m<0?(G=0,m=-m):m>15&&(G=2,m-=16),N<1||N>y||w!==C||m<8||m>15||U<0||U>9||H<0||H>p)return wt(g,A);m===8&&(m=9);var Y=new ce;return g.state=Y,Y.strm=g,Y.wrap=G,Y.gzhead=null,Y.w_bits=m,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=N+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+B-1)/B),Y.window=new s.Buf8(2*Y.w_size),Y.head=new s.Buf16(Y.hash_size),Y.prev=new s.Buf16(Y.w_size),Y.lit_bufsize=1<<N+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new s.Buf8(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=U,Y.strategy=H,Y.method=w,Xe(g)}i=[new Qt(0,0,0,0,function(g,U){var w=65535;for(w>g.pending_buf_size-5&&(w=g.pending_buf_size-5);;){if(g.lookahead<=1){if(Vt(g),g.lookahead===0&&U===l)return f;if(g.lookahead===0)break}g.strstart+=g.lookahead,g.lookahead=0;var m=g.block_start+w;if((g.strstart===0||g.strstart>=m)&&(g.lookahead=g.strstart-m,g.strstart=m,F(g,!1),g.strm.avail_out===0)||g.strstart-g.block_start>=g.w_size-$&&(F(g,!1),g.strm.avail_out===0))return f}return g.insert=0,U===c?(F(g,!0),g.strm.avail_out===0?ct:D):(g.strstart>g.block_start&&(F(g,!1),g.strm.avail_out),f)}),new Qt(4,4,8,4,Re),new Qt(4,5,16,8,Re),new Qt(4,6,32,32,Re),new Qt(4,4,16,16,St),new Qt(8,16,32,32,St),new Qt(8,16,128,128,St),new Qt(8,32,128,256,St),new Qt(32,128,258,1024,St),new Qt(32,258,258,4096,St)],t.deflateInit=function(g,U){return Je(g,U,C,15,8,0)},t.deflateInit2=Je,t.deflateReset=Xe,t.deflateResetKeep=Zt,t.deflateSetHeader=function(g,U){return g&&g.state?g.state.wrap!==2?A:(g.state.gzhead=U,d):A},t.deflate=function(g,U){var w,m,N,H;if(!g||!g.state||U>5||U<0)return g?wt(g,A):A;if(m=g.state,!g.output||!g.input&&g.avail_in!==0||m.status===z&&U!==c)return wt(g,g.avail_out===0?-5:A);if(m.strm=g,w=m.last_flush,m.last_flush=U,m.status===st)if(m.wrap===2)g.adler=0,nt(m,31),nt(m,139),nt(m,8),m.gzhead?(nt(m,(m.gzhead.text?1:0)+(m.gzhead.hcrc?2:0)+(m.gzhead.extra?4:0)+(m.gzhead.name?8:0)+(m.gzhead.comment?16:0)),nt(m,255&m.gzhead.time),nt(m,m.gzhead.time>>8&255),nt(m,m.gzhead.time>>16&255),nt(m,m.gzhead.time>>24&255),nt(m,m.level===9?2:m.strategy>=2||m.level<2?4:0),nt(m,255&m.gzhead.os),m.gzhead.extra&&m.gzhead.extra.length&&(nt(m,255&m.gzhead.extra.length),nt(m,m.gzhead.extra.length>>8&255)),m.gzhead.hcrc&&(g.adler=a(g.adler,m.pending_buf,m.pending,0)),m.gzindex=0,m.status=69):(nt(m,0),nt(m,0),nt(m,0),nt(m,0),nt(m,0),nt(m,m.level===9?2:m.strategy>=2||m.level<2?4:0),nt(m,3),m.status=S);else{var G=C+(m.w_bits-8<<4)<<8;G|=(m.strategy>=2||m.level<2?0:m.level<6?1:m.level===6?2:3)<<6,m.strstart!==0&&(G|=32),G+=31-G%31,m.status=S,Ct(m,G),m.strstart!==0&&(Ct(m,g.adler>>>16),Ct(m,65535&g.adler)),g.adler=1}if(m.status===69)if(m.gzhead.extra){for(N=m.pending;m.gzindex<(65535&m.gzhead.extra.length)&&(m.pending!==m.pending_buf_size||(m.gzhead.hcrc&&m.pending>N&&(g.adler=a(g.adler,m.pending_buf,m.pending-N,N)),M(g),N=m.pending,m.pending!==m.pending_buf_size));)nt(m,255&m.gzhead.extra[m.gzindex]),m.gzindex++;m.gzhead.hcrc&&m.pending>N&&(g.adler=a(g.adler,m.pending_buf,m.pending-N,N)),m.gzindex===m.gzhead.extra.length&&(m.gzindex=0,m.status=73)}else m.status=73;if(m.status===73)if(m.gzhead.name){N=m.pending;do{if(m.pending===m.pending_buf_size&&(m.gzhead.hcrc&&m.pending>N&&(g.adler=a(g.adler,m.pending_buf,m.pending-N,N)),M(g),N=m.pending,m.pending===m.pending_buf_size)){H=1;break}H=m.gzindex<m.gzhead.name.length?255&m.gzhead.name.charCodeAt(m.gzindex++):0,nt(m,H)}while(H!==0);m.gzhead.hcrc&&m.pending>N&&(g.adler=a(g.adler,m.pending_buf,m.pending-N,N)),H===0&&(m.gzindex=0,m.status=91)}else m.status=91;if(m.status===91)if(m.gzhead.comment){N=m.pending;do{if(m.pending===m.pending_buf_size&&(m.gzhead.hcrc&&m.pending>N&&(g.adler=a(g.adler,m.pending_buf,m.pending-N,N)),M(g),N=m.pending,m.pending===m.pending_buf_size)){H=1;break}H=m.gzindex<m.gzhead.comment.length?255&m.gzhead.comment.charCodeAt(m.gzindex++):0,nt(m,H)}while(H!==0);m.gzhead.hcrc&&m.pending>N&&(g.adler=a(g.adler,m.pending_buf,m.pending-N,N)),H===0&&(m.status=Z)}else m.status=Z;if(m.status===Z&&(m.gzhead.hcrc?(m.pending+2>m.pending_buf_size&&M(g),m.pending+2<=m.pending_buf_size&&(nt(m,255&g.adler),nt(m,g.adler>>8&255),g.adler=0,m.status=S)):m.status=S),m.pending!==0){if(M(g),g.avail_out===0)return m.last_flush=-1,d}else if(g.avail_in===0&&K(U)<=K(w)&&U!==c)return wt(g,-5);if(m.status===z&&g.avail_in!==0)return wt(g,-5);if(g.avail_in!==0||m.lookahead!==0||U!==l&&m.status!==z){var Y=m.strategy===2?function(W,V){for(var ot;;){if(W.lookahead===0&&(Vt(W),W.lookahead===0)){if(V===l)return f;break}if(W.match_length=0,ot=r._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++,ot&&(F(W,!1),W.strm.avail_out===0))return f}return W.insert=0,V===c?(F(W,!0),W.strm.avail_out===0?ct:D):W.last_lit&&(F(W,!1),W.strm.avail_out===0)?f:X}(m,U):m.strategy===3?function(W,V){for(var ot,At,Et,ne,Xt=W.window;;){if(W.lookahead<=j){if(Vt(W),W.lookahead<=j&&V===l)return f;if(W.lookahead===0)break}if(W.match_length=0,W.lookahead>=B&&W.strstart>0&&(At=Xt[Et=W.strstart-1])===Xt[++Et]&&At===Xt[++Et]&&At===Xt[++Et]){ne=W.strstart+j;do;while(At===Xt[++Et]&&At===Xt[++Et]&&At===Xt[++Et]&&At===Xt[++Et]&&At===Xt[++Et]&&At===Xt[++Et]&&At===Xt[++Et]&&At===Xt[++Et]&&Et<ne);W.match_length=j-(ne-Et),W.match_length>W.lookahead&&(W.match_length=W.lookahead)}if(W.match_length>=B?(ot=r._tr_tally(W,1,W.match_length-B),W.lookahead-=W.match_length,W.strstart+=W.match_length,W.match_length=0):(ot=r._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++),ot&&(F(W,!1),W.strm.avail_out===0))return f}return W.insert=0,V===c?(F(W,!0),W.strm.avail_out===0?ct:D):W.last_lit&&(F(W,!1),W.strm.avail_out===0)?f:X}(m,U):i[m.level].func(m,U);if(Y!==ct&&Y!==D||(m.status=z),Y===f||Y===ct)return g.avail_out===0&&(m.last_flush=-1),d;if(Y===X&&(U===1?r._tr_align(m):U!==5&&(r._tr_stored_block(m,0,0,!1),U===3&&(pt(m.head),m.lookahead===0&&(m.strstart=0,m.block_start=0,m.insert=0))),M(g),g.avail_out===0))return m.last_flush=-1,d}return U!==c?d:m.wrap<=0?1:(m.wrap===2?(nt(m,255&g.adler),nt(m,g.adler>>8&255),nt(m,g.adler>>16&255),nt(m,g.adler>>24&255),nt(m,255&g.total_in),nt(m,g.total_in>>8&255),nt(m,g.total_in>>16&255),nt(m,g.total_in>>24&255)):(Ct(m,g.adler>>>16),Ct(m,65535&g.adler)),M(g),m.wrap>0&&(m.wrap=-m.wrap),m.pending!==0?d:1)},t.deflateEnd=function(g){var U;return g&&g.state?(U=g.state.status)!==st&&U!==69&&U!==73&&U!==91&&U!==Z&&U!==S&&U!==z?wt(g,A):(g.state=null,U===S?wt(g,-3):d):A},t.deflateSetDictionary=function(g,U){var w,m,N,H,G,Y,W,V,ot=U.length;if(!g||!g.state||(H=(w=g.state).wrap)===2||H===1&&w.status!==st||w.lookahead)return A;for(H===1&&(g.adler=o(g.adler,U,ot,0)),w.wrap=0,ot>=w.w_size&&(H===0&&(pt(w.head),w.strstart=0,w.block_start=0,w.insert=0),V=new s.Buf8(w.w_size),s.arraySet(V,U,ot-w.w_size,w.w_size,0),U=V,ot=w.w_size),G=g.avail_in,Y=g.next_in,W=g.input,g.avail_in=ot,g.next_in=0,g.input=U,Vt(w);w.lookahead>=B;){m=w.strstart,N=w.lookahead-(B-1);do w.ins_h=(w.ins_h<<w.hash_shift^w.window[m+B-1])&w.hash_mask,w.prev[m&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=m,m++;while(--N);w.strstart=m,w.lookahead=B-1,Vt(w)}return w.strstart+=w.lookahead,w.block_start=w.strstart,w.insert=w.lookahead,w.lookahead=0,w.match_length=w.prev_length=B-1,w.match_available=0,g.next_in=Y,g.input=W,g.avail_in=G,w.wrap=H,d},t.deflateInfo="pako deflate (from Nodeca project)"},414:n=>{n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},293:n=>{n.exports=function(t,e){var i,s,r,o,a,h,l,c,d,A,u,p,v,C,y,b,P,I,Q,O,B,j,$,st,Z;i=t.state,s=t.next_in,st=t.input,r=s+(t.avail_in-5),o=t.next_out,Z=t.output,a=o-(e-t.avail_out),h=o+(t.avail_out-257),l=i.dmax,c=i.wsize,d=i.whave,A=i.wnext,u=i.window,p=i.hold,v=i.bits,C=i.lencode,y=i.distcode,b=(1<<i.lenbits)-1,P=(1<<i.distbits)-1;t:do{v<15&&(p+=st[s++]<<v,v+=8,p+=st[s++]<<v,v+=8),I=C[p&b];e:for(;;){if(p>>>=Q=I>>>24,v-=Q,(Q=I>>>16&255)===0)Z[o++]=65535&I;else{if(!(16&Q)){if((64&Q)==0){I=C[(65535&I)+(p&(1<<Q)-1)];continue e}if(32&Q){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}O=65535&I,(Q&=15)&&(v<Q&&(p+=st[s++]<<v,v+=8),O+=p&(1<<Q)-1,p>>>=Q,v-=Q),v<15&&(p+=st[s++]<<v,v+=8,p+=st[s++]<<v,v+=8),I=y[p&P];i:for(;;){if(p>>>=Q=I>>>24,v-=Q,!(16&(Q=I>>>16&255))){if((64&Q)==0){I=y[(65535&I)+(p&(1<<Q)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(B=65535&I,v<(Q&=15)&&(p+=st[s++]<<v,(v+=8)<Q&&(p+=st[s++]<<v,v+=8)),(B+=p&(1<<Q)-1)>l){t.msg="invalid distance too far back",i.mode=30;break t}if(p>>>=Q,v-=Q,B>(Q=o-a)){if((Q=B-Q)>d&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(j=0,$=u,A===0){if(j+=c-Q,Q<O){O-=Q;do Z[o++]=u[j++];while(--Q);j=o-B,$=Z}}else if(A<Q){if(j+=c+A-Q,(Q-=A)<O){O-=Q;do Z[o++]=u[j++];while(--Q);if(j=0,A<O){O-=Q=A;do Z[o++]=u[j++];while(--Q);j=o-B,$=Z}}}else if(j+=A-Q,Q<O){O-=Q;do Z[o++]=u[j++];while(--Q);j=o-B,$=Z}for(;O>2;)Z[o++]=$[j++],Z[o++]=$[j++],Z[o++]=$[j++],O-=3;O&&(Z[o++]=$[j++],O>1&&(Z[o++]=$[j++]))}else{j=o-B;do Z[o++]=Z[j++],Z[o++]=Z[j++],Z[o++]=Z[j++],O-=3;while(O>2);O&&(Z[o++]=Z[j++],O>1&&(Z[o++]=Z[j++]))}break}}break}}while(s<r&&o<h);s-=O=v>>3,p&=(1<<(v-=O<<3))-1,t.next_in=s,t.next_out=o,t.avail_in=s<r?r-s+5:5-(s-r),t.avail_out=o<h?h-o+257:257-(o-h),i.hold=p,i.bits=v}},447:(n,t,e)=>{var i=e(805),s=e(269),r=e(823),o=e(293),a=e(998),h=1,l=2,c=0,d=-2,A=1,u=12,p=30,v=852,C=592;function y(S){return(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function P(S){var z;return S&&S.state?(z=S.state,S.total_in=S.total_out=z.total=0,S.msg="",z.wrap&&(S.adler=1&z.wrap),z.mode=A,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new i.Buf32(v),z.distcode=z.distdyn=new i.Buf32(C),z.sane=1,z.back=-1,c):d}function I(S){var z;return S&&S.state?((z=S.state).wsize=0,z.whave=0,z.wnext=0,P(S)):d}function Q(S,z){var f,X;return S&&S.state?(X=S.state,z<0?(f=0,z=-z):(f=1+(z>>4),z<48&&(z&=15)),z&&(z<8||z>15)?d:(X.window!==null&&X.wbits!==z&&(X.window=null),X.wrap=f,X.wbits=z,I(S))):d}function O(S,z){var f,X;return S?(X=new b,S.state=X,X.window=null,(f=Q(S,z))!==c&&(S.state=null),f):d}var B,j,$=!0;function st(S){if($){var z;for(B=new i.Buf32(512),j=new i.Buf32(32),z=0;z<144;)S.lens[z++]=8;for(;z<256;)S.lens[z++]=9;for(;z<280;)S.lens[z++]=7;for(;z<288;)S.lens[z++]=8;for(a(h,S.lens,0,288,B,0,S.work,{bits:9}),z=0;z<32;)S.lens[z++]=5;a(l,S.lens,0,32,j,0,S.work,{bits:5}),$=!1}S.lencode=B,S.lenbits=9,S.distcode=j,S.distbits=5}function Z(S,z,f,X){var ct,D=S.state;return D.window===null&&(D.wsize=1<<D.wbits,D.wnext=0,D.whave=0,D.window=new i.Buf8(D.wsize)),X>=D.wsize?(i.arraySet(D.window,z,f-D.wsize,D.wsize,0),D.wnext=0,D.whave=D.wsize):((ct=D.wsize-D.wnext)>X&&(ct=X),i.arraySet(D.window,z,f-X,ct,D.wnext),(X-=ct)?(i.arraySet(D.window,z,f-X,X,0),D.wnext=X,D.whave=D.wsize):(D.wnext+=ct,D.wnext===D.wsize&&(D.wnext=0),D.whave<D.wsize&&(D.whave+=ct))),0}t.inflateReset=I,t.inflateReset2=Q,t.inflateResetKeep=P,t.inflateInit=function(S){return O(S,15)},t.inflateInit2=O,t.inflate=function(S,z){var f,X,ct,D,wt,K,pt,M,F,nt,Ct,rt,Vt,Re,St,Qt,ce,Zt,Xe,Je,g,U,w,m,N=0,H=new i.Buf8(4),G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!S||!S.state||!S.output||!S.input&&S.avail_in!==0)return d;(f=S.state).mode===u&&(f.mode=13),wt=S.next_out,ct=S.output,pt=S.avail_out,D=S.next_in,X=S.input,K=S.avail_in,M=f.hold,F=f.bits,nt=K,Ct=pt,U=c;t:for(;;)switch(f.mode){case A:if(f.wrap===0){f.mode=13;break}for(;F<16;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}if(2&f.wrap&&M===35615){f.check=0,H[0]=255&M,H[1]=M>>>8&255,f.check=r(f.check,H,2,0),M=0,F=0,f.mode=2;break}if(f.flags=0,f.head&&(f.head.done=!1),!(1&f.wrap)||(((255&M)<<8)+(M>>8))%31){S.msg="incorrect header check",f.mode=p;break}if((15&M)!=8){S.msg="unknown compression method",f.mode=p;break}if(F-=4,g=8+(15&(M>>>=4)),f.wbits===0)f.wbits=g;else if(g>f.wbits){S.msg="invalid window size",f.mode=p;break}f.dmax=1<<g,S.adler=f.check=1,f.mode=512&M?10:u,M=0,F=0;break;case 2:for(;F<16;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}if(f.flags=M,(255&f.flags)!=8){S.msg="unknown compression method",f.mode=p;break}if(57344&f.flags){S.msg="unknown header flags set",f.mode=p;break}f.head&&(f.head.text=M>>8&1),512&f.flags&&(H[0]=255&M,H[1]=M>>>8&255,f.check=r(f.check,H,2,0)),M=0,F=0,f.mode=3;case 3:for(;F<32;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}f.head&&(f.head.time=M),512&f.flags&&(H[0]=255&M,H[1]=M>>>8&255,H[2]=M>>>16&255,H[3]=M>>>24&255,f.check=r(f.check,H,4,0)),M=0,F=0,f.mode=4;case 4:for(;F<16;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}f.head&&(f.head.xflags=255&M,f.head.os=M>>8),512&f.flags&&(H[0]=255&M,H[1]=M>>>8&255,f.check=r(f.check,H,2,0)),M=0,F=0,f.mode=5;case 5:if(1024&f.flags){for(;F<16;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}f.length=M,f.head&&(f.head.extra_len=M),512&f.flags&&(H[0]=255&M,H[1]=M>>>8&255,f.check=r(f.check,H,2,0)),M=0,F=0}else f.head&&(f.head.extra=null);f.mode=6;case 6:if(1024&f.flags&&((rt=f.length)>K&&(rt=K),rt&&(f.head&&(g=f.head.extra_len-f.length,f.head.extra||(f.head.extra=new Array(f.head.extra_len)),i.arraySet(f.head.extra,X,D,rt,g)),512&f.flags&&(f.check=r(f.check,X,rt,D)),K-=rt,D+=rt,f.length-=rt),f.length))break t;f.length=0,f.mode=7;case 7:if(2048&f.flags){if(K===0)break t;rt=0;do g=X[D+rt++],f.head&&g&&f.length<65536&&(f.head.name+=String.fromCharCode(g));while(g&&rt<K);if(512&f.flags&&(f.check=r(f.check,X,rt,D)),K-=rt,D+=rt,g)break t}else f.head&&(f.head.name=null);f.length=0,f.mode=8;case 8:if(4096&f.flags){if(K===0)break t;rt=0;do g=X[D+rt++],f.head&&g&&f.length<65536&&(f.head.comment+=String.fromCharCode(g));while(g&&rt<K);if(512&f.flags&&(f.check=r(f.check,X,rt,D)),K-=rt,D+=rt,g)break t}else f.head&&(f.head.comment=null);f.mode=9;case 9:if(512&f.flags){for(;F<16;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}if(M!==(65535&f.check)){S.msg="header crc mismatch",f.mode=p;break}M=0,F=0}f.head&&(f.head.hcrc=f.flags>>9&1,f.head.done=!0),S.adler=f.check=0,f.mode=u;break;case 10:for(;F<32;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}S.adler=f.check=y(M),M=0,F=0,f.mode=11;case 11:if(f.havedict===0)return S.next_out=wt,S.avail_out=pt,S.next_in=D,S.avail_in=K,f.hold=M,f.bits=F,2;S.adler=f.check=1,f.mode=u;case u:if(z===5||z===6)break t;case 13:if(f.last){M>>>=7&F,F-=7&F,f.mode=27;break}for(;F<3;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}switch(f.last=1&M,F-=1,3&(M>>>=1)){case 0:f.mode=14;break;case 1:if(st(f),f.mode=20,z===6){M>>>=2,F-=2;break t}break;case 2:f.mode=17;break;case 3:S.msg="invalid block type",f.mode=p}M>>>=2,F-=2;break;case 14:for(M>>>=7&F,F-=7&F;F<32;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}if((65535&M)!=(M>>>16^65535)){S.msg="invalid stored block lengths",f.mode=p;break}if(f.length=65535&M,M=0,F=0,f.mode=15,z===6)break t;case 15:f.mode=16;case 16:if(rt=f.length){if(rt>K&&(rt=K),rt>pt&&(rt=pt),rt===0)break t;i.arraySet(ct,X,D,rt,wt),K-=rt,D+=rt,pt-=rt,wt+=rt,f.length-=rt;break}f.mode=u;break;case 17:for(;F<14;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}if(f.nlen=257+(31&M),M>>>=5,F-=5,f.ndist=1+(31&M),M>>>=5,F-=5,f.ncode=4+(15&M),M>>>=4,F-=4,f.nlen>286||f.ndist>30){S.msg="too many length or distance symbols",f.mode=p;break}f.have=0,f.mode=18;case 18:for(;f.have<f.ncode;){for(;F<3;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}f.lens[G[f.have++]]=7&M,M>>>=3,F-=3}for(;f.have<19;)f.lens[G[f.have++]]=0;if(f.lencode=f.lendyn,f.lenbits=7,w={bits:f.lenbits},U=a(0,f.lens,0,19,f.lencode,0,f.work,w),f.lenbits=w.bits,U){S.msg="invalid code lengths set",f.mode=p;break}f.have=0,f.mode=19;case 19:for(;f.have<f.nlen+f.ndist;){for(;Qt=(N=f.lencode[M&(1<<f.lenbits)-1])>>>16&255,ce=65535&N,!((St=N>>>24)<=F);){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}if(ce<16)M>>>=St,F-=St,f.lens[f.have++]=ce;else{if(ce===16){for(m=St+2;F<m;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}if(M>>>=St,F-=St,f.have===0){S.msg="invalid bit length repeat",f.mode=p;break}g=f.lens[f.have-1],rt=3+(3&M),M>>>=2,F-=2}else if(ce===17){for(m=St+3;F<m;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}F-=St,g=0,rt=3+(7&(M>>>=St)),M>>>=3,F-=3}else{for(m=St+7;F<m;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}F-=St,g=0,rt=11+(127&(M>>>=St)),M>>>=7,F-=7}if(f.have+rt>f.nlen+f.ndist){S.msg="invalid bit length repeat",f.mode=p;break}for(;rt--;)f.lens[f.have++]=g}}if(f.mode===p)break;if(f.lens[256]===0){S.msg="invalid code -- missing end-of-block",f.mode=p;break}if(f.lenbits=9,w={bits:f.lenbits},U=a(h,f.lens,0,f.nlen,f.lencode,0,f.work,w),f.lenbits=w.bits,U){S.msg="invalid literal/lengths set",f.mode=p;break}if(f.distbits=6,f.distcode=f.distdyn,w={bits:f.distbits},U=a(l,f.lens,f.nlen,f.ndist,f.distcode,0,f.work,w),f.distbits=w.bits,U){S.msg="invalid distances set",f.mode=p;break}if(f.mode=20,z===6)break t;case 20:f.mode=21;case 21:if(K>=6&&pt>=258){S.next_out=wt,S.avail_out=pt,S.next_in=D,S.avail_in=K,f.hold=M,f.bits=F,o(S,Ct),wt=S.next_out,ct=S.output,pt=S.avail_out,D=S.next_in,X=S.input,K=S.avail_in,M=f.hold,F=f.bits,f.mode===u&&(f.back=-1);break}for(f.back=0;Qt=(N=f.lencode[M&(1<<f.lenbits)-1])>>>16&255,ce=65535&N,!((St=N>>>24)<=F);){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}if(Qt&&(240&Qt)==0){for(Zt=St,Xe=Qt,Je=ce;Qt=(N=f.lencode[Je+((M&(1<<Zt+Xe)-1)>>Zt)])>>>16&255,ce=65535&N,!(Zt+(St=N>>>24)<=F);){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}M>>>=Zt,F-=Zt,f.back+=Zt}if(M>>>=St,F-=St,f.back+=St,f.length=ce,Qt===0){f.mode=26;break}if(32&Qt){f.back=-1,f.mode=u;break}if(64&Qt){S.msg="invalid literal/length code",f.mode=p;break}f.extra=15&Qt,f.mode=22;case 22:if(f.extra){for(m=f.extra;F<m;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}f.length+=M&(1<<f.extra)-1,M>>>=f.extra,F-=f.extra,f.back+=f.extra}f.was=f.length,f.mode=23;case 23:for(;Qt=(N=f.distcode[M&(1<<f.distbits)-1])>>>16&255,ce=65535&N,!((St=N>>>24)<=F);){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}if((240&Qt)==0){for(Zt=St,Xe=Qt,Je=ce;Qt=(N=f.distcode[Je+((M&(1<<Zt+Xe)-1)>>Zt)])>>>16&255,ce=65535&N,!(Zt+(St=N>>>24)<=F);){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}M>>>=Zt,F-=Zt,f.back+=Zt}if(M>>>=St,F-=St,f.back+=St,64&Qt){S.msg="invalid distance code",f.mode=p;break}f.offset=ce,f.extra=15&Qt,f.mode=24;case 24:if(f.extra){for(m=f.extra;F<m;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}f.offset+=M&(1<<f.extra)-1,M>>>=f.extra,F-=f.extra,f.back+=f.extra}if(f.offset>f.dmax){S.msg="invalid distance too far back",f.mode=p;break}f.mode=25;case 25:if(pt===0)break t;if(rt=Ct-pt,f.offset>rt){if((rt=f.offset-rt)>f.whave&&f.sane){S.msg="invalid distance too far back",f.mode=p;break}rt>f.wnext?(rt-=f.wnext,Vt=f.wsize-rt):Vt=f.wnext-rt,rt>f.length&&(rt=f.length),Re=f.window}else Re=ct,Vt=wt-f.offset,rt=f.length;rt>pt&&(rt=pt),pt-=rt,f.length-=rt;do ct[wt++]=Re[Vt++];while(--rt);f.length===0&&(f.mode=21);break;case 26:if(pt===0)break t;ct[wt++]=f.length,pt--,f.mode=21;break;case 27:if(f.wrap){for(;F<32;){if(K===0)break t;K--,M|=X[D++]<<F,F+=8}if(Ct-=pt,S.total_out+=Ct,f.total+=Ct,Ct&&(S.adler=f.check=f.flags?r(f.check,ct,Ct,wt-Ct):s(f.check,ct,Ct,wt-Ct)),Ct=pt,(f.flags?M:y(M))!==f.check){S.msg="incorrect data check",f.mode=p;break}M=0,F=0}f.mode=28;case 28:if(f.wrap&&f.flags){for(;F<32;){if(K===0)break t;K--,M+=X[D++]<<F,F+=8}if(M!==(4294967295&f.total)){S.msg="incorrect length check",f.mode=p;break}M=0,F=0}f.mode=29;case 29:U=1;break t;case p:U=-3;break t;case 31:return-4;default:return d}return S.next_out=wt,S.avail_out=pt,S.next_in=D,S.avail_in=K,f.hold=M,f.bits=F,(f.wsize||Ct!==S.avail_out&&f.mode<p&&(f.mode<27||z!==4))&&Z(S,S.output,S.next_out,Ct-S.avail_out)?(f.mode=31,-4):(nt-=S.avail_in,Ct-=S.avail_out,S.total_in+=nt,S.total_out+=Ct,f.total+=Ct,f.wrap&&Ct&&(S.adler=f.check=f.flags?r(f.check,ct,Ct,S.next_out-Ct):s(f.check,ct,Ct,S.next_out-Ct)),S.data_type=f.bits+(f.last?64:0)+(f.mode===u?128:0)+(f.mode===20||f.mode===15?256:0),(nt===0&&Ct===0||z===4)&&U===c&&(U=-5),U)},t.inflateEnd=function(S){if(!S||!S.state)return d;var z=S.state;return z.window&&(z.window=null),S.state=null,c},t.inflateGetHeader=function(S,z){var f;return S&&S.state?(2&(f=S.state).wrap)==0?d:(f.head=z,z.done=!1,c):d},t.inflateSetDictionary=function(S,z){var f,X=z.length;return S&&S.state?(f=S.state).wrap!==0&&f.mode!==11?d:f.mode===11&&s(1,z,X,0)!==f.check?-3:Z(S,z,X,X)?(f.mode=31,-4):(f.havedict=1,c):d},t.inflateInfo="pako inflate (from Nodeca project)"},998:(n,t,e)=>{var i=e(805),s=15,r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(l,c,d,A,u,p,v,C){var y,b,P,I,Q,O,B,j,$,st=C.bits,Z=0,S=0,z=0,f=0,X=0,ct=0,D=0,wt=0,K=0,pt=0,M=null,F=0,nt=new i.Buf16(16),Ct=new i.Buf16(16),rt=null,Vt=0;for(Z=0;Z<=s;Z++)nt[Z]=0;for(S=0;S<A;S++)nt[c[d+S]]++;for(X=st,f=s;f>=1&&nt[f]===0;f--);if(X>f&&(X=f),f===0)return u[p++]=20971520,u[p++]=20971520,C.bits=1,0;for(z=1;z<f&&nt[z]===0;z++);for(X<z&&(X=z),wt=1,Z=1;Z<=s;Z++)if(wt<<=1,(wt-=nt[Z])<0)return-1;if(wt>0&&(l===0||f!==1))return-1;for(Ct[1]=0,Z=1;Z<s;Z++)Ct[Z+1]=Ct[Z]+nt[Z];for(S=0;S<A;S++)c[d+S]!==0&&(v[Ct[c[d+S]]++]=S);if(l===0?(M=rt=v,O=19):l===1?(M=r,F-=257,rt=o,Vt-=257,O=256):(M=a,rt=h,O=-1),pt=0,S=0,Z=z,Q=p,ct=X,D=0,P=-1,I=(K=1<<X)-1,l===1&&K>852||l===2&&K>592)return 1;for(;;){B=Z-D,v[S]<O?(j=0,$=v[S]):v[S]>O?(j=rt[Vt+v[S]],$=M[F+v[S]]):(j=96,$=0),y=1<<Z-D,z=b=1<<ct;do u[Q+(pt>>D)+(b-=y)]=B<<24|j<<16|$|0;while(b!==0);for(y=1<<Z-1;pt&y;)y>>=1;if(y!==0?(pt&=y-1,pt+=y):pt=0,S++,--nt[Z]==0){if(Z===f)break;Z=c[d+v[S]]}if(Z>X&&(pt&I)!==P){for(D===0&&(D=X),Q+=z,wt=1<<(ct=Z-D);ct+D<f&&!((wt-=nt[ct+D])<=0);)ct++,wt<<=1;if(K+=1<<ct,l===1&&K>852||l===2&&K>592)return 1;u[P=pt&I]=X<<24|ct<<16|Q-p|0}}return pt!==0&&(u[Q+pt]=Z-D<<24|64<<16|0),C.bits=X,0}},674:n=>{n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},665:(n,t,e)=>{var i=e(805),s=0,r=1;function o(w){for(var m=w.length;--m>=0;)w[m]=0}var a=0,h=29,l=256,c=l+1+h,d=30,A=19,u=2*c+1,p=15,v=16,C=7,y=256,b=16,P=17,I=18,Q=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],O=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(c+2));o($);var st=new Array(2*d);o(st);var Z=new Array(512);o(Z);var S=new Array(256);o(S);var z=new Array(h);o(z);var f,X,ct,D=new Array(d);function wt(w,m,N,H,G){this.static_tree=w,this.extra_bits=m,this.extra_base=N,this.elems=H,this.max_length=G,this.has_stree=w&&w.length}function K(w,m){this.dyn_tree=w,this.max_code=0,this.stat_desc=m}function pt(w){return w<256?Z[w]:Z[256+(w>>>7)]}function M(w,m){w.pending_buf[w.pending++]=255&m,w.pending_buf[w.pending++]=m>>>8&255}function F(w,m,N){w.bi_valid>v-N?(w.bi_buf|=m<<w.bi_valid&65535,M(w,w.bi_buf),w.bi_buf=m>>v-w.bi_valid,w.bi_valid+=N-v):(w.bi_buf|=m<<w.bi_valid&65535,w.bi_valid+=N)}function nt(w,m,N){F(w,N[2*m],N[2*m+1])}function Ct(w,m){var N=0;do N|=1&w,w>>>=1,N<<=1;while(--m>0);return N>>>1}function rt(w,m,N){var H,G,Y=new Array(p+1),W=0;for(H=1;H<=p;H++)Y[H]=W=W+N[H-1]<<1;for(G=0;G<=m;G++){var V=w[2*G+1];V!==0&&(w[2*G]=Ct(Y[V]++,V))}}function Vt(w){var m;for(m=0;m<c;m++)w.dyn_ltree[2*m]=0;for(m=0;m<d;m++)w.dyn_dtree[2*m]=0;for(m=0;m<A;m++)w.bl_tree[2*m]=0;w.dyn_ltree[2*y]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0}function Re(w){w.bi_valid>8?M(w,w.bi_buf):w.bi_valid>0&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0}function St(w,m,N,H){var G=2*m,Y=2*N;return w[G]<w[Y]||w[G]===w[Y]&&H[m]<=H[N]}function Qt(w,m,N){for(var H=w.heap[N],G=N<<1;G<=w.heap_len&&(G<w.heap_len&&St(m,w.heap[G+1],w.heap[G],w.depth)&&G++,!St(m,H,w.heap[G],w.depth));)w.heap[N]=w.heap[G],N=G,G<<=1;w.heap[N]=H}function ce(w,m,N){var H,G,Y,W,V=0;if(w.last_lit!==0)do H=w.pending_buf[w.d_buf+2*V]<<8|w.pending_buf[w.d_buf+2*V+1],G=w.pending_buf[w.l_buf+V],V++,H===0?nt(w,G,m):(nt(w,(Y=S[G])+l+1,m),(W=Q[Y])!==0&&F(w,G-=z[Y],W),nt(w,Y=pt(--H),N),(W=O[Y])!==0&&F(w,H-=D[Y],W));while(V<w.last_lit);nt(w,y,m)}function Zt(w,m){var N,H,G,Y=m.dyn_tree,W=m.stat_desc.static_tree,V=m.stat_desc.has_stree,ot=m.stat_desc.elems,At=-1;for(w.heap_len=0,w.heap_max=u,N=0;N<ot;N++)Y[2*N]!==0?(w.heap[++w.heap_len]=At=N,w.depth[N]=0):Y[2*N+1]=0;for(;w.heap_len<2;)Y[2*(G=w.heap[++w.heap_len]=At<2?++At:0)]=1,w.depth[G]=0,w.opt_len--,V&&(w.static_len-=W[2*G+1]);for(m.max_code=At,N=w.heap_len>>1;N>=1;N--)Qt(w,Y,N);G=ot;do N=w.heap[1],w.heap[1]=w.heap[w.heap_len--],Qt(w,Y,1),H=w.heap[1],w.heap[--w.heap_max]=N,w.heap[--w.heap_max]=H,Y[2*G]=Y[2*N]+Y[2*H],w.depth[G]=(w.depth[N]>=w.depth[H]?w.depth[N]:w.depth[H])+1,Y[2*N+1]=Y[2*H+1]=G,w.heap[1]=G++,Qt(w,Y,1);while(w.heap_len>=2);w.heap[--w.heap_max]=w.heap[1],function(Et,ne){var Xt,Ke,Ns,Jt,zr,Vn,di=ne.dyn_tree,ih=ne.max_code,Nc=ne.stat_desc.static_tree,zc=ne.stat_desc.has_stree,Oc=ne.stat_desc.extra_bits,sh=ne.stat_desc.extra_base,zs=ne.stat_desc.max_length,Or=0;for(Jt=0;Jt<=p;Jt++)Et.bl_count[Jt]=0;for(di[2*Et.heap[Et.heap_max]+1]=0,Xt=Et.heap_max+1;Xt<u;Xt++)(Jt=di[2*di[2*(Ke=Et.heap[Xt])+1]+1]+1)>zs&&(Jt=zs,Or++),di[2*Ke+1]=Jt,Ke>ih||(Et.bl_count[Jt]++,zr=0,Ke>=sh&&(zr=Oc[Ke-sh]),Vn=di[2*Ke],Et.opt_len+=Vn*(Jt+zr),zc&&(Et.static_len+=Vn*(Nc[2*Ke+1]+zr)));if(Or!==0){do{for(Jt=zs-1;Et.bl_count[Jt]===0;)Jt--;Et.bl_count[Jt]--,Et.bl_count[Jt+1]+=2,Et.bl_count[zs]--,Or-=2}while(Or>0);for(Jt=zs;Jt!==0;Jt--)for(Ke=Et.bl_count[Jt];Ke!==0;)(Ns=Et.heap[--Xt])>ih||(di[2*Ns+1]!==Jt&&(Et.opt_len+=(Jt-di[2*Ns+1])*di[2*Ns],di[2*Ns+1]=Jt),Ke--)}}(w,m),rt(Y,At,w.bl_count)}function Xe(w,m,N){var H,G,Y=-1,W=m[1],V=0,ot=7,At=4;for(W===0&&(ot=138,At=3),m[2*(N+1)+1]=65535,H=0;H<=N;H++)G=W,W=m[2*(H+1)+1],++V<ot&&G===W||(V<At?w.bl_tree[2*G]+=V:G!==0?(G!==Y&&w.bl_tree[2*G]++,w.bl_tree[2*b]++):V<=10?w.bl_tree[2*P]++:w.bl_tree[2*I]++,V=0,Y=G,W===0?(ot=138,At=3):G===W?(ot=6,At=3):(ot=7,At=4))}function Je(w,m,N){var H,G,Y=-1,W=m[1],V=0,ot=7,At=4;for(W===0&&(ot=138,At=3),H=0;H<=N;H++)if(G=W,W=m[2*(H+1)+1],!(++V<ot&&G===W)){if(V<At)do nt(w,G,w.bl_tree);while(--V!=0);else G!==0?(G!==Y&&(nt(w,G,w.bl_tree),V--),nt(w,b,w.bl_tree),F(w,V-3,2)):V<=10?(nt(w,P,w.bl_tree),F(w,V-3,3)):(nt(w,I,w.bl_tree),F(w,V-11,7));V=0,Y=G,W===0?(ot=138,At=3):G===W?(ot=6,At=3):(ot=7,At=4)}}o(D);var g=!1;function U(w,m,N,H){F(w,(a<<1)+(H?1:0),3),function(G,Y,W,V){Re(G),M(G,W),M(G,~W),i.arraySet(G.pending_buf,G.window,Y,W,G.pending),G.pending+=W}(w,m,N)}t._tr_init=function(w){g||(function(){var m,N,H,G,Y,W=new Array(p+1);for(H=0,G=0;G<h-1;G++)for(z[G]=H,m=0;m<1<<Q[G];m++)S[H++]=G;for(S[H-1]=G,Y=0,G=0;G<16;G++)for(D[G]=Y,m=0;m<1<<O[G];m++)Z[Y++]=G;for(Y>>=7;G<d;G++)for(D[G]=Y<<7,m=0;m<1<<O[G]-7;m++)Z[256+Y++]=G;for(N=0;N<=p;N++)W[N]=0;for(m=0;m<=143;)$[2*m+1]=8,m++,W[8]++;for(;m<=255;)$[2*m+1]=9,m++,W[9]++;for(;m<=279;)$[2*m+1]=7,m++,W[7]++;for(;m<=287;)$[2*m+1]=8,m++,W[8]++;for(rt($,c+1,W),m=0;m<d;m++)st[2*m+1]=5,st[2*m]=Ct(m,5);f=new wt($,Q,l+1,c,p),X=new wt(st,O,0,d,p),ct=new wt(new Array(0),B,0,A,C)}(),g=!0),w.l_desc=new K(w.dyn_ltree,f),w.d_desc=new K(w.dyn_dtree,X),w.bl_desc=new K(w.bl_tree,ct),w.bi_buf=0,w.bi_valid=0,Vt(w)},t._tr_stored_block=U,t._tr_flush_block=function(w,m,N,H){var G,Y,W=0;w.level>0?(w.strm.data_type===2&&(w.strm.data_type=function(V){var ot,At=4093624447;for(ot=0;ot<=31;ot++,At>>>=1)if(1&At&&V.dyn_ltree[2*ot]!==0)return s;if(V.dyn_ltree[18]!==0||V.dyn_ltree[20]!==0||V.dyn_ltree[26]!==0)return r;for(ot=32;ot<l;ot++)if(V.dyn_ltree[2*ot]!==0)return r;return s}(w)),Zt(w,w.l_desc),Zt(w,w.d_desc),W=function(V){var ot;for(Xe(V,V.dyn_ltree,V.l_desc.max_code),Xe(V,V.dyn_dtree,V.d_desc.max_code),Zt(V,V.bl_desc),ot=A-1;ot>=3&&V.bl_tree[2*j[ot]+1]===0;ot--);return V.opt_len+=3*(ot+1)+5+5+4,ot}(w),G=w.opt_len+3+7>>>3,(Y=w.static_len+3+7>>>3)<=G&&(G=Y)):G=Y=N+5,N+4<=G&&m!==-1?U(w,m,N,H):w.strategy===4||Y===G?(F(w,2+(H?1:0),3),ce(w,$,st)):(F(w,4+(H?1:0),3),function(V,ot,At,Et){var ne;for(F(V,ot-257,5),F(V,At-1,5),F(V,Et-4,4),ne=0;ne<Et;ne++)F(V,V.bl_tree[2*j[ne]+1],3);Je(V,V.dyn_ltree,ot-1),Je(V,V.dyn_dtree,At-1)}(w,w.l_desc.max_code+1,w.d_desc.max_code+1,W+1),ce(w,w.dyn_ltree,w.dyn_dtree)),Vt(w),H&&Re(w)},t._tr_tally=function(w,m,N){return w.pending_buf[w.d_buf+2*w.last_lit]=m>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&m,w.pending_buf[w.l_buf+w.last_lit]=255&N,w.last_lit++,m===0?w.dyn_ltree[2*N]++:(w.matches++,m--,w.dyn_ltree[2*(S[N]+l+1)]++,w.dyn_dtree[2*pt(m)]++),w.last_lit===w.lit_bufsize-1},t._tr_align=function(w){F(w,2,3),nt(w,y,$),function(m){m.bi_valid===16?(M(m,m.bi_buf),m.bi_buf=0,m.bi_valid=0):m.bi_valid>=8&&(m.pending_buf[m.pending++]=255&m.bi_buf,m.bi_buf>>=8,m.bi_valid-=8)}(w)}},442:n=>{n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},371:n=>{n.exports=AA}},uh={};function _i(n){var t=uh[n];if(t!==void 0)return t.exports;var e=uh[n]={exports:{}};return gA[n](e,e.exports,_i),e.exports}_i.d=(n,t)=>{for(var e in t)_i.o(t,e)&&!_i.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})},_i.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var Tt,So,ut={};_i.d(ut,{XM:()=>br,Pp:()=>Ir,B8:()=>$t,Z9:()=>Tc,Ms:()=>Bc,yO:()=>Sc,UZ:()=>jn,fN:()=>fs,_k:()=>Cs,J4:()=>Bi,bR:()=>Dc,tS:()=>Yn,Ro:()=>kc,M_:()=>Er,Bj:()=>Fc,HZ:()=>ps,xn:()=>Rc,EY:()=>Ja,FA:()=>Lo,o4:()=>Mc,$u:()=>eh,ZR:()=>bc,uE:()=>Wn,Bf:()=>Sr,xm:()=>Xa,OK:()=>yc,r0:()=>Va,IB:()=>wc,cp:()=>vc,pE:()=>xn,fO:()=>Za,pf:()=>Br,fc:()=>th,NW:()=>ki,OW:()=>Me,I:()=>Fi,N5:()=>Mo,fd:()=>ls,zU:()=>Cr,RT:()=>Ro,SW:()=>ko,s:()=>Fo,mD:()=>xr,wi:()=>qn,tP:()=>Ic,YK:()=>Ec,Ey:()=>Hn,qD:()=>Qc,rr:()=>qi,Xs:()=>yr,lj:()=>Ka,MB:()=>$a,hu:()=>Pc,Uk:()=>mi}),function(n){n.assertEqual=t=>t,n.assertIs=function(t){},n.assertNever=function(t){throw new Error},n.arrayToEnum=t=>{const e={};for(const i of t)e[i]=i;return e},n.getValidEnumValues=t=>{const e=n.objectKeys(t).filter(s=>typeof t[t[s]]!="number"),i={};for(const s of e)i[s]=t[s];return n.objectValues(i)},n.objectValues=t=>n.objectKeys(t).map(function(e){return t[e]}),n.objectKeys=typeof Object.keys=="function"?t=>Object.keys(t):t=>{const e=[];for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e},n.find=(t,e)=>{for(const i of t)if(e(i))return i},n.isInteger=typeof Number.isInteger=="function"?t=>Number.isInteger(t):t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t,n.joinValues=function(t,e=" | "){return t.map(i=>typeof i=="string"?`'${i}'`:i).join(e)},n.jsonStringifyReplacer=(t,e)=>typeof e=="bigint"?e.toString():e}(Tt||(Tt={})),function(n){n.mergeShapes=(t,e)=>({...t,...e})}(So||(So={}));const it=Tt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),fi=n=>{switch(typeof n){case"undefined":return it.undefined;case"string":return it.string;case"number":return isNaN(n)?it.nan:it.number;case"boolean":return it.boolean;case"function":return it.function;case"bigint":return it.bigint;case"symbol":return it.symbol;case"object":return Array.isArray(n)?it.array:n===null?it.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?it.promise:typeof Map<"u"&&n instanceof Map?it.map:typeof Set<"u"&&n instanceof Set?it.set:typeof Date<"u"&&n instanceof Date?it.date:it.object;default:return it.unknown}},J=Tt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class De extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};const e=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,e):this.__proto__=e,this.name="ZodError",this.issues=t}format(t){const e=t||function(r){return r.message},i={_errors:[]},s=r=>{for(const o of r.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)i._errors.push(e(o));else{let a=i,h=0;for(;h<o.path.length;){const l=o.path[h];h===o.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(e(o))):a[l]=a[l]||{_errors:[]},a=a[l],h++}}};return s(this),i}static assert(t){if(!(t instanceof De))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Tt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=e=>e.message){const e={},i=[];for(const s of this.issues)s.path.length>0?(e[s.path[0]]=e[s.path[0]]||[],e[s.path[0]].push(t(s))):i.push(t(s));return{formErrors:i,fieldErrors:e}}get formErrors(){return this.flatten()}}De.create=n=>new De(n);const Ss=(n,t)=>{let e;switch(n.code){case J.invalid_type:e=n.received===it.undefined?"Required":`Expected ${n.expected}, received ${n.received}`;break;case J.invalid_literal:e=`Invalid literal value, expected ${JSON.stringify(n.expected,Tt.jsonStringifyReplacer)}`;break;case J.unrecognized_keys:e=`Unrecognized key(s) in object: ${Tt.joinValues(n.keys,", ")}`;break;case J.invalid_union:e="Invalid input";break;case J.invalid_union_discriminator:e=`Invalid discriminator value. Expected ${Tt.joinValues(n.options)}`;break;case J.invalid_enum_value:e=`Invalid enum value. Expected ${Tt.joinValues(n.options)}, received '${n.received}'`;break;case J.invalid_arguments:e="Invalid function arguments";break;case J.invalid_return_type:e="Invalid function return type";break;case J.invalid_date:e="Invalid date";break;case J.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(e=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(e=`${e} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?e=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?e=`Invalid input: must end with "${n.validation.endsWith}"`:Tt.assertNever(n.validation):e=n.validation!=="regex"?`Invalid ${n.validation}`:"Invalid";break;case J.too_small:e=n.type==="array"?`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:"Invalid input";break;case J.too_big:e=n.type==="array"?`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:"Invalid input";break;case J.custom:e="Invalid input";break;case J.invalid_intersection_types:e="Intersection results could not be merged";break;case J.not_multiple_of:e=`Number must be a multiple of ${n.multipleOf}`;break;case J.not_finite:e="Number must be finite";break;default:e=t.defaultError,Tt.assertNever(n)}return{message:e}};let Ac=Ss;function pn(){return Ac}const fn=n=>{const{data:t,path:e,errorMaps:i,issueData:s}=n,r=[...e,...s.path||[]],o={...s,path:r};if(s.message!==void 0)return{...s,path:r,message:s.message};let a="";const h=i.filter(l=>!!l).slice().reverse();for(const l of h)a=l(o,{data:t,defaultError:a}).message;return{...s,path:r,message:a}};function et(n,t){const e=pn(),i=fn({issueData:t,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,e,e===Ss?void 0:Ss].filter(s=>!!s)});n.common.issues.push(i)}class Ce{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,e){const i=[];for(const s of e){if(s.status==="aborted")return mt;s.status==="dirty"&&t.dirty(),i.push(s.value)}return{status:t.value,value:i}}static async mergeObjectAsync(t,e){const i=[];for(const s of e){const r=await s.key,o=await s.value;i.push({key:r,value:o})}return Ce.mergeObjectSync(t,i)}static mergeObjectSync(t,e){const i={};for(const s of e){const{key:r,value:o}=s;if(r.status==="aborted"||o.status==="aborted")return mt;r.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),r.value==="__proto__"||o.value===void 0&&!s.alwaysSet||(i[r.value]=o.value)}return{status:t.value,value:i}}}const mt=Object.freeze({status:"aborted"}),_n=n=>({status:"dirty",value:n}),Ee=n=>({status:"valid",value:n}),To=n=>n.status==="aborted",Qo=n=>n.status==="dirty",os=n=>n.status==="valid",lr=n=>typeof Promise<"u"&&n instanceof Promise;function mn(n,t,e,i){if(typeof t=="function"?n!==t||!0:!t.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(n)}function gc(n,t,e,i,s){if(typeof t=="function"?n!==t||!0:!t.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(n,e),e}var at,js,Ys;typeof SuppressedError=="function"&&SuppressedError,function(n){n.errToObj=t=>typeof t=="string"?{message:t}:t||{},n.toString=t=>typeof t=="string"?t:t?.message}(at||(at={}));class oi{constructor(t,e,i,s){this._cachedPath=[],this.parent=t,this.data=e,this._path=i,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Ah=(n,t)=>{if(os(t))return{success:!0,data:t.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const e=new De(n.common.issues);return this._error=e,this._error}}};function vt(n){if(!n)return{};const{errorMap:t,invalid_type_error:e,required_error:i,description:s}=n;if(t&&(e||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:s}:{errorMap:(r,o)=>{var a,h;const{message:l}=n;return r.code==="invalid_enum_value"?{message:l??o.defaultError}:o.data===void 0?{message:(a=l??i)!==null&&a!==void 0?a:o.defaultError}:r.code!=="invalid_type"?{message:o.defaultError}:{message:(h=l??e)!==null&&h!==void 0?h:o.defaultError}},description:s}}class xt{get description(){return this._def.description}_getType(t){return fi(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:fi(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Ce,ctx:{common:t.parent.common,data:t.data,parsedType:fi(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const e=this._parse(t);if(lr(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(t){const e=this._parse(t);return Promise.resolve(e)}parse(t,e){const i=this.safeParse(t,e);if(i.success)return i.data;throw i.error}safeParse(t,e){var i;const s={common:{issues:[],async:(i=e?.async)!==null&&i!==void 0&&i,contextualErrorMap:e?.errorMap},path:e?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:fi(t)},r=this._parseSync({data:t,path:s.path,parent:s});return Ah(s,r)}"~validate"(t){var e,i;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:fi(t)};if(!this["~standard"].async)try{const r=this._parseSync({data:t,path:[],parent:s});return os(r)?{value:r.value}:{issues:s.common.issues}}catch(r){!((i=(e=r?.message)===null||e===void 0?void 0:e.toLowerCase())===null||i===void 0)&&i.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:s}).then(r=>os(r)?{value:r.value}:{issues:s.common.issues})}async parseAsync(t,e){const i=await this.safeParseAsync(t,e);if(i.success)return i.data;throw i.error}async safeParseAsync(t,e){const i={common:{issues:[],contextualErrorMap:e?.errorMap,async:!0},path:e?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:fi(t)},s=this._parse({data:t,path:i.path,parent:i}),r=await(lr(s)?s:Promise.resolve(s));return Ah(i,r)}refine(t,e){const i=s=>typeof e=="string"||e===void 0?{message:e}:typeof e=="function"?e(s):e;return this._refinement((s,r)=>{const o=t(s),a=()=>r.addIssue({code:J.custom,...i(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(h=>!!h||(a(),!1)):!!o||(a(),!1)})}refinement(t,e){return this._refinement((i,s)=>!!t(i)||(s.addIssue(typeof e=="function"?e(i,s):e),!1))}_refinement(t){return new qe({schema:this,typeName:ft.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return ni.create(this,this._def)}nullable(){return Gi.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ye.create(this)}promise(){return Qs.create(this,this._def)}or(t){return Ar.create([this,t],this._def)}and(t){return gr.create(this,t,this._def)}transform(t){return new qe({...vt(this._def),schema:this,typeName:ft.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const e=typeof t=="function"?t:()=>t;return new mr({...vt(this._def),innerType:this,defaultValue:e,typeName:ft.ZodDefault})}brand(){return new ja({typeName:ft.ZodBranded,type:this,...vt(this._def)})}catch(t){const e=typeof t=="function"?t:()=>t;return new vr({...vt(this._def),innerType:this,catchValue:e,typeName:ft.ZodCatch})}describe(t){return new this.constructor({...this._def,description:t})}pipe(t){return Nr.create(this,t)}readonly(){return wr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const pA=/^c[^\s-]{8,}$/i,fA=/^[0-9a-z]+$/,_A=/^[0-9A-HJKMNP-TV-Z]{26}$/i,mA=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vA=/^[a-z0-9_-]{21}$/i,wA=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,yA=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,CA=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Kn;const xA=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,bA=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,IA=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,EA=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,BA=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,SA=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,pc="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",TA=new RegExp(`^${pc}$`);function fc(n){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?t=`${t}\\.\\d{${n.precision}}`:n.precision==null&&(t=`${t}(\\.\\d+)?`),t}function _c(n){let t=`${pc}T${fc(n)}`;const e=[];return e.push(n.local?"Z?":"Z"),n.offset&&e.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${e.join("|")})`,new RegExp(`^${t}$`)}function QA(n,t){if(!wA.test(n))return!1;try{const[e]=n.split("."),i=e.replace(/-/g,"+").replace(/_/g,"/").padEnd(e.length+(4-e.length%4)%4,"="),s=JSON.parse(atob(i));return typeof s=="object"&&s!==null&&!(!s.typ||!s.alg)&&(!t||s.alg===t)}catch{return!1}}function PA(n,t){return!(t!=="v4"&&t||!bA.test(n))||!(t!=="v6"&&t||!EA.test(n))}class He extends xt{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==it.string){const o=this._getOrReturnCtx(t);return et(o,{code:J.invalid_type,expected:it.string,received:o.parsedType}),mt}const e=new Ce;let i;for(const o of this._def.checks)if(o.kind==="min")t.data.length<o.value&&(i=this._getOrReturnCtx(t,i),et(i,{code:J.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),e.dirty());else if(o.kind==="max")t.data.length>o.value&&(i=this._getOrReturnCtx(t,i),et(i,{code:J.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),e.dirty());else if(o.kind==="length"){const a=t.data.length>o.value,h=t.data.length<o.value;(a||h)&&(i=this._getOrReturnCtx(t,i),a?et(i,{code:J.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):h&&et(i,{code:J.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),e.dirty())}else if(o.kind==="email")CA.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"email",code:J.invalid_string,message:o.message}),e.dirty());else if(o.kind==="emoji")Kn||(Kn=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Kn.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"emoji",code:J.invalid_string,message:o.message}),e.dirty());else if(o.kind==="uuid")mA.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"uuid",code:J.invalid_string,message:o.message}),e.dirty());else if(o.kind==="nanoid")vA.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"nanoid",code:J.invalid_string,message:o.message}),e.dirty());else if(o.kind==="cuid")pA.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"cuid",code:J.invalid_string,message:o.message}),e.dirty());else if(o.kind==="cuid2")fA.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"cuid2",code:J.invalid_string,message:o.message}),e.dirty());else if(o.kind==="ulid")_A.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"ulid",code:J.invalid_string,message:o.message}),e.dirty());else if(o.kind==="url")try{new URL(t.data)}catch{i=this._getOrReturnCtx(t,i),et(i,{validation:"url",code:J.invalid_string,message:o.message}),e.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"regex",code:J.invalid_string,message:o.message}),e.dirty())):o.kind==="trim"?t.data=t.data.trim():o.kind==="includes"?t.data.includes(o.value,o.position)||(i=this._getOrReturnCtx(t,i),et(i,{code:J.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),e.dirty()):o.kind==="toLowerCase"?t.data=t.data.toLowerCase():o.kind==="toUpperCase"?t.data=t.data.toUpperCase():o.kind==="startsWith"?t.data.startsWith(o.value)||(i=this._getOrReturnCtx(t,i),et(i,{code:J.invalid_string,validation:{startsWith:o.value},message:o.message}),e.dirty()):o.kind==="endsWith"?t.data.endsWith(o.value)||(i=this._getOrReturnCtx(t,i),et(i,{code:J.invalid_string,validation:{endsWith:o.value},message:o.message}),e.dirty()):o.kind==="datetime"?_c(o).test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{code:J.invalid_string,validation:"datetime",message:o.message}),e.dirty()):o.kind==="date"?TA.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{code:J.invalid_string,validation:"date",message:o.message}),e.dirty()):o.kind==="time"?new RegExp(`^${fc(o)}$`).test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{code:J.invalid_string,validation:"time",message:o.message}),e.dirty()):o.kind==="duration"?yA.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"duration",code:J.invalid_string,message:o.message}),e.dirty()):o.kind==="ip"?(s=t.data,((r=o.version)!=="v4"&&r||!xA.test(s))&&(r!=="v6"&&r||!IA.test(s))&&(i=this._getOrReturnCtx(t,i),et(i,{validation:"ip",code:J.invalid_string,message:o.message}),e.dirty())):o.kind==="jwt"?QA(t.data,o.alg)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"jwt",code:J.invalid_string,message:o.message}),e.dirty()):o.kind==="cidr"?PA(t.data,o.version)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"cidr",code:J.invalid_string,message:o.message}),e.dirty()):o.kind==="base64"?BA.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"base64",code:J.invalid_string,message:o.message}),e.dirty()):o.kind==="base64url"?SA.test(t.data)||(i=this._getOrReturnCtx(t,i),et(i,{validation:"base64url",code:J.invalid_string,message:o.message}),e.dirty()):Tt.assertNever(o);var s,r;return{status:e.value,value:t.data}}_regex(t,e,i){return this.refinement(s=>t.test(s),{validation:e,code:J.invalid_string,...at.errToObj(i)})}_addCheck(t){return new He({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...at.errToObj(t)})}url(t){return this._addCheck({kind:"url",...at.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...at.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...at.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...at.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...at.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...at.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...at.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...at.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...at.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...at.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...at.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...at.errToObj(t)})}datetime(t){var e,i;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:t?.precision===void 0?null:t?.precision,offset:(e=t?.offset)!==null&&e!==void 0&&e,local:(i=t?.local)!==null&&i!==void 0&&i,...at.errToObj(t?.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:t?.precision===void 0?null:t?.precision,...at.errToObj(t?.message)})}duration(t){return this._addCheck({kind:"duration",...at.errToObj(t)})}regex(t,e){return this._addCheck({kind:"regex",regex:t,...at.errToObj(e)})}includes(t,e){return this._addCheck({kind:"includes",value:t,position:e?.position,...at.errToObj(e?.message)})}startsWith(t,e){return this._addCheck({kind:"startsWith",value:t,...at.errToObj(e)})}endsWith(t,e){return this._addCheck({kind:"endsWith",value:t,...at.errToObj(e)})}min(t,e){return this._addCheck({kind:"min",value:t,...at.errToObj(e)})}max(t,e){return this._addCheck({kind:"max",value:t,...at.errToObj(e)})}length(t,e){return this._addCheck({kind:"length",value:t,...at.errToObj(e)})}nonempty(t){return this.min(1,at.errToObj(t))}trim(){return new He({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new He({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new He({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxLength(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}function DA(n,t){const e=(n.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,s=e>i?e:i;return parseInt(n.toFixed(s).replace(".",""))%parseInt(t.toFixed(s).replace(".",""))/Math.pow(10,s)}He.create=n=>{var t;return new He({checks:[],typeName:ft.ZodString,coerce:(t=n?.coerce)!==null&&t!==void 0&&t,...vt(n)})};class Mi extends xt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==it.number){const s=this._getOrReturnCtx(t);return et(s,{code:J.invalid_type,expected:it.number,received:s.parsedType}),mt}let e;const i=new Ce;for(const s of this._def.checks)s.kind==="int"?Tt.isInteger(t.data)||(e=this._getOrReturnCtx(t,e),et(e,{code:J.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(e=this._getOrReturnCtx(t,e),et(e,{code:J.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(e=this._getOrReturnCtx(t,e),et(e,{code:J.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?DA(t.data,s.value)!==0&&(e=this._getOrReturnCtx(t,e),et(e,{code:J.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(e=this._getOrReturnCtx(t,e),et(e,{code:J.not_finite,message:s.message}),i.dirty()):Tt.assertNever(s);return{status:i.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,at.toString(e))}gt(t,e){return this.setLimit("min",t,!1,at.toString(e))}lte(t,e){return this.setLimit("max",t,!0,at.toString(e))}lt(t,e){return this.setLimit("max",t,!1,at.toString(e))}setLimit(t,e,i,s){return new Mi({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:i,message:at.toString(s)}]})}_addCheck(t){return new Mi({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:at.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:at.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:at.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:at.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:at.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:at.toString(e)})}finite(t){return this._addCheck({kind:"finite",message:at.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:at.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:at.toString(t)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Tt.isInteger(t.value))}get isFinite(){let t=null,e=null;for(const i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(e===null||i.value>e)&&(e=i.value):i.kind==="max"&&(t===null||i.value<t)&&(t=i.value)}return Number.isFinite(e)&&Number.isFinite(t)}}Mi.create=n=>new Mi({checks:[],typeName:ft.ZodNumber,coerce:n?.coerce||!1,...vt(n)});class Li extends xt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==it.bigint)return this._getInvalidInput(t);let e;const i=new Ce;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(e=this._getOrReturnCtx(t,e),et(e,{code:J.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(e=this._getOrReturnCtx(t,e),et(e,{code:J.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?t.data%s.value!==BigInt(0)&&(e=this._getOrReturnCtx(t,e),et(e,{code:J.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):Tt.assertNever(s);return{status:i.value,value:t.data}}_getInvalidInput(t){const e=this._getOrReturnCtx(t);return et(e,{code:J.invalid_type,expected:it.bigint,received:e.parsedType}),mt}gte(t,e){return this.setLimit("min",t,!0,at.toString(e))}gt(t,e){return this.setLimit("min",t,!1,at.toString(e))}lte(t,e){return this.setLimit("max",t,!0,at.toString(e))}lt(t,e){return this.setLimit("max",t,!1,at.toString(e))}setLimit(t,e,i,s){return new Li({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:i,message:at.toString(s)}]})}_addCheck(t){return new Li({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:at.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:at.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:at.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:at.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:at.toString(e)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}Li.create=n=>{var t;return new Li({checks:[],typeName:ft.ZodBigInt,coerce:(t=n?.coerce)!==null&&t!==void 0&&t,...vt(n)})};class cr extends xt{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==it.boolean){const e=this._getOrReturnCtx(t);return et(e,{code:J.invalid_type,expected:it.boolean,received:e.parsedType}),mt}return Ee(t.data)}}cr.create=n=>new cr({typeName:ft.ZodBoolean,coerce:n?.coerce||!1,...vt(n)});class as extends xt{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==it.date){const s=this._getOrReturnCtx(t);return et(s,{code:J.invalid_type,expected:it.date,received:s.parsedType}),mt}if(isNaN(t.data.getTime()))return et(this._getOrReturnCtx(t),{code:J.invalid_date}),mt;const e=new Ce;let i;for(const s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(i=this._getOrReturnCtx(t,i),et(i,{code:J.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),e.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(i=this._getOrReturnCtx(t,i),et(i,{code:J.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),e.dirty()):Tt.assertNever(s);return{status:e.value,value:new Date(t.data.getTime())}}_addCheck(t){return new as({...this._def,checks:[...this._def.checks,t]})}min(t,e){return this._addCheck({kind:"min",value:t.getTime(),message:at.toString(e)})}max(t,e){return this._addCheck({kind:"max",value:t.getTime(),message:at.toString(e)})}get minDate(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t!=null?new Date(t):null}}as.create=n=>new as({checks:[],coerce:n?.coerce||!1,typeName:ft.ZodDate,...vt(n)});class vn extends xt{_parse(t){if(this._getType(t)!==it.symbol){const e=this._getOrReturnCtx(t);return et(e,{code:J.invalid_type,expected:it.symbol,received:e.parsedType}),mt}return Ee(t.data)}}vn.create=n=>new vn({typeName:ft.ZodSymbol,...vt(n)});class dr extends xt{_parse(t){if(this._getType(t)!==it.undefined){const e=this._getOrReturnCtx(t);return et(e,{code:J.invalid_type,expected:it.undefined,received:e.parsedType}),mt}return Ee(t.data)}}dr.create=n=>new dr({typeName:ft.ZodUndefined,...vt(n)});class ur extends xt{_parse(t){if(this._getType(t)!==it.null){const e=this._getOrReturnCtx(t);return et(e,{code:J.invalid_type,expected:it.null,received:e.parsedType}),mt}return Ee(t.data)}}ur.create=n=>new ur({typeName:ft.ZodNull,...vt(n)});class Ts extends xt{constructor(){super(...arguments),this._any=!0}_parse(t){return Ee(t.data)}}Ts.create=n=>new Ts({typeName:ft.ZodAny,...vt(n)});class $i extends xt{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Ee(t.data)}}$i.create=n=>new $i({typeName:ft.ZodUnknown,...vt(n)});class Ci extends xt{_parse(t){const e=this._getOrReturnCtx(t);return et(e,{code:J.invalid_type,expected:it.never,received:e.parsedType}),mt}}Ci.create=n=>new Ci({typeName:ft.ZodNever,...vt(n)});class wn extends xt{_parse(t){if(this._getType(t)!==it.undefined){const e=this._getOrReturnCtx(t);return et(e,{code:J.invalid_type,expected:it.void,received:e.parsedType}),mt}return Ee(t.data)}}wn.create=n=>new wn({typeName:ft.ZodVoid,...vt(n)});class Ye extends xt{_parse(t){const{ctx:e,status:i}=this._processInputParams(t),s=this._def;if(e.parsedType!==it.array)return et(e,{code:J.invalid_type,expected:it.array,received:e.parsedType}),mt;if(s.exactLength!==null){const o=e.data.length>s.exactLength.value,a=e.data.length<s.exactLength.value;(o||a)&&(et(e,{code:o?J.too_big:J.too_small,minimum:a?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),i.dirty())}if(s.minLength!==null&&e.data.length<s.minLength.value&&(et(e,{code:J.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),i.dirty()),s.maxLength!==null&&e.data.length>s.maxLength.value&&(et(e,{code:J.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),i.dirty()),e.common.async)return Promise.all([...e.data].map((o,a)=>s.type._parseAsync(new oi(e,o,e.path,a)))).then(o=>Ce.mergeArray(i,o));const r=[...e.data].map((o,a)=>s.type._parseSync(new oi(e,o,e.path,a)));return Ce.mergeArray(i,r)}get element(){return this._def.type}min(t,e){return new Ye({...this._def,minLength:{value:t,message:at.toString(e)}})}max(t,e){return new Ye({...this._def,maxLength:{value:t,message:at.toString(e)}})}length(t,e){return new Ye({...this._def,exactLength:{value:t,message:at.toString(e)}})}nonempty(t){return this.min(1,t)}}function us(n){if(n instanceof Ot){const t={};for(const e in n.shape){const i=n.shape[e];t[e]=ni.create(us(i))}return new Ot({...n._def,shape:()=>t})}return n instanceof Ye?new Ye({...n._def,type:us(n.element)}):n instanceof ni?ni.create(us(n.unwrap())):n instanceof Gi?Gi.create(us(n.unwrap())):n instanceof ai?ai.create(n.items.map(t=>us(t))):n}Ye.create=(n,t)=>new Ye({type:n,minLength:null,maxLength:null,exactLength:null,typeName:ft.ZodArray,...vt(t)});class Ot extends xt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),e=Tt.objectKeys(t);return this._cached={shape:t,keys:e}}_parse(t){if(this._getType(t)!==it.object){const h=this._getOrReturnCtx(t);return et(h,{code:J.invalid_type,expected:it.object,received:h.parsedType}),mt}const{status:e,ctx:i}=this._processInputParams(t),{shape:s,keys:r}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ci&&this._def.unknownKeys==="strip"))for(const h in i.data)r.includes(h)||o.push(h);const a=[];for(const h of r){const l=s[h],c=i.data[h];a.push({key:{status:"valid",value:h},value:l._parse(new oi(i,c,i.path,h)),alwaysSet:h in i.data})}if(this._def.catchall instanceof Ci){const h=this._def.unknownKeys;if(h==="passthrough")for(const l of o)a.push({key:{status:"valid",value:l},value:{status:"valid",value:i.data[l]}});else if(h==="strict")o.length>0&&(et(i,{code:J.unrecognized_keys,keys:o}),e.dirty());else if(h!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const h=this._def.catchall;for(const l of o){const c=i.data[l];a.push({key:{status:"valid",value:l},value:h._parse(new oi(i,c,i.path,l)),alwaysSet:l in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const h=[];for(const l of a){const c=await l.key,d=await l.value;h.push({key:c,value:d,alwaysSet:l.alwaysSet})}return h}).then(h=>Ce.mergeObjectSync(e,h)):Ce.mergeObjectSync(e,a)}get shape(){return this._def.shape()}strict(t){return at.errToObj,new Ot({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(e,i)=>{var s,r,o,a;const h=(o=(r=(s=this._def).errorMap)===null||r===void 0?void 0:r.call(s,e,i).message)!==null&&o!==void 0?o:i.defaultError;return e.code==="unrecognized_keys"?{message:(a=at.errToObj(t).message)!==null&&a!==void 0?a:h}:{message:h}}}:{}})}strip(){return new Ot({...this._def,unknownKeys:"strip"})}passthrough(){return new Ot({...this._def,unknownKeys:"passthrough"})}extend(t){return new Ot({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Ot({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:ft.ZodObject})}setKey(t,e){return this.augment({[t]:e})}catchall(t){return new Ot({...this._def,catchall:t})}pick(t){const e={};return Tt.objectKeys(t).forEach(i=>{t[i]&&this.shape[i]&&(e[i]=this.shape[i])}),new Ot({...this._def,shape:()=>e})}omit(t){const e={};return Tt.objectKeys(this.shape).forEach(i=>{t[i]||(e[i]=this.shape[i])}),new Ot({...this._def,shape:()=>e})}deepPartial(){return us(this)}partial(t){const e={};return Tt.objectKeys(this.shape).forEach(i=>{const s=this.shape[i];t&&!t[i]?e[i]=s:e[i]=s.optional()}),new Ot({...this._def,shape:()=>e})}required(t){const e={};return Tt.objectKeys(this.shape).forEach(i=>{if(t&&!t[i])e[i]=this.shape[i];else{let s=this.shape[i];for(;s instanceof ni;)s=s._def.innerType;e[i]=s}}),new Ot({...this._def,shape:()=>e})}keyof(){return mc(Tt.objectKeys(this.shape))}}Ot.create=(n,t)=>new Ot({shape:()=>n,unknownKeys:"strip",catchall:Ci.create(),typeName:ft.ZodObject,...vt(t)}),Ot.strictCreate=(n,t)=>new Ot({shape:()=>n,unknownKeys:"strict",catchall:Ci.create(),typeName:ft.ZodObject,...vt(t)}),Ot.lazycreate=(n,t)=>new Ot({shape:n,unknownKeys:"strip",catchall:Ci.create(),typeName:ft.ZodObject,...vt(t)});class Ar extends xt{_parse(t){const{ctx:e}=this._processInputParams(t),i=this._def.options;if(e.common.async)return Promise.all(i.map(async s=>{const r={...e,common:{...e.common,issues:[]},parent:null};return{result:await s._parseAsync({data:e.data,path:e.path,parent:r}),ctx:r}})).then(function(s){for(const o of s)if(o.result.status==="valid")return o.result;for(const o of s)if(o.result.status==="dirty")return e.common.issues.push(...o.ctx.common.issues),o.result;const r=s.map(o=>new De(o.ctx.common.issues));return et(e,{code:J.invalid_union,unionErrors:r}),mt});{let s;const r=[];for(const a of i){const h={...e,common:{...e.common,issues:[]},parent:null},l=a._parseSync({data:e.data,path:e.path,parent:h});if(l.status==="valid")return l;l.status!=="dirty"||s||(s={result:l,ctx:h}),h.common.issues.length&&r.push(h.common.issues)}if(s)return e.common.issues.push(...s.ctx.common.issues),s.result;const o=r.map(a=>new De(a));return et(e,{code:J.invalid_union,unionErrors:o}),mt}}get options(){return this._def.options}}Ar.create=(n,t)=>new Ar({options:n,typeName:ft.ZodUnion,...vt(t)});const Si=n=>n instanceof pr?Si(n.schema):n instanceof qe?Si(n.innerType()):n instanceof fr?[n.value]:n instanceof Ui?n.options:n instanceof _r?Tt.objectValues(n.enum):n instanceof mr?Si(n._def.innerType):n instanceof dr?[void 0]:n instanceof ur?[null]:n instanceof ni?[void 0,...Si(n.unwrap())]:n instanceof Gi?[null,...Si(n.unwrap())]:n instanceof ja||n instanceof wr?Si(n.unwrap()):n instanceof vr?Si(n._def.innerType):[];class Nn extends xt{_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==it.object)return et(e,{code:J.invalid_type,expected:it.object,received:e.parsedType}),mt;const i=this.discriminator,s=e.data[i],r=this.optionsMap.get(s);return r?e.common.async?r._parseAsync({data:e.data,path:e.path,parent:e}):r._parseSync({data:e.data,path:e.path,parent:e}):(et(e,{code:J.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),mt)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,e,i){const s=new Map;for(const r of e){const o=Si(r.shape[t]);if(!o.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const a of o){if(s.has(a))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(a)}`);s.set(a,r)}}return new Nn({typeName:ft.ZodDiscriminatedUnion,discriminator:t,options:e,optionsMap:s,...vt(i)})}}function Po(n,t){const e=fi(n),i=fi(t);if(n===t)return{valid:!0,data:n};if(e===it.object&&i===it.object){const s=Tt.objectKeys(t),r=Tt.objectKeys(n).filter(a=>s.indexOf(a)!==-1),o={...n,...t};for(const a of r){const h=Po(n[a],t[a]);if(!h.valid)return{valid:!1};o[a]=h.data}return{valid:!0,data:o}}if(e===it.array&&i===it.array){if(n.length!==t.length)return{valid:!1};const s=[];for(let r=0;r<n.length;r++){const o=Po(n[r],t[r]);if(!o.valid)return{valid:!1};s.push(o.data)}return{valid:!0,data:s}}return e===it.date&&i===it.date&&+n==+t?{valid:!0,data:n}:{valid:!1}}class gr extends xt{_parse(t){const{status:e,ctx:i}=this._processInputParams(t),s=(r,o)=>{if(To(r)||To(o))return mt;const a=Po(r.value,o.value);return a.valid?((Qo(r)||Qo(o))&&e.dirty(),{status:e.value,value:a.data}):(et(i,{code:J.invalid_intersection_types}),mt)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([r,o])=>s(r,o)):s(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}gr.create=(n,t,e)=>new gr({left:n,right:t,typeName:ft.ZodIntersection,...vt(e)});class ai extends xt{_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==it.array)return et(i,{code:J.invalid_type,expected:it.array,received:i.parsedType}),mt;if(i.data.length<this._def.items.length)return et(i,{code:J.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),mt;!this._def.rest&&i.data.length>this._def.items.length&&(et(i,{code:J.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),e.dirty());const s=[...i.data].map((r,o)=>{const a=this._def.items[o]||this._def.rest;return a?a._parse(new oi(i,r,i.path,o)):null}).filter(r=>!!r);return i.common.async?Promise.all(s).then(r=>Ce.mergeArray(e,r)):Ce.mergeArray(e,s)}get items(){return this._def.items}rest(t){return new ai({...this._def,rest:t})}}ai.create=(n,t)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ai({items:n,typeName:ft.ZodTuple,rest:null,...vt(t)})};class zn extends xt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==it.object)return et(i,{code:J.invalid_type,expected:it.object,received:i.parsedType}),mt;const s=[],r=this._def.keyType,o=this._def.valueType;for(const a in i.data)s.push({key:r._parse(new oi(i,a,i.path,a)),value:o._parse(new oi(i,i.data[a],i.path,a)),alwaysSet:a in i.data});return i.common.async?Ce.mergeObjectAsync(e,s):Ce.mergeObjectSync(e,s)}get element(){return this._def.valueType}static create(t,e,i){return new zn(e instanceof xt?{keyType:t,valueType:e,typeName:ft.ZodRecord,...vt(i)}:{keyType:He.create(),valueType:t,typeName:ft.ZodRecord,...vt(e)})}}class yn extends xt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==it.map)return et(i,{code:J.invalid_type,expected:it.map,received:i.parsedType}),mt;const s=this._def.keyType,r=this._def.valueType,o=[...i.data.entries()].map(([a,h],l)=>({key:s._parse(new oi(i,a,i.path,[l,"key"])),value:r._parse(new oi(i,h,i.path,[l,"value"]))}));if(i.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const h of o){const l=await h.key,c=await h.value;if(l.status==="aborted"||c.status==="aborted")return mt;l.status!=="dirty"&&c.status!=="dirty"||e.dirty(),a.set(l.value,c.value)}return{status:e.value,value:a}})}{const a=new Map;for(const h of o){const l=h.key,c=h.value;if(l.status==="aborted"||c.status==="aborted")return mt;l.status!=="dirty"&&c.status!=="dirty"||e.dirty(),a.set(l.value,c.value)}return{status:e.value,value:a}}}}yn.create=(n,t,e)=>new yn({valueType:t,keyType:n,typeName:ft.ZodMap,...vt(e)});class hs extends xt{_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.parsedType!==it.set)return et(i,{code:J.invalid_type,expected:it.set,received:i.parsedType}),mt;const s=this._def;s.minSize!==null&&i.data.size<s.minSize.value&&(et(i,{code:J.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),e.dirty()),s.maxSize!==null&&i.data.size>s.maxSize.value&&(et(i,{code:J.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),e.dirty());const r=this._def.valueType;function o(h){const l=new Set;for(const c of h){if(c.status==="aborted")return mt;c.status==="dirty"&&e.dirty(),l.add(c.value)}return{status:e.value,value:l}}const a=[...i.data.values()].map((h,l)=>r._parse(new oi(i,h,i.path,l)));return i.common.async?Promise.all(a).then(h=>o(h)):o(a)}min(t,e){return new hs({...this._def,minSize:{value:t,message:at.toString(e)}})}max(t,e){return new hs({...this._def,maxSize:{value:t,message:at.toString(e)}})}size(t,e){return this.min(t,e).max(t,e)}nonempty(t){return this.min(1,t)}}hs.create=(n,t)=>new hs({valueType:n,minSize:null,maxSize:null,typeName:ft.ZodSet,...vt(t)});class ys extends xt{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==it.function)return et(e,{code:J.invalid_type,expected:it.function,received:e.parsedType}),mt;function i(a,h){return fn({data:a,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,pn(),Ss].filter(l=>!!l),issueData:{code:J.invalid_arguments,argumentsError:h}})}function s(a,h){return fn({data:a,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,pn(),Ss].filter(l=>!!l),issueData:{code:J.invalid_return_type,returnTypeError:h}})}const r={errorMap:e.common.contextualErrorMap},o=e.data;if(this._def.returns instanceof Qs){const a=this;return Ee(async function(...h){const l=new De([]),c=await a._def.args.parseAsync(h,r).catch(A=>{throw l.addIssue(i(h,A)),l}),d=await Reflect.apply(o,this,c);return await a._def.returns._def.type.parseAsync(d,r).catch(A=>{throw l.addIssue(s(d,A)),l})})}{const a=this;return Ee(function(...h){const l=a._def.args.safeParse(h,r);if(!l.success)throw new De([i(h,l.error)]);const c=Reflect.apply(o,this,l.data),d=a._def.returns.safeParse(c,r);if(!d.success)throw new De([s(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new ys({...this._def,args:ai.create(t).rest($i.create())})}returns(t){return new ys({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,e,i){return new ys({args:t||ai.create([]).rest($i.create()),returns:e||$i.create(),typeName:ft.ZodFunction,...vt(i)})}}class pr extends xt{get schema(){return this._def.getter()}_parse(t){const{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}}pr.create=(n,t)=>new pr({getter:n,typeName:ft.ZodLazy,...vt(t)});class fr extends xt{_parse(t){if(t.data!==this._def.value){const e=this._getOrReturnCtx(t);return et(e,{received:e.data,code:J.invalid_literal,expected:this._def.value}),mt}return{status:"valid",value:t.data}}get value(){return this._def.value}}function mc(n,t){return new Ui({values:n,typeName:ft.ZodEnum,...vt(t)})}fr.create=(n,t)=>new fr({value:n,typeName:ft.ZodLiteral,...vt(t)});class Ui extends xt{constructor(){super(...arguments),js.set(this,void 0)}_parse(t){if(typeof t.data!="string"){const e=this._getOrReturnCtx(t),i=this._def.values;return et(e,{expected:Tt.joinValues(i),received:e.parsedType,code:J.invalid_type}),mt}if(mn(this,js)||gc(this,js,new Set(this._def.values)),!mn(this,js).has(t.data)){const e=this._getOrReturnCtx(t),i=this._def.values;return et(e,{received:e.data,code:J.invalid_enum_value,options:i}),mt}return Ee(t.data)}get options(){return this._def.values}get enum(){const t={};for(const e of this._def.values)t[e]=e;return t}get Values(){const t={};for(const e of this._def.values)t[e]=e;return t}get Enum(){const t={};for(const e of this._def.values)t[e]=e;return t}extract(t,e=this._def){return Ui.create(t,{...this._def,...e})}exclude(t,e=this._def){return Ui.create(this.options.filter(i=>!t.includes(i)),{...this._def,...e})}}js=new WeakMap,Ui.create=mc;class _r extends xt{constructor(){super(...arguments),Ys.set(this,void 0)}_parse(t){const e=Tt.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(t);if(i.parsedType!==it.string&&i.parsedType!==it.number){const s=Tt.objectValues(e);return et(i,{expected:Tt.joinValues(s),received:i.parsedType,code:J.invalid_type}),mt}if(mn(this,Ys)||gc(this,Ys,new Set(Tt.getValidEnumValues(this._def.values))),!mn(this,Ys).has(t.data)){const s=Tt.objectValues(e);return et(i,{received:i.data,code:J.invalid_enum_value,options:s}),mt}return Ee(t.data)}get enum(){return this._def.values}}Ys=new WeakMap,_r.create=(n,t)=>new _r({values:n,typeName:ft.ZodNativeEnum,...vt(t)});class Qs extends xt{unwrap(){return this._def.type}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==it.promise&&e.common.async===!1)return et(e,{code:J.invalid_type,expected:it.promise,received:e.parsedType}),mt;const i=e.parsedType===it.promise?e.data:Promise.resolve(e.data);return Ee(i.then(s=>this._def.type.parseAsync(s,{path:e.path,errorMap:e.common.contextualErrorMap})))}}Qs.create=(n,t)=>new Qs({type:n,typeName:ft.ZodPromise,...vt(t)});class qe extends xt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ft.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:e,ctx:i}=this._processInputParams(t),s=this._def.effect||null,r={addIssue:o=>{et(i,o),o.fatal?e.abort():e.dirty()},get path(){return i.path}};if(r.addIssue=r.addIssue.bind(r),s.type==="preprocess"){const o=s.transform(i.data,r);if(i.common.async)return Promise.resolve(o).then(async a=>{if(e.value==="aborted")return mt;const h=await this._def.schema._parseAsync({data:a,path:i.path,parent:i});return h.status==="aborted"?mt:h.status==="dirty"||e.value==="dirty"?_n(h.value):h});{if(e.value==="aborted")return mt;const a=this._def.schema._parseSync({data:o,path:i.path,parent:i});return a.status==="aborted"?mt:a.status==="dirty"||e.value==="dirty"?_n(a.value):a}}if(s.type==="refinement"){const o=a=>{const h=s.refinement(a,r);if(i.common.async)return Promise.resolve(h);if(h instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(i.common.async===!1){const a=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return a.status==="aborted"?mt:(a.status==="dirty"&&e.dirty(),o(a.value),{status:e.value,value:a.value})}return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(a=>a.status==="aborted"?mt:(a.status==="dirty"&&e.dirty(),o(a.value).then(()=>({status:e.value,value:a.value}))))}if(s.type==="transform"){if(i.common.async===!1){const o=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!os(o))return o;const a=s.transform(o.value,r);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:a}}return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(o=>os(o)?Promise.resolve(s.transform(o.value,r)).then(a=>({status:e.value,value:a})):o)}Tt.assertNever(s)}}qe.create=(n,t,e)=>new qe({schema:n,typeName:ft.ZodEffects,effect:t,...vt(e)}),qe.createWithPreprocess=(n,t,e)=>new qe({schema:t,effect:{type:"preprocess",transform:n},typeName:ft.ZodEffects,...vt(e)});class ni extends xt{_parse(t){return this._getType(t)===it.undefined?Ee(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}ni.create=(n,t)=>new ni({innerType:n,typeName:ft.ZodOptional,...vt(t)});class Gi extends xt{_parse(t){return this._getType(t)===it.null?Ee(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Gi.create=(n,t)=>new Gi({innerType:n,typeName:ft.ZodNullable,...vt(t)});class mr extends xt{_parse(t){const{ctx:e}=this._processInputParams(t);let i=e.data;return e.parsedType===it.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:e.path,parent:e})}removeDefault(){return this._def.innerType}}mr.create=(n,t)=>new mr({innerType:n,typeName:ft.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...vt(t)});class vr extends xt{_parse(t){const{ctx:e}=this._processInputParams(t),i={...e,common:{...e.common,issues:[]}},s=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return lr(s)?s.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new De(i.common.issues)},input:i.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new De(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}vr.create=(n,t)=>new vr({innerType:n,typeName:ft.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...vt(t)});class Cn extends xt{_parse(t){if(this._getType(t)!==it.nan){const e=this._getOrReturnCtx(t);return et(e,{code:J.invalid_type,expected:it.nan,received:e.parsedType}),mt}return{status:"valid",value:t.data}}}Cn.create=n=>new Cn({typeName:ft.ZodNaN,...vt(n)});const kA=Symbol("zod_brand");class ja extends xt{_parse(t){const{ctx:e}=this._processInputParams(t),i=e.data;return this._def.type._parse({data:i,path:e.path,parent:e})}unwrap(){return this._def.type}}class Nr extends xt{_parse(t){const{status:e,ctx:i}=this._processInputParams(t);if(i.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return s.status==="aborted"?mt:s.status==="dirty"?(e.dirty(),_n(s.value)):this._def.out._parseAsync({data:s.value,path:i.path,parent:i})})();{const s=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return s.status==="aborted"?mt:s.status==="dirty"?(e.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:i.path,parent:i})}}static create(t,e){return new Nr({in:t,out:e,typeName:ft.ZodPipeline})}}class wr extends xt{_parse(t){const e=this._def.innerType._parse(t),i=s=>(os(s)&&(s.value=Object.freeze(s.value)),s);return lr(e)?e.then(s=>i(s)):i(e)}unwrap(){return this._def.innerType}}function gh(n,t={},e){return n?Ts.create().superRefine((i,s)=>{var r,o;if(!n(i)){const a=typeof t=="function"?t(i):typeof t=="string"?{message:t}:t,h=(o=(r=a.fatal)!==null&&r!==void 0?r:e)===null||o===void 0||o,l=typeof a=="string"?{message:a}:a;s.addIssue({code:"custom",...l,fatal:h})}}):Ts.create()}wr.create=(n,t)=>new wr({innerType:n,typeName:ft.ZodReadonly,...vt(t)});const FA={object:Ot.lazycreate};var ft;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(ft||(ft={}));const ph=He.create,fh=Mi.create,RA=Cn.create,MA=Li.create,_h=cr.create,LA=as.create,UA=vn.create,GA=dr.create,NA=ur.create,zA=Ts.create,OA=$i.create,HA=Ci.create,qA=wn.create,WA=Ye.create,jA=Ot.create,YA=Ot.strictCreate,VA=Ar.create,ZA=Nn.create,XA=gr.create,JA=ai.create,KA=zn.create,$A=yn.create,tg=hs.create,eg=ys.create,ig=pr.create,sg=fr.create,rg=Ui.create,ng=_r.create,og=Qs.create,mh=qe.create,ag=ni.create,hg=Gi.create,lg=qe.createWithPreprocess,cg=Nr.create,dg={string:n=>He.create({...n,coerce:!0}),number:n=>Mi.create({...n,coerce:!0}),boolean:n=>cr.create({...n,coerce:!0}),bigint:n=>Li.create({...n,coerce:!0}),date:n=>as.create({...n,coerce:!0})},ug=mt;var x=Object.freeze({__proto__:null,defaultErrorMap:Ss,setErrorMap:function(n){Ac=n},getErrorMap:pn,makeIssue:fn,EMPTY_PATH:[],addIssueToContext:et,ParseStatus:Ce,INVALID:mt,DIRTY:_n,OK:Ee,isAborted:To,isDirty:Qo,isValid:os,isAsync:lr,get util(){return Tt},get objectUtil(){return So},ZodParsedType:it,getParsedType:fi,ZodType:xt,datetimeRegex:_c,ZodString:He,ZodNumber:Mi,ZodBigInt:Li,ZodBoolean:cr,ZodDate:as,ZodSymbol:vn,ZodUndefined:dr,ZodNull:ur,ZodAny:Ts,ZodUnknown:$i,ZodNever:Ci,ZodVoid:wn,ZodArray:Ye,ZodObject:Ot,ZodUnion:Ar,ZodDiscriminatedUnion:Nn,ZodIntersection:gr,ZodTuple:ai,ZodRecord:zn,ZodMap:yn,ZodSet:hs,ZodFunction:ys,ZodLazy:pr,ZodLiteral:fr,ZodEnum:Ui,ZodNativeEnum:_r,ZodPromise:Qs,ZodEffects:qe,ZodTransformer:qe,ZodOptional:ni,ZodNullable:Gi,ZodDefault:mr,ZodCatch:vr,ZodNaN:Cn,BRAND:kA,ZodBranded:ja,ZodPipeline:Nr,ZodReadonly:wr,custom:gh,Schema:xt,ZodSchema:xt,late:FA,get ZodFirstPartyTypeKind(){return ft},coerce:dg,any:zA,array:WA,bigint:MA,boolean:_h,date:LA,discriminatedUnion:ZA,effect:mh,enum:rg,function:eg,instanceof:(n,t={message:`Input not instance of ${n.name}`})=>gh(e=>e instanceof n,t),intersection:XA,lazy:ig,literal:sg,map:$A,nan:RA,nativeEnum:ng,never:HA,null:NA,nullable:hg,number:fh,object:jA,oboolean:()=>_h().optional(),onumber:()=>fh().optional(),optional:ag,ostring:()=>ph().optional(),pipeline:cg,preprocess:lg,promise:og,record:KA,set:tg,strictObject:YA,string:ph,symbol:UA,transformer:mh,tuple:JA,undefined:GA,union:VA,unknown:OA,void:qA,NEVER:ug,ZodIssueCode:J,quotelessJson:n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:De});const Ag=x.object({name:x.string(),type:x.literal("int"),value:x.number().int()}),gg=x.object({name:x.string(),type:x.literal("bool"),value:x.boolean()}),pg=x.object({name:x.string(),type:x.literal("float"),value:x.number()}),fg=x.object({name:x.string(),type:x.literal("string"),value:x.string()}),_g=x.object({name:x.string(),type:x.literal("file"),value:x.string()}),mg=x.object({name:x.string(),type:x.literal("color"),value:x.string()}),vg=x.object({name:x.string(),type:x.literal("object"),value:x.number()}),Hi=x.discriminatedUnion("type",[Ag,gg,pg,fg,_g,mg,vg]),Gs=x.object({name:x.string(),type:x.literal("tilelayer"),class:x.string().optional(),height:x.number(),width:x.number(),x:x.number(),y:x.number(),id:x.number(),opacity:x.number(),properties:x.array(Hi).optional(),visible:x.boolean(),tintcolor:x.string().optional(),parallaxx:x.number().optional(),parallaxy:x.number().optional(),offsetx:x.number().optional(),offsety:x.number().optional()}),wg=Gs.extend({data:x.array(x.number()),encoding:x.literal("csv")}),yg=Gs.extend({data:x.array(x.number()),encoding:x.literal("base64"),compression:x.literal("gzip")}),Cg=Gs.extend({data:x.array(x.number()),encoding:x.literal("base64"),compression:x.literal("zlib")}),xg=Gs.extend({data:x.array(x.number()),encoding:x.literal("base64"),compression:x.literal("zstandard")}),bg=Gs.extend({data:x.string(),encoding:x.literal("base64"),compression:x.string().optional()}),Ig=x.object({x:x.number(),y:x.number(),width:x.number(),height:x.number(),data:x.string()}),Eg=x.object({x:x.number(),y:x.number(),width:x.number(),height:x.number(),data:x.array(x.number())}),Bg=x.union([Ig,Eg]),vc=Gs.extend({startx:x.number(),starty:x.number(),chunks:x.array(Bg),encoding:x.string().optional(),compression:x.string().optional(),data:x.undefined()}),wc=x.union([bg,wg,yg,Cg,xg,vc]);function yr(n){return n.encoding==="base64"}function Cr(n){return n.encoding==="csv"||Array.isArray(n.data)}const Ya=x.object({x:x.number(),y:x.number()}),Sg=x.array(Ya),yc=x.object({text:x.string(),color:x.string().optional(),fontfamily:x.string().optional(),pixelsize:x.number().optional(),wrap:x.boolean().optional(),halign:x.union([x.literal("left"),x.literal("center"),x.literal("right"),x.literal("justify")]).optional(),valign:x.union([x.literal("top"),x.literal("center"),x.literal("bottom")]).optional()}),On=x.object({id:x.number().optional(),name:x.string().optional(),type:x.string().optional(),x:x.number().optional(),y:x.number().optional(),rotation:x.number().optional(),height:x.number().optional(),width:x.number().optional(),visible:x.boolean().optional(),gid:x.number().optional(),text:yc.optional(),point:x.boolean().optional(),ellipse:x.boolean().optional(),polyline:x.array(Ya).optional(),polygon:Sg.optional(),template:x.string().optional(),properties:x.array(Hi).optional()}),Tg=x.object({duration:x.number(),tileid:x.number()}),Qg=x.object({name:x.string(),draworder:x.string(),type:x.literal("objectgroup"),class:x.string().optional(),x:x.number(),y:x.number(),id:x.number(),color:x.string().optional(),tintcolor:x.string().optional(),parallaxx:x.number().optional(),parallaxy:x.number().optional(),offsetx:x.number().optional(),offsety:x.number().optional(),opacity:x.number(),properties:x.array(Hi).optional(),visible:x.boolean(),objects:x.array(On)}),Pg=x.object({name:x.string(),x:x.number(),y:x.number(),id:x.number(),type:x.literal("imagelayer"),class:x.string().optional(),image:x.string().optional(),opacity:x.number(),properties:x.array(Hi).optional(),visible:x.boolean(),tintcolor:x.string().optional(),repeatx:x.boolean().optional(),repeaty:x.boolean().optional(),parallaxx:x.number().optional(),parallaxy:x.number().optional(),offsetx:x.number().optional(),offsety:x.number().optional(),transparentcolor:x.string().optional()}),Xr=x.union([wc,Pg,Qg]),Dg=x.object({draworder:x.string(),id:x.number().optional(),name:x.string(),x:x.number(),y:x.number(),opacity:x.number(),tintcolor:x.string().optional(),type:x.literal("objectgroup"),visible:x.boolean(),objects:x.array(On),properties:x.array(Hi).optional()}),Va=x.object({id:x.number(),type:x.string().optional(),animation:x.array(Tg).optional(),objectgroup:Dg.optional(),probability:x.number().optional(),properties:x.array(Hi).optional(),image:x.string().optional(),imageheight:x.number().optional(),imagewidth:x.number().optional()}),Cc=x.object({name:x.string(),firstgid:x.number().optional(),class:x.string().optional(),objectalignment:x.union([x.literal("topleft"),x.literal("top"),x.literal("topright"),x.literal("left"),x.literal("center"),x.literal("right"),x.literal("bottomleft"),x.literal("bottom"),x.literal("bottomright")]).optional(),image:x.string().optional(),imagewidth:x.number().optional(),imageheight:x.number().optional(),columns:x.number(),tileheight:x.number(),tilewidth:x.number(),tilecount:x.number(),grid:x.object({height:x.number(),width:x.number(),orientation:x.union([x.literal("isometric"),x.literal("orthogonal")])}).optional(),tileoffset:Ya.optional(),spacing:x.number(),margin:x.number(),tiles:x.array(Va).optional(),properties:x.array(Hi).optional()});function Hn(n){return!!n.image}function qn(n){return!n.image}const Za=Cc.extend({tiledversion:x.string().optional(),type:x.literal("tileset"),version:x.string().optional()}),xc=x.object({firstgid:x.number(),source:x.string()}),xn=x.union([Cc,xc]),Xa=x.object({object:On.extend({id:x.number().optional()}),tileset:xc.optional(),type:x.literal("template")}),bc=x.object({type:x.string(),class:x.string().optional(),tiledversion:x.string(),version:x.string(),width:x.number(),height:x.number(),tilewidth:x.number(),tileheight:x.number(),compressionlevel:x.number().optional(),infinite:x.boolean(),nextlayerid:x.number(),nextobjectid:x.number(),parallaxoriginx:x.number().optional(),parallaxoriginy:x.number().optional(),hexsidelength:x.number().optional(),staggeraxis:x.literal("y").or(x.literal("x")).optional(),staggerindex:x.literal("odd").or(x.literal("even")).optional(),orientation:x.union([x.literal("isometric"),x.literal("orthogonal"),x.literal("staggered"),x.literal("hexagonal")]),renderorder:x.union([x.literal("right-down"),x.literal("right-up"),x.literal("left-down"),x.literal("left-up")]),backgroundcolor:x.string().optional(),layers:x.array(Xr),tilesets:x.array(xn),properties:x.array(Hi).optional()});function xr(n){return!!n.chunks}function Ic(n){return!n.source}function Ec(n){return!!n.source}class gs{constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}combine(t){const e=this.x+this.width,i=this.y+this.height,s=t.x+t.width,r=t.y+t.height,o=Math.max(e,s),a=Math.max(i,r);return new gs(Math.min(this.x,t.x),Math.min(this.y,t.y),o-Math.min(this.x,t.x),a-Math.min(this.y,t.y))}}class Wn{constructor(){this._largestBounds=new gs(0,0,0,0)}_coerceNumber(t){return+t}_coerceBoolean(t){switch(t){case"0":case"false":return!1;case"true":return!0;default:return!!t}}_coerceType(t,e){return t==="bool"?this._coerceBoolean(e):t==="int"||t==="float"||t==="object"?this._coerceNumber(e):e}_parsePropertiesNode(t,e){var i;const s=[];if(t)for(let r of t.children){const o=(i=r.getAttribute("type"))!==null&&i!==void 0?i:"string";let a=r.getAttribute("value");a||(a=r.innerHTML),s.push({name:r.getAttribute("name"),type:o,value:this._coerceType(o,a)})}e.properties=s}_parseAttributes(t,e){const i=["width","height","columns","firstgid","spacing","margin","tilecount","tilewidth","tileheight","opacity","compressionlevel","nextlayerid","nextobjectid","parallaxoriginx","parallaxoriginy","parallaxx","parallaxy","hexsidelength","offsetx","offsety","id","gid","x","y","rotation","probability"],s=["infinite","visible","repeatx","repeaty"];for(let r of t.attributes)i.indexOf(r.name)>-1?e[r.name]=this._coerceNumber(r.value):s.indexOf(r.name)>-1?e[r.name]=this._coerceBoolean(r.value):e[r.name]=r.value}_parseToDocument(t){if(typeof DOMParser<"u")return new DOMParser().parseFromString(t,"application/xml");try{const{JSDOM:i}=_i(371);return new i(t,{contentType:"application/xml",encoding:"utf-8"}).window.document}catch{}const e=new Error("Could not find DOM parser");throw console.error(e.message,e),e}parseObject(t,e=!0){var i,s;const r={type:"",x:0,y:0};t.getAttribute("template")||(r.visible=!0,r.name="",r.rotation=0,r.height=0,r.width=0),this._parseAttributes(t,r);const o=t.querySelector("properties");o&&this._parsePropertiesNode(o,r);const a=t.querySelector("text");if(a){r.text={text:a.textContent};const c=a.getAttribute("fontfamily");c&&(r.text.fontfamily=c);const d=a.getAttribute("color");d&&(r.text.color=d);const A=a.getAttribute("pixelsize");A&&(r.text.pixelsize=this._coerceNumber(A));const u=a.getAttribute("wrap");u&&(r.text.wrap=this._coerceBoolean(u));const p=a.getAttribute("valign");p&&(r.text.valign=p);const v=a.getAttribute("halign");v&&(r.text.halign=v)}t.querySelector("point")&&(r.point=!0),t.querySelector("ellipse")&&(r.ellipse=!0);const h=t.querySelector("polygon");if(h){const c=(i=h.getAttribute("points"))===null||i===void 0?void 0:i.split(" ");r.polygon=[],c&&c.forEach(d=>{const A=d.split(",");r.polygon.push({x:+A[0],y:+A[1]})})}const l=t.querySelector("polyline");if(l){const c=(s=l.getAttribute("points"))===null||s===void 0?void 0:s.split(" ");r.polyline=[],c&&c.forEach(d=>{const A=d.split(",");r.polyline.push({x:+A[0],y:+A[1]})})}if(e)try{return On.parse(r)}catch(c){throw console.error("Could not parse object",r,c),c}return r}parseTileset(t,e=!0){const i={spacing:0,margin:0};if(this._parseAttributes(t,i),i.source)try{return xn.parse(i)}catch(s){console.error("Could not parse external tileset",i,s)}for(let s of t.children)switch(s.tagName){case"properties":this._parsePropertiesNode(s,i);break;case"tileoffset":{const r={};this._parseAttributes(s,r),i.tileoffset=r;break}case"grid":{const r={};this._parseAttributes(s,r),i.grid=r;break}case"image":i.image=s.getAttribute("source"),i.imagewidth=this._coerceNumber(s.getAttribute("width")),i.imageheight=this._coerceNumber(s.getAttribute("height"));break;case"tile":{i.tiles||(i.tiles=[]);const r={};this._parseAttributes(s,r);for(let o of s.children)switch(o.tagName){case"image":r.image=o.getAttribute("source"),r.imagewidth=this._coerceNumber(o.getAttribute("width")),r.imageheight=this._coerceNumber(o.getAttribute("height"));break;case"objectgroup":{const a={type:"objectgroup",name:"",visible:!0,x:0,y:0,opacity:1,objects:[]};this._parseAttributes(o,a),r.objectgroup=a;for(let h of o.children){const l=this.parseObject(h,e);a.objects.push(l)}break}case"animation":{const a=[];for(let h of o.children)a.push({duration:this._coerceNumber(h.getAttribute("duration")),tileid:this._coerceNumber(h.getAttribute("tileid"))});r.animation=a;break}case"properties":this._parsePropertiesNode(o,r)}if(e)try{i.tiles.push(Va.parse(r))}catch(o){throw console.error("Could not parse Tile",r,o),o}else i.tiles.push(r);break}}if(e)try{return xn.parse(i)}catch(s){throw console.error("Could not parse Tileset",i,s),s}return i}parseTileLayer(t,e,i=!0){var s,r,o,a;const h={type:"tilelayer",x:0,y:0,opacity:1,visible:!0};this._parseAttributes(t,h);for(let l of t.children)switch(l.tagName){case"properties":this._parsePropertiesNode(l,h);break;case"data":{const c=l.getAttribute("encoding");c&&(h.encoding=c);const d=l.getAttribute("compression");if(d&&(h.compression=d),e){h.width=0,h.height=0,h.chunks=[];let A=new gs(0,0,0,0);for(let u of l.children)if(u.tagName==="chunk"){const p={};switch(this._parseAttributes(u,p),h.encoding){case"base64":p.data=(s=u.textContent)===null||s===void 0?void 0:s.trim();break;case"csv":p.data=(r=u.textContent)===null||r===void 0?void 0:r.split(",").map(C=>+C)}const v=new gs(p.x,p.y,p.width,p.height);A=A.combine(v),h.chunks.push(p)}h.width=A.width,h.height=A.height,h.startx=A.x,h.starty=A.y,this._largestBounds=this._largestBounds.combine(new gs(h.startx,h.starty,h.width,h.height))}else switch(h.encoding){case"base64":h.data=(o=l.textContent)===null||o===void 0?void 0:o.trim();break;case"csv":h.data=(a=l.textContent)===null||a===void 0?void 0:a.split(",").map(A=>+A)}}}if(i)try{return Xr.parse(h)}catch(l){throw console.error("Could not parse tiled tile layer",h,l),l}return h}parseObjectGroup(t,e=!0){const i={type:"objectgroup",draworder:"topdown",visible:!0,x:0,y:0,opacity:1,objects:[]};this._parseAttributes(t,i);for(let s of t.children)switch(s.tagName){case"properties":this._parsePropertiesNode(s,i);break;case"object":{const r=this.parseObject(s,e);i.objects.push(r);break}}if(e)try{return Xr.parse(i)}catch(s){throw console.error("Could not parse object group",i,s),s}return i}parseImageLayer(t,e=!0){const i={type:"imagelayer",visible:!0,x:0,y:0,opacity:1},s=t.querySelector("image");i.image=s?.getAttribute("source");const r=t.querySelector("properties");r&&this._parsePropertiesNode(r,i);const o=s?.getAttribute("trans");if(o&&(i.transparentcolor="#"+o),this._parseAttributes(t,i),e)try{return Xr.parse(i)}catch(a){throw console.error("Could not parse layer",i,a),a}return i}parseExternalTemplate(t,e=!0){const i=this._parseToDocument(t).querySelector("template"),s={type:"template"},r=i.querySelector("object");r&&(s.object=this.parseObject(r,e));const o=i.querySelector("tileset");if(o&&(s.tileset=this.parseTileset(o,e)),e)try{return Xa.parse(s)}catch(a){throw console.error("Could not parse template",s,a),a}return s}parseExternalTileset(t,e=!0){const i=this._parseToDocument(t).querySelector("tileset"),s=this.parseTileset(i,e);if(s.type="tileset",this._parseAttributes(i,s),e)try{return Za.parse(s)}catch(r){throw console.error("Could not parse tileset file",s,r),r}return s}parse(t,e=!0){const i=this._parseToDocument(t).querySelector("map"),s={type:"map",compressionlevel:-1,layers:[],tilesets:[]};this._parseAttributes(i,s);const r=(o,a=!0)=>{switch(o.tagName){case"group":for(let h of o.children)r(h,a);break;case"layer":{const h=this.parseTileLayer(o,s.infinite,a);s.layers.push(h);break}case"properties":this._parsePropertiesNode(o,s);break;case"tileset":{const h=this.parseTileset(o,a);s.tilesets.push(h);break}case"objectgroup":{const h=this.parseObjectGroup(o,a);s.layers.push(h);break}case"imagelayer":{const h=this.parseImageLayer(o,a);s.layers.push(h);break}}};for(let o of i.children)r(o,e);if(e)try{return bc.parse(s)}catch(o){throw console.error("Could not parse Tiled map",o),o}return s}}var kg=_i(668);let $n,ui,Do;const to={env:{emscripten_notify_memory_growth:function(n){Do=new Uint8Array(ui.exports.memory.buffer)}}};class Fg{init(){return $n||($n=typeof fetch<"u"?fetch("data:application/wasm;base64,"+vh).then(t=>t.arrayBuffer()).then(t=>WebAssembly.instantiate(t,to)).then(this._init):WebAssembly.instantiate(Buffer.from(vh,"base64"),to).then(this._init),$n)}_init(t){ui=t.instance,to.env.emscripten_notify_memory_growth(0)}decode(t,e=0){if(!ui)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=t.byteLength,s=ui.exports.malloc(i);Do.set(t,s),e=e||Number(ui.exports.ZSTD_findDecompressedSize(s,i));const r=ui.exports.malloc(e),o=ui.exports.ZSTD_decompress(r,e,s,i),a=Do.slice(r,r+o);return ui.exports.free(s),ui.exports.free(r),a}}const vh="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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";class br{static decode(t,e){var i,s,r,o,a,h;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var l=43,c=47,d=48,A=97,u=65,p=45,v=95;function C(I){var Q=I.charCodeAt(0);if(Q===l||Q===p)return 62;if(Q===c||Q===v)return 63;if(Q<d)return-1;if(Q<d+10)return Q-d+26+26;if(Q<u+26)return Q-u;if(Q<A+26)return Q-A+26;throw Error("Could not decode elt")}var y=t.length;a=t.charAt(y-2)==="="?2:t.charAt(y-1)==="="?1:0,h=new Uint8Array(3*t.length/4-a),r=a>0?t.length-4:t.length;var b=0;function P(I){h[b++]=I}for(i=0,s=0;i<r;i+=4,s+=3)P((16711680&(o=C(t.charAt(i))<<18|C(t.charAt(i+1))<<12|C(t.charAt(i+2))<<6|C(t.charAt(i+3))))>>16),P((65280&o)>>8),P(255&o);return a===2?P(255&(o=C(t.charAt(i))<<2|C(t.charAt(i+1))>>4)):a===1&&(P((o=C(t.charAt(i))<<10|C(t.charAt(i+1))<<4|C(t.charAt(i+2))>>2)>>8&255),P(255&o)),new Promise(I=>{const Q=function(j){for(var $=0,st=j.length-1;st>=0;st--)$=256*$+1*j[st];return $};if(e==="zlib"||e==="gzip"){var O=(h=(0,kg.inflate)(h)).length/4,B=new Array(O);for(i=0;i<O;i++)B[i]=Q(h.slice(4*i,4*i+4));I(B)}if(e==="zstd"){const j=new Fg;j.init().then(()=>{var $=(h=j.decode(h)).length/4,st=new Array($);for(i=0;i<$;i++)st[i]=Q(h.slice(4*i,4*i+4));I(st)})}if(!e){for(O=h.length/4,B=new Array(O),i=0;i<O;i++)B[i]=Q(h.slice(4*i,4*i+4));I(B)}})}}const $t={TileData:{Tiled:"ex-tiled"},ZIndex:{ZIndex:"zindex"},Camera:{Camera:"camera",Zoom:"zoom"},Animation:{Strategy:"animationstrategy"},Layer:{Solid:"solid"},Collision:{Type:"collisiontype"}},jn=async(n,t)=>{const e=await fetch(n);switch(t.toLowerCase()){case"xml":default:return await e.text();case"json":return await e.json()}},Me=n=>t=>t?.name&&n?t.name.toLocaleLowerCase().localeCompare(n.toLocaleLowerCase())===0:t?.name===n,ki=n=>t=>t?.class&&n?t.class.toLocaleLowerCase().localeCompare(n.toLocaleLowerCase())===0:t?.class===n,Fi=(n,t)=>e=>{const i=(s=>{const r=new Map;for(let[o,a]of s){let h=a;typeof a=="string"&&(h=a.toLocaleLowerCase()),r.set(o.toLocaleLowerCase(),h)}return r})(e.properties);if(t!==void 0){let s=t;return typeof t=="string"&&(s=t.toLocaleLowerCase()),i.get(n.toLocaleLowerCase())===s}return i.has(n.toLocaleLowerCase())},Bc=2147483648,Sc=1073741824,Tc=536870912,ko=n=>!!(n&Bc),Fo=n=>!!(n&Sc),Ro=n=>!!(n&Tc),ls=n=>n&536870911;class Cs{constructor(t){this.type=t,this._loaded=!1,this.cache=new Map}getOrAdd(...t){let e=this.cache.get(t.join("+"));return e||(e=new this.type(...t),this.cache.set(t.join("+"),e),e)}values(){if(this._loaded)return Array.from(this.cache.values());throw new Error("Read through cache not yet loaded! No values to return!")}async load(){const t=Array.from(this.cache.entries()),e=await Promise.allSettled(t.map(s=>s[1].load()));let i=0;for(let s=0;s<e.length;s++){const r=e[s];r.status==="rejected"&&(console.error(`Error loading resource at ${t[s][0]}, is your pathMap correct? or your Tiled map corrupted?`,r.reason),i++)}if(i)throw new Error(`Error loading ${i} resources`);this._loaded=!0}}const k=(n=>{var t={};return _i.d(t,n),t})({Actor:()=>_t,AffineMatrix:()=>Ou,Animation:()=>Hu,AnimationStrategy:()=>qu,BaseAlign:()=>Wu,BodyComponent:()=>ju,BoundingBox:()=>Yu,CollisionType:()=>cs,Color:()=>Le,Component:()=>Vu,Font:()=>ws,FontUnit:()=>dc,GraphicsComponent:()=>Ju,ImageSource:()=>dt,IsometricEntityComponent:()=>Ku,IsometricMap:()=>$u,Logger:()=>eA,ParallaxComponent:()=>iA,Shape:()=>sA,SpriteSheet:()=>nA,Text:()=>oA,TextAlign:()=>aA,TileMap:()=>hA,TransformComponent:()=>lA,Vector:()=>L,toRadians:()=>cA,vec:()=>dA});function qi(n,t){try{if(t)for(const e of t){let i=e.value;typeof e.value=="string"&&(i=e.value.toLocaleLowerCase()),n.properties.set(e.name.toLocaleLowerCase(),i)}}catch(e){console.error(`Unable to map properties onto ${n}`,e)}}function Mo(n){const t=n.match(/[^/\\&\?]+\.\w{2,4}(?=([\#\?&].*$|$))/gi);if(t)return t[0];throw new Error(`Could not locate filename from path: ${n}`)}function Qc(n,t){for(const{path:e,output:i}of t)if(typeof e=="string"){if(n.includes(e))return i}else{const s=n.match(e);if(s)return i.replace("[match]",s[0])}return n}function Pc(n,t){if(!t)return!1;for(const{path:e,output:i}of t)if(typeof e=="string"){if(n.includes(e))return!0}else if(n.match(e))return!0;return!1}function mi(n,t,e){if(Pc(t,e)&&e)return Qc(t,e);if(t.indexOf("/")===0)return t;const i=n.split("/"),s=t.split("/");return i[i.length-1].includes(".")&&i.pop(),i.concat(s).join("/")}class Bi{constructor(t){var e,i,s,r;this.properties=new Map,this.tiledObject=t.tiledObject,this.name=this.tiledObject.name,this.class=this.tiledObject.type,this.id=(e=this.tiledObject.id)!==null&&e!==void 0?e:-1,this.x=(i=this.tiledObject.x)!==null&&i!==void 0?i:0,this.y=(s=this.tiledObject.y)!==null&&s!==void 0?s:0,this.rotation=(r=this.tiledObject.rotation)!==null&&r!==void 0?r:0}}class ps extends Bi{constructor(t,e){if(super({tiledObject:t}),!t.template)throw new Error("Invalid template");if(this.source=t.template,this.gid=t.gid,this.instanceObject=t,this.template=e,e.object){this.name=this.name||e.object.name,this.class=this.class||e.object.class;for(const[i,s]of e.object.properties.entries())this.properties.has(i)||this.properties.set(i,s)}if(e.tileset&&e.object.tiledObject.gid){const i=e.tileset.getTileByGid(e.object.tiledObject.gid);if(i){this.class=this.class||i.class;for(const[s,r]of i.properties.entries())this.properties.has(s)||this.properties.set(s,r)}}}}class fs extends Bi{constructor(t,e,i,s){super({tiledObject:t}),this.gid=e,this.width=i,this.height=s}}class Dc extends Bi{}class Ja extends Bi{constructor(t,e,i,s){var r,o,a;super({tiledObject:t}),this.font=new k.Font({family:(r=e.fontfamily)!==null&&r!==void 0?r:"sans-serif",color:e.color?k.Color.fromHex(e.color):k.Color.Black,size:(o=e.pixelsize)!==null&&o!==void 0?o:16,unit:k.FontUnit.Px,textAlign:this._textAlignFromTiled(e.halign),baseAlign:this._textBaselineFromTiled(e.valign),quality:s});const h=(a=e.wrap)!==null&&a!==void 0&&a;this.text=new k.Text({text:e.text,font:this.font,...h?{maxWidth:i+10}:{}})}_textBaselineFromTiled(t){switch(t){case"bottom":return k.BaseAlign.Bottom;case"center":return k.BaseAlign.Middle;default:return k.BaseAlign.Top}}_textAlignFromTiled(t){switch(t){case"left":default:return k.TextAlign.Left;case"center":return k.TextAlign.Center;case"right":return k.TextAlign.Right;case"justify":return k.TextAlign.Start}}}class Ir extends Bi{constructor(t,e,i){super({tiledObject:t}),this.width=e,this.height=i}}class Er extends Bi{constructor(t,e,i,s){super({tiledObject:t}),this.width=e,this.height=i,this.anchor=s}}class Yn extends Bi{constructor(t,e){super({tiledObject:t}),this.points=[],this.localPoints=[],this.localPoints=e.map(i=>(0,k.vec)(i.x,i.y)),this.points=e.map(i=>(0,k.vec)(i.x,i.y).rotate((0,k.toRadians)(this.rotation)).add((0,k.vec)(this.x,this.y)))}}class kc extends Bi{constructor(t,e){super({tiledObject:t}),this.points=[],this.points=e.map(i=>(0,k.vec)(i.x,i.y))}}function Ka(n,t){var e,i,s,r;let o;if(n.point)o=new Dc({tiledObject:n});else if(n.ellipse)n.width&&n.height?(o=new Ir(n,n.width,n.height),o.x+=n.width/2,o.y+=n.height/2):o=new Ir(n,20,20);else if(n.polygon)o=new Yn(n,n.polygon);else if(n.polyline)o=new kc(n,n.polyline);else if(n.text)o=new Ja(n,n.text,(e=n.width)!==null&&e!==void 0?e:0,(i=t?.textQuality)!==null&&i!==void 0?i:4);else if(n.gid&&!n.template){o=new fs(n,n.gid,(s=n.width)!==null&&s!==void 0?s:0,(r=n.height)!==null&&r!==void 0?r:0);const a=t?.getTilesetForTileGid(n.gid);let h=n.type;if(a){const l=a?.getTileByGid(n.gid);if(h=h||l?.class,l?.properties)for(const[c,d]of l.properties.entries())o.properties.has(c)||o.properties.set(c,d)}o.class=h}else if(n.template&&t){const a=t.templates.find(h=>Mo(h.templatePath)===Mo(n.template));if(!a)throw new Error(`Template object id ${n.id} with name ${n.name} is missing a loaded template file, there should be one loaded from ${n.template}! Is your tiled map or template corrupted?`);o=new ps(n,a)}else o=n.width&&n.height?new Er(n,n.width,n.height,k.Vector.Zero):new Er(n,20,20,k.Vector.Half);return qi(o,n.properties),o}function $a(n,t){const e=[];for(const i of n.objects){let s=Ka(i,t);e.push(s)}return e}class Fc{constructor(t){const{templatePath:e,object:i,tiledTemplate:s,tileset:r}=t;this.templatePath=e,this.object=i,this.tiledTemplate=s,this.tileset=r}}class Lo{constructor(t){this.objects=[],this.colliders=[],this.animation=[],this.properties=new Map;const{id:e,tileset:i,tiledTile:s}=t;this.id=e,this.tileset=i,this.tiledTile=s,this.class=s.type,qi(this,s.properties),s.objectgroup&&s.objectgroup.objects&&(this.objects=$a(s.objectgroup)),s.animation&&(this.animation=s.animation)}}class Br{constructor(t){var e,i,s,r,o,a,h,l,c,d;this.firstGid=-1,this.tileCount=0,this.tileWidth=0,this.tileHeight=0,this.tileOffset=(0,k.vec)(0,0),this.tiles=[],this.objectalignment="bottomleft",this.orientation="orthogonal",this.properties=new Map;const{name:A,tiledTileset:u,image:p,tileToImage:v,firstGid:C}=t;if(this.name=A,this.tiledTileset=u,this.firstGid=C,Hn(u)){qi(this,u.properties);const y=u.spacing,b=Math.floor((u.imagewidth+y)/(u.tilewidth+y)),P=Math.floor((u.imageheight+y)/(u.tileheight+y));if(this.class=u.class,this.orientation=(i=(e=u.grid)===null||e===void 0?void 0:e.orientation)!==null&&i!==void 0?i:"orthogonal",this.horizontalFlipTransform=k.AffineMatrix.identity().translate(u.tilewidth,0).scale(-1,1),this.verticalFlipTransform=k.AffineMatrix.identity().translate(0,u.tileheight).scale(1,-1),this.diagonalFlipTransform=k.AffineMatrix.identity().translate(0,0).rotate(-Math.PI/2).scale(-1,1),this.objectalignment=(s=u.objectalignment)!==null&&s!==void 0?s:this.orientation==="orthogonal"?"bottomleft":"bottom",p&&(this.spritesheet=k.SpriteSheet.fromImageSource({image:p,grid:{rows:P,columns:b,spriteWidth:u.tilewidth,spriteHeight:u.tileheight},spacing:{originOffset:{x:(r=u.margin)!==null&&r!==void 0?r:0,y:(o=u.margin)!==null&&o!==void 0?o:0},margin:{x:(a=u.spacing)!==null&&a!==void 0?a:0,y:(h=u.spacing)!==null&&h!==void 0?h:0}}})),this.tileCount=u.tilecount,this.tileWidth=u.tilewidth,this.tileHeight=u.tileheight,u.tileoffset&&(this.tileOffset=(0,k.vec)(u.tileoffset.x,u.tileoffset.y)),u.tiles)for(const I of u.tiles)this.tiles.push(new Lo({id:I.id,tileset:this,tiledTile:I,image:p}))}if(qn(u)&&u.firstgid!==void 0){this.horizontalFlipTransform=k.AffineMatrix.identity().translate(u.tilewidth,0).scale(-1,1),this.verticalFlipTransform=k.AffineMatrix.identity().translate(0,u.tileheight).scale(1,-1),this.diagonalFlipTransform=k.AffineMatrix.identity().translate(0,0).rotate(-Math.PI/2).scale(-1,1),this.objectalignment=(l=u.objectalignment)!==null&&l!==void 0?l:this.orientation==="orthogonal"?"bottomleft":"bottom",this.orientation=(d=(c=u.grid)===null||c===void 0?void 0:c.orientation)!==null&&d!==void 0?d:"orthogonal",this.tileCount=u.tilecount,this.tileWidth=u.tilewidth,this.tileHeight=u.tileheight,u.tileoffset&&(this.tileOffset=(0,k.vec)(u.tileoffset.x,u.tileoffset.y));let y=[];if(u.tiles)for(const b of u.tiles){const P=v?.get(b);P&&y.push(P.toSprite()),this.tiles.push(new Lo({id:b.id,tileset:this,tiledTile:b,image:P}))}v&&(this.spritesheet=new k.SpriteSheet({sprites:y}))}}getTilesetAlignmentAnchor(t){switch(t??this.objectalignment){case"topleft":return(0,k.vec)(0,0);case"top":return(0,k.vec)(.5,0);case"topright":return(0,k.vec)(1,0);case"left":return(0,k.vec)(0,.5);case"center":return(0,k.vec)(.5,.5);case"right":return(0,k.vec)(1,.5);case"bottomleft":default:return(0,k.vec)(0,1);case"bottom":return(0,k.vec)(.5,1);case"bottomright":return(0,k.vec)(1,1)}}getTileByGid(t){const e=ls(t)-this.firstGid;return this.tiles.find(i=>i.id===e)}getTilesByClassName(t){return this.tiles.filter(ki(t))}getTilesByProperty(t,e){return this.tiles.filter(Fi(t,e))}getSpriteForGid(t){const e=ko(t),i=Fo(t),s=Ro(t),r=ls(t),o=r-this.firstGid;if(this.spritesheet){let a=this.spritesheet.sprites[o];return(s||e||i)&&(a=a.clone()),s&&(a.rotation=-Math.PI/2,a.scale=(0,k.vec)(-1,1)),e&&(a.scale=(0,k.vec)((s?1:-1)*a.scale.x,(s?-1:1)*a.scale.y)),i&&(a.scale=(0,k.vec)((s?-1:1)*a.scale.x,(s?1:-1)*a.scale.y)),a}throw new Error(`Tileset: [${this.name}] Could not find sprite for gid: [${t}] normalized gid: [${r}]`)}_isometricTiledCoordToWorld(t){const e=this.tileWidth,i=this.tileHeight/2,s=t.y/i,r=t.x/i;return(0,k.vec)((r-s)*e/2+0,(r+s)*i/2)}getCollidersForGid(t,e){let{scale:i,orientationOverride:s,offset:r}={anchor:k.Vector.Zero,scale:k.Vector.One,offset:k.Vector.Zero,orientationOverride:void 0,...e};const o=s??this.orientation,a=this.getTileByGid(t),h=[];if(a&&a.objects)for(let l of a.objects){if(l instanceof Yn){let c=l.points.map(A=>A.scale(i));c=this._applyFlipsToPoints(c,t),o==="isometric"&&(c=c.map(A=>this._isometricTiledCoordToWorld(A))),c=c.map(A=>A.add(r));let d=k.Shape.Polygon(c,k.Vector.Zero,!0);d.isConvex()?h.push(d):h.push(d.triangulate())}if(l instanceof Er){const c=l.width,d=l.height,A=l.anchor;let u=k.BoundingBox.fromDimension(c*i.x,d*i.y,A).getPoints().map(v=>v.rotate((0,k.toRadians)(l.rotation)).add((0,k.vec)(l.x,l.y)));o==="isometric"&&(u=u.map(v=>this._isometricTiledCoordToWorld(v))),u=this._applyFlipsToPoints(u,t),u=u.map(v=>v.add(r));const p=k.Shape.Polygon(u);h.push(p)}if(l instanceof Ir){let c=(0,k.vec)(l.x,l.y);o==="isometric"&&(c=this._isometricTiledCoordToWorld(c)),c=c.add(r);const d=Math.min(l.width/2,l.height/2),A=k.Shape.Circle(d,c.scale(i));h.push(A)}}return h}_applyFlipsToPoints(t,e){const i=ko(e),s=Fo(e);return Ro(e)&&(t=t.map(r=>this.diagonalFlipTransform.multiply(r))),i&&(t=t.map(r=>this.horizontalFlipTransform.multiply(r))),s&&(t=t.map(r=>this.verticalFlipTransform.multiply(r))),t}getAnimationForGid(t){var e;const i=this.getTileByGid(t);if(i&&(!((e=i.animation)===null||e===void 0)&&e.length)){let s=[];for(let r of i.animation)s.push({graphic:this.getSpriteForGid(r.tileid+this.firstGid),duration:r.duration});return new k.Animation({frames:s,strategy:k.AnimationStrategy.Loop})}return null}}class th{constructor(t,e,i){this.path=t,this.strict=!0,this.headless=!1,this.orientation="orthogonal",this.fileLoader=jn;const{fileLoader:s,parser:r,pathMap:o,imageLoader:a,strict:h,headless:l,orientation:c}={...i};this.headless=l??this.headless,this.orientation=c??this.orientation,this.strict=h??this.strict,this.fileLoader=s??this.fileLoader,this.imageLoader=a??new Cs(k.ImageSource),this.parser=r??new Wn,this.firstGid=e,this.pathMap=o}async load(){const t=this.path.includes(".tsx")?"xml":"json";try{const e=await this.fileLoader(this.path,t);let i;if(i=t==="json"?this.strict?Za.parse(e):e:this.parser.parseExternalTileset(e,this.strict),Hn(i)){const s=mi(this.path,i.image,this.pathMap),r=this.headless?void 0:this.imageLoader.getOrAdd(s);this.data=new Br({name:i.name,tiledTileset:i,firstGid:this.firstGid,image:r})}if(qn(i)){const s=this.headless?void 0:new Map;if(s){const r=[];if(i.tiles){for(let o of i.tiles)if(o.image){const a=mi(this.path,o.image,this.pathMap),h=this.imageLoader.getOrAdd(a);s.set(o,h),r.push(h)}}}i.firstgid=this.firstGid,this.data=new Br({name:i.name,tiledTileset:i,firstGid:this.firstGid,tileToImage:s})}if(this.headless||await this.imageLoader.load(),this.data)return this.data}catch(e){throw console.error(`Could not load tileset at path ${this.path}`),e}throw new Error(`No tileset at path ${this.path}`)}isLoaded(){return!!this.data}}class Rc{constructor(t,e){this.templatePath=t,this.headless=!1,this.strict=!0,this.fileLoader=jn;const{fileLoader:i,parser:s,pathMap:r,imageLoader:o,strict:a,headless:h}={...e};this.headless=h??this.headless,this.strict=a??this.strict,this.fileLoader=i??this.fileLoader,this.imageLoader=o??new Cs(k.ImageSource),this.parser=s??new Wn,this.pathMap=r}isLoaded(){return!!this.data}async load(){const t=this.templatePath.includes(".tx")?"xml":"json";try{const e=await this.fileLoader(this.templatePath,t);let i;i=t==="xml"?this.parser.parseExternalTemplate(e,this.strict):this.strict?Xa.parse(e):e;const s=i,r=Ka(i.object);let o;if(i.tileset){const a=mi(this.templatePath,i.tileset.source,this.pathMap);o=await new th(a,i.tileset.firstgid,{headless:this.headless,strict:this.strict,fileLoader:this.fileLoader,imageLoader:this.imageLoader,parser:this.parser,pathMap:this.pathMap}).load()}return this.data=new Fc({templatePath:this.templatePath,tiledTemplate:s,object:r,tileset:o})}catch(e){throw console.error(`Could not load template at ${this.templatePath}, check to see if your pathMap is correct or if you're Tiled map is corrupted`),e}}}class Mc extends k.Component{constructor(t){super();const{tiledObject:e}=t;this.tiledObject=e}}class eh extends k.Component{constructor(t){super();const{tiledTileLayer:e}=t;this.tiledTileLayer=e}}class eo{constructor(t,e,i){this.tiledTileLayer=t,this.resource=e,this.order=i,this.logger=k.Logger.getInstance(),this.width=0,this.height=0,this.properties=new Map,this.data=[],this._gidToTileInfo=new Map,this.name=t.name,this.id=t.id,this.class=t.class,this.width=t.width,this.height=t.height,this.visible=!!t.visible,qi(this,t.properties)}getTilesByGid(t){var e;return(e=this._gidToTileInfo.get(t))!==null&&e!==void 0?e:[]}getTilesByClassName(t){return this.isometricMap.tiles.filter(e=>{const i=e.data.get($t.TileData.Tiled);return!!i&&ki(t)(i)}).map(e=>({exTile:e,tiledTile:e.data.get($t.TileData.Tiled)}))}getTilesByProperty(t,e){return this.isometricMap.tiles.filter(i=>{const s=i.data.get($t.TileData.Tiled);return!!s&&Fi(t,e)(s)}).map(i=>({exTile:i,tiledTile:i.data.get($t.TileData.Tiled)}))}getTileByPoint(t){if(!this.isometricMap)return this.logger.warn("IsometricMap has not yet been loaded! getTileByPoint() will only return null"),null;if(this.isometricMap){const e=this.isometricMap.getTileByPoint(t);if(!e)return null;const i=this.isometricMap.tiles.indexOf(e),s=ls(this.data[i]);return s<=0?null:{tiledTile:this.resource.getTilesetForTileGid(s).getTileByGid(s),exTile:e}}return null}_recordTileData(t,e){let i=this._gidToTileInfo.get(t),s=this.resource.getTilesetForTileGid(t).getTileByGid(t);i?i.push({exTile:e,tiledTile:s}):i=[{exTile:e,tiledTile:s}],this._gidToTileInfo.set(t,i),e.data.set($t.TileData.Tiled,s)}updateTile(t,e,i,s,r){this._recordTileData(e,t);const o=this.resource.getLayerConfig(this.name)||this.resource.getLayerConfig(this.id);o?.isSolid!==void 0&&(r=o.isSolid),this.resource.useExcaliburWiring&&r&&(t.solid=!0);const a=t.get(k.IsometricEntityComponent);a&&(a.elevation=this.order);const h=this.resource.getTilesetForTileGid(e);let l=h.getSpriteForGid(e);i&&(l=l.clone(),l.tint=s),t.addGraphic(l,{offset:h.tileOffset});let c=t.pos;if(h.orientation==="orthogonal")c=(0,k.vec)(0,0);else{const u=this.resource.map.tilewidth/2,p=this.resource.map.tileheight;c=(0,k.vec)(u,p)}const d=h.getCollidersForGid(e,{offset:c});for(let u of d)t.addCollider(u);o?.useTileColliders&&d.length>0&&this.visible&&(t.solid=!0),o?.useTileCollidersWhenInvisible&&d.length>0&&(t.solid=!0);let A=h.getAnimationForGid(e);if(A&&(i&&(A=A.clone(),A.tint=s),t.clearGraphics(),t.addGraphic(A,{offset:h.tileOffset}),this.resource.useExcaliburWiring)){const u=h.getTileByGid(e),p=u?.properties.get($t.Animation.Strategy);if(p&&typeof p=="string")switch(p.toLowerCase()){case k.AnimationStrategy.End.toLowerCase():A.strategy=k.AnimationStrategy.End;break;case k.AnimationStrategy.Freeze.toLowerCase():A.strategy=k.AnimationStrategy.Freeze;break;case k.AnimationStrategy.Loop.toLowerCase():A.strategy=k.AnimationStrategy.Loop;break;case k.AnimationStrategy.PingPong.toLowerCase():A.strategy=k.AnimationStrategy.PingPong;break;default:this.logger.warn(`Unknown animation strategy in tileset ${h.name} on tile gid ${e}: ${p}`)}}}async load(){var t,e,i,s;const r=this.resource.getLayerConfig(this.name)||this.resource.getLayerConfig(this.id),o=this.tiledTileLayer,a=!!this.properties.get($t.Layer.Solid),h=(this.tiledTileLayer.opacity,!!this.tiledTileLayer.tintcolor),l=this.tiledTileLayer.tintcolor?k.Color.fromHex(this.tiledTileLayer.tintcolor):k.Color.Transparent,c=(0,k.vec)((t=o.offsetx)!==null&&t!==void 0?t:0,(e=o.offsety)!==null&&e!==void 0?e:0);this.tiledTileLayer.data&&yr(this.tiledTileLayer)?this.data=await br.decode(this.tiledTileLayer.data,this.tiledTileLayer.compression):this.tiledTileLayer.data&&Cr(this.tiledTileLayer)&&(this.data=this.tiledTileLayer.data);let d=this.order,A=this.properties.get($t.ZIndex.ZIndex);if(typeof A=="number"&&(d=A),this.resource.map.infinite&&xr(this.tiledTileLayer)){const u=this.resource.isometricTiledCoordToWorld(this.tiledTileLayer.startx,this.tiledTileLayer.starty),p=(0,k.vec)(u.x*this.resource.map.tilewidth,u.y*this.resource.map.tileheight);this.isometricMap=new k.IsometricMap({name:this.name,pos:c.add(p),tileHeight:this.resource.map.tileheight,tileWidth:this.resource.map.tilewidth,columns:o.width,rows:o.height,elevation:d}),r?.collisionGroup&&(this.isometricMap.get(k.BodyComponent).group=r.collisionGroup)}else this.isometricMap=new k.IsometricMap({name:this.name,pos:c,tileWidth:this.resource.map.tilewidth,tileHeight:this.resource.map.tileheight,columns:o.width,rows:o.height,elevation:d}),r?.collisionGroup&&(this.isometricMap.get(k.BodyComponent).group=r.collisionGroup);if(this.isometricMap.visible=this.tiledTileLayer.visible,this.isometricMap.opacity=this.tiledTileLayer.opacity,this.isometricMap.addComponent(new eh({tiledTileLayer:o})),o.parallaxx||o.parallaxy){const u=(0,k.vec)((i=o.parallaxx)!==null&&i!==void 0?i:1,(s=o.parallaxy)!==null&&s!==void 0?s:1);this.isometricMap.addComponent(new k.ParallaxComponent(u))}if(this.resource.map.infinite&&xr(this.tiledTileLayer)){const u=this.tiledTileLayer;for(let p of this.tiledTileLayer.chunks){let v=[];yr(this.tiledTileLayer)?v=await br.decode(p.data,u.compression):Cr(this.tiledTileLayer)&&(v=p.data);for(let C=0;C<v.length;C++){const y=v[C];if(y!=0){const b=C%p.width+(p.x-this.tiledTileLayer.startx),P=Math.floor(C/p.width)+(p.y-this.tiledTileLayer.starty),I=this.isometricMap.tiles[b+P*o.width];this.updateTile(I,y,h,l,a)}}}}else for(let u=0;u<this.data.length;u++){let p=this.data[u];if(p!==0){const v=this.isometricMap.tiles[u];this.updateTile(v,p,h,l,a)}}}}class io{getTilesByGid(t){var e;return(e=this._gidToTileInfo.get(t))!==null&&e!==void 0?e:[]}getTilesByClassName(t){return this.tilemap.tiles.filter(e=>{const i=e.data.get($t.TileData.Tiled);return!!i&&ki(t)(i)}).map(e=>({exTile:e,tiledTile:e.data.get($t.TileData.Tiled)}))}getTilesByProperty(t,e){return this.tilemap.tiles.filter(i=>{const s=i.data.get($t.TileData.Tiled);return!!s&&Fi(t,e)(s)}).map(i=>({exTile:i,tiledTile:i.data.get($t.TileData.Tiled)}))}getTileByPoint(t){if(!this.tilemap)return this.logger.warn("Tilemap has not yet been loaded! getTileByPoint() will only return null"),null;if(this.tilemap){const e=this.tilemap.getTileByPoint(t);if(!e)return null;const i=this.tilemap.tiles.indexOf(e),s=ls(this.data[i]);return s<=0?null:{tiledTile:this.resource.getTilesetForTileGid(s).getTileByGid(s),exTile:e}}return null}getTileByCoordinate(t,e){if(!this.tilemap)return this.logger.warn("Tilemap has not yet been loaded! getTileByCoordinate() will only return null"),null;if(this.tilemap){const i=this.tilemap.getTile(t,e),s=this.tilemap.tiles.indexOf(i),r=ls(this.data[s]);return r<=0?null:{tiledTile:this.resource.getTilesetForTileGid(r).getTileByGid(r),exTile:i}}return null}constructor(t,e,i){this.tiledTileLayer=t,this.resource=e,this.order=i,this.logger=k.Logger.getInstance(),this.width=0,this.height=0,this.properties=new Map,this.data=[],this._gidToTileInfo=new Map,this.name=t.name,this.id=t.id,this.class=t.class,this.width=t.width,this.height=t.height,this.visible=!!t.visible,qi(this,t.properties)}_recordTileData(t,e){let i=this._gidToTileInfo.get(t),s=this.resource.getTilesetForTileGid(t).getTileByGid(t);i?i.push({exTile:e,tiledTile:s}):i=[{exTile:e,tiledTile:s}],this._gidToTileInfo.set(t,i),e.data.set($t.TileData.Tiled,s)}updateTile(t,e,i,s,r){this._recordTileData(e,t);const o=this.resource.getLayerConfig(this.name)||this.resource.getLayerConfig(this.id);o?.isSolid!==void 0&&(r=o.isSolid),this.resource.useExcaliburWiring&&r&&this.visible&&(t.solid=!0);const a=this.resource.getTilesetForTileGid(e),h=this.resource.headless;if(!h){let d=a.getSpriteForGid(e);i&&(d=d.clone(),d.tint=s),t.addGraphic(d,{offset:a.tileOffset})}const l=a.getCollidersForGid(e);for(let d of l)t.addCollider(d);o?.useTileColliders&&l.length>0&&this.visible&&(t.solid=!0),o?.useTileCollidersWhenInvisible&&l.length>0&&(t.solid=!0);let c=h?null:a.getAnimationForGid(e);if(c&&(i&&(c=c.clone(),c.tint=s),t.clearGraphics(),t.addGraphic(c,{offset:a.tileOffset}),this.resource.useExcaliburWiring)){const d=a.getTileByGid(e),A=d?.properties.get($t.Animation.Strategy);if(A&&typeof A=="string")switch(A.toLowerCase()){case k.AnimationStrategy.End.toLowerCase():c.strategy=k.AnimationStrategy.End;break;case k.AnimationStrategy.Freeze.toLowerCase():c.strategy=k.AnimationStrategy.Freeze;break;case k.AnimationStrategy.Loop.toLowerCase():c.strategy=k.AnimationStrategy.Loop;break;case k.AnimationStrategy.PingPong.toLowerCase():c.strategy=k.AnimationStrategy.PingPong;break;default:this.logger.warn(`Unknown animation strategy in tileset ${a.name} on tile gid ${e}: ${A}`)}}}async load(){var t,e,i,s;const r=this.resource.getLayerConfig(this.name)||this.resource.getLayerConfig(this.id),o=this.tiledTileLayer.opacity,a=!!this.tiledTileLayer.tintcolor,h=this.tiledTileLayer.tintcolor?k.Color.fromHex(this.tiledTileLayer.tintcolor):k.Color.Transparent,l=!!this.properties.get($t.Layer.Solid),c=this.tiledTileLayer,d=(0,k.vec)((t=c.offsetx)!==null&&t!==void 0?t:0,(e=c.offsety)!==null&&e!==void 0?e:0);if(this.tiledTileLayer.data&&yr(this.tiledTileLayer)?this.data=await br.decode(this.tiledTileLayer.data,this.tiledTileLayer.compression):this.tiledTileLayer.data&&Cr(this.tiledTileLayer)&&(this.data=this.tiledTileLayer.data),this.resource.map.infinite&&xr(this.tiledTileLayer)){const p=(0,k.vec)(this.tiledTileLayer.startx*this.resource.map.tilewidth,this.tiledTileLayer.starty*this.resource.map.tileheight);this.tilemap=new k.TileMap({name:this.name,pos:d.add(p),tileHeight:this.resource.map.tileheight,tileWidth:this.resource.map.tilewidth,columns:c.width,rows:c.height}),r?.collisionGroup&&(this.tilemap.get(k.BodyComponent).group=r.collisionGroup)}else this.tilemap=new k.TileMap({name:this.name,pos:d,tileWidth:this.resource.map.tilewidth,tileHeight:this.resource.map.tileheight,columns:c.width,rows:c.height}),r?.collisionGroup&&(this.tilemap.get(k.BodyComponent).group=r.collisionGroup);this.tilemap.addComponent(new eh({tiledTileLayer:c}));const A=this.tilemap.get(k.TransformComponent);if(A){A.z=this.order;let p=this.properties.get($t.ZIndex.ZIndex);typeof p=="number"&&(A.z=p)}const u=this.tilemap.get(k.GraphicsComponent);if(u&&(u.isVisible=this.tiledTileLayer.visible,u.opacity=o),c.parallaxx||c.parallaxy){const p=(0,k.vec)((i=c.parallaxx)!==null&&i!==void 0?i:1,(s=c.parallaxy)!==null&&s!==void 0?s:1);this.tilemap.addComponent(new k.ParallaxComponent(p))}if(this.resource.map.infinite&&xr(this.tiledTileLayer)){const p=this.tiledTileLayer;for(let v of this.tiledTileLayer.chunks){let C=[];yr(this.tiledTileLayer)?C=await br.decode(v.data,p.compression):Cr(this.tiledTileLayer)&&(C=v.data);for(let y=0;y<C.length;y++){const b=C[y];if(b!=0){const P=y%v.width+(v.x-this.tiledTileLayer.startx),I=Math.floor(y/v.width)+(v.y-this.tiledTileLayer.starty),Q=this.tilemap.tiles[P+I*c.width];this.updateTile(Q,b,a,h,l)}}}}else for(let p=0;p<this.data.length;p++){let v=this.data[p];if(v!==0){const C=this.tilemap.tiles[p];this.updateTile(C,v,a,h,l)}}}}class so{constructor(t,e,i){this.tiledObjectLayer=t,this.resource=e,this.order=i,this.logger=k.Logger.getInstance(),this.properties=new Map,this.objects=[],this.entities=[],this._objectToEntity=new Map,this._entityToObject=new Map,this._loaded=!1,this.name=t.name,this.class=t.class,qi(this,t.properties)}_logLoadedWarning(t){this.logger.warn(`ObjectLayer ${this.name} is not yet loaded, ${t}() will always be empty!`)}getObjectsByName(t){return this._loaded||this._logLoadedWarning("getObjectsByName"),this.objects.filter(Me(t))}getEntitiesByName(t){return this._loaded||this._logLoadedWarning("getEntitiesByName"),this.entities.filter(Me(t))}getEntityByObject(t){return this._loaded||this._logLoadedWarning("getEntityByObject"),this._objectToEntity.get(t)}getObjectByEntity(t){return this._loaded||this._logLoadedWarning("getObjectByEntity"),this._entityToObject.get(t)}getObjectsByProperty(t,e){return this._loaded||this._logLoadedWarning("getObjectsByProperty"),this.objects.filter(Fi(t,e))}getEntitiesByProperty(t,e){return this._loaded||this._logLoadedWarning("getEntitiesByProperty"),this.getObjectsByProperty(t,e).map(i=>this._objectToEntity.get(i)).filter(i=>!!i)}getObjectsByClassName(t){return this._loaded||this._logLoadedWarning("getObjectsByClassName"),this.objects.filter(ki(t))}getEntitiesByClassName(t){return this._loaded||this._logLoadedWarning("getEntitiesByClassName"),this.getObjectsByClassName(t).map(e=>this._objectToEntity.get(e)).filter(e=>!!e)}getTemplates(){return this._loaded||this._logLoadedWarning("getTemplates"),this.objects.filter(t=>t instanceof ps)}runFactory(t){var e,i,s,r;const o=(0,k.vec)((e=this.tiledObjectLayer.offsetx)!==null&&e!==void 0?e:0,(i=this.tiledObjectLayer.offsety)!==null&&i!==void 0?i:0),a=this.objects.slice();for(let h of a){let l=h.class;if(h instanceof ps&&(l=l||h.template.object.class),t!==l)continue;let c=(0,k.vec)(((s=h.x)!==null&&s!==void 0?s:0)+o.x,((r=h.y)!==null&&r!==void 0?r:0)+o.y);this.resource.map.orientation==="isometric"&&(c=this.resource.isometricTiledCoordToWorld(c.x,c.y));const d=this.resource.factories.get(t);if(d){const A=d({worldPos:c,name:h.name,class:l,layer:this,object:h,properties:h.properties});A&&this._recordObjectEntityMapping(h,A)}}}_actorFromObject(t,e,i){var s,r,o,a,h,l;const c=this.resource.headless,d=!!this.tiledObjectLayer.tintcolor,A=this.tiledObjectLayer.tintcolor?k.Color.fromHex(this.tiledObjectLayer.tintcolor):k.Color.White;if(t instanceof fs&&i){const u=this.resource.map.orientation==="isometric"&&i.orientation==="orthogonal"?"bottom":void 0,p=i.getTilesetAlignmentAnchor(u);e.anchor=p;const v=((s=t.tiledObject.width)!==null&&s!==void 0?s:this.resource.map.tilewidth)/this.resource.map.tilewidth,C=((r=t.tiledObject.width)!==null&&r!==void 0?r:this.resource.map.tilewidth)/this.resource.map.tilewidth,y=(0,k.vec)(v,C);if(!c){const st=i.getSpriteForGid(t.gid).clone();st.destSize.width=(o=t.tiledObject.width)!==null&&o!==void 0?o:st.width,st.destSize.height=(a=t.tiledObject.height)!==null&&a!==void 0?a:st.height,d&&(st.tint=A),e.graphics.use(st),e.graphics.offset=i.tileOffset;const Z=i.getAnimationForGid(t.gid);if(Z){const S=Z.clone();S.scale=y,d&&(S.tint=A),e.graphics.use(S),e.graphics.offset=i.tileOffset}}const b=(h=t.tiledObject.width)!==null&&h!==void 0?h:0,P=(l=t.tiledObject.height)!==null&&l!==void 0?l:0,I=-b*p.x,Q=-P*p.y,O=this.resource.map.tilewidth/2,B=this.resource.map.tileheight;let j=(0,k.vec)(I,Q);this.resource.map.orientation==="isometric"&&(j=(0,k.vec)(I+O,Q+B),i.orientation==="orthogonal"&&(j=j.sub((0,k.vec)(O,B))));const $=i.getCollidersForGid(t.gid,{anchor:k.Vector.Zero,scale:y,offset:j});if($.length)e.collider.useCompositeCollider($);else{let st=t.width,Z=t.height;if(this.resource.map.orientation==="isometric"){const z=t.height/2;st=z,Z=z}let S=k.Shape.Box(st,Z,this.resource.map.orientation==="isometric"?(0,k.vec)(1,1):(0,k.vec)(0,1));this.resource.map.orientation==="isometric"&&(S.points=S.points.map(z=>this.resource.isometricTiledCoordToWorld(z.x,z.y))),e.collider.set(S)}}if(t instanceof Ja&&e.graphics.use(t.text),t instanceof Yn){let u=(0,k.vec)(t.x,t.y),p=t.localPoints;this.resource.map.orientation==="isometric"&&(u=this.resource.isometricTiledCoordToWorld(u.x,u.y),p=p.map(C=>this.resource.isometricTiledCoordToWorld(C.x,C.y))),e.anchor=(0,k.vec)(0,1),e.pos=u;const v=k.Shape.Polygon(p,k.Vector.Zero,!0);v.isConvex()?e.collider.set(v):e.collider.set(v.triangulate())}if(t instanceof Er){e.anchor=t.anchor;let u=k.Shape.Box(t.width,t.height,t.anchor);this.resource.map.orientation==="isometric"&&(u.points=u.points.map(p=>this.resource.isometricTiledCoordToWorld(p.x,p.y))),e.collider.set(u)}t instanceof Ir&&e.collider.useCircleCollider(Math.min(t.width,t.height)/2)}async load(){var t,e,i,s,r;const o=this.tiledObjectLayer.opacity,a=(0,k.vec)((t=this.tiledObjectLayer.offsetx)!==null&&t!==void 0?t:0,(e=this.tiledObjectLayer.offsety)!==null&&e!==void 0?e:0),h=$a(this.tiledObjectLayer,this.resource);for(let l of h){let c=(0,k.vec)(((i=l.x)!==null&&i!==void 0?i:0)+a.x,((s=l.y)!==null&&s!==void 0?s:0)+a.y);this.resource.map.orientation==="isometric"&&(c=this.resource.isometricTiledCoordToWorld(c.x,c.y));let d,A=l.class;if(l instanceof ps&&(A=A||l.template.object.class),A){const C=this.resource.factories.get(A);if(C){const y=C({worldPos:c,name:l.name,class:A,layer:this,object:l,properties:l.properties});y&&this._recordObjectEntityMapping(l,y);continue}}let u=this.properties.get($t.ZIndex.ZIndex);typeof u=="number"&&(d=u);const p=new k.Actor({name:l.tiledObject.name,pos:c,anchor:k.Vector.Zero,rotation:(0,k.toRadians)((r=l.tiledObject.rotation)!==null&&r!==void 0?r:0),z:d}),v=p.get(k.GraphicsComponent);if(v&&(v.visible=this.tiledObjectLayer.visible&&(l.tiledObject.visible===void 0||!!l.tiledObject.visible),v.opacity=o),this.resource.map.orientation==="isometric"){const C=new k.IsometricEntityComponent({rows:this.resource.map.height,columns:this.resource.map.width,tileWidth:this.resource.map.tilewidth,tileHeight:this.resource.map.tileheight});C.elevation=d??this.order,p.addComponent(C)}if(this.resource.useExcaliburWiring){const C=l.properties.get($t.Collision.Type);if(C&&typeof C=="string")switch(C.toLowerCase()){case k.CollisionType.Active.toLowerCase():p.body.collisionType=k.CollisionType.Active;break;case k.CollisionType.Fixed.toLowerCase():p.body.collisionType=k.CollisionType.Fixed;break;case k.CollisionType.Passive.toLowerCase():p.body.collisionType=k.CollisionType.Passive;break;case k.CollisionType.PreventCollision.toLowerCase():p.body.collisionType=k.CollisionType.PreventCollision;break;default:this.logger.warn(`Unknown collision type in layer ${this.name}, for object id ${l.id} and name ${l.name}: ${C}`)}}if(l instanceof ps){let C=l.template.tileset,y=l.template.object;y&&(l.gid&&y instanceof fs&&(C=this.resource.getTilesetForTileGid(l.gid),y=new fs(y.tiledObject,l.gid,y.width,y.height)),this._actorFromObject(y,p,C))}else{let C;l instanceof fs&&(C=this.resource.getTilesetForTileGid(l.gid)),this._actorFromObject(l,p,C)}this._recordObjectEntityMapping(l,p)}this._loaded=!0}_recordObjectEntityMapping(t,e){e.addComponent(new Mc({tiledObject:t})),this.objects.push(t),this.entities.push(e),this._objectToEntity.set(t,e),this._entityToObject.set(e,t)}}const Rg=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,wh=n=>{if(typeof n!="string")throw new TypeError("Invalid argument expected string");const t=n.match(Rg);if(!t)throw new Error(`Invalid argument not valid semver ('${n}' received)`);return t.shift(),t},yh=n=>n==="*"||n==="x"||n==="X",Ch=n=>{const t=parseInt(n,10);return isNaN(t)?n:t},Mg=(n,t)=>{if(yh(n)||yh(t))return 0;const[e,i]=((s,r)=>typeof s!=typeof r?[String(s),String(r)]:[s,r])(Ch(n),Ch(t));return e>i?1:e<i?-1:0},xh=(n,t)=>{for(let e=0;e<Math.max(n.length,t.length);e++){const i=Mg(n[e]||"0",t[e]||"0");if(i!==0)return i}return 0},Lg=(n,t,e)=>{Ug(e);const i=((s,r)=>{const o=wh(s),a=wh(r),h=o.pop(),l=a.pop(),c=xh(o,a);return c!==0?c:h&&l?xh(h.split("."),l.split(".")):h||l?h?-1:1:0})(n,t);return Lc[e].includes(i)},Lc={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},bh=Object.keys(Lc),Ug=n=>{if(bh.indexOf(n)===-1)throw new Error(`Invalid operator, expected one of ${bh.join("|")}`)};class ro{constructor(t,e,i){this.tiledImageLayer=t,this.resource=e,this.order=i,this.properties=new Map,this.image=null,this.imageActor=null,this.name=t.name,this.class=t.class,qi(this,t.properties),t.image&&(this.image=new k.ImageSource(mi(this.resource.path,t.image,this.resource.pathMap)))}async load(){var t,e,i,s;const r=this.tiledImageLayer.opacity,o=!!this.tiledImageLayer.tintcolor,a=this.tiledImageLayer.tintcolor?k.Color.fromHex(this.tiledImageLayer.tintcolor):k.Color.White,h=(0,k.vec)((t=this.tiledImageLayer.offsetx)!==null&&t!==void 0?t:0,(e=this.tiledImageLayer.offsety)!==null&&e!==void 0?e:0),l=(i=this.tiledImageLayer.parallaxx)!==null&&i!==void 0?i:1,c=(s=this.tiledImageLayer.parallaxy)!==null&&s!==void 0?s:1;if(this.image){this.resource.headless||await this.image.load(),this.imageActor=new k.Actor({name:this.tiledImageLayer.name,pos:h,anchor:k.Vector.Zero,z:this.order}),this.imageActor.addComponent(new k.ParallaxComponent((0,k.vec)(l,c)));const d=this.image.toSprite();this.imageActor.graphics.use(d),this.imageActor.graphics.visible=this.tiledImageLayer.visible,this.imageActor.graphics.opacity=r,o&&(d.tint=a)}}}class Sr{constructor(t,e){this.path=t,this.logger=k.Logger.getInstance(),this.tilesets=[],this.templates=[],this.layers=[],this.mapFormat="TMX",this.strict=!0,this.factories=new Map,this.parser=new Wn,this.fileLoader=jn,this.startZIndex=0,this.textQuality=4,this.useExcaliburWiring=!0,this.useMapBackgroundColor=!1,this.useTilemapCameraStrategy=!1,this.headless=!1,this.layerConfig={},this._imageLoader=new Cs(k.ImageSource),this._tilesetLoader=new Cs(th),this._templateLoader=new Cs(Rc);const{mapFormatOverride:i,textQuality:s,entityClassNameFactories:r,useExcaliburWiring:o,useTilemapCameraStrategy:a,useMapBackgroundColor:h,layerConfig:l,pathMap:c,fileLoader:d,strict:A,headless:u,startZIndex:p}={...e};this.strict=A??this.strict,this.headless=u??this.headless,this.useExcaliburWiring=o??this.useExcaliburWiring,this.useTilemapCameraStrategy=a??this.useTilemapCameraStrategy,this.useMapBackgroundColor=h??this.useMapBackgroundColor,this.layerConfig=l??this.layerConfig,this.textQuality=s??this.textQuality,this.startZIndex=p??this.startZIndex,this.fileLoader=d??this.fileLoader,this.pathMap=c;for(const v in r)this.registerEntityFactory(v,r[v]);this.mapFormat=i??(t.includes(".tmx")?"TMX":"TMJ")}registerEntityFactory(t,e){if(this.factories.has(t)&&console.warn(`Another factory has already been registered for tiled class/type "${t}", this is probably a bug.`),this.factories.set(t,e),this.isLoaded())for(let i of this.getObjectLayers())i.runFactory(t)}unregisterEntityFactory(t){this.factories.has(t)||console.warn(`No factory has been registered for tiled class/type "${t}", cannot unregister!`),this.factories.delete(t)}getLayerConfig(t){return this.layerConfig[t]}getTilesetForTileGid(t){const e=ls(t);if(this.tilesets){for(let i of this.tilesets)if(e>=i.firstGid&&e<=i.firstGid+i.tileCount-1)return i}throw Error(`No tileset exists for tiled gid [${t}] normalized [${e}]!`)}getTilesetByName(t){return this.tilesets.filter(Me(t))}getTilesetByClassName(t){return this.tilesets.filter(ki(t))}getTilesetByProperty(t,e){return this.tilesets.filter(Fi(t,e))}getTileMetadataByClassName(t){let e=[];for(let i of this.tilesets)e=e.concat(i.tiles.filter(ki(t)));return e}getTileMetadataByProperty(t,e){let i=[];for(let s of this.tilesets)i=i.concat(s.tiles.filter(Fi(t,e)));return i}getTilesByGid(t){if(this.map.orientation==="orthogonal"){let e=[];for(let i of this.getTileLayers())e=e.concat(i.getTilesByGid(t));return e}{let e=[];for(let i of this.getIsoTileLayers())e=e.concat(i.getTilesByGid(t));return e}}getTilesByClassName(t){if(this.map.orientation==="orthogonal"){let e=[];for(let i of this.getTileLayers())e=e.concat(i.getTilesByClassName(t));return e}{let e=[];for(let i of this.getIsoTileLayers())e=e.concat(i.getTilesByClassName(t));return e}}getTilesByProperty(t,e){if(this.map.orientation==="orthogonal"){let i=[];for(let s of this.getTileLayers())i=i.concat(s.getTilesByProperty(t,e));return i}{let i=[];for(let s of this.getIsoTileLayers())i=i.concat(s.getTilesByProperty(t,e));return i}}getTileByPoint(t,e){if(this.map.orientation==="isometric"){const i=this.getIsoTileLayers().find(Me(t));if(i)return i.getTileByPoint(e)}else{const i=this.getTileLayers().find(Me(t));if(i)return i.getTileByPoint(e)}return null}getTilesByPoint(t){if(this.map.orientation==="orthogonal"){let e=[];for(let i of this.getTileLayers()){const s=i.getTileByPoint(t);s&&e.push(s)}return e}{let e=[];for(let i of this.getIsoTileLayers()){const s=i.getTileByPoint(t);s&&e.push(s)}return e}}getObjectsByName(t){let e=[];for(let i of this.getObjectLayers())e=e.concat(i.getObjectsByName(t));return e}getEntitiesByName(t){let e=[];for(let i of this.getObjectLayers())e=e.concat(i.getEntitiesByName(t));return e}getEntityByObject(t){for(let e of this.getObjectLayers()){const i=e.getEntityByObject(t);if(i)return i}}getObjectByEntity(t){for(let e of this.getObjectLayers()){const i=e.getObjectByEntity(t);if(i)return i}}getObjectsByProperty(t,e){let i=[];for(let s of this.getObjectLayers())i=i.concat(s.getObjectsByProperty(t,e));return i}getEntitiesByProperty(t,e){let i=[];for(let s of this.getObjectLayers())i=i.concat(s.getEntitiesByProperty(t,e));return i}getObjectsByClassName(t){let e=[];for(let i of this.getObjectLayers())e=e.concat(i.getObjectsByClassName(t));return e}getEntitiesByClassName(t){let e=[];for(let i of this.getObjectLayers())e=e.concat(i.getEntitiesByClassName(t));return e}getTileByCoordinate(t,e,i){const s=this.getTileLayers().find(Me(t));return s?s.getTileByCoordinate(e,i):null}getImageLayers(t){const e=this.layers.filter(i=>i instanceof ro);return t?e.filter(Me(t)):e}getTileLayers(t){const e=this.layers.filter(i=>i instanceof io);return t?e.filter(Me(t)):e}getIsoTileLayers(t){const e=this.layers.filter(i=>i instanceof eo);return t?e.filter(Me(t)):e}getObjectLayers(t){const e=this.layers.filter(i=>i instanceof so);return t?e.filter(Me(t)):e}getLayersByName(t){return this.layers.filter(Me(t))}getLayersByClassName(t){return this.layers.filter(ki(t))}getLayersByProperty(t,e){return this.layers.filter(Fi(t,e))}_parseMap(t){return this.mapFormat==="TMX"?this.parser.parse(t,this.strict):t}async load(){var t;const e=await this.fileLoader(this.path,this.mapFormat==="TMX"?"xml":"json");let i;if(this.strict)try{i=this._parseMap(e)}catch(o){throw console.error(`Could not parse tiled map from location ${this.path}, attempted to interpret as ${this.mapFormat}.
Excalibur only supports the latest version of Tiled formats as of the plugin's release.`),console.error("Is your map file corrupted or being interpreted as the wrong type?"),o}else i=this._parseMap(e);Lg(Sr.supportedTiledVersion,(t=i.tiledversion)!==null&&t!==void 0?t:"0.0.0",">")&&console.warn(`The excalibur tiled plugin officially supports ${Sr.supportedTiledVersion}+, the current map has tiled version ${i.tiledversion}`),this.map=i,this._collectTilesets(),this._collectTemplates(),await Promise.all([this._tilesetLoader.load(),this.headless?Promise.resolve():this._imageLoader.load(),this._templateLoader.load()]),this.tilesets=[...this.tilesets,...this._tilesetLoader.values().map(o=>o.data)],this.templates=this._templateLoader.values().map(o=>o.data);let s=[],r=this.startZIndex;for(const o of this.map.layers){if(o.type==="tilelayer"){if(this.map.orientation==="isometric"){const a=new eo(o,this,r);s.push(a)}if(this.map.orientation==="orthogonal"){const a=new io(o,this,r);s.push(a)}}if(o.type==="objectgroup"){const a=new so(o,this,r);s.push(a)}if(o.type==="imagelayer"){const a=new ro(o,this,r);s.push(a)}r++}await Promise.all(s.map(o=>o.load())),this.layers=s}_collectTilesets(){for(const t of this.map.tilesets){if(Ic(t)){if(Hn(t)){const e=mi(this.path,t.image,this.pathMap),i=this._imageLoader.getOrAdd(e),s=new Br({name:t.name,tiledTileset:t,image:i,firstGid:t.firstgid});this.tilesets.push(s)}if(qn(t)){const e=new Map;if(t.tiles){for(let s of t.tiles)if(s.image){const r=mi(this.path,s.image,this.pathMap),o=this._imageLoader.getOrAdd(r);e.set(s,o)}}const i=new Br({name:t.name,tiledTileset:t,tileToImage:e,firstGid:t.firstgid});this.tilesets.push(i)}}if(Ec(t)){const e=mi(this.path,t.source,this.pathMap);this._tilesetLoader.getOrAdd(e,t.firstgid,{strict:this.strict,headless:this.headless,parser:this.parser,fileLoader:this.fileLoader,imageLoader:this._imageLoader,pathMap:this.pathMap})}}}_collectTemplates(){let t=[];for(const i of this.map.layers)if(i.type==="objectgroup"){let s=i.objects.filter(r=>r.template).map(r=>r.template);t=t.concat(s)}const e=t.filter((i,s,r)=>r.findIndex(o=>o===i)===s);for(const i of e){const s=mi(this.path,i,this.pathMap);this._templateLoader.getOrAdd(s,{strict:this.strict,headless:this.headless,parser:this.parser,fileLoader:this.fileLoader,imageLoader:this._imageLoader,pathMap:this.pathMap})}}addToScene(t,e){if(!this.isLoaded())return void this.logger.warn(`TiledResource ${this.path} is not loaded! Nothing will be wired into excalibur!`);const i={pos:(0,k.vec)(0,0)},{pos:s}={...i,...e};for(const r of this.layers){if(r instanceof io&&(r.tilemap.pos=r.tilemap.pos.add(s),t.add(r.tilemap)),r instanceof eo&&t.add(r.isometricMap),r instanceof so)for(const o of r.entities){const a=o.get(k.TransformComponent);a&&(a.pos=a.pos.add(s)),t.add(o)}r instanceof ro&&r.imageActor&&(r.imageActor.pos=r.imageActor.pos.add(s),t.add(r.imageActor))}if(this.useExcaliburWiring){const r=this.getObjectsByProperty($t.Camera.Camera,!0);if(r&&r.length){const o=r[0];let a=1;const h=o.properties.get($t.Camera.Zoom);h&&typeof h=="number"&&(a=h),this.map.orientation==="isometric"?t.camera.pos=this.isometricTiledCoordToWorld(o.x,o.y):t.camera.pos=(0,k.vec)(o.x,o.y),t.camera.zoom=a}}if(this.useTilemapCameraStrategy){const r=this.getTileLayers()[0];if(r){const o=k.BoundingBox.fromDimension(this.map.width*this.map.tilewidth,this.map.height*this.map.tileheight,k.Vector.Zero,s.add(r.tilemap.pos));t.camera.strategy.limitCameraBounds(o)}}this.useMapBackgroundColor&&this.map.backgroundcolor&&(t.backgroundColor=k.Color.fromHex(this.map.backgroundcolor))}isometricTiledCoordToWorld(t,e){const i=this.map.tilewidth,s=this.map.tileheight,r=e/s,o=t/s;return(0,k.vec)((o-r)*i/2+0,(o+r)*s/2)}isLoaded(){return!!this.map}}Sr.supportedTiledVersion="1.10.1";ut.XM;ut.Pp;ut.B8;ut.Z9;ut.Ms;ut.yO;ut.UZ;ut.fN;ut._k;ut.J4;ut.bR;ut.tS;ut.Ro;ut.M_;ut.Bj;ut.HZ;ut.xn;ut.EY;ut.FA;ut.o4;ut.$u;ut.ZR;ut.uE;var Gg=ut.Bf;ut.xm;ut.OK;ut.r0;ut.IB;ut.cp;ut.pE;ut.fO;ut.pf;ut.fc;ut.NW;ut.OW;ut.I;ut.N5;ut.fd;ut.zU;ut.RT;ut.SW;ut.s;ut.mD;ut.wi;ut.tP;ut.YK;ut.Ey;ut.qD;ut.rr;ut.Xs;ut.lj;ut.MB;ut.hu;ut.Uk;class jr extends _t{constructor(t,e){super(),this.graphics.use(e),this.pos=new L(0,0),this.scale=new L(.3,.3)}treasureGrabbed(t){t.target.pos=new L(Math.random()*1280,Math.random()*720)}}class Uo extends _t{constructor(t){super({pos:t,width:200,height:120,color:Le.Yellow})}onInitialize(){this.on("collisionstart",t=>this.handleCollision(t)),this.graphics.use(R.Cage.toSprite()).scale=new L(2,2)}handleCollision(t){t.other.owner instanceof fe&&t.other.owner.pickupState&&t.other.owner.treasure&&R.PutInTreasure.play()}}const Yr=[new L(928,1024),new L(1232,1696),new L(624,2096),new L(400,2768),new L(1120,3328),new L(624,4352),new L(1120,5312),new L(128,5008)];class Tr extends _t{constructor(t=!1){if(super({width:100,height:100,collisionType:cs.Active}),this.graphics.use(R.Bubbles.toSprite()),this.scale=new L(.2,.2),t&&Yr.length>0){const e=Math.floor(Math.random()*Yr.length);this.pos=Yr[e].clone(),Yr.splice(e,1),this.vel=new L(0,0)}else{const e=Math.random()*1280,i=720;this.pos=new L(e,i),this.vel=new L(0,-50)}}onPreUpdate(){this.pos.y<-20&&this.bubbleLeft()}bubbleLeft(){const t=Math.random()*1280,e=720;this.pos=new L(t,e),this.vel=new L(0,-50),this.scale=new L(.2,.2)}}const Zs=[new L(1376,1136),new L(512,1200),new L(768,1808),new L(832,4016),new L(1552,2400),new L(1568,1424),new L(224,2784),new L(112,2256),new L(368,3568),new L(1248,3936),new L(1312,4576)],Xs=[new L(1370,1136),new L(508,1200),new L(760,1808),new L(825,4016),new L(1544,2400),new L(1560,1424),new L(220,2784),new L(106,2256),new L(361,3568),new L(1240,3936),new L(1305,4576)];class xs extends _t{pickUpType;constructor(t,e){super({width:R.Diver1.width,height:R.Diver1.height}),this.graphics.use(t);let i;e===0?i=Zs:e===1&&(i=Xs);const s=Math.floor(Math.random()*i.length);this.pos=i[s].clone(),i.splice(s,1),this.scale=new L(.3,.3),this.pickUpType=e}onInitialize(t){this.on("collisionstart",e=>this.handleCollision(e))}handleCollision(t){t.other.owner instanceof fe&&t.other.owner.pickupState===!1&&(this.pickUpType===0?(t.other.owner.pickupItem(this.pickUpType),this.kill()):this.pickUpType===1&&(t.other.owner.pickupItem(this.pickUpType),this.kill()))}}class Ng extends xs{worth;constructor(t){super(R.Packet.toSprite(),1),this.scale=new L(1,1)}onInitialize(){this.worth=1}}class Uc extends _t{constructor(t){super({pos:t,width:R.Net.width,height:R.Net.height,scale:new L(3,3)}),this.graphics.use(R.Net.toSprite())}onInitialize(){this.on("collisionstart",t=>this.handleCollision(t))}handleCollision(t){t.other.owner instanceof fe&&t.other.owner.pickupState&&t.other.owner.trash}}class fe extends _t{lastButtonPress=0;buttonCooldown=500;pickupState=!1;treasure;trash;relic;pickupItemType;engine;constructor(t,e,i,s,r,o,a,h,l){super({pos:t,width:R.Diver1.width,height:R.Diver1.height,collisionType:cs.Active}),this.score=0,this.upKey=e,this.downKey=i,this.leftKey=s,this.rightKey=r,this.gamepadIndex=o,this.sprite=a,this.speed=h,this.objectSpeed=l}onInitialize(t){this.graphics.use(this.sprite),this.engine=t,this.on("collisionstart",e=>this.handleCollision(e))}onPreUpdate(t){let e=0,i=0;navigator.getGamepads();let s=t.input.gamepads.at(this.gamepadIndex),r=0,o=0;if(s&&s.connected){if(s.isButtonPressed(0)){const d=Date.now();d-this.lastButtonPress>this.buttonCooldown&&(this.lastButtonPress=d)}s.isButtonPressed(1)&&console.log("B button pressed")}s&&s.connected&&(r=s.getAxes(0)??0,o=s.getAxes(1)??0),t.input.keyboard.isHeld(this.upKey)&&(o=-200),t.input.keyboard.isHeld(this.downKey)&&(o=200),t.input.keyboard.isHeld(this.rightKey)&&(r=200),t.input.keyboard.isHeld(this.leftKey)&&(r=-200);let a=new L(r,o);const h=this.pickupState?this.objectSpeed:this.speed;a=a.normalize().scale(h),e=a.x,i=a.y;const l=.05;this.vel=new L(this.vel.x+(e-this.vel.x)*l,this.vel.y+(i-this.vel.y)*l),Math.abs(this.vel.x)>Math.abs(this.vel.y)?this.vel.x>0?this.rotation=Math.PI/2:this.vel.x<0&&(this.rotation=-Math.PI/2):Math.abs(this.vel.y)>0&&(this.vel.y>0?this.rotation=Math.PI:this.vel.y<0&&(this.rotation=0));const c=t.getCameraBounds();this.pos.x=Math.max(c.left,Math.min(c.right,this.pos.x)),this.pos.y=Math.max(c.top,Math.min(c.bottom,this.pos.y))}handleCollision(t){if((t.other.owner instanceof Uo&&this.pickupItemType===0||t.other.owner instanceof Uc&&this.pickupItemType===1)&&(this.treasure&&this.pickupState||this.pickupItemType===1&&this.pickupState)&&(this.pickupItemType===0?(this.removePickedUpItem(0),this.score+=2,R.PutInTreasure.play()):this.pickupItemType===1&&(this.removePickedUpItem(1),this.score+=1,R.trashputinsound.play()),this.scene.engine.ui.updateScore()),t.other.owner instanceof Uo&&this.pickupState&&(this.pickupItemType===2?(this.removePickedUpItem(2),this.score+=10,this.placeInMuseum(2),R.PutInTreasure.play()):this.pickupItemType===3?(this.removePickedUpItem(2),this.score+=10,this.placeInMuseum(3),R.PutInTreasure.play()):this.pickupItemType===3&&(this.removePickedUpItem(2),this.score+=10,this.placeInMuseum(4),R.PutInTreasure.play()),this.scene.engine.ui.updateScore()),t.other.owner&&t.other.owner.solid&&console.log("Collision with solid object"),t.other.owner instanceof Tr){if(this.scene.engine.ui&&typeof this.scene.engine.ui.timerValue=="number"){const e=this.scene.engine.ui.maxTime||60;this.scene.engine.ui.timerValue=Math.min(this.scene.engine.ui.timerValue+10,e),this.scene.engine.ui.labelTimer&&(this.scene.engine.ui.labelTimer.text=`Oxygen: ${this.scene.engine.ui.timerValue}`),this.scene.engine.ui.oxygenBar&&this.scene.engine.ui.oxygenBar.setValue(this.scene.engine.ui.timerValue)}t.other.owner.bubbleLeft()}}pickupItem(t){if(this.pickupItemType=t,this.pickupState===!1)this.pickupState=!0,this.pickupItemType===0?(this.treasure=new jr(fe,R.Treasure.toSprite()),this.addChild(this.treasure),this.playPickupSound()):this.pickupItemType===1?(this.pickupState=!0,this.trash=new Ng(fe),this.addChild(this.trash),R.trashpickup.play()):(this.pickupItemType,this.pickupState=!0,this.pickupItemType===2?(this.relic=new jr(fe,R.RelicAmulet.toSprite()),this.relic.scale=new L(1.5,1.5)):this.pickupItemType===3?(this.relic=new jr(fe,R.RelicMask.toSprite()),this.relic.scale=new L(1.5,1.5)):this.pickupItemType===4&&(this.relic=new jr(fe,R.RelicStatue.toSprite()),this.relic.scale=new L(1.5,1.5)),this.addChild(this.relic)),console.log(this.pickupState);else return}playPickupSound(){R.pickup2.play()}removePickedUpItem(t){t===0?this.treasure&&(this.treasure.kill(),this.treasure=null,this.pickupState=!1):t===1?this.trash&&(this.trash.kill(),this.trash=null,this.pickupState=!1):t===2&&this.relic&&(this.relic.kill(),this.relic=null,this.pickupState=!1),console.log(this.pickupState)}placeInMuseum(t){t===2?(console.log("hello"),this.engine.scenes.museum.setAmulet(),console.log("hi")):t===3?this.engine.scenes.museum.setMask():t===4&&this.engine.scenes.museum.setStatue()}}class Vi extends _t{constructor(t,e,i){super({width:e.width,height:e.height}),this.graphics.use(e),this.pos=t,this.scale=new L(1,1),this.type=i}onInitialize(t){this.on("collisionstart",e=>this.handleCollision(e))}handleCollision(t){t.other.owner instanceof fe&&t.other.owner.pickupState===!1&&(t.other.owner.pickupItem(this.type),this.kill())}}const R={Treasure:new dt("images/treasure_placeholder.webp"),DisplayEmpty:new dt("images/DisplayCase.png"),DisplayAmulet:new dt("images/DisplayCaseAmulet.png"),DisplayMask:new dt("images/DisplayCaseMask.png"),DisplayStatue:new dt("images/DisplayCaseStatue.png"),Screen:new dt("images/Window.png"),Background:new dt("images/ocean_background_temp.jpg"),oxygenTank:new dt("images/oxygenTank.png"),up1:new dt("images/up1.png"),SpeedUpgrade:new dt("images/speed_upgrade.png"),Bubbles:new dt("images/bubble.webp"),Diver1:new dt("images/diver1.png"),Diver2:new dt("images/diver2.png"),Catsuit:new dt("images/catsuit.png"),Anchor:new dt("images/Anchor.png"),Cage:new dt("images/Cage.png"),Gate:new dt("images/Gate.png"),RelicAmulet:new dt("images/amulet.png"),RelicMask:new dt("images/Mask.png"),RelicStatue:new dt("images/statue.png"),Packet:new dt("images/trash-sprites/drinkpacket-48x48.PNG"),Net:new dt("images/trash-sprites/fishnet-64x64.PNG"),PaintingShark:new dt("images/Painting_shark.png"),PaintingFish:new dt("images/Painting_Fish.png"),Pillar:new dt("images/pillar.png"),Door:new dt("images/door.png"),trashputinsound:new Os("sounds/trashputinsound.mp3"),trashpickup:new Os("sounds/pickuptrash.mp3"),pickup2:new Os("sounds/pickup2.mp3"),PutInTreasure:new Os("sounds/put-in-treasure.mp3"),BackgroundMusic:new Os("sounds/backgroundmusic.wav"),Fish1:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_73_xx.png"),Fish2:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_04_xx.png"),Fish3:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_08_xx.png"),Fish4:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_13_xx.png"),Fish5:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_20_xx.png"),Fish6:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_27_xx.png"),Fish7:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_30_xx.png"),Fish8:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_47_xx.png"),Fish9:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_48_xx.png"),Fish10:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_53_xx.png"),Fish11:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_67_xx.png"),Fish12:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_82_xx.png"),Fish13:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_85_xx.png"),Fish14:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_90_xx.png"),Fish15:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_93_xx.png"),Fish16:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_102_xx.png"),Fish17:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_109_xx.png"),Fish18:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_125_xx.png"),Fish19:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_135_xx.png"),Fish20:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_140_xx.png"),Fish21:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_143_xx.png"),Fish22:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_149_xx.png"),Fish23:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_154_xx.png"),Fish24:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_160_xx.png"),Fish25:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_164_xx.png"),Fish26:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_170_xx.png"),Fish27:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_171_xx.png"),Fish28:new dt("images/Beowulf_Fishes_Assets_Pack_size_64x64/spr_fish_01_xx.png")},Jr=new tA;for(let n of Object.values(R))Jr.addResource(n);const zg=""+new URL("../maps/level1.tmx",import.meta.url).href;class Og extends _t{onInitialize(t){const e=R.Background.toSprite();e.width=t.drawWidth+100,e.height=t.drawHeight+100,this.graphics.use(e),this.z=-100,this.pos=new L(t.drawWidth/2,t.drawHeight/2)}onPreUpdate(t){const e=t.currentScene.camera.pos,i=(s,r,o)=>s+(r-s)*o;this.pos=new L(i(this.pos.x,e.x,.1),i(this.pos.y,e.y,.1))}}class Hg extends Wa{constructor(t,e,i,s,r){super({pos:new L(t,e),anchor:L.Zero}),this.barWidth=i,this.barHeight=s,this.maxValue=r,this.value=r,this.background=new dh({width:this.barWidth,height:this.barHeight,color:Le.White}),this.redBar=new dh({width:this.barWidth,height:this.barHeight,color:Le.Red}),this.graphics.add(this.background),this.graphics.add(this.redBar)}setValue(t){this.value=Math.max(0,Math.min(this.maxValue,t)),this.redBar.width=this.barWidth*(this.value/this.maxValue)}}class qg extends Wa{labelP1;labelP2;labelTimer;oxygenBar;timerValue=60;maxTime=60;player1;player2;constructor(t,e){super(),this.player1=t,this.player2=e}onInitialize(t){this.labelP1=new Vs({text:"Score P1: 0",pos:new L(100,50),font:new ws({family:"Arial",size:24,color:Le.White})}),this.labelP2=new Vs({text:"Score P2: 0",pos:new L(100,100),font:new ws({family:"Arial",size:24,color:Le.White})}),this.labelTimer=new Vs({text:`Oxygen: ${this.timerValue}`,pos:new L(700,50),font:new ws({family:"Arial",size:24,color:Le.White})}),this.addChild(this.labelP1),this.addChild(this.labelP2),this.addChild(this.labelTimer),this.oxygenBar=new Hg(700,100,300,30,this.maxTime),this.addChild(this.oxygenBar),this.oxygenBar&&console.log("OxygenBar is initialized successfully."),this._lastTimerUpdate=t.clock.now()}updateScore(){this.labelP1.text=`Score P1: ${this.player1.score}`,this.labelP2.text=`Score P2: ${this.player2.score}`}onPostUpdate(t){t.clock.now()-this._lastTimerUpdate>1e3&&this.timerValue>0&&(this.timerValue-=1,this.labelTimer&&(this.labelTimer.text=`Oxygen: ${this.timerValue}`),this.oxygenBar.setValue(this.timerValue),this._lastTimerUpdate=t.clock.now(),this.timerValue===0&&t.goToGameOver&&t.goToGameOver())}}class Ps extends _t{#t=200;score=0;sprite;keyleft;keyright;constructor(t,e,i,s,r){super({pos:t,width:R.Diver1.width,height:R.Diver1.height,collisionType:cs.Active}),this.sprite=s,this.keyleft=e,this.keyright=i,this.gamepadIndex=r}onInitialize(t){this.graphics.use(this.sprite),this.on("collisionstart",e=>this.handleCollision(e))}handleCollision(t){}onPreUpdate(t){let e=0,i=this.vel.y;t.input.keyboard.isHeld(this.keyleft)&&(e=-this.#t),t.input.keyboard.isHeld(this.keyright)&&(e=this.#t);const s=t.input.gamepads.at(this.gamepadIndex);s&&s.connected&&(e=(s.getAxes(0)??0)*this.#t),this.vel=new L(e,i)}increaseOxygenBar(t){this.oxygenBarLength+=50}increaseSpeed(t){this.#t+=50}}class Gc extends _t{sprite;constructor(t,e,i,s){super({pos:t,width:e.width,height:e.height}),this.location=s,this.playerOverlapping=!1,this.sprite=e,this.scale=i}onInitialize(t){this.graphics.use(this.sprite).scale=this.scale,this.engine=t,this.on("collisionstart",e=>this.handleCollisionStart(e)),this.on("collisionend",e=>this.handleCollisionEnd(e))}handleCollisionStart(t){(t.other.owner instanceof fe||t.other.owner instanceof Ps)&&(this.playerOverlapping=!0,this.engine.dialog.makeVisible())}handleCollisionEnd(t){(t.other.owner instanceof fe||t.other.owner instanceof Ps)&&(this.playerOverlapping=!1,this.engine.dialog.makeInvisible())}onPreUpdate(){this.playerOverlapping&&this.engine.input.keyboard.wasPressed(Pe.E)&&this.scene.engine.goToScene(this.location)}leaveTeleport(t){t.other.owner instanceof fe&&(this.player1In=!1),t.other.owner instanceof Player2&&(this.player2In=!1)}}class Wg extends _t{constructor(t,e,i){super({pos:t,width:e,height:i,color:Le.DarkGray,collisionType:cs.Fixed})}}class ds extends _t{constructor(t,e,i){super({pos:t,width:R.DisplayEmpty.width,height:R.DisplayEmpty.height}),this.value=e,this.sprite=i}onInitialize(t){this.value===!0?(this.graphics.use(this.sprite),this.scale=new L(2,2)):(this.graphics.use(R.DisplayEmpty.toSprite()),this.scale=new L(2,2))}}class Go extends _t{constructor(t){super({pos:t,width:64,height:64})}onInitialize(t){const e=R.up1.toSprite();e.width=64,e.height=64,this.graphics.use(e),this.on("pointerdown",i=>this.onClick(i,t))}onClick(t,e){e.currentScene.actors.forEach(i=>{(i instanceof fe||i instanceof Ps)&&(i.score===2||i.score===3||i.score===4)&&(e.ui&&typeof e.ui.timerValue=="number"&&(e.ui.timerValue=Math.min(e.ui.timerValue,60),e.ui.oxygenBar.setValue(e.ui.timerValue),e.ui.maxTime=70,e.ui.oxygenBar.maxValue=70,e.ui.timerValue=70,e.ui.oxygenBar.setValue(e.ui.timerValue),e.ui.labelTimer.text=`Oxygen: ${e.ui.timerValue}`),typeof i.increaseOxygenBar=="function"?i.increaseOxygenBar(50):i.oxygenBarLength=(i.oxygenBarLength||100)+50,this.kill())})}}class jg extends _t{constructor(t){super({pos:t,width:64,height:64})}onInitialize(t){const e=R.Catsuit.toSprite();e.width=64,e.height=64,this.graphics.use(e)}}class no extends _t{sprite;constructor(t,e){super({pos:t,width:e.width,height:e.height}),this.sprite=e}onInitialize(){this.graphics.use(this.sprite)}}class No extends _t{constructor(t){super({pos:t,width:64,height:64})}onInitialize(t){const e=R.SpeedUpgrade.toSprite();e.width=64,e.height=64,this.graphics.use(e),this.on("pointerdown",i=>this.onClick(i,t))}onClick(t,e){e.currentScene.actors.forEach(i=>{(i instanceof fe||i instanceof Ps)&&(i.score===2||i.score===3||i.score===4)&&(typeof i.increaseSpeed=="function"?i.increaseSpeed(300):i.speed=(i.speed||200)+300,this.kill())})}}class Ih extends _t{constructor(t,e,i){super({pos:t,width:e,height:i,collisionType:cs.Fixed})}onInitialize(){this.graphics.use(R.Pillar.toSprite()).scale=new L(.3,.3)}}class Yg extends uc{player;player2;cameraTarget;amulet=!1;mask=!1;statue=!1;setAmulet(){this.amulet=!0,this.refreshDisplayCases()}setMask(){this.mask=!0,this.refreshDisplayCases()}setStatue(){this.statue=!0,this.refreshDisplayCases()}refreshDisplayCases(){this.displayCaseAmulet&&this.displayCaseAmulet.kill(),this.displayCaseMask&&this.displayCaseMask.kill(),this.displayCaseStatue&&this.displayCaseStatue.kill(),this.displayCaseAmulet=new ds(new L(400,625),this.amulet,R.DisplayAmulet.toSprite()),this.add(this.displayCaseAmulet),this.displayCaseMask=new ds(new L(640,625),this.mask,R.DisplayMask.toSprite()),this.add(this.displayCaseMask),this.displayCaseStatue=new ds(new L(880,625),this.statue,R.DisplayStatue.toSprite()),this.add(this.displayCaseStatue)}onInitialize(t){t.backgroundColor=Le.LightGray;const e=new Ps(new L(350,620),Pe.A,Pe.D,R.Diver1.toSprite(),0);e.score=2,this.add(e);const i=new Ps(new L(400,620),Pe.Left,Pe.Right,R.Diver2.toSprite(),1);e.score=2,this.add(i);const s=new Gc(new L(200,600),R.Door.toSprite(),new L(.6,.6),"root");this.add(s);const r=new Wg(new L(640,700),1280,100);this.add(r);const o=new Ih(new L(0,350),100,1280);this.add(o);const a=new Ih(new L(1280,350),100,1280);this.add(a);const h=new no(new L(650,400),R.Screen.toSprite());h.scale=new L(1.5,1.5),this.add(h);const l=new no(new L(200,400),R.PaintingShark.toSprite());this.add(l);const c=new no(new L(1100,400),R.PaintingFish.toSprite());this.add(c);const d=new ds(new L(500,625),this.amulet,R.DisplayAmulet.toSprite());this.add(d);const A=new ds(new L(690,625),this.mask,R.DisplayMask.toSprite());this.add(A);const u=new ds(new L(880,625),this.mask,R.DisplayStatue.toSprite());this.add(u);const p=new Go(new L(1180,590));this.add(p);const v=new No(new L(1100,590));this.add(v);const C=new jg(new L(1030,619));this.add(C);const y=new _t;y.pos=new L(e.pos.x,350),this.add(y),this.camera.strategy.lockToActor(y),this.player=e,this.cameraTarget=y,this.player2=i}onPostUpdate(){let t=(this.player.pos.x+this.player2.pos.x)/2;t=Math.max(640,Math.min(640,t)),this.cameraTarget.pos=new L(t,350)}}class Vg extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}onInitialize(){}getDescription(){return this.#t="The rainbow fish is one of the most pretty fish in the sea, even sharks don't eat them due to their pretty colors",this.#t}getColor(){return this.#e="Rainbow",this.#e}getRarity(){return this.#i="Very rare",this.#i}getName(){return this.#s="Rainbow Jack",this.#s}}class Zg extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish2",this.#t}getColor(){return this.#e="Red",this.#e}getRarity(){return this.#i="Common",this.#i}getName(){return this.#s="Red snapper",this.#s}}class Xg extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish3",this.#t}getColor(){return this.#e="Red and yellow",this.#e}getRarity(){return this.#i="Uncommon",this.#i}getName(){return this.#s="Red grouper",this.#s}}class Jg extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish14",this.#t}getColor(){return this.#e="Grey",this.#e}getRarity(){return this.#i="Common",this.#i}getName(){return this.#s="Trapon",this.#s}}class Kg extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish5",this.#t}getColor(){return this.#e="Purple",this.#e}getRarity(){return this.#i="Rare",this.#i}getName(){return this.#s="Purple grouper",this.#s}}class $g extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish6",this.#t}getColor(){return this.#e="A kind of purple",this.#e}getRarity(){return this.#i="Uncommon",this.#i}getName(){return this.#s="Sharkcarp",this.#s}}class tp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish7",this.#t}getColor(){return this.#e="Pink with white",this.#e}getRarity(){return this.#i="Common",this.#i}getName(){return this.#s="Shrimp barracuda",this.#s}}class ep extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish8",this.#t}getColor(){return this.#e="Grey",this.#e}getRarity(){return this.#i="Uncommon",this.#i}getName(){return this.#s="Grey eel",this.#s}}class ip extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish9",this.#t}getColor(){return this.#e="Purple",this.#e}getRarity(){return this.#i="Rare",this.#i}getName(){return this.#s="Change eel",this.#s}}class sp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish10",this.#t}getColor(){return this.#e="Yellow",this.#e}getRarity(){return this.#i="Common",this.#i}getName(){return this.#s="Flounder grouper",this.#s}}class rp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="This odd fella has huge eyes and tends to live more near the shores.",this.#t}getColor(){return this.#e="Grey",this.#e}getRarity(){return this.#i="Uncommon",this.#i}getName(){return this.#s="Goober grouper",this.#s}}class np extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish12",this.#t}getColor(){return this.#e="Blue",this.#e}getRarity(){return this.#i="Uncommon",this.#i}getName(){return this.#s="Blue starfish",this.#s}}class op extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="A friendly crab that's often found chilling close to divers, occasionally coming closer to take a curious look at divers",this.#t}getColor(){return this.#e="Golden yellow",this.#e}getRarity(){return this.#i="Rare",this.#i}getName(){return this.#s="Sabastian crab",this.#s}}class ap extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Despite it's name the Dash Seahorse isn't all that fast.",this.#t}getColor(){return this.#e="Blue",this.#e}getRarity(){return this.#i="Uncommon",this.#i}getName(){return this.#s="Dash seahorse",this.#s}}class hp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish15",this.#t}getColor(){return this.#e="Blue",this.#e}getRarity(){return this.#i="Common",this.#i}getName(){return this.#s="Corfi lobster",this.#s}}class lp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish16",this.#t}getColor(){return this.#e="Purple with green",this.#e}getRarity(){return this.#i="Rare",this.#i}getName(){return this.#s="Joker Tuna",this.#s}}class cp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish17",this.#t}getColor(){return this.#e="Blue",this.#e}getRarity(){return this.#i="Common",this.#i}getName(){return this.#s="Dolphin Marlin",this.#s}}class dp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish18",this.#t}getColor(){return this.#e="Green",this.#e}getRarity(){return this.#i="Common",this.#i}getName(){return this.#s="Piranha snapper",this.#s}}class up extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="This fish likes it to copy other fish their looks for survival purpuses. Without disguise it's a grey fish.",this.#t}getColor(){return this.#e="Grey",this.#e}getRarity(){return this.#i="Common",this.#i}getName(){return this.#s="Copycat Snapper",this.#s}}class Ap extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="A very rare fish, only a few have ever been seen. If two find to happen each other they tend to end up in a fight over their territory.",this.#t}getColor(){return this.#e="Green",this.#e}getRarity(){return this.#i="Extremely rare",this.#i}getName(){return this.#s="KingFish",this.#s}}class gp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish21",this.#t}getColor(){return this.#e="Blue",this.#e}getRarity(){return this.#i="Rare",this.#i}getName(){return this.#s="RiverSnapper",this.#s}}class pp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish22",this.#t}getColor(){return this.#e="Red",this.#e}getRarity(){return this.#i="Rare",this.#i}getName(){return this.#s="Mr.red crab",this.#s}}class fp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish23",this.#t}getColor(){return this.#e="Yellow",this.#e}getRarity(){return this.#i="Common",this.#i}getName(){return this.#s="Bolding Seahorse",this.#s}}class _p extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish24",this.#t}getColor(){return this.#e="Purple",this.#e}getRarity(){return this.#i="Common",this.#i}getName(){return this.#s="Giant Pacific Octopus",this.#s}}class mp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish25",this.#t}getColor(){return this.#e="Purple",this.#e}getRarity(){return this.#i="Common",this.#i}getName(){return this.#s="Jelly sir. Fish",this.#s}}class vp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish26",this.#t}getColor(){return this.#e="Yellow",this.#e}getRarity(){return this.#i="Uncommon",this.#i}getName(){return this.#s="Yellow Betta Fish",this.#s}}class wp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish27",this.#t}getColor(){return this.#e="Pink",this.#e}getRarity(){return this.#i="Rare",this.#i}getName(){return this.#s="Pink Betta Fish",this.#s}}class yp extends _t{#t;#e;#i;#s;constructor(t){super({width:R.Fish1.width,height:R.Fish1.height})}getDescription(){return this.#t="Fish28",this.#t}getColor(){return this.#e="Brown",this.#e}getRarity(){return this.#i="Common",this.#i}getName(){return this.#s="Brown Scarus",this.#s}}class Cp extends _t{#t;#e;#i;#s;sprite;chosenFish;loopFish;name;#r;startingxPos;startingyPos;constructor(t,e,i){super({collisionType:cs.Active}),this.pos=t,this.body.useGravity=!1,this.startingxPos=e,this.startingyPos=i,this.#r=!0}onInitialize(){const t=Math.floor(Math.random()*27+1);this.chosenFish=`Fish${t}`,this.#t=t,this.#o(),this.#n()}#n(){let t=Math.floor(Math.random()*500-Math.floor(Math.random()*500)),e=Math.floor(Math.random()*500-Math.floor(Math.random()*500)),i=Math.floor(Math.random()*500-Math.floor(Math.random()*500)),s=Math.floor(Math.random()*300-Math.floor(Math.random()*300)),r=Math.floor(Math.random()*300-Math.floor(Math.random()*300)),o=Math.floor(Math.random()*300-Math.floor(Math.random()*300)),a=Math.floor(Math.random()*3e3),h;setTimeout(()=>{for(let l=0;l<40;l++)h=Math.floor(Math.random()*40+20),t>this.startingxPos?(console.log(`right: ${t} vs ${this.startingxPos}`),this.graphics.flipHorizontal=!1):t<this.startingxPos&&(console.log(`left ${t} vs ${this.startingxPos}`),this.graphics.flipHorizontal=!0),this.actions.moveTo(new L(t,s),h).delay(a),a=Math.floor(Math.random()*3e3),h=Math.floor(Math.random()*40+20),e>t?(console.log(`right ${e} vs ${t}`),this.graphics.flipHorizontal=!1):e<t&&(console.log(`left ${e} vs ${t}`),this.graphics.flipHorizontal=!0),this.actions.moveTo(new L(e,r),h).delay(a),a=Math.floor(Math.random()*3e3),h=Math.floor(Math.random()*40+20),i>e?(console.log(`right ${i} vs ${e}`),this.graphics.flipHorizontal=!1):i<e&&(console.log(`left ${i} vs ${e}`),this.graphics.flipHorizontal=!0),this.actions.moveTo(new L(i,o),h).delay(a),console.log("moved"),console.log(t,e,i,s,r,o),t=Math.floor(Math.random()*400+50),e=Math.floor(Math.random()*400+50),i=Math.floor(Math.random()*400+50),s=Math.floor(Math.random()*400+50),r=Math.floor(Math.random()*400+50),o=Math.floor(Math.random()*400+50)},1e3)}#o(){switch(this.#t){case 1:this.graphics.use(R.Fish1.toSprite()),this.loopFish=new Vg;break;case 2:this.graphics.use(R.Fish2.toSprite()),this.loopFish=new Zg;break;case 3:this.graphics.use(R.Fish3.toSprite()),this.loopFish=new Xg;break;case 4:this.graphics.use(R.Fish4.toSprite()),this.loopFish=new Jg;break;case 5:this.graphics.use(R.Fish5.toSprite()),this.loopFish=new Kg;break;case 6:this.graphics.use(R.Fish6.toSprite()),this.loopFish=new $g;break;case 7:this.graphics.use(R.Fish7.toSprite()),this.loopFish=new tp;break;case 8:this.graphics.use(R.Fish8.toSprite()),this.loopFish=new ep;break;case 9:this.graphics.use(R.Fish9.toSprite()),this.loopFish=new ip;break;case 10:this.graphics.use(R.Fish10.toSprite()),this.loopFish=new sp;break;case 11:this.graphics.use(R.Fish11.toSprite()),this.loopFish=new rp;break;case 12:this.graphics.use(R.Fish12.toSprite()),this.loopFish=new np;break;case 13:this.graphics.use(R.Fish13.toSprite()),this.loopFish=new op;break;case 14:this.graphics.use(R.Fish14.toSprite()),this.loopFish=new ap;break;case 15:this.graphics.use(R.Fish15.toSprite()),this.loopFish=new hp;break;case 16:this.graphics.use(R.Fish16.toSprite()),this.loopFish=new lp;break;case 17:this.graphics.use(R.Fish17.toSprite()),this.loopFish=new cp;break;case 18:this.graphics.use(R.Fish18.toSprite()),this.loopFish=new dp;break;case 19:this.graphics.use(R.Fish19.toSprite()),this.loopFish=new up;break;case 20:this.graphics.use(R.Fish20.toSprite()),this.loopFish=new Ap;break;case 21:this.graphics.use(R.Fish21.toSprite()),this.loopFish=new gp;break;case 22:this.graphics.use(R.Fish22.toSprite()),this.loopFish=new pp;break;case 23:this.graphics.use(R.Fish23.toSprite()),this.loopFish=new fp;break;case 24:this.graphics.use(R.Fish24.toSprite()),this.loopFish=new _p;break;case 25:this.graphics.use(R.Fish25.toSprite()),this.loopFish=new mp;break;case 26:this.graphics.use(R.Fish26.toSprite()),this.loopFish=new vp;break;case 27:this.graphics.use(R.Fish27.toSprite()),this.loopFish=new wp;break;case 28:this.graphics.use(R.Fish28.toSprite()),this.loopFish=new yp;break}this.#s=this.loopFish.getDescription(),this.#i=this.loopFish.getColor(),this.#e=this.loopFish.getRarity(),this.name=this.loopFish.getName(),console.log(this.#s),console.log(this.#i),console.log(this.#e),console.log(this.name)}}class xp extends Wa{constructor(t){super({width:700,height:100,color:Le.White,anchor:new L(.05,.05),pos:new L(300,550),opacity:0}),this.text=t}onInitialize(t){this.dialog=new Vs({text:this.text,anchor:new L(0,0),font:new ws({size:32,unit:dc.Px,color:Le.Black})}),this.addChild(this.dialog)}makeVisible(){this.graphics.opacity=.8}makeInvisible(){this.graphics.opacity=0}}class Eh{static resetPickupsAndObjects(t){t.currentScene.actors.forEach(r=>{(r instanceof xs||r instanceof Vi||r.constructor.name==="Trash"||r instanceof Tr)&&r.kill()}),Zs.splice(0,Zs.length,new L(1376,1136),new L(512,1200),new L(768,1808),new L(832,4016),new L(1552,2400),new L(1568,1424),new L(224,2784),new L(112,2256),new L(368,3568),new L(1248,3936),new L(1312,4576)),Xs.splice(0,Xs.length,new L(1370,1136),new L(508,1200),new L(760,1808),new L(825,4016),new L(1544,2400),new L(1560,1424),new L(220,2784),new L(106,2256),new L(361,3568),new L(1240,3936),new L(1305,4576));for(let r=0;r<Zs.length;r++){const o=new xs(R.Treasure.toSprite(),0);t.add(o)}for(let r=0;r<Xs.length;r++){const o=new xs(R.Packet.toSprite(),1);t.add(o)}const e=new Vi(new L(192,2064),R.RelicAmulet.toSprite(),"amulet"),i=new Vi(new L(192,4224),R.RelicMask.toSprite(),"mask"),s=new Vi(new L(1168,5344),R.RelicStatue.toSprite(),"statue");t.add(e),t.add(i),t.add(s),t.bubbles=new Tr,t.add(t.bubbles)}static resetMuseumUpgrades(t){t.actors.forEach(s=>{(s instanceof Go||s instanceof No)&&s.kill()});const e=new Go(new L(840,590));t.add(e);const i=new No(new L(940,590));t.add(i)}}class bp extends uc{onInitialize(t){this.showGameOverLabel(),this.resetAndReturn(t)}showGameOverLabel(){const t=new Vs({text:"Game Over",pos:new L(500,350),font:new ws({family:"Arial",size:48,color:Le.Red})});this.add(t)}resetAndReturn(t){setTimeout(()=>{this.resetPlayers(t),this.resetUI(t),this.resetCamera(t),Eh.resetPickupsAndObjects(t),t.scenes&&t.scenes.museum&&Eh.resetMuseumUpgrades(t.scenes.museum),t.goToScene("root")},5e3)}resetPlayers(t){t.player1&&(t.player1.treasure&&(t.player1.treasure.kill(),t.player1.treasure=null),t.player1.trash&&(t.player1.trash.kill(),t.player1.trash=null),t.player1.score=0,t.player1.pos=new L(100,200),t.player1.vel=new L(0,0),t.player1.pickupState=!1,t.player1.pickupItemType=null,t.player1.speed=300,t.player1.objectSpeed=150,t.player1.oxygenBarLength=100),t.player2&&(t.player2.treasure&&(t.player2.treasure.kill(),t.player2.treasure=null),t.player2.trash&&(t.player2.trash.kill(),t.player2.trash=null),t.player2.score=0,t.player2.pos=new L(200,200),t.player2.vel=new L(0,0),t.player2.pickupState=!1,t.player2.pickupItemType=null,t.player2.speed=250,t.player2.objectSpeed=200,t.player2.oxygenBarLength=100)}resetUI(t){t.ui&&(t.ui.timerValue=60,t.ui.maxTime=60,t.ui.oxygenBar&&(t.ui.oxygenBar.maxValue=60,t.ui.oxygenBar.setValue(60)),t.ui.labelTimer&&(t.ui.labelTimer.text="Oxygen: 60"),t.ui.player1.score=0,t.ui.player2.score=0,t.ui.updateScore())}resetCamera(t){if(t.player1&&t.player2&&t.cameraTarget){const e=(t.player1.pos.x+t.player2.pos.x)/2,i=(t.player1.pos.y+t.player2.pos.y)/2;t.cameraTarget.pos.x=Math.round(e),t.cameraTarget.pos.y=Math.round(i)}}}class Ip extends Xu{player1;player2;cameraTarget;ui;constructor(){super({width:1280,height:720,maxFps:60,displayMode:Zu.Fixed,suppressPlayButton:!0,physics:{solver:rA.Arcade,gravity:new L(0,10)}}),this.add("museum",new Yg),this.add("gameover",new bp),this.tiledMap=new Gg(zg),Jr.addResource(this.tiledMap),this.start(Jr).then(()=>{R.BackgroundMusic.loop=!0,R.BackgroundMusic.volume=.5;try{this.input.gamepads.setMinimumGamepadConfiguration({axis:2,buttons:6})}catch(t){console.warn("Kon minimum gamepad config niet zetten:",t)}this.start(Jr).then(()=>this.startGame())}),this.showDebug(!0)}startGame(){this.tiledMap.addToScene(this.currentScene);const t=new Og;this.add(t);const e=new fe(new L(100,200),Pe.W,Pe.S,Pe.A,Pe.D,0,R.Diver1.toSprite(),300,150);this.add(e);const i=new fe(new L(200,200),Pe.Up,Pe.Down,Pe.Left,Pe.Right,1,R.Diver2.toSprite(),250,200);this.add(i);const s=new _t;s.pos=e.pos.clone(),this.add(s),this.currentScene.camera.strategy.lockToActor(s);for(let d=0;d<Zs.length;d++){const A=new xs(R.Treasure.toSprite(),0);this.add(A)}for(let d=0;d<Xs.length;d++){const A=new xs(R.Packet.toSprite(),1);this.add(A)}const r=new Vi(new L(192,2064),R.RelicAmulet.toSprite(),2),o=new Vi(new L(192,4224),R.RelicMask.toSprite(),3),a=new Vi(new L(1168,5344),R.RelicStatue.toSprite(),4);this.add(r),this.add(o),this.add(a);const h=new Gc(new L(1e3,550),R.Anchor.toSprite(),new L(2,2),"museum");this.add(h);const l=new Uo(new L(500,100));this.add(l);const c=new Uc(new L(300,100));this.add(c),this.player1=e,this.player2=i,this.cameraTarget=s,this.spawnFish(new L(400,300),400,300),this.ui=new qg(e,i),this.add(this.ui),this.bubbles=new Tr,this.add(this.bubbles),this.fixedBubbles=new Tr(!0),this.add(this.fixedBubbles),console.log("Bubbles Spawned at coordinates:",this.fixedBubbles.x,this.fixedBubbles.y),R.BackgroundMusic.loop=!0,R.BackgroundMusic.volume=.5,R.BackgroundMusic.play(),this.dialog=new xp("Do you want to enter the museum? (e)"),this.add(this.dialog)}onPostUpdate(){if(this.player1&&this.player2&&this.cameraTarget){const t=(this.player1.pos.x+this.player2.pos.x)/2,e=(this.player1.pos.y+this.player2.pos.y)/2;this.cameraTarget.pos.x=Math.round(t),this.cameraTarget.pos.y=Math.round(e)}}getGamepadAxes(){let t=0,e=0,i=this.input.gamepads.at(0);if(i&&i.connected)t=i.getAxes(0)??0,e=i.getAxes(1)??0;else{const s=navigator.getGamepads();s&&s[0]&&s[0].connected&&(t=s[0].axes[0]??0,e=s[0].axes[1]??0)}return[t,e]}getCameraBounds(){const t=this.currentScene.camera,e=this.drawWidth,i=this.drawHeight,s=t.x-e/2,r=t.x+e/2,o=t.y-i/2,a=t.y+i/2;return{left:s,right:r,top:o,bottom:a}}spawnFish(t){const e=new Cp(t);this.add(e)}goToGameOver(){this.goToScene("gameover")}}new Ip;export{Ip as Game};
